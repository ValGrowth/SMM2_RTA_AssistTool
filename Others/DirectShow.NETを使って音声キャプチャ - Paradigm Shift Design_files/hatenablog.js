(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
module.exports = require('./lib/axios');
},{"./lib/axios":3}],2:[function(require,module,exports){
(function (process){
'use strict';

var utils = require('./../utils');
var buildURL = require('./../helpers/buildURL');
var parseHeaders = require('./../helpers/parseHeaders');
var transformData = require('./../helpers/transformData');
var isURLSameOrigin = require('./../helpers/isURLSameOrigin');
var btoa = (typeof window !== 'undefined' && window.btoa) || require('./../helpers/btoa');

module.exports = function xhrAdapter(resolve, reject, config) {
  var requestData = config.data;
  var requestHeaders = config.headers;

  if (utils.isFormData(requestData)) {
    delete requestHeaders['Content-Type']; // Let the browser set it
  }

  var request = new XMLHttpRequest();
  var loadEvent = 'onreadystatechange';
  var xDomain = false;

  // For IE 8/9 CORS support
  // Only supports POST and GET calls and doesn't returns the response headers.
  // DON'T do this for testing b/c XMLHttpRequest is mocked, not XDomainRequest.
  if (process.env.NODE_ENV !== 'test' && typeof window !== 'undefined' && window.XDomainRequest && !('withCredentials' in request) && !isURLSameOrigin(config.url)) {
    request = new window.XDomainRequest();
    loadEvent = 'onload';
    xDomain = true;
  }

  // HTTP basic authentication
  if (config.auth) {
    var username = config.auth.username || '';
    var password = config.auth.password || '';
    requestHeaders.Authorization = 'Basic ' + btoa(username + ':' + password);
  }

  request.open(config.method.toUpperCase(), buildURL(config.url, config.params, config.paramsSerializer), true);

  // Set the request timeout in MS
  request.timeout = config.timeout;

  // For IE 9 CORS support.
  request.onprogress = function handleProgress() {};
  request.ontimeout = function handleTimeout() {};

  // Listen for ready state
  request[loadEvent] = function handleLoad() {
    if (!request || (request.readyState !== 4 && !xDomain)) {
      return;
    }

    // The request errored out and we didn't get a response, this will be
    // handled by onerror instead
    if (request.status === 0) {
      return;
    }

    // Prepare the response
    var responseHeaders = 'getAllResponseHeaders' in request ? parseHeaders(request.getAllResponseHeaders()) : null;
    var responseData = !config.responseType || config.responseType === 'text' ? request.responseText : request.response;
    var response = {
      data: transformData(
        responseData,
        responseHeaders,
        config.transformResponse
      ),
      // IE sends 1223 instead of 204 (https://github.com/mzabriskie/axios/issues/201)
      status: request.status === 1223 ? 204 : request.status,
      statusText: request.status === 1223 ? 'No Content' : request.statusText,
      headers: responseHeaders,
      config: config,
      request: request
    };

    // Resolve or reject the Promise based on the status
    ((response.status >= 200 && response.status < 300) ||
     (!('status' in request) && request.responseText) ?
      resolve :
      reject)(response);

    // Clean up request
    request = null;
  };

  // Handle low level network errors
  request.onerror = function handleError() {
    // Real errors are hidden from us by the browser
    // onerror should only fire if it's a network error
    reject(new Error('Network Error'));

    // Clean up request
    request = null;
  };

  // Handle timeout
  request.ontimeout = function handleTimeout() {
    var err = new Error('timeout of ' + config.timeout + 'ms exceeded');
    err.timeout = config.timeout;
    err.code = 'ECONNABORTED';
    reject(err);

    // Clean up request
    request = null;
  };

  // Add xsrf header
  // This is only done if running in a standard browser environment.
  // Specifically not if we're in a web worker, or react-native.
  if (utils.isStandardBrowserEnv()) {
    var cookies = require('./../helpers/cookies');

    // Add xsrf header
    var xsrfValue = config.withCredentials || isURLSameOrigin(config.url) ?
        cookies.read(config.xsrfCookieName) :
        undefined;

    if (xsrfValue) {
      requestHeaders[config.xsrfHeaderName] = xsrfValue;
    }
  }

  // Add headers to the request
  if ('setRequestHeader' in request) {
    utils.forEach(requestHeaders, function setRequestHeader(val, key) {
      if (typeof requestData === 'undefined' && key.toLowerCase() === 'content-type') {
        // Remove Content-Type if data is undefined
        delete requestHeaders[key];
      } else {
        // Otherwise add header to the request
        request.setRequestHeader(key, val);
      }
    });
  }

  // Add withCredentials to request if needed
  if (config.withCredentials) {
    request.withCredentials = true;
  }

  // Add responseType to request if needed
  if (config.responseType) {
    try {
      request.responseType = config.responseType;
    } catch (e) {
      if (request.responseType !== 'json') {
        throw e;
      }
    }
  }

  // Handle progress if needed
  if (config.progress) {
    if (config.method === 'post' || config.method === 'put') {
      request.upload.addEventListener('progress', config.progress);
    } else if (config.method === 'get') {
      request.addEventListener('progress', config.progress);
    }
  }

  // Format request data
  if (utils.isArrayBuffer(requestData)) {
    requestData = new DataView(requestData);
  }

  if (requestData === undefined) {
    requestData = null;
  }

  // Send the request
  request.send(requestData);
};

}).call(this,require('_process'))
},{"./../helpers/btoa":8,"./../helpers/buildURL":9,"./../helpers/cookies":11,"./../helpers/isURLSameOrigin":13,"./../helpers/parseHeaders":14,"./../helpers/transformData":16,"./../utils":17,"_process":211}],3:[function(require,module,exports){
'use strict';

var defaults = require('./defaults');
var utils = require('./utils');
var dispatchRequest = require('./core/dispatchRequest');
var InterceptorManager = require('./core/InterceptorManager');
var isAbsoluteURL = require('./helpers/isAbsoluteURL');
var combineURLs = require('./helpers/combineURLs');
var bind = require('./helpers/bind');
var transformData = require('./helpers/transformData');

function Axios(defaultConfig) {
  this.defaults = utils.merge({}, defaultConfig);
  this.interceptors = {
    request: new InterceptorManager(),
    response: new InterceptorManager()
  };
}

Axios.prototype.request = function request(config) {
  /*eslint no-param-reassign:0*/
  // Allow for axios('example/url'[, config]) a la fetch API
  if (typeof config === 'string') {
    config = utils.merge({
      url: arguments[0]
    }, arguments[1]);
  }

  config = utils.merge(defaults, this.defaults, { method: 'get' }, config);

  // Support baseURL config
  if (config.baseURL && !isAbsoluteURL(config.url)) {
    config.url = combineURLs(config.baseURL, config.url);
  }

  // Don't allow overriding defaults.withCredentials
  config.withCredentials = config.withCredentials || this.defaults.withCredentials;

  // Transform request data
  config.data = transformData(
    config.data,
    config.headers,
    config.transformRequest
  );

  // Flatten headers
  config.headers = utils.merge(
    config.headers.common || {},
    config.headers[config.method] || {},
    config.headers || {}
  );

  utils.forEach(
    ['delete', 'get', 'head', 'post', 'put', 'patch', 'common'],
    function cleanHeaderConfig(method) {
      delete config.headers[method];
    }
  );

  // Hook up interceptors middleware
  var chain = [dispatchRequest, undefined];
  var promise = Promise.resolve(config);

  this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor) {
    chain.unshift(interceptor.fulfilled, interceptor.rejected);
  });

  this.interceptors.response.forEach(function pushResponseInterceptors(interceptor) {
    chain.push(interceptor.fulfilled, interceptor.rejected);
  });

  while (chain.length) {
    promise = promise.then(chain.shift(), chain.shift());
  }

  return promise;
};

var defaultInstance = new Axios(defaults);
var axios = module.exports = bind(Axios.prototype.request, defaultInstance);

// Expose properties from defaultInstance
axios.defaults = defaultInstance.defaults;
axios.interceptors = defaultInstance.interceptors;

// Factory for creating new instances
axios.create = function create(defaultConfig) {
  return new Axios(defaultConfig);
};

// Expose all/spread
axios.all = function all(promises) {
  return Promise.all(promises);
};
axios.spread = require('./helpers/spread');

// Provide aliases for supported request methods
utils.forEach(['delete', 'get', 'head'], function forEachMethodNoData(method) {
  /*eslint func-names:0*/
  Axios.prototype[method] = function(url, config) {
    return this.request(utils.merge(config || {}, {
      method: method,
      url: url
    }));
  };
  axios[method] = bind(Axios.prototype[method], defaultInstance);
});

utils.forEach(['post', 'put', 'patch'], function forEachMethodWithData(method) {
  /*eslint func-names:0*/
  Axios.prototype[method] = function(url, data, config) {
    return this.request(utils.merge(config || {}, {
      method: method,
      url: url,
      data: data
    }));
  };
  axios[method] = bind(Axios.prototype[method], defaultInstance);
});

},{"./core/InterceptorManager":4,"./core/dispatchRequest":5,"./defaults":6,"./helpers/bind":7,"./helpers/combineURLs":10,"./helpers/isAbsoluteURL":12,"./helpers/spread":15,"./helpers/transformData":16,"./utils":17}],4:[function(require,module,exports){
'use strict';

var utils = require('./../utils');

function InterceptorManager() {
  this.handlers = [];
}

/**
 * Add a new interceptor to the stack
 *
 * @param {Function} fulfilled The function to handle `then` for a `Promise`
 * @param {Function} rejected The function to handle `reject` for a `Promise`
 *
 * @return {Number} An ID used to remove interceptor later
 */
InterceptorManager.prototype.use = function use(fulfilled, rejected) {
  this.handlers.push({
    fulfilled: fulfilled,
    rejected: rejected
  });
  return this.handlers.length - 1;
};

/**
 * Remove an interceptor from the stack
 *
 * @param {Number} id The ID that was returned by `use`
 */
InterceptorManager.prototype.eject = function eject(id) {
  if (this.handlers[id]) {
    this.handlers[id] = null;
  }
};

/**
 * Iterate over all the registered interceptors
 *
 * This method is particularly useful for skipping over any
 * interceptors that may have become `null` calling `eject`.
 *
 * @param {Function} fn The function to call for each interceptor
 */
InterceptorManager.prototype.forEach = function forEach(fn) {
  utils.forEach(this.handlers, function forEachHandler(h) {
    if (h !== null) {
      fn(h);
    }
  });
};

module.exports = InterceptorManager;

},{"./../utils":17}],5:[function(require,module,exports){
(function (process){
'use strict';

/**
 * Dispatch a request to the server using whichever adapter
 * is supported by the current environment.
 *
 * @param {object} config The config that is to be used for the request
 * @returns {Promise} The Promise to be fulfilled
 */
module.exports = function dispatchRequest(config) {
  return new Promise(function executor(resolve, reject) {
    try {
      var adapter;

      if (typeof config.adapter === 'function') {
        // For custom adapter support
        adapter = config.adapter;
      } else if (typeof XMLHttpRequest !== 'undefined') {
        // For browsers use XHR adapter
        adapter = require('../adapters/xhr');
      } else if (typeof process !== 'undefined') {
        // For node use HTTP adapter
        adapter = require('../adapters/http');
      }

      if (typeof adapter === 'function') {
        adapter(resolve, reject, config);
      }
    } catch (e) {
      reject(e);
    }
  });
};


}).call(this,require('_process'))
},{"../adapters/http":2,"../adapters/xhr":2,"_process":211}],6:[function(require,module,exports){
'use strict';

var utils = require('./utils');

var PROTECTION_PREFIX = /^\)\]\}',?\n/;
var DEFAULT_CONTENT_TYPE = {
  'Content-Type': 'application/x-www-form-urlencoded'
};

module.exports = {
  transformRequest: [function transformRequestJSON(data, headers) {
    if (utils.isFormData(data)) {
      return data;
    }
    if (utils.isArrayBuffer(data)) {
      return data;
    }
    if (utils.isArrayBufferView(data)) {
      return data.buffer;
    }
    if (utils.isObject(data) && !utils.isFile(data) && !utils.isBlob(data)) {
      // Set application/json if no Content-Type has been specified
      if (!utils.isUndefined(headers)) {
        utils.forEach(headers, function processContentTypeHeader(val, key) {
          if (key.toLowerCase() === 'content-type') {
            headers['Content-Type'] = val;
          }
        });

        if (utils.isUndefined(headers['Content-Type'])) {
          headers['Content-Type'] = 'application/json;charset=utf-8';
        }
      }
      return JSON.stringify(data);
    }
    return data;
  }],

  transformResponse: [function transformResponseJSON(data) {
    /*eslint no-param-reassign:0*/
    if (typeof data === 'string') {
      data = data.replace(PROTECTION_PREFIX, '');
      try {
        data = JSON.parse(data);
      } catch (e) { /* Ignore */ }
    }
    return data;
  }],

  headers: {
    common: {
      'Accept': 'application/json, text/plain, */*'
    },
    patch: utils.merge(DEFAULT_CONTENT_TYPE),
    post: utils.merge(DEFAULT_CONTENT_TYPE),
    put: utils.merge(DEFAULT_CONTENT_TYPE)
  },

  timeout: 0,

  xsrfCookieName: 'XSRF-TOKEN',
  xsrfHeaderName: 'X-XSRF-TOKEN',

  maxContentLength: -1
};

},{"./utils":17}],7:[function(require,module,exports){
'use strict';

module.exports = function bind(fn, thisArg) {
  return function wrap() {
    var args = new Array(arguments.length);
    for (var i = 0; i < args.length; i++) {
      args[i] = arguments[i];
    }
    return fn.apply(thisArg, args);
  };
};

},{}],8:[function(require,module,exports){
'use strict';

// btoa polyfill for IE<10 courtesy https://github.com/davidchambers/Base64.js

var chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';

function E() {
  this.message = 'String contains an invalid character';
}
E.prototype = new Error;
E.prototype.code = 5;
E.prototype.name = 'InvalidCharacterError';

function btoa(input) {
  var str = String(input);
  var output = '';
  for (
    // initialize result and counter
    var block, charCode, idx = 0, map = chars;
    // if the next str index does not exist:
    //   change the mapping table to "="
    //   check if d has no fractional digits
    str.charAt(idx | 0) || (map = '=', idx % 1);
    // "8 - idx % 1 * 8" generates the sequence 2, 4, 6, 8
    output += map.charAt(63 & block >> 8 - idx % 1 * 8)
  ) {
    charCode = str.charCodeAt(idx += 3 / 4);
    if (charCode > 0xFF) {
      throw new E();
    }
    block = block << 8 | charCode;
  }
  return output;
}

module.exports = btoa;

},{}],9:[function(require,module,exports){
'use strict';

var utils = require('./../utils');

function encode(val) {
  return encodeURIComponent(val).
    replace(/%40/gi, '@').
    replace(/%3A/gi, ':').
    replace(/%24/g, '$').
    replace(/%2C/gi, ',').
    replace(/%20/g, '+').
    replace(/%5B/gi, '[').
    replace(/%5D/gi, ']');
}

/**
 * Build a URL by appending params to the end
 *
 * @param {string} url The base of the url (e.g., http://www.google.com)
 * @param {object} [params] The params to be appended
 * @returns {string} The formatted url
 */
module.exports = function buildURL(url, params, paramsSerializer) {
  /*eslint no-param-reassign:0*/
  if (!params) {
    return url;
  }

  var serializedParams;
  if (paramsSerializer) {
    serializedParams = paramsSerializer(params);
  } else {
    var parts = [];

    utils.forEach(params, function serialize(val, key) {
      if (val === null || typeof val === 'undefined') {
        return;
      }

      if (utils.isArray(val)) {
        key = key + '[]';
      }

      if (!utils.isArray(val)) {
        val = [val];
      }

      utils.forEach(val, function parseValue(v) {
        if (utils.isDate(v)) {
          v = v.toISOString();
        } else if (utils.isObject(v)) {
          v = JSON.stringify(v);
        }
        parts.push(encode(key) + '=' + encode(v));
      });
    });

    serializedParams = parts.join('&');
  }

  if (serializedParams) {
    url += (url.indexOf('?') === -1 ? '?' : '&') + serializedParams;
  }

  return url;
};


},{"./../utils":17}],10:[function(require,module,exports){
'use strict';

/**
 * Creates a new URL by combining the specified URLs
 *
 * @param {string} baseURL The base URL
 * @param {string} relativeURL The relative URL
 * @returns {string} The combined URL
 */
module.exports = function combineURLs(baseURL, relativeURL) {
  return baseURL.replace(/\/+$/, '') + '/' + relativeURL.replace(/^\/+/, '');
};

},{}],11:[function(require,module,exports){
'use strict';

var utils = require('./../utils');

module.exports = (
  utils.isStandardBrowserEnv() ?

  // Standard browser envs support document.cookie
  (function standardBrowserEnv() {
    return {
      write: function write(name, value, expires, path, domain, secure) {
        var cookie = [];
        cookie.push(name + '=' + encodeURIComponent(value));

        if (utils.isNumber(expires)) {
          cookie.push('expires=' + new Date(expires).toGMTString());
        }

        if (utils.isString(path)) {
          cookie.push('path=' + path);
        }

        if (utils.isString(domain)) {
          cookie.push('domain=' + domain);
        }

        if (secure === true) {
          cookie.push('secure');
        }

        document.cookie = cookie.join('; ');
      },

      read: function read(name) {
        var match = document.cookie.match(new RegExp('(^|;\\s*)(' + name + ')=([^;]*)'));
        return (match ? decodeURIComponent(match[3]) : null);
      },

      remove: function remove(name) {
        this.write(name, '', Date.now() - 86400000);
      }
    };
  })() :

  // Non standard browser env (web workers, react-native) lack needed support.
  (function nonStandardBrowserEnv() {
    return {
      write: function write() {},
      read: function read() { return null; },
      remove: function remove() {}
    };
  })()
);

},{"./../utils":17}],12:[function(require,module,exports){
'use strict';

/**
 * Determines whether the specified URL is absolute
 *
 * @param {string} url The URL to test
 * @returns {boolean} True if the specified URL is absolute, otherwise false
 */
module.exports = function isAbsoluteURL(url) {
  // A URL is considered absolute if it begins with "<scheme>://" or "//" (protocol-relative URL).
  // RFC 3986 defines scheme name as a sequence of characters beginning with a letter and followed
  // by any combination of letters, digits, plus, period, or hyphen.
  return /^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url);
};

},{}],13:[function(require,module,exports){
'use strict';

var utils = require('./../utils');

module.exports = (
  utils.isStandardBrowserEnv() ?

  // Standard browser envs have full support of the APIs needed to test
  // whether the request URL is of the same origin as current location.
  (function standardBrowserEnv() {
    var msie = /(msie|trident)/i.test(navigator.userAgent);
    var urlParsingNode = document.createElement('a');
    var originURL;

    /**
    * Parse a URL to discover it's components
    *
    * @param {String} url The URL to be parsed
    * @returns {Object}
    */
    function resolveURL(url) {
      var href = url;

      if (msie) {
        // IE needs attribute set twice to normalize properties
        urlParsingNode.setAttribute('href', href);
        href = urlParsingNode.href;
      }

      urlParsingNode.setAttribute('href', href);

      // urlParsingNode provides the UrlUtils interface - http://url.spec.whatwg.org/#urlutils
      return {
        href: urlParsingNode.href,
        protocol: urlParsingNode.protocol ? urlParsingNode.protocol.replace(/:$/, '') : '',
        host: urlParsingNode.host,
        search: urlParsingNode.search ? urlParsingNode.search.replace(/^\?/, '') : '',
        hash: urlParsingNode.hash ? urlParsingNode.hash.replace(/^#/, '') : '',
        hostname: urlParsingNode.hostname,
        port: urlParsingNode.port,
        pathname: (urlParsingNode.pathname.charAt(0) === '/') ?
                  urlParsingNode.pathname :
                  '/' + urlParsingNode.pathname
      };
    }

    originURL = resolveURL(window.location.href);

    /**
    * Determine if a URL shares the same origin as the current location
    *
    * @param {String} requestURL The URL to test
    * @returns {boolean} True if URL shares the same origin, otherwise false
    */
    return function isURLSameOrigin(requestURL) {
      var parsed = (utils.isString(requestURL)) ? resolveURL(requestURL) : requestURL;
      return (parsed.protocol === originURL.protocol &&
            parsed.host === originURL.host);
    };
  })() :

  // Non standard browser envs (web workers, react-native) lack needed support.
  (function nonStandardBrowserEnv() {
    return function isURLSameOrigin() {
      return true;
    };
  })()
);

},{"./../utils":17}],14:[function(require,module,exports){
'use strict';

var utils = require('./../utils');

/**
 * Parse headers into an object
 *
 * ```
 * Date: Wed, 27 Aug 2014 08:58:49 GMT
 * Content-Type: application/json
 * Connection: keep-alive
 * Transfer-Encoding: chunked
 * ```
 *
 * @param {String} headers Headers needing to be parsed
 * @returns {Object} Headers parsed into an object
 */
module.exports = function parseHeaders(headers) {
  var parsed = {};
  var key;
  var val;
  var i;

  if (!headers) { return parsed; }

  utils.forEach(headers.split('\n'), function parser(line) {
    i = line.indexOf(':');
    key = utils.trim(line.substr(0, i)).toLowerCase();
    val = utils.trim(line.substr(i + 1));

    if (key) {
      parsed[key] = parsed[key] ? parsed[key] + ', ' + val : val;
    }
  });

  return parsed;
};

},{"./../utils":17}],15:[function(require,module,exports){
'use strict';

/**
 * Syntactic sugar for invoking a function and expanding an array for arguments.
 *
 * Common use case would be to use `Function.prototype.apply`.
 *
 *  ```js
 *  function f(x, y, z) {}
 *  var args = [1, 2, 3];
 *  f.apply(null, args);
 *  ```
 *
 * With `spread` this example can be re-written.
 *
 *  ```js
 *  spread(function(x, y, z) {})([1, 2, 3]);
 *  ```
 *
 * @param {Function} callback
 * @returns {Function}
 */
module.exports = function spread(callback) {
  return function wrap(arr) {
    return callback.apply(null, arr);
  };
};

},{}],16:[function(require,module,exports){
'use strict';

var utils = require('./../utils');

/**
 * Transform the data for a request or a response
 *
 * @param {Object|String} data The data to be transformed
 * @param {Array} headers The headers for the request or response
 * @param {Array|Function} fns A single function or Array of functions
 * @returns {*} The resulting transformed data
 */
module.exports = function transformData(data, headers, fns) {
  /*eslint no-param-reassign:0*/
  utils.forEach(fns, function transform(fn) {
    data = fn(data, headers);
  });

  return data;
};

},{"./../utils":17}],17:[function(require,module,exports){
'use strict';

/*global toString:true*/

// utils is a library of generic helper functions non-specific to axios

var toString = Object.prototype.toString;

/**
 * Determine if a value is an Array
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is an Array, otherwise false
 */
function isArray(val) {
  return toString.call(val) === '[object Array]';
}

/**
 * Determine if a value is an ArrayBuffer
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is an ArrayBuffer, otherwise false
 */
function isArrayBuffer(val) {
  return toString.call(val) === '[object ArrayBuffer]';
}

/**
 * Determine if a value is a FormData
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is an FormData, otherwise false
 */
function isFormData(val) {
  return toString.call(val) === '[object FormData]';
}

/**
 * Determine if a value is a view on an ArrayBuffer
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is a view on an ArrayBuffer, otherwise false
 */
function isArrayBufferView(val) {
  var result;
  if ((typeof ArrayBuffer !== 'undefined') && (ArrayBuffer.isView)) {
    result = ArrayBuffer.isView(val);
  } else {
    result = (val) && (val.buffer) && (val.buffer instanceof ArrayBuffer);
  }
  return result;
}

/**
 * Determine if a value is a String
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is a String, otherwise false
 */
function isString(val) {
  return typeof val === 'string';
}

/**
 * Determine if a value is a Number
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is a Number, otherwise false
 */
function isNumber(val) {
  return typeof val === 'number';
}

/**
 * Determine if a value is undefined
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if the value is undefined, otherwise false
 */
function isUndefined(val) {
  return typeof val === 'undefined';
}

/**
 * Determine if a value is an Object
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is an Object, otherwise false
 */
function isObject(val) {
  return val !== null && typeof val === 'object';
}

/**
 * Determine if a value is a Date
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is a Date, otherwise false
 */
function isDate(val) {
  return toString.call(val) === '[object Date]';
}

/**
 * Determine if a value is a File
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is a File, otherwise false
 */
function isFile(val) {
  return toString.call(val) === '[object File]';
}

/**
 * Determine if a value is a Blob
 *
 * @param {Object} val The value to test
 * @returns {boolean} True if value is a Blob, otherwise false
 */
function isBlob(val) {
  return toString.call(val) === '[object Blob]';
}

/**
 * Trim excess whitespace off the beginning and end of a string
 *
 * @param {String} str The String to trim
 * @returns {String} The String freed of excess whitespace
 */
function trim(str) {
  return str.replace(/^\s*/, '').replace(/\s*$/, '');
}

/**
 * Determine if we're running in a standard browser environment
 *
 * This allows axios to run in a web worker, and react-native.
 * Both environments support XMLHttpRequest, but not fully standard globals.
 *
 * web workers:
 *  typeof window -> undefined
 *  typeof document -> undefined
 *
 * react-native:
 *  typeof document.createElement -> undefined
 */
function isStandardBrowserEnv() {
  return (
    typeof window !== 'undefined' &&
    typeof document !== 'undefined' &&
    typeof document.createElement === 'function'
  );
}

/**
 * Iterate over an Array or an Object invoking a function for each item.
 *
 * If `obj` is an Array callback will be called passing
 * the value, index, and complete array for each item.
 *
 * If 'obj' is an Object callback will be called passing
 * the value, key, and complete object for each property.
 *
 * @param {Object|Array} obj The object to iterate
 * @param {Function} fn The callback to invoke for each item
 */
function forEach(obj, fn) {
  // Don't bother if no value provided
  if (obj === null || typeof obj === 'undefined') {
    return;
  }

  // Force an array if not already something iterable
  if (typeof obj !== 'object' && !isArray(obj)) {
    /*eslint no-param-reassign:0*/
    obj = [obj];
  }

  if (isArray(obj)) {
    // Iterate over array values
    for (var i = 0, l = obj.length; i < l; i++) {
      fn.call(null, obj[i], i, obj);
    }
  } else {
    // Iterate over object keys
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        fn.call(null, obj[key], key, obj);
      }
    }
  }
}

/**
 * Accepts varargs expecting each argument to be an object, then
 * immutably merges the properties of each object and returns result.
 *
 * When multiple objects contain the same key the later object in
 * the arguments list will take precedence.
 *
 * Example:
 *
 * ```js
 * var result = merge({foo: 123}, {foo: 456});
 * console.log(result.foo); // outputs 456
 * ```
 *
 * @param {Object} obj1 Object to merge
 * @returns {Object} Result of all merge properties
 */
function merge(/* obj1, obj2, obj3, ... */) {
  var result = {};
  function assignValue(val, key) {
    if (typeof result[key] === 'object' && typeof val === 'object') {
      result[key] = merge(result[key], val);
    } else {
      result[key] = val;
    }
  }

  for (var i = 0, l = arguments.length; i < l; i++) {
    forEach(arguments[i], assignValue);
  }
  return result;
}

module.exports = {
  isArray: isArray,
  isArrayBuffer: isArrayBuffer,
  isFormData: isFormData,
  isArrayBufferView: isArrayBufferView,
  isString: isString,
  isNumber: isNumber,
  isObject: isObject,
  isUndefined: isUndefined,
  isDate: isDate,
  isFile: isFile,
  isBlob: isBlob,
  isStandardBrowserEnv: isStandardBrowserEnv,
  forEach: forEach,
  merge: merge,
  trim: trim
};

},{}],18:[function(require,module,exports){
(function (global){
"use strict";

require("core-js/shim");

require("babel-regenerator-runtime");

if (global._babelPolyfill) {
  throw new Error("only one instance of babel-polyfill is allowed");
}
global._babelPolyfill = true;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"babel-regenerator-runtime":19,"core-js/shim":206}],19:[function(require,module,exports){
(function (process,global){
/**
 * Copyright (c) 2014, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * https://raw.github.com/facebook/regenerator/master/LICENSE file. An
 * additional grant of patent rights can be found in the PATENTS file in
 * the same directory.
 */

!(function(global) {
  "use strict";

  var hasOwn = Object.prototype.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var iteratorSymbol =
    typeof Symbol === "function" && Symbol.iterator || "@@iterator";

  var inModule = typeof module === "object";
  var runtime = global.regeneratorRuntime;
  if (runtime) {
    if (inModule) {
      // If regeneratorRuntime is defined globally and we're in a module,
      // make the exports object identical to regeneratorRuntime.
      module.exports = runtime;
    }
    // Don't bother evaluating the rest of this file if the runtime was
    // already defined globally.
    return;
  }

  // Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime = global.regeneratorRuntime = inModule ? module.exports : {};

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided, then outerFn.prototype instanceof Generator.
    var generator = Object.create((outerFn || Generator).prototype);
    var context = new Context(tryLocsList || []);

    // The ._invoke method unifies the implementations of the .next,
    // .throw, and .return methods.
    generator._invoke = makeInvokeMethod(innerFn, self, context);

    return generator;
  }
  runtime.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  var Gp = GeneratorFunctionPrototype.prototype = Generator.prototype;
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunction.displayName = "GeneratorFunction";

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      prototype[method] = function(arg) {
        return this._invoke(method, arg);
      };
    });
  }

  runtime.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  runtime.mark = function(genFun) {
    if (Object.setPrototypeOf) {
      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
    } else {
      genFun.__proto__ = GeneratorFunctionPrototype;
    }
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `value instanceof AwaitArgument` to determine if the yielded value is
  // meant to be awaited. Some may consider the name of this method too
  // cutesy, but they are curmudgeons.
  runtime.awrap = function(arg) {
    return new AwaitArgument(arg);
  };

  function AwaitArgument(arg) {
    this.arg = arg;
  }

  function AsyncIterator(generator) {
    // This invoke function is written in a style that assumes some
    // calling function (or Promise) will handle exceptions.
    function invoke(method, arg) {
      var result = generator[method](arg);
      var value = result.value;
      return value instanceof AwaitArgument
        ? Promise.resolve(value.arg).then(invokeNext, invokeThrow)
        : Promise.resolve(value).then(function(unwrapped) {
            // When a yielded Promise is resolved, its final value becomes
            // the .value of the Promise<{value,done}> result for the
            // current iteration. If the Promise is rejected, however, the
            // result for this iteration will be rejected with the same
            // reason. Note that rejections of yielded Promises are not
            // thrown back into the generator function, as is the case
            // when an awaited Promise is rejected. This difference in
            // behavior between yield and await is important, because it
            // allows the consumer to decide what to do with the yielded
            // rejection (swallow it and continue, manually .throw it back
            // into the generator, abandon iteration, whatever). With
            // await, by contrast, there is no opportunity to examine the
            // rejection reason outside the generator function, so the
            // only option is to throw it from the await expression, and
            // let the generator function handle the exception.
            result.value = unwrapped;
            return result;
          });
    }

    if (typeof process === "object" && process.domain) {
      invoke = process.domain.bind(invoke);
    }

    var invokeNext = invoke.bind(generator, "next");
    var invokeThrow = invoke.bind(generator, "throw");
    var invokeReturn = invoke.bind(generator, "return");
    var previousPromise;

    function enqueue(method, arg) {
      function callInvokeWithMethodAndArg() {
        return invoke(method, arg);
      }

      return previousPromise =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(
          callInvokeWithMethodAndArg,
          // Avoid propagating failures to Promises returned by later
          // invocations of the iterator.
          callInvokeWithMethodAndArg
        ) : new Promise(function (resolve) {
          resolve(callInvokeWithMethodAndArg());
        });
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async = function(innerFn, outerFn, self, tryLocsList) {
    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList)
    );

    return runtime.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          if (method === "return" ||
              (method === "throw" && delegate.iterator[method] === undefined)) {
            // A return or throw (when the delegate iterator has no throw
            // method) always terminates the yield* loop.
            context.delegate = null;

            // If the delegate iterator has a return method, give it a
            // chance to clean up.
            var returnMethod = delegate.iterator["return"];
            if (returnMethod) {
              var record = tryCatch(returnMethod, delegate.iterator, arg);
              if (record.type === "throw") {
                // If the return method threw an exception, let that
                // exception prevail over the original return or throw.
                method = "throw";
                arg = record.arg;
                continue;
              }
            }

            if (method === "return") {
              // Continue with the outer return, now that the delegate
              // iterator has been terminated.
              continue;
            }
          }

          var record = tryCatch(
            delegate.iterator[method],
            delegate.iterator,
            arg
          );

          if (record.type === "throw") {
            context.delegate = null;

            // Like returning generator.throw(uncaught), but without the
            // overhead of an extra function call.
            method = "throw";
            arg = record.arg;
            continue;
          }

          // Delegate generator ran and handled its own exceptions so
          // regardless of what the method was, we continue as if it is
          // "next" with an undefined arg.
          method = "next";
          arg = undefined;

          var info = record.arg;
          if (info.done) {
            context[delegate.resultName] = info.value;
            context.next = delegate.nextLoc;
          } else {
            state = GenStateSuspendedYield;
            return info;
          }

          context.delegate = null;
        }

        if (method === "next") {
          context._sent = arg;

          if (state === GenStateSuspendedYield) {
            context.sent = arg;
          } else {
            context.sent = undefined;
          }
        } else if (method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw arg;
          }

          if (context.dispatchException(arg)) {
            // If the dispatched exception was caught by a catch block,
            // then let that catch block handle the exception normally.
            method = "next";
            arg = undefined;
          }

        } else if (method === "return") {
          context.abrupt("return", arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          var info = {
            value: record.arg,
            done: context.done
          };

          if (record.arg === ContinueSentinel) {
            if (context.delegate && method === "next") {
              // Deliberately forget the last sent value so that we don't
              // accidentally pass it on to the delegate.
              arg = undefined;
            }
          } else {
            return info;
          }

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(arg) call above.
          method = "throw";
          arg = record.arg;
        }
      }
    };
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  runtime.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  runtime.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      this.sent = undefined;
      this.done = false;
      this.delegate = null;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;
        return !!caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.next = finallyEntry.finallyLoc;
      } else {
        this.complete(record);
      }

      return ContinueSentinel;
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = record.arg;
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      return ContinueSentinel;
    }
  };
})(
  // Among the various tricks for obtaining a reference to the global
  // object, this seems to be the most reliable technique that does not
  // use indirect eval (which violates Content Security Policy).
  typeof global === "object" ? global :
  typeof window === "object" ? window :
  typeof self === "object" ? self : this
);

}).call(this,require('_process'),typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"_process":211}],20:[function(require,module,exports){
module.exports = function(it){
  if(typeof it != 'function')throw TypeError(it + ' is not a function!');
  return it;
};
},{}],21:[function(require,module,exports){
// 22.1.3.31 Array.prototype[@@unscopables]
var UNSCOPABLES = require('./$.wks')('unscopables')
  , ArrayProto  = Array.prototype;
if(ArrayProto[UNSCOPABLES] == undefined)require('./$.hide')(ArrayProto, UNSCOPABLES, {});
module.exports = function(key){
  ArrayProto[UNSCOPABLES][key] = true;
};
},{"./$.hide":49,"./$.wks":101}],22:[function(require,module,exports){
var isObject = require('./$.is-object');
module.exports = function(it){
  if(!isObject(it))throw TypeError(it + ' is not an object!');
  return it;
};
},{"./$.is-object":56}],23:[function(require,module,exports){
// 22.1.3.3 Array.prototype.copyWithin(target, start, end = this.length)
'use strict';
var toObject = require('./$.to-object')
  , toIndex  = require('./$.to-index')
  , toLength = require('./$.to-length');

module.exports = [].copyWithin || function copyWithin(target/*= 0*/, start/*= 0, end = @length*/){
  var O     = toObject(this)
    , len   = toLength(O.length)
    , to    = toIndex(target, len)
    , from  = toIndex(start, len)
    , $$    = arguments
    , end   = $$.length > 2 ? $$[2] : undefined
    , count = Math.min((end === undefined ? len : toIndex(end, len)) - from, len - to)
    , inc   = 1;
  if(from < to && to < from + count){
    inc  = -1;
    from += count - 1;
    to   += count - 1;
  }
  while(count-- > 0){
    if(from in O)O[to] = O[from];
    else delete O[to];
    to   += inc;
    from += inc;
  } return O;
};
},{"./$.to-index":94,"./$.to-length":97,"./$.to-object":98}],24:[function(require,module,exports){
// 22.1.3.6 Array.prototype.fill(value, start = 0, end = this.length)
'use strict';
var toObject = require('./$.to-object')
  , toIndex  = require('./$.to-index')
  , toLength = require('./$.to-length');
module.exports = [].fill || function fill(value /*, start = 0, end = @length */){
  var O      = toObject(this)
    , length = toLength(O.length)
    , $$     = arguments
    , $$len  = $$.length
    , index  = toIndex($$len > 1 ? $$[1] : undefined, length)
    , end    = $$len > 2 ? $$[2] : undefined
    , endPos = end === undefined ? length : toIndex(end, length);
  while(endPos > index)O[index++] = value;
  return O;
};
},{"./$.to-index":94,"./$.to-length":97,"./$.to-object":98}],25:[function(require,module,exports){
// false -> Array#indexOf
// true  -> Array#includes
var toIObject = require('./$.to-iobject')
  , toLength  = require('./$.to-length')
  , toIndex   = require('./$.to-index');
module.exports = function(IS_INCLUDES){
  return function($this, el, fromIndex){
    var O      = toIObject($this)
      , length = toLength(O.length)
      , index  = toIndex(fromIndex, length)
      , value;
    // Array#includes uses SameValueZero equality algorithm
    if(IS_INCLUDES && el != el)while(length > index){
      value = O[index++];
      if(value != value)return true;
    // Array#toIndex ignores holes, Array#includes - not
    } else for(;length > index; index++)if(IS_INCLUDES || index in O){
      if(O[index] === el)return IS_INCLUDES || index;
    } return !IS_INCLUDES && -1;
  };
};
},{"./$.to-index":94,"./$.to-iobject":96,"./$.to-length":97}],26:[function(require,module,exports){
// 0 -> Array#forEach
// 1 -> Array#map
// 2 -> Array#filter
// 3 -> Array#some
// 4 -> Array#every
// 5 -> Array#find
// 6 -> Array#findIndex
var ctx      = require('./$.ctx')
  , IObject  = require('./$.iobject')
  , toObject = require('./$.to-object')
  , toLength = require('./$.to-length')
  , asc      = require('./$.array-species-create');
module.exports = function(TYPE){
  var IS_MAP        = TYPE == 1
    , IS_FILTER     = TYPE == 2
    , IS_SOME       = TYPE == 3
    , IS_EVERY      = TYPE == 4
    , IS_FIND_INDEX = TYPE == 6
    , NO_HOLES      = TYPE == 5 || IS_FIND_INDEX;
  return function($this, callbackfn, that){
    var O      = toObject($this)
      , self   = IObject(O)
      , f      = ctx(callbackfn, that, 3)
      , length = toLength(self.length)
      , index  = 0
      , result = IS_MAP ? asc($this, length) : IS_FILTER ? asc($this, 0) : undefined
      , val, res;
    for(;length > index; index++)if(NO_HOLES || index in self){
      val = self[index];
      res = f(val, index, O);
      if(TYPE){
        if(IS_MAP)result[index] = res;            // map
        else if(res)switch(TYPE){
          case 3: return true;                    // some
          case 5: return val;                     // find
          case 6: return index;                   // findIndex
          case 2: result.push(val);               // filter
        } else if(IS_EVERY)return false;          // every
      }
    }
    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;
  };
};
},{"./$.array-species-create":27,"./$.ctx":35,"./$.iobject":52,"./$.to-length":97,"./$.to-object":98}],27:[function(require,module,exports){
// 9.4.2.3 ArraySpeciesCreate(originalArray, length)
var isObject = require('./$.is-object')
  , isArray  = require('./$.is-array')
  , SPECIES  = require('./$.wks')('species');
module.exports = function(original, length){
  var C;
  if(isArray(original)){
    C = original.constructor;
    // cross-realm fallback
    if(typeof C == 'function' && (C === Array || isArray(C.prototype)))C = undefined;
    if(isObject(C)){
      C = C[SPECIES];
      if(C === null)C = undefined;
    }
  } return new (C === undefined ? Array : C)(length);
};
},{"./$.is-array":54,"./$.is-object":56,"./$.wks":101}],28:[function(require,module,exports){
// getting tag from 19.1.3.6 Object.prototype.toString()
var cof = require('./$.cof')
  , TAG = require('./$.wks')('toStringTag')
  // ES3 wrong here
  , ARG = cof(function(){ return arguments; }()) == 'Arguments';

module.exports = function(it){
  var O, T, B;
  return it === undefined ? 'Undefined' : it === null ? 'Null'
    // @@toStringTag case
    : typeof (T = (O = Object(it))[TAG]) == 'string' ? T
    // builtinTag case
    : ARG ? cof(O)
    // ES3 arguments fallback
    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;
};
},{"./$.cof":29,"./$.wks":101}],29:[function(require,module,exports){
var toString = {}.toString;

module.exports = function(it){
  return toString.call(it).slice(8, -1);
};
},{}],30:[function(require,module,exports){
'use strict';
var $            = require('./$')
  , hide         = require('./$.hide')
  , redefineAll  = require('./$.redefine-all')
  , ctx          = require('./$.ctx')
  , strictNew    = require('./$.strict-new')
  , defined      = require('./$.defined')
  , forOf        = require('./$.for-of')
  , $iterDefine  = require('./$.iter-define')
  , step         = require('./$.iter-step')
  , ID           = require('./$.uid')('id')
  , $has         = require('./$.has')
  , isObject     = require('./$.is-object')
  , setSpecies   = require('./$.set-species')
  , DESCRIPTORS  = require('./$.descriptors')
  , isExtensible = Object.isExtensible || isObject
  , SIZE         = DESCRIPTORS ? '_s' : 'size'
  , id           = 0;

var fastKey = function(it, create){
  // return primitive with prefix
  if(!isObject(it))return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;
  if(!$has(it, ID)){
    // can't set id to frozen object
    if(!isExtensible(it))return 'F';
    // not necessary to add id
    if(!create)return 'E';
    // add missing object id
    hide(it, ID, ++id);
  // return object id with prefix
  } return 'O' + it[ID];
};

var getEntry = function(that, key){
  // fast case
  var index = fastKey(key), entry;
  if(index !== 'F')return that._i[index];
  // frozen object case
  for(entry = that._f; entry; entry = entry.n){
    if(entry.k == key)return entry;
  }
};

module.exports = {
  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){
    var C = wrapper(function(that, iterable){
      strictNew(that, C, NAME);
      that._i = $.create(null); // index
      that._f = undefined;      // first entry
      that._l = undefined;      // last entry
      that[SIZE] = 0;           // size
      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);
    });
    redefineAll(C.prototype, {
      // 23.1.3.1 Map.prototype.clear()
      // 23.2.3.2 Set.prototype.clear()
      clear: function clear(){
        for(var that = this, data = that._i, entry = that._f; entry; entry = entry.n){
          entry.r = true;
          if(entry.p)entry.p = entry.p.n = undefined;
          delete data[entry.i];
        }
        that._f = that._l = undefined;
        that[SIZE] = 0;
      },
      // 23.1.3.3 Map.prototype.delete(key)
      // 23.2.3.4 Set.prototype.delete(value)
      'delete': function(key){
        var that  = this
          , entry = getEntry(that, key);
        if(entry){
          var next = entry.n
            , prev = entry.p;
          delete that._i[entry.i];
          entry.r = true;
          if(prev)prev.n = next;
          if(next)next.p = prev;
          if(that._f == entry)that._f = next;
          if(that._l == entry)that._l = prev;
          that[SIZE]--;
        } return !!entry;
      },
      // 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)
      // 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)
      forEach: function forEach(callbackfn /*, that = undefined */){
        var f = ctx(callbackfn, arguments.length > 1 ? arguments[1] : undefined, 3)
          , entry;
        while(entry = entry ? entry.n : this._f){
          f(entry.v, entry.k, this);
          // revert to the last existing entry
          while(entry && entry.r)entry = entry.p;
        }
      },
      // 23.1.3.7 Map.prototype.has(key)
      // 23.2.3.7 Set.prototype.has(value)
      has: function has(key){
        return !!getEntry(this, key);
      }
    });
    if(DESCRIPTORS)$.setDesc(C.prototype, 'size', {
      get: function(){
        return defined(this[SIZE]);
      }
    });
    return C;
  },
  def: function(that, key, value){
    var entry = getEntry(that, key)
      , prev, index;
    // change existing entry
    if(entry){
      entry.v = value;
    // create new entry
    } else {
      that._l = entry = {
        i: index = fastKey(key, true), // <- index
        k: key,                        // <- key
        v: value,                      // <- value
        p: prev = that._l,             // <- previous entry
        n: undefined,                  // <- next entry
        r: false                       // <- removed
      };
      if(!that._f)that._f = entry;
      if(prev)prev.n = entry;
      that[SIZE]++;
      // add to index
      if(index !== 'F')that._i[index] = entry;
    } return that;
  },
  getEntry: getEntry,
  setStrong: function(C, NAME, IS_MAP){
    // add .keys, .values, .entries, [@@iterator]
    // 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11
    $iterDefine(C, NAME, function(iterated, kind){
      this._t = iterated;  // target
      this._k = kind;      // kind
      this._l = undefined; // previous
    }, function(){
      var that  = this
        , kind  = that._k
        , entry = that._l;
      // revert to the last existing entry
      while(entry && entry.r)entry = entry.p;
      // get next entry
      if(!that._t || !(that._l = entry = entry ? entry.n : that._t._f)){
        // or finish the iteration
        that._t = undefined;
        return step(1);
      }
      // return step by kind
      if(kind == 'keys'  )return step(0, entry.k);
      if(kind == 'values')return step(0, entry.v);
      return step(0, [entry.k, entry.v]);
    }, IS_MAP ? 'entries' : 'values' , !IS_MAP, true);

    // add [@@species], 23.1.2.2, 23.2.2.2
    setSpecies(NAME);
  }
};
},{"./$":64,"./$.ctx":35,"./$.defined":36,"./$.descriptors":37,"./$.for-of":45,"./$.has":48,"./$.hide":49,"./$.is-object":56,"./$.iter-define":60,"./$.iter-step":62,"./$.redefine-all":78,"./$.set-species":83,"./$.strict-new":87,"./$.uid":100}],31:[function(require,module,exports){
// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var forOf   = require('./$.for-of')
  , classof = require('./$.classof');
module.exports = function(NAME){
  return function toJSON(){
    if(classof(this) != NAME)throw TypeError(NAME + "#toJSON isn't generic");
    var arr = [];
    forOf(this, false, arr.push, arr);
    return arr;
  };
};
},{"./$.classof":28,"./$.for-of":45}],32:[function(require,module,exports){
'use strict';
var hide              = require('./$.hide')
  , redefineAll       = require('./$.redefine-all')
  , anObject          = require('./$.an-object')
  , isObject          = require('./$.is-object')
  , strictNew         = require('./$.strict-new')
  , forOf             = require('./$.for-of')
  , createArrayMethod = require('./$.array-methods')
  , $has              = require('./$.has')
  , WEAK              = require('./$.uid')('weak')
  , isExtensible      = Object.isExtensible || isObject
  , arrayFind         = createArrayMethod(5)
  , arrayFindIndex    = createArrayMethod(6)
  , id                = 0;

// fallback for frozen keys
var frozenStore = function(that){
  return that._l || (that._l = new FrozenStore);
};
var FrozenStore = function(){
  this.a = [];
};
var findFrozen = function(store, key){
  return arrayFind(store.a, function(it){
    return it[0] === key;
  });
};
FrozenStore.prototype = {
  get: function(key){
    var entry = findFrozen(this, key);
    if(entry)return entry[1];
  },
  has: function(key){
    return !!findFrozen(this, key);
  },
  set: function(key, value){
    var entry = findFrozen(this, key);
    if(entry)entry[1] = value;
    else this.a.push([key, value]);
  },
  'delete': function(key){
    var index = arrayFindIndex(this.a, function(it){
      return it[0] === key;
    });
    if(~index)this.a.splice(index, 1);
    return !!~index;
  }
};

module.exports = {
  getConstructor: function(wrapper, NAME, IS_MAP, ADDER){
    var C = wrapper(function(that, iterable){
      strictNew(that, C, NAME);
      that._i = id++;      // collection id
      that._l = undefined; // leak store for frozen objects
      if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);
    });
    redefineAll(C.prototype, {
      // 23.3.3.2 WeakMap.prototype.delete(key)
      // 23.4.3.3 WeakSet.prototype.delete(value)
      'delete': function(key){
        if(!isObject(key))return false;
        if(!isExtensible(key))return frozenStore(this)['delete'](key);
        return $has(key, WEAK) && $has(key[WEAK], this._i) && delete key[WEAK][this._i];
      },
      // 23.3.3.4 WeakMap.prototype.has(key)
      // 23.4.3.4 WeakSet.prototype.has(value)
      has: function has(key){
        if(!isObject(key))return false;
        if(!isExtensible(key))return frozenStore(this).has(key);
        return $has(key, WEAK) && $has(key[WEAK], this._i);
      }
    });
    return C;
  },
  def: function(that, key, value){
    if(!isExtensible(anObject(key))){
      frozenStore(that).set(key, value);
    } else {
      $has(key, WEAK) || hide(key, WEAK, {});
      key[WEAK][that._i] = value;
    } return that;
  },
  frozenStore: frozenStore,
  WEAK: WEAK
};
},{"./$.an-object":22,"./$.array-methods":26,"./$.for-of":45,"./$.has":48,"./$.hide":49,"./$.is-object":56,"./$.redefine-all":78,"./$.strict-new":87,"./$.uid":100}],33:[function(require,module,exports){
'use strict';
var global         = require('./$.global')
  , $export        = require('./$.export')
  , redefine       = require('./$.redefine')
  , redefineAll    = require('./$.redefine-all')
  , forOf          = require('./$.for-of')
  , strictNew      = require('./$.strict-new')
  , isObject       = require('./$.is-object')
  , fails          = require('./$.fails')
  , $iterDetect    = require('./$.iter-detect')
  , setToStringTag = require('./$.set-to-string-tag');

module.exports = function(NAME, wrapper, methods, common, IS_MAP, IS_WEAK){
  var Base  = global[NAME]
    , C     = Base
    , ADDER = IS_MAP ? 'set' : 'add'
    , proto = C && C.prototype
    , O     = {};
  var fixMethod = function(KEY){
    var fn = proto[KEY];
    redefine(proto, KEY,
      KEY == 'delete' ? function(a){
        return IS_WEAK && !isObject(a) ? false : fn.call(this, a === 0 ? 0 : a);
      } : KEY == 'has' ? function has(a){
        return IS_WEAK && !isObject(a) ? false : fn.call(this, a === 0 ? 0 : a);
      } : KEY == 'get' ? function get(a){
        return IS_WEAK && !isObject(a) ? undefined : fn.call(this, a === 0 ? 0 : a);
      } : KEY == 'add' ? function add(a){ fn.call(this, a === 0 ? 0 : a); return this; }
        : function set(a, b){ fn.call(this, a === 0 ? 0 : a, b); return this; }
    );
  };
  if(typeof C != 'function' || !(IS_WEAK || proto.forEach && !fails(function(){
    new C().entries().next();
  }))){
    // create collection constructor
    C = common.getConstructor(wrapper, NAME, IS_MAP, ADDER);
    redefineAll(C.prototype, methods);
  } else {
    var instance             = new C
      // early implementations not supports chaining
      , HASNT_CHAINING       = instance[ADDER](IS_WEAK ? {} : -0, 1) != instance
      // V8 ~  Chromium 40- weak-collections throws on primitives, but should return false
      , THROWS_ON_PRIMITIVES = fails(function(){ instance.has(1); })
      // most early implementations doesn't supports iterables, most modern - not close it correctly
      , ACCEPT_ITERABLES     = $iterDetect(function(iter){ new C(iter); }) // eslint-disable-line no-new
      // for early implementations -0 and +0 not the same
      , BUGGY_ZERO;
    if(!ACCEPT_ITERABLES){ 
      C = wrapper(function(target, iterable){
        strictNew(target, C, NAME);
        var that = new Base;
        if(iterable != undefined)forOf(iterable, IS_MAP, that[ADDER], that);
        return that;
      });
      C.prototype = proto;
      proto.constructor = C;
    }
    IS_WEAK || instance.forEach(function(val, key){
      BUGGY_ZERO = 1 / key === -Infinity;
    });
    if(THROWS_ON_PRIMITIVES || BUGGY_ZERO){
      fixMethod('delete');
      fixMethod('has');
      IS_MAP && fixMethod('get');
    }
    if(BUGGY_ZERO || HASNT_CHAINING)fixMethod(ADDER);
    // weak collections should not contains .clear method
    if(IS_WEAK && proto.clear)delete proto.clear;
  }

  setToStringTag(C, NAME);

  O[NAME] = C;
  $export($export.G + $export.W + $export.F * (C != Base), O);

  if(!IS_WEAK)common.setStrong(C, NAME, IS_MAP);

  return C;
};
},{"./$.export":40,"./$.fails":42,"./$.for-of":45,"./$.global":47,"./$.is-object":56,"./$.iter-detect":61,"./$.redefine":79,"./$.redefine-all":78,"./$.set-to-string-tag":84,"./$.strict-new":87}],34:[function(require,module,exports){
var core = module.exports = {version: '1.2.6'};
if(typeof __e == 'number')__e = core; // eslint-disable-line no-undef
},{}],35:[function(require,module,exports){
// optional / simple context binding
var aFunction = require('./$.a-function');
module.exports = function(fn, that, length){
  aFunction(fn);
  if(that === undefined)return fn;
  switch(length){
    case 1: return function(a){
      return fn.call(that, a);
    };
    case 2: return function(a, b){
      return fn.call(that, a, b);
    };
    case 3: return function(a, b, c){
      return fn.call(that, a, b, c);
    };
  }
  return function(/* ...args */){
    return fn.apply(that, arguments);
  };
};
},{"./$.a-function":20}],36:[function(require,module,exports){
// 7.2.1 RequireObjectCoercible(argument)
module.exports = function(it){
  if(it == undefined)throw TypeError("Can't call method on  " + it);
  return it;
};
},{}],37:[function(require,module,exports){
// Thank's IE8 for his funny defineProperty
module.exports = !require('./$.fails')(function(){
  return Object.defineProperty({}, 'a', {get: function(){ return 7; }}).a != 7;
});
},{"./$.fails":42}],38:[function(require,module,exports){
var isObject = require('./$.is-object')
  , document = require('./$.global').document
  // in old IE typeof document.createElement is 'object'
  , is = isObject(document) && isObject(document.createElement);
module.exports = function(it){
  return is ? document.createElement(it) : {};
};
},{"./$.global":47,"./$.is-object":56}],39:[function(require,module,exports){
// all enumerable object keys, includes symbols
var $ = require('./$');
module.exports = function(it){
  var keys       = $.getKeys(it)
    , getSymbols = $.getSymbols;
  if(getSymbols){
    var symbols = getSymbols(it)
      , isEnum  = $.isEnum
      , i       = 0
      , key;
    while(symbols.length > i)if(isEnum.call(it, key = symbols[i++]))keys.push(key);
  }
  return keys;
};
},{"./$":64}],40:[function(require,module,exports){
var global    = require('./$.global')
  , core      = require('./$.core')
  , hide      = require('./$.hide')
  , redefine  = require('./$.redefine')
  , ctx       = require('./$.ctx')
  , PROTOTYPE = 'prototype';

var $export = function(type, name, source){
  var IS_FORCED = type & $export.F
    , IS_GLOBAL = type & $export.G
    , IS_STATIC = type & $export.S
    , IS_PROTO  = type & $export.P
    , IS_BIND   = type & $export.B
    , target    = IS_GLOBAL ? global : IS_STATIC ? global[name] || (global[name] = {}) : (global[name] || {})[PROTOTYPE]
    , exports   = IS_GLOBAL ? core : core[name] || (core[name] = {})
    , expProto  = exports[PROTOTYPE] || (exports[PROTOTYPE] = {})
    , key, own, out, exp;
  if(IS_GLOBAL)source = name;
  for(key in source){
    // contains in native
    own = !IS_FORCED && target && key in target;
    // export native or passed
    out = (own ? target : source)[key];
    // bind timers to global for call from export context
    exp = IS_BIND && own ? ctx(out, global) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;
    // extend global
    if(target && !own)redefine(target, key, out);
    // export
    if(exports[key] != out)hide(exports, key, exp);
    if(IS_PROTO && expProto[key] != out)expProto[key] = out;
  }
};
global.core = core;
// type bitmap
$export.F = 1;  // forced
$export.G = 2;  // global
$export.S = 4;  // static
$export.P = 8;  // proto
$export.B = 16; // bind
$export.W = 32; // wrap
module.exports = $export;
},{"./$.core":34,"./$.ctx":35,"./$.global":47,"./$.hide":49,"./$.redefine":79}],41:[function(require,module,exports){
var MATCH = require('./$.wks')('match');
module.exports = function(KEY){
  var re = /./;
  try {
    '/./'[KEY](re);
  } catch(e){
    try {
      re[MATCH] = false;
      return !'/./'[KEY](re);
    } catch(f){ /* empty */ }
  } return true;
};
},{"./$.wks":101}],42:[function(require,module,exports){
module.exports = function(exec){
  try {
    return !!exec();
  } catch(e){
    return true;
  }
};
},{}],43:[function(require,module,exports){
'use strict';
var hide     = require('./$.hide')
  , redefine = require('./$.redefine')
  , fails    = require('./$.fails')
  , defined  = require('./$.defined')
  , wks      = require('./$.wks');

module.exports = function(KEY, length, exec){
  var SYMBOL   = wks(KEY)
    , original = ''[KEY];
  if(fails(function(){
    var O = {};
    O[SYMBOL] = function(){ return 7; };
    return ''[KEY](O) != 7;
  })){
    redefine(String.prototype, KEY, exec(defined, SYMBOL, original));
    hide(RegExp.prototype, SYMBOL, length == 2
      // 21.2.5.8 RegExp.prototype[@@replace](string, replaceValue)
      // 21.2.5.11 RegExp.prototype[@@split](string, limit)
      ? function(string, arg){ return original.call(string, this, arg); }
      // 21.2.5.6 RegExp.prototype[@@match](string)
      // 21.2.5.9 RegExp.prototype[@@search](string)
      : function(string){ return original.call(string, this); }
    );
  }
};
},{"./$.defined":36,"./$.fails":42,"./$.hide":49,"./$.redefine":79,"./$.wks":101}],44:[function(require,module,exports){
'use strict';
// 21.2.5.3 get RegExp.prototype.flags
var anObject = require('./$.an-object');
module.exports = function(){
  var that   = anObject(this)
    , result = '';
  if(that.global)     result += 'g';
  if(that.ignoreCase) result += 'i';
  if(that.multiline)  result += 'm';
  if(that.unicode)    result += 'u';
  if(that.sticky)     result += 'y';
  return result;
};
},{"./$.an-object":22}],45:[function(require,module,exports){
var ctx         = require('./$.ctx')
  , call        = require('./$.iter-call')
  , isArrayIter = require('./$.is-array-iter')
  , anObject    = require('./$.an-object')
  , toLength    = require('./$.to-length')
  , getIterFn   = require('./core.get-iterator-method');
module.exports = function(iterable, entries, fn, that){
  var iterFn = getIterFn(iterable)
    , f      = ctx(fn, that, entries ? 2 : 1)
    , index  = 0
    , length, step, iterator;
  if(typeof iterFn != 'function')throw TypeError(iterable + ' is not iterable!');
  // fast case for arrays with default iterator
  if(isArrayIter(iterFn))for(length = toLength(iterable.length); length > index; index++){
    entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);
  } else for(iterator = iterFn.call(iterable); !(step = iterator.next()).done; ){
    call(iterator, f, step.value, entries);
  }
};
},{"./$.an-object":22,"./$.ctx":35,"./$.is-array-iter":53,"./$.iter-call":58,"./$.to-length":97,"./core.get-iterator-method":102}],46:[function(require,module,exports){
// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window
var toIObject = require('./$.to-iobject')
  , getNames  = require('./$').getNames
  , toString  = {}.toString;

var windowNames = typeof window == 'object' && Object.getOwnPropertyNames
  ? Object.getOwnPropertyNames(window) : [];

var getWindowNames = function(it){
  try {
    return getNames(it);
  } catch(e){
    return windowNames.slice();
  }
};

module.exports.get = function getOwnPropertyNames(it){
  if(windowNames && toString.call(it) == '[object Window]')return getWindowNames(it);
  return getNames(toIObject(it));
};
},{"./$":64,"./$.to-iobject":96}],47:[function(require,module,exports){
// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
var global = module.exports = typeof window != 'undefined' && window.Math == Math
  ? window : typeof self != 'undefined' && self.Math == Math ? self : Function('return this')();
if(typeof __g == 'number')__g = global; // eslint-disable-line no-undef
},{}],48:[function(require,module,exports){
var hasOwnProperty = {}.hasOwnProperty;
module.exports = function(it, key){
  return hasOwnProperty.call(it, key);
};
},{}],49:[function(require,module,exports){
var $          = require('./$')
  , createDesc = require('./$.property-desc');
module.exports = require('./$.descriptors') ? function(object, key, value){
  return $.setDesc(object, key, createDesc(1, value));
} : function(object, key, value){
  object[key] = value;
  return object;
};
},{"./$":64,"./$.descriptors":37,"./$.property-desc":77}],50:[function(require,module,exports){
module.exports = require('./$.global').document && document.documentElement;
},{"./$.global":47}],51:[function(require,module,exports){
// fast apply, http://jsperf.lnkit.com/fast-apply/5
module.exports = function(fn, args, that){
  var un = that === undefined;
  switch(args.length){
    case 0: return un ? fn()
                      : fn.call(that);
    case 1: return un ? fn(args[0])
                      : fn.call(that, args[0]);
    case 2: return un ? fn(args[0], args[1])
                      : fn.call(that, args[0], args[1]);
    case 3: return un ? fn(args[0], args[1], args[2])
                      : fn.call(that, args[0], args[1], args[2]);
    case 4: return un ? fn(args[0], args[1], args[2], args[3])
                      : fn.call(that, args[0], args[1], args[2], args[3]);
  } return              fn.apply(that, args);
};
},{}],52:[function(require,module,exports){
// fallback for non-array-like ES3 and non-enumerable old V8 strings
var cof = require('./$.cof');
module.exports = Object('z').propertyIsEnumerable(0) ? Object : function(it){
  return cof(it) == 'String' ? it.split('') : Object(it);
};
},{"./$.cof":29}],53:[function(require,module,exports){
// check on default Array iterator
var Iterators  = require('./$.iterators')
  , ITERATOR   = require('./$.wks')('iterator')
  , ArrayProto = Array.prototype;

module.exports = function(it){
  return it !== undefined && (Iterators.Array === it || ArrayProto[ITERATOR] === it);
};
},{"./$.iterators":63,"./$.wks":101}],54:[function(require,module,exports){
// 7.2.2 IsArray(argument)
var cof = require('./$.cof');
module.exports = Array.isArray || function(arg){
  return cof(arg) == 'Array';
};
},{"./$.cof":29}],55:[function(require,module,exports){
// 20.1.2.3 Number.isInteger(number)
var isObject = require('./$.is-object')
  , floor    = Math.floor;
module.exports = function isInteger(it){
  return !isObject(it) && isFinite(it) && floor(it) === it;
};
},{"./$.is-object":56}],56:[function(require,module,exports){
module.exports = function(it){
  return typeof it === 'object' ? it !== null : typeof it === 'function';
};
},{}],57:[function(require,module,exports){
// 7.2.8 IsRegExp(argument)
var isObject = require('./$.is-object')
  , cof      = require('./$.cof')
  , MATCH    = require('./$.wks')('match');
module.exports = function(it){
  var isRegExp;
  return isObject(it) && ((isRegExp = it[MATCH]) !== undefined ? !!isRegExp : cof(it) == 'RegExp');
};
},{"./$.cof":29,"./$.is-object":56,"./$.wks":101}],58:[function(require,module,exports){
// call something on iterator step with safe closing on error
var anObject = require('./$.an-object');
module.exports = function(iterator, fn, value, entries){
  try {
    return entries ? fn(anObject(value)[0], value[1]) : fn(value);
  // 7.4.6 IteratorClose(iterator, completion)
  } catch(e){
    var ret = iterator['return'];
    if(ret !== undefined)anObject(ret.call(iterator));
    throw e;
  }
};
},{"./$.an-object":22}],59:[function(require,module,exports){
'use strict';
var $              = require('./$')
  , descriptor     = require('./$.property-desc')
  , setToStringTag = require('./$.set-to-string-tag')
  , IteratorPrototype = {};

// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()
require('./$.hide')(IteratorPrototype, require('./$.wks')('iterator'), function(){ return this; });

module.exports = function(Constructor, NAME, next){
  Constructor.prototype = $.create(IteratorPrototype, {next: descriptor(1, next)});
  setToStringTag(Constructor, NAME + ' Iterator');
};
},{"./$":64,"./$.hide":49,"./$.property-desc":77,"./$.set-to-string-tag":84,"./$.wks":101}],60:[function(require,module,exports){
'use strict';
var LIBRARY        = require('./$.library')
  , $export        = require('./$.export')
  , redefine       = require('./$.redefine')
  , hide           = require('./$.hide')
  , has            = require('./$.has')
  , Iterators      = require('./$.iterators')
  , $iterCreate    = require('./$.iter-create')
  , setToStringTag = require('./$.set-to-string-tag')
  , getProto       = require('./$').getProto
  , ITERATOR       = require('./$.wks')('iterator')
  , BUGGY          = !([].keys && 'next' in [].keys()) // Safari has buggy iterators w/o `next`
  , FF_ITERATOR    = '@@iterator'
  , KEYS           = 'keys'
  , VALUES         = 'values';

var returnThis = function(){ return this; };

module.exports = function(Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED){
  $iterCreate(Constructor, NAME, next);
  var getMethod = function(kind){
    if(!BUGGY && kind in proto)return proto[kind];
    switch(kind){
      case KEYS: return function keys(){ return new Constructor(this, kind); };
      case VALUES: return function values(){ return new Constructor(this, kind); };
    } return function entries(){ return new Constructor(this, kind); };
  };
  var TAG        = NAME + ' Iterator'
    , DEF_VALUES = DEFAULT == VALUES
    , VALUES_BUG = false
    , proto      = Base.prototype
    , $native    = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT]
    , $default   = $native || getMethod(DEFAULT)
    , methods, key;
  // Fix native
  if($native){
    var IteratorPrototype = getProto($default.call(new Base));
    // Set @@toStringTag to native iterators
    setToStringTag(IteratorPrototype, TAG, true);
    // FF fix
    if(!LIBRARY && has(proto, FF_ITERATOR))hide(IteratorPrototype, ITERATOR, returnThis);
    // fix Array#{values, @@iterator}.name in V8 / FF
    if(DEF_VALUES && $native.name !== VALUES){
      VALUES_BUG = true;
      $default = function values(){ return $native.call(this); };
    }
  }
  // Define iterator
  if((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])){
    hide(proto, ITERATOR, $default);
  }
  // Plug for library
  Iterators[NAME] = $default;
  Iterators[TAG]  = returnThis;
  if(DEFAULT){
    methods = {
      values:  DEF_VALUES  ? $default : getMethod(VALUES),
      keys:    IS_SET      ? $default : getMethod(KEYS),
      entries: !DEF_VALUES ? $default : getMethod('entries')
    };
    if(FORCED)for(key in methods){
      if(!(key in proto))redefine(proto, key, methods[key]);
    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);
  }
  return methods;
};
},{"./$":64,"./$.export":40,"./$.has":48,"./$.hide":49,"./$.iter-create":59,"./$.iterators":63,"./$.library":66,"./$.redefine":79,"./$.set-to-string-tag":84,"./$.wks":101}],61:[function(require,module,exports){
var ITERATOR     = require('./$.wks')('iterator')
  , SAFE_CLOSING = false;

try {
  var riter = [7][ITERATOR]();
  riter['return'] = function(){ SAFE_CLOSING = true; };
  Array.from(riter, function(){ throw 2; });
} catch(e){ /* empty */ }

module.exports = function(exec, skipClosing){
  if(!skipClosing && !SAFE_CLOSING)return false;
  var safe = false;
  try {
    var arr  = [7]
      , iter = arr[ITERATOR]();
    iter.next = function(){ safe = true; };
    arr[ITERATOR] = function(){ return iter; };
    exec(arr);
  } catch(e){ /* empty */ }
  return safe;
};
},{"./$.wks":101}],62:[function(require,module,exports){
module.exports = function(done, value){
  return {value: value, done: !!done};
};
},{}],63:[function(require,module,exports){
module.exports = {};
},{}],64:[function(require,module,exports){
var $Object = Object;
module.exports = {
  create:     $Object.create,
  getProto:   $Object.getPrototypeOf,
  isEnum:     {}.propertyIsEnumerable,
  getDesc:    $Object.getOwnPropertyDescriptor,
  setDesc:    $Object.defineProperty,
  setDescs:   $Object.defineProperties,
  getKeys:    $Object.keys,
  getNames:   $Object.getOwnPropertyNames,
  getSymbols: $Object.getOwnPropertySymbols,
  each:       [].forEach
};
},{}],65:[function(require,module,exports){
var $         = require('./$')
  , toIObject = require('./$.to-iobject');
module.exports = function(object, el){
  var O      = toIObject(object)
    , keys   = $.getKeys(O)
    , length = keys.length
    , index  = 0
    , key;
  while(length > index)if(O[key = keys[index++]] === el)return key;
};
},{"./$":64,"./$.to-iobject":96}],66:[function(require,module,exports){
module.exports = false;
},{}],67:[function(require,module,exports){
// 20.2.2.14 Math.expm1(x)
module.exports = Math.expm1 || function expm1(x){
  return (x = +x) == 0 ? x : x > -1e-6 && x < 1e-6 ? x + x * x / 2 : Math.exp(x) - 1;
};
},{}],68:[function(require,module,exports){
// 20.2.2.20 Math.log1p(x)
module.exports = Math.log1p || function log1p(x){
  return (x = +x) > -1e-8 && x < 1e-8 ? x - x * x / 2 : Math.log(1 + x);
};
},{}],69:[function(require,module,exports){
// 20.2.2.28 Math.sign(x)
module.exports = Math.sign || function sign(x){
  return (x = +x) == 0 || x != x ? x : x < 0 ? -1 : 1;
};
},{}],70:[function(require,module,exports){
var global    = require('./$.global')
  , macrotask = require('./$.task').set
  , Observer  = global.MutationObserver || global.WebKitMutationObserver
  , process   = global.process
  , Promise   = global.Promise
  , isNode    = require('./$.cof')(process) == 'process'
  , head, last, notify;

var flush = function(){
  var parent, domain, fn;
  if(isNode && (parent = process.domain)){
    process.domain = null;
    parent.exit();
  }
  while(head){
    domain = head.domain;
    fn     = head.fn;
    if(domain)domain.enter();
    fn(); // <- currently we use it only for Promise - try / catch not required
    if(domain)domain.exit();
    head = head.next;
  } last = undefined;
  if(parent)parent.enter();
};

// Node.js
if(isNode){
  notify = function(){
    process.nextTick(flush);
  };
// browsers with MutationObserver
} else if(Observer){
  var toggle = 1
    , node   = document.createTextNode('');
  new Observer(flush).observe(node, {characterData: true}); // eslint-disable-line no-new
  notify = function(){
    node.data = toggle = -toggle;
  };
// environments with maybe non-completely correct, but existent Promise
} else if(Promise && Promise.resolve){
  notify = function(){
    Promise.resolve().then(flush);
  };
// for other environments - macrotask based on:
// - setImmediate
// - MessageChannel
// - window.postMessag
// - onreadystatechange
// - setTimeout
} else {
  notify = function(){
    // strange IE + webpack dev server bug - use .call(global)
    macrotask.call(global, flush);
  };
}

module.exports = function asap(fn){
  var task = {fn: fn, next: undefined, domain: isNode && process.domain};
  if(last)last.next = task;
  if(!head){
    head = task;
    notify();
  } last = task;
};
},{"./$.cof":29,"./$.global":47,"./$.task":93}],71:[function(require,module,exports){
// 19.1.2.1 Object.assign(target, source, ...)
var $        = require('./$')
  , toObject = require('./$.to-object')
  , IObject  = require('./$.iobject');

// should work with symbols and should have deterministic property order (V8 bug)
module.exports = require('./$.fails')(function(){
  var a = Object.assign
    , A = {}
    , B = {}
    , S = Symbol()
    , K = 'abcdefghijklmnopqrst';
  A[S] = 7;
  K.split('').forEach(function(k){ B[k] = k; });
  return a({}, A)[S] != 7 || Object.keys(a({}, B)).join('') != K;
}) ? function assign(target, source){ // eslint-disable-line no-unused-vars
  var T     = toObject(target)
    , $$    = arguments
    , $$len = $$.length
    , index = 1
    , getKeys    = $.getKeys
    , getSymbols = $.getSymbols
    , isEnum     = $.isEnum;
  while($$len > index){
    var S      = IObject($$[index++])
      , keys   = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S)
      , length = keys.length
      , j      = 0
      , key;
    while(length > j)if(isEnum.call(S, key = keys[j++]))T[key] = S[key];
  }
  return T;
} : Object.assign;
},{"./$":64,"./$.fails":42,"./$.iobject":52,"./$.to-object":98}],72:[function(require,module,exports){
// most Object methods by ES6 should accept primitives
var $export = require('./$.export')
  , core    = require('./$.core')
  , fails   = require('./$.fails');
module.exports = function(KEY, exec){
  var fn  = (core.Object || {})[KEY] || Object[KEY]
    , exp = {};
  exp[KEY] = exec(fn);
  $export($export.S + $export.F * fails(function(){ fn(1); }), 'Object', exp);
};
},{"./$.core":34,"./$.export":40,"./$.fails":42}],73:[function(require,module,exports){
var $         = require('./$')
  , toIObject = require('./$.to-iobject')
  , isEnum    = $.isEnum;
module.exports = function(isEntries){
  return function(it){
    var O      = toIObject(it)
      , keys   = $.getKeys(O)
      , length = keys.length
      , i      = 0
      , result = []
      , key;
    while(length > i)if(isEnum.call(O, key = keys[i++])){
      result.push(isEntries ? [key, O[key]] : O[key]);
    } return result;
  };
};
},{"./$":64,"./$.to-iobject":96}],74:[function(require,module,exports){
// all object keys, includes non-enumerable and symbols
var $        = require('./$')
  , anObject = require('./$.an-object')
  , Reflect  = require('./$.global').Reflect;
module.exports = Reflect && Reflect.ownKeys || function ownKeys(it){
  var keys       = $.getNames(anObject(it))
    , getSymbols = $.getSymbols;
  return getSymbols ? keys.concat(getSymbols(it)) : keys;
};
},{"./$":64,"./$.an-object":22,"./$.global":47}],75:[function(require,module,exports){
'use strict';
var path      = require('./$.path')
  , invoke    = require('./$.invoke')
  , aFunction = require('./$.a-function');
module.exports = function(/* ...pargs */){
  var fn     = aFunction(this)
    , length = arguments.length
    , pargs  = Array(length)
    , i      = 0
    , _      = path._
    , holder = false;
  while(length > i)if((pargs[i] = arguments[i++]) === _)holder = true;
  return function(/* ...args */){
    var that  = this
      , $$    = arguments
      , $$len = $$.length
      , j = 0, k = 0, args;
    if(!holder && !$$len)return invoke(fn, pargs, that);
    args = pargs.slice();
    if(holder)for(;length > j; j++)if(args[j] === _)args[j] = $$[k++];
    while($$len > k)args.push($$[k++]);
    return invoke(fn, args, that);
  };
};
},{"./$.a-function":20,"./$.invoke":51,"./$.path":76}],76:[function(require,module,exports){
module.exports = require('./$.global');
},{"./$.global":47}],77:[function(require,module,exports){
module.exports = function(bitmap, value){
  return {
    enumerable  : !(bitmap & 1),
    configurable: !(bitmap & 2),
    writable    : !(bitmap & 4),
    value       : value
  };
};
},{}],78:[function(require,module,exports){
var redefine = require('./$.redefine');
module.exports = function(target, src){
  for(var key in src)redefine(target, key, src[key]);
  return target;
};
},{"./$.redefine":79}],79:[function(require,module,exports){
// add fake Function#toString
// for correct work wrapped methods / constructors with methods like LoDash isNative
var global    = require('./$.global')
  , hide      = require('./$.hide')
  , SRC       = require('./$.uid')('src')
  , TO_STRING = 'toString'
  , $toString = Function[TO_STRING]
  , TPL       = ('' + $toString).split(TO_STRING);

require('./$.core').inspectSource = function(it){
  return $toString.call(it);
};

(module.exports = function(O, key, val, safe){
  if(typeof val == 'function'){
    val.hasOwnProperty(SRC) || hide(val, SRC, O[key] ? '' + O[key] : TPL.join(String(key)));
    val.hasOwnProperty('name') || hide(val, 'name', key);
  }
  if(O === global){
    O[key] = val;
  } else {
    if(!safe)delete O[key];
    hide(O, key, val);
  }
})(Function.prototype, TO_STRING, function toString(){
  return typeof this == 'function' && this[SRC] || $toString.call(this);
});
},{"./$.core":34,"./$.global":47,"./$.hide":49,"./$.uid":100}],80:[function(require,module,exports){
module.exports = function(regExp, replace){
  var replacer = replace === Object(replace) ? function(part){
    return replace[part];
  } : replace;
  return function(it){
    return String(it).replace(regExp, replacer);
  };
};
},{}],81:[function(require,module,exports){
// 7.2.9 SameValue(x, y)
module.exports = Object.is || function is(x, y){
  return x === y ? x !== 0 || 1 / x === 1 / y : x != x && y != y;
};
},{}],82:[function(require,module,exports){
// Works with __proto__ only. Old v8 can't work with null proto objects.
/* eslint-disable no-proto */
var getDesc  = require('./$').getDesc
  , isObject = require('./$.is-object')
  , anObject = require('./$.an-object');
var check = function(O, proto){
  anObject(O);
  if(!isObject(proto) && proto !== null)throw TypeError(proto + ": can't set as prototype!");
};
module.exports = {
  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line
    function(test, buggy, set){
      try {
        set = require('./$.ctx')(Function.call, getDesc(Object.prototype, '__proto__').set, 2);
        set(test, []);
        buggy = !(test instanceof Array);
      } catch(e){ buggy = true; }
      return function setPrototypeOf(O, proto){
        check(O, proto);
        if(buggy)O.__proto__ = proto;
        else set(O, proto);
        return O;
      };
    }({}, false) : undefined),
  check: check
};
},{"./$":64,"./$.an-object":22,"./$.ctx":35,"./$.is-object":56}],83:[function(require,module,exports){
'use strict';
var global      = require('./$.global')
  , $           = require('./$')
  , DESCRIPTORS = require('./$.descriptors')
  , SPECIES     = require('./$.wks')('species');

module.exports = function(KEY){
  var C = global[KEY];
  if(DESCRIPTORS && C && !C[SPECIES])$.setDesc(C, SPECIES, {
    configurable: true,
    get: function(){ return this; }
  });
};
},{"./$":64,"./$.descriptors":37,"./$.global":47,"./$.wks":101}],84:[function(require,module,exports){
var def = require('./$').setDesc
  , has = require('./$.has')
  , TAG = require('./$.wks')('toStringTag');

module.exports = function(it, tag, stat){
  if(it && !has(it = stat ? it : it.prototype, TAG))def(it, TAG, {configurable: true, value: tag});
};
},{"./$":64,"./$.has":48,"./$.wks":101}],85:[function(require,module,exports){
var global = require('./$.global')
  , SHARED = '__core-js_shared__'
  , store  = global[SHARED] || (global[SHARED] = {});
module.exports = function(key){
  return store[key] || (store[key] = {});
};
},{"./$.global":47}],86:[function(require,module,exports){
// 7.3.20 SpeciesConstructor(O, defaultConstructor)
var anObject  = require('./$.an-object')
  , aFunction = require('./$.a-function')
  , SPECIES   = require('./$.wks')('species');
module.exports = function(O, D){
  var C = anObject(O).constructor, S;
  return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? D : aFunction(S);
};
},{"./$.a-function":20,"./$.an-object":22,"./$.wks":101}],87:[function(require,module,exports){
module.exports = function(it, Constructor, name){
  if(!(it instanceof Constructor))throw TypeError(name + ": use the 'new' operator!");
  return it;
};
},{}],88:[function(require,module,exports){
var toInteger = require('./$.to-integer')
  , defined   = require('./$.defined');
// true  -> String#at
// false -> String#codePointAt
module.exports = function(TO_STRING){
  return function(that, pos){
    var s = String(defined(that))
      , i = toInteger(pos)
      , l = s.length
      , a, b;
    if(i < 0 || i >= l)return TO_STRING ? '' : undefined;
    a = s.charCodeAt(i);
    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff
      ? TO_STRING ? s.charAt(i) : a
      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;
  };
};
},{"./$.defined":36,"./$.to-integer":95}],89:[function(require,module,exports){
// helper for String#{startsWith, endsWith, includes}
var isRegExp = require('./$.is-regexp')
  , defined  = require('./$.defined');

module.exports = function(that, searchString, NAME){
  if(isRegExp(searchString))throw TypeError('String#' + NAME + " doesn't accept regex!");
  return String(defined(that));
};
},{"./$.defined":36,"./$.is-regexp":57}],90:[function(require,module,exports){
// https://github.com/ljharb/proposal-string-pad-left-right
var toLength = require('./$.to-length')
  , repeat   = require('./$.string-repeat')
  , defined  = require('./$.defined');

module.exports = function(that, maxLength, fillString, left){
  var S            = String(defined(that))
    , stringLength = S.length
    , fillStr      = fillString === undefined ? ' ' : String(fillString)
    , intMaxLength = toLength(maxLength);
  if(intMaxLength <= stringLength)return S;
  if(fillStr == '')fillStr = ' ';
  var fillLen = intMaxLength - stringLength
    , stringFiller = repeat.call(fillStr, Math.ceil(fillLen / fillStr.length));
  if(stringFiller.length > fillLen)stringFiller = stringFiller.slice(0, fillLen);
  return left ? stringFiller + S : S + stringFiller;
};
},{"./$.defined":36,"./$.string-repeat":91,"./$.to-length":97}],91:[function(require,module,exports){
'use strict';
var toInteger = require('./$.to-integer')
  , defined   = require('./$.defined');

module.exports = function repeat(count){
  var str = String(defined(this))
    , res = ''
    , n   = toInteger(count);
  if(n < 0 || n == Infinity)throw RangeError("Count can't be negative");
  for(;n > 0; (n >>>= 1) && (str += str))if(n & 1)res += str;
  return res;
};
},{"./$.defined":36,"./$.to-integer":95}],92:[function(require,module,exports){
var $export = require('./$.export')
  , defined = require('./$.defined')
  , fails   = require('./$.fails')
  , spaces  = '\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003' +
      '\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF'
  , space   = '[' + spaces + ']'
  , non     = '\u200b\u0085'
  , ltrim   = RegExp('^' + space + space + '*')
  , rtrim   = RegExp(space + space + '*$');

var exporter = function(KEY, exec){
  var exp  = {};
  exp[KEY] = exec(trim);
  $export($export.P + $export.F * fails(function(){
    return !!spaces[KEY]() || non[KEY]() != non;
  }), 'String', exp);
};

// 1 -> String#trimLeft
// 2 -> String#trimRight
// 3 -> String#trim
var trim = exporter.trim = function(string, TYPE){
  string = String(defined(string));
  if(TYPE & 1)string = string.replace(ltrim, '');
  if(TYPE & 2)string = string.replace(rtrim, '');
  return string;
};

module.exports = exporter;
},{"./$.defined":36,"./$.export":40,"./$.fails":42}],93:[function(require,module,exports){
var ctx                = require('./$.ctx')
  , invoke             = require('./$.invoke')
  , html               = require('./$.html')
  , cel                = require('./$.dom-create')
  , global             = require('./$.global')
  , process            = global.process
  , setTask            = global.setImmediate
  , clearTask          = global.clearImmediate
  , MessageChannel     = global.MessageChannel
  , counter            = 0
  , queue              = {}
  , ONREADYSTATECHANGE = 'onreadystatechange'
  , defer, channel, port;
var run = function(){
  var id = +this;
  if(queue.hasOwnProperty(id)){
    var fn = queue[id];
    delete queue[id];
    fn();
  }
};
var listner = function(event){
  run.call(event.data);
};
// Node.js 0.9+ & IE10+ has setImmediate, otherwise:
if(!setTask || !clearTask){
  setTask = function setImmediate(fn){
    var args = [], i = 1;
    while(arguments.length > i)args.push(arguments[i++]);
    queue[++counter] = function(){
      invoke(typeof fn == 'function' ? fn : Function(fn), args);
    };
    defer(counter);
    return counter;
  };
  clearTask = function clearImmediate(id){
    delete queue[id];
  };
  // Node.js 0.8-
  if(require('./$.cof')(process) == 'process'){
    defer = function(id){
      process.nextTick(ctx(run, id, 1));
    };
  // Browsers with MessageChannel, includes WebWorkers
  } else if(MessageChannel){
    channel = new MessageChannel;
    port    = channel.port2;
    channel.port1.onmessage = listner;
    defer = ctx(port.postMessage, port, 1);
  // Browsers with postMessage, skip WebWorkers
  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'
  } else if(global.addEventListener && typeof postMessage == 'function' && !global.importScripts){
    defer = function(id){
      global.postMessage(id + '', '*');
    };
    global.addEventListener('message', listner, false);
  // IE8-
  } else if(ONREADYSTATECHANGE in cel('script')){
    defer = function(id){
      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function(){
        html.removeChild(this);
        run.call(id);
      };
    };
  // Rest old browsers
  } else {
    defer = function(id){
      setTimeout(ctx(run, id, 1), 0);
    };
  }
}
module.exports = {
  set:   setTask,
  clear: clearTask
};
},{"./$.cof":29,"./$.ctx":35,"./$.dom-create":38,"./$.global":47,"./$.html":50,"./$.invoke":51}],94:[function(require,module,exports){
var toInteger = require('./$.to-integer')
  , max       = Math.max
  , min       = Math.min;
module.exports = function(index, length){
  index = toInteger(index);
  return index < 0 ? max(index + length, 0) : min(index, length);
};
},{"./$.to-integer":95}],95:[function(require,module,exports){
// 7.1.4 ToInteger
var ceil  = Math.ceil
  , floor = Math.floor;
module.exports = function(it){
  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);
};
},{}],96:[function(require,module,exports){
// to indexed object, toObject with fallback for non-array-like ES3 strings
var IObject = require('./$.iobject')
  , defined = require('./$.defined');
module.exports = function(it){
  return IObject(defined(it));
};
},{"./$.defined":36,"./$.iobject":52}],97:[function(require,module,exports){
// 7.1.15 ToLength
var toInteger = require('./$.to-integer')
  , min       = Math.min;
module.exports = function(it){
  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991
};
},{"./$.to-integer":95}],98:[function(require,module,exports){
// 7.1.13 ToObject(argument)
var defined = require('./$.defined');
module.exports = function(it){
  return Object(defined(it));
};
},{"./$.defined":36}],99:[function(require,module,exports){
// 7.1.1 ToPrimitive(input [, PreferredType])
var isObject = require('./$.is-object');
// instead of the ES6 spec version, we didn't implement @@toPrimitive case
// and the second argument - flag - preferred type is a string
module.exports = function(it, S){
  if(!isObject(it))return it;
  var fn, val;
  if(S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it)))return val;
  if(typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it)))return val;
  if(!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it)))return val;
  throw TypeError("Can't convert object to primitive value");
};
},{"./$.is-object":56}],100:[function(require,module,exports){
var id = 0
  , px = Math.random();
module.exports = function(key){
  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));
};
},{}],101:[function(require,module,exports){
var store  = require('./$.shared')('wks')
  , uid    = require('./$.uid')
  , Symbol = require('./$.global').Symbol;
module.exports = function(name){
  return store[name] || (store[name] =
    Symbol && Symbol[name] || (Symbol || uid)('Symbol.' + name));
};
},{"./$.global":47,"./$.shared":85,"./$.uid":100}],102:[function(require,module,exports){
var classof   = require('./$.classof')
  , ITERATOR  = require('./$.wks')('iterator')
  , Iterators = require('./$.iterators');
module.exports = require('./$.core').getIteratorMethod = function(it){
  if(it != undefined)return it[ITERATOR]
    || it['@@iterator']
    || Iterators[classof(it)];
};
},{"./$.classof":28,"./$.core":34,"./$.iterators":63,"./$.wks":101}],103:[function(require,module,exports){
'use strict';
var $                 = require('./$')
  , $export           = require('./$.export')
  , DESCRIPTORS       = require('./$.descriptors')
  , createDesc        = require('./$.property-desc')
  , html              = require('./$.html')
  , cel               = require('./$.dom-create')
  , has               = require('./$.has')
  , cof               = require('./$.cof')
  , invoke            = require('./$.invoke')
  , fails             = require('./$.fails')
  , anObject          = require('./$.an-object')
  , aFunction         = require('./$.a-function')
  , isObject          = require('./$.is-object')
  , toObject          = require('./$.to-object')
  , toIObject         = require('./$.to-iobject')
  , toInteger         = require('./$.to-integer')
  , toIndex           = require('./$.to-index')
  , toLength          = require('./$.to-length')
  , IObject           = require('./$.iobject')
  , IE_PROTO          = require('./$.uid')('__proto__')
  , createArrayMethod = require('./$.array-methods')
  , arrayIndexOf      = require('./$.array-includes')(false)
  , ObjectProto       = Object.prototype
  , ArrayProto        = Array.prototype
  , arraySlice        = ArrayProto.slice
  , arrayJoin         = ArrayProto.join
  , defineProperty    = $.setDesc
  , getOwnDescriptor  = $.getDesc
  , defineProperties  = $.setDescs
  , factories         = {}
  , IE8_DOM_DEFINE;

if(!DESCRIPTORS){
  IE8_DOM_DEFINE = !fails(function(){
    return defineProperty(cel('div'), 'a', {get: function(){ return 7; }}).a != 7;
  });
  $.setDesc = function(O, P, Attributes){
    if(IE8_DOM_DEFINE)try {
      return defineProperty(O, P, Attributes);
    } catch(e){ /* empty */ }
    if('get' in Attributes || 'set' in Attributes)throw TypeError('Accessors not supported!');
    if('value' in Attributes)anObject(O)[P] = Attributes.value;
    return O;
  };
  $.getDesc = function(O, P){
    if(IE8_DOM_DEFINE)try {
      return getOwnDescriptor(O, P);
    } catch(e){ /* empty */ }
    if(has(O, P))return createDesc(!ObjectProto.propertyIsEnumerable.call(O, P), O[P]);
  };
  $.setDescs = defineProperties = function(O, Properties){
    anObject(O);
    var keys   = $.getKeys(Properties)
      , length = keys.length
      , i = 0
      , P;
    while(length > i)$.setDesc(O, P = keys[i++], Properties[P]);
    return O;
  };
}
$export($export.S + $export.F * !DESCRIPTORS, 'Object', {
  // 19.1.2.6 / 15.2.3.3 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $.getDesc,
  // 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)
  defineProperty: $.setDesc,
  // 19.1.2.3 / 15.2.3.7 Object.defineProperties(O, Properties)
  defineProperties: defineProperties
});

  // IE 8- don't enum bug keys
var keys1 = ('constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,' +
            'toLocaleString,toString,valueOf').split(',')
  // Additional keys for getOwnPropertyNames
  , keys2 = keys1.concat('length', 'prototype')
  , keysLen1 = keys1.length;

// Create object with `null` prototype: use iframe Object with cleared prototype
var createDict = function(){
  // Thrash, waste and sodomy: IE GC bug
  var iframe = cel('iframe')
    , i      = keysLen1
    , gt     = '>'
    , iframeDocument;
  iframe.style.display = 'none';
  html.appendChild(iframe);
  iframe.src = 'javascript:'; // eslint-disable-line no-script-url
  // createDict = iframe.contentWindow.Object;
  // html.removeChild(iframe);
  iframeDocument = iframe.contentWindow.document;
  iframeDocument.open();
  iframeDocument.write('<script>document.F=Object</script' + gt);
  iframeDocument.close();
  createDict = iframeDocument.F;
  while(i--)delete createDict.prototype[keys1[i]];
  return createDict();
};
var createGetKeys = function(names, length){
  return function(object){
    var O      = toIObject(object)
      , i      = 0
      , result = []
      , key;
    for(key in O)if(key != IE_PROTO)has(O, key) && result.push(key);
    // Don't enum bug & hidden keys
    while(length > i)if(has(O, key = names[i++])){
      ~arrayIndexOf(result, key) || result.push(key);
    }
    return result;
  };
};
var Empty = function(){};
$export($export.S, 'Object', {
  // 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)
  getPrototypeOf: $.getProto = $.getProto || function(O){
    O = toObject(O);
    if(has(O, IE_PROTO))return O[IE_PROTO];
    if(typeof O.constructor == 'function' && O instanceof O.constructor){
      return O.constructor.prototype;
    } return O instanceof Object ? ObjectProto : null;
  },
  // 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $.getNames = $.getNames || createGetKeys(keys2, keys2.length, true),
  // 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
  create: $.create = $.create || function(O, /*?*/Properties){
    var result;
    if(O !== null){
      Empty.prototype = anObject(O);
      result = new Empty();
      Empty.prototype = null;
      // add "__proto__" for Object.getPrototypeOf shim
      result[IE_PROTO] = O;
    } else result = createDict();
    return Properties === undefined ? result : defineProperties(result, Properties);
  },
  // 19.1.2.14 / 15.2.3.14 Object.keys(O)
  keys: $.getKeys = $.getKeys || createGetKeys(keys1, keysLen1, false)
});

var construct = function(F, len, args){
  if(!(len in factories)){
    for(var n = [], i = 0; i < len; i++)n[i] = 'a[' + i + ']';
    factories[len] = Function('F,a', 'return new F(' + n.join(',') + ')');
  }
  return factories[len](F, args);
};

// 19.2.3.2 / 15.3.4.5 Function.prototype.bind(thisArg, args...)
$export($export.P, 'Function', {
  bind: function bind(that /*, args... */){
    var fn       = aFunction(this)
      , partArgs = arraySlice.call(arguments, 1);
    var bound = function(/* args... */){
      var args = partArgs.concat(arraySlice.call(arguments));
      return this instanceof bound ? construct(fn, args.length, args) : invoke(fn, args, that);
    };
    if(isObject(fn.prototype))bound.prototype = fn.prototype;
    return bound;
  }
});

// fallback for not array-like ES3 strings and DOM objects
$export($export.P + $export.F * fails(function(){
  if(html)arraySlice.call(html);
}), 'Array', {
  slice: function(begin, end){
    var len   = toLength(this.length)
      , klass = cof(this);
    end = end === undefined ? len : end;
    if(klass == 'Array')return arraySlice.call(this, begin, end);
    var start  = toIndex(begin, len)
      , upTo   = toIndex(end, len)
      , size   = toLength(upTo - start)
      , cloned = Array(size)
      , i      = 0;
    for(; i < size; i++)cloned[i] = klass == 'String'
      ? this.charAt(start + i)
      : this[start + i];
    return cloned;
  }
});
$export($export.P + $export.F * (IObject != Object), 'Array', {
  join: function join(separator){
    return arrayJoin.call(IObject(this), separator === undefined ? ',' : separator);
  }
});

// 22.1.2.2 / 15.4.3.2 Array.isArray(arg)
$export($export.S, 'Array', {isArray: require('./$.is-array')});

var createArrayReduce = function(isRight){
  return function(callbackfn, memo){
    aFunction(callbackfn);
    var O      = IObject(this)
      , length = toLength(O.length)
      , index  = isRight ? length - 1 : 0
      , i      = isRight ? -1 : 1;
    if(arguments.length < 2)for(;;){
      if(index in O){
        memo = O[index];
        index += i;
        break;
      }
      index += i;
      if(isRight ? index < 0 : length <= index){
        throw TypeError('Reduce of empty array with no initial value');
      }
    }
    for(;isRight ? index >= 0 : length > index; index += i)if(index in O){
      memo = callbackfn(memo, O[index], index, this);
    }
    return memo;
  };
};

var methodize = function($fn){
  return function(arg1/*, arg2 = undefined */){
    return $fn(this, arg1, arguments[1]);
  };
};

$export($export.P, 'Array', {
  // 22.1.3.10 / 15.4.4.18 Array.prototype.forEach(callbackfn [, thisArg])
  forEach: $.each = $.each || methodize(createArrayMethod(0)),
  // 22.1.3.15 / 15.4.4.19 Array.prototype.map(callbackfn [, thisArg])
  map: methodize(createArrayMethod(1)),
  // 22.1.3.7 / 15.4.4.20 Array.prototype.filter(callbackfn [, thisArg])
  filter: methodize(createArrayMethod(2)),
  // 22.1.3.23 / 15.4.4.17 Array.prototype.some(callbackfn [, thisArg])
  some: methodize(createArrayMethod(3)),
  // 22.1.3.5 / 15.4.4.16 Array.prototype.every(callbackfn [, thisArg])
  every: methodize(createArrayMethod(4)),
  // 22.1.3.18 / 15.4.4.21 Array.prototype.reduce(callbackfn [, initialValue])
  reduce: createArrayReduce(false),
  // 22.1.3.19 / 15.4.4.22 Array.prototype.reduceRight(callbackfn [, initialValue])
  reduceRight: createArrayReduce(true),
  // 22.1.3.11 / 15.4.4.14 Array.prototype.indexOf(searchElement [, fromIndex])
  indexOf: methodize(arrayIndexOf),
  // 22.1.3.14 / 15.4.4.15 Array.prototype.lastIndexOf(searchElement [, fromIndex])
  lastIndexOf: function(el, fromIndex /* = @[*-1] */){
    var O      = toIObject(this)
      , length = toLength(O.length)
      , index  = length - 1;
    if(arguments.length > 1)index = Math.min(index, toInteger(fromIndex));
    if(index < 0)index = toLength(length + index);
    for(;index >= 0; index--)if(index in O)if(O[index] === el)return index;
    return -1;
  }
});

// 20.3.3.1 / 15.9.4.4 Date.now()
$export($export.S, 'Date', {now: function(){ return +new Date; }});

var lz = function(num){
  return num > 9 ? num : '0' + num;
};

// 20.3.4.36 / 15.9.5.43 Date.prototype.toISOString()
// PhantomJS / old WebKit has a broken implementations
$export($export.P + $export.F * (fails(function(){
  return new Date(-5e13 - 1).toISOString() != '0385-07-25T07:06:39.999Z';
}) || !fails(function(){
  new Date(NaN).toISOString();
})), 'Date', {
  toISOString: function toISOString(){
    if(!isFinite(this))throw RangeError('Invalid time value');
    var d = this
      , y = d.getUTCFullYear()
      , m = d.getUTCMilliseconds()
      , s = y < 0 ? '-' : y > 9999 ? '+' : '';
    return s + ('00000' + Math.abs(y)).slice(s ? -6 : -4) +
      '-' + lz(d.getUTCMonth() + 1) + '-' + lz(d.getUTCDate()) +
      'T' + lz(d.getUTCHours()) + ':' + lz(d.getUTCMinutes()) +
      ':' + lz(d.getUTCSeconds()) + '.' + (m > 99 ? m : '0' + lz(m)) + 'Z';
  }
});
},{"./$":64,"./$.a-function":20,"./$.an-object":22,"./$.array-includes":25,"./$.array-methods":26,"./$.cof":29,"./$.descriptors":37,"./$.dom-create":38,"./$.export":40,"./$.fails":42,"./$.has":48,"./$.html":50,"./$.invoke":51,"./$.iobject":52,"./$.is-array":54,"./$.is-object":56,"./$.property-desc":77,"./$.to-index":94,"./$.to-integer":95,"./$.to-iobject":96,"./$.to-length":97,"./$.to-object":98,"./$.uid":100}],104:[function(require,module,exports){
// 22.1.3.3 Array.prototype.copyWithin(target, start, end = this.length)
var $export = require('./$.export');

$export($export.P, 'Array', {copyWithin: require('./$.array-copy-within')});

require('./$.add-to-unscopables')('copyWithin');
},{"./$.add-to-unscopables":21,"./$.array-copy-within":23,"./$.export":40}],105:[function(require,module,exports){
// 22.1.3.6 Array.prototype.fill(value, start = 0, end = this.length)
var $export = require('./$.export');

$export($export.P, 'Array', {fill: require('./$.array-fill')});

require('./$.add-to-unscopables')('fill');
},{"./$.add-to-unscopables":21,"./$.array-fill":24,"./$.export":40}],106:[function(require,module,exports){
'use strict';
// 22.1.3.9 Array.prototype.findIndex(predicate, thisArg = undefined)
var $export = require('./$.export')
  , $find   = require('./$.array-methods')(6)
  , KEY     = 'findIndex'
  , forced  = true;
// Shouldn't skip holes
if(KEY in [])Array(1)[KEY](function(){ forced = false; });
$export($export.P + $export.F * forced, 'Array', {
  findIndex: function findIndex(callbackfn/*, that = undefined */){
    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);
  }
});
require('./$.add-to-unscopables')(KEY);
},{"./$.add-to-unscopables":21,"./$.array-methods":26,"./$.export":40}],107:[function(require,module,exports){
'use strict';
// 22.1.3.8 Array.prototype.find(predicate, thisArg = undefined)
var $export = require('./$.export')
  , $find   = require('./$.array-methods')(5)
  , KEY     = 'find'
  , forced  = true;
// Shouldn't skip holes
if(KEY in [])Array(1)[KEY](function(){ forced = false; });
$export($export.P + $export.F * forced, 'Array', {
  find: function find(callbackfn/*, that = undefined */){
    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);
  }
});
require('./$.add-to-unscopables')(KEY);
},{"./$.add-to-unscopables":21,"./$.array-methods":26,"./$.export":40}],108:[function(require,module,exports){
'use strict';
var ctx         = require('./$.ctx')
  , $export     = require('./$.export')
  , toObject    = require('./$.to-object')
  , call        = require('./$.iter-call')
  , isArrayIter = require('./$.is-array-iter')
  , toLength    = require('./$.to-length')
  , getIterFn   = require('./core.get-iterator-method');
$export($export.S + $export.F * !require('./$.iter-detect')(function(iter){ Array.from(iter); }), 'Array', {
  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)
  from: function from(arrayLike/*, mapfn = undefined, thisArg = undefined*/){
    var O       = toObject(arrayLike)
      , C       = typeof this == 'function' ? this : Array
      , $$      = arguments
      , $$len   = $$.length
      , mapfn   = $$len > 1 ? $$[1] : undefined
      , mapping = mapfn !== undefined
      , index   = 0
      , iterFn  = getIterFn(O)
      , length, result, step, iterator;
    if(mapping)mapfn = ctx(mapfn, $$len > 2 ? $$[2] : undefined, 2);
    // if object isn't iterable or it's array with default iterator - use simple case
    if(iterFn != undefined && !(C == Array && isArrayIter(iterFn))){
      for(iterator = iterFn.call(O), result = new C; !(step = iterator.next()).done; index++){
        result[index] = mapping ? call(iterator, mapfn, [step.value, index], true) : step.value;
      }
    } else {
      length = toLength(O.length);
      for(result = new C(length); length > index; index++){
        result[index] = mapping ? mapfn(O[index], index) : O[index];
      }
    }
    result.length = index;
    return result;
  }
});

},{"./$.ctx":35,"./$.export":40,"./$.is-array-iter":53,"./$.iter-call":58,"./$.iter-detect":61,"./$.to-length":97,"./$.to-object":98,"./core.get-iterator-method":102}],109:[function(require,module,exports){
'use strict';
var addToUnscopables = require('./$.add-to-unscopables')
  , step             = require('./$.iter-step')
  , Iterators        = require('./$.iterators')
  , toIObject        = require('./$.to-iobject');

// 22.1.3.4 Array.prototype.entries()
// 22.1.3.13 Array.prototype.keys()
// 22.1.3.29 Array.prototype.values()
// 22.1.3.30 Array.prototype[@@iterator]()
module.exports = require('./$.iter-define')(Array, 'Array', function(iterated, kind){
  this._t = toIObject(iterated); // target
  this._i = 0;                   // next index
  this._k = kind;                // kind
// 22.1.5.2.1 %ArrayIteratorPrototype%.next()
}, function(){
  var O     = this._t
    , kind  = this._k
    , index = this._i++;
  if(!O || index >= O.length){
    this._t = undefined;
    return step(1);
  }
  if(kind == 'keys'  )return step(0, index);
  if(kind == 'values')return step(0, O[index]);
  return step(0, [index, O[index]]);
}, 'values');

// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)
Iterators.Arguments = Iterators.Array;

addToUnscopables('keys');
addToUnscopables('values');
addToUnscopables('entries');
},{"./$.add-to-unscopables":21,"./$.iter-define":60,"./$.iter-step":62,"./$.iterators":63,"./$.to-iobject":96}],110:[function(require,module,exports){
'use strict';
var $export = require('./$.export');

// WebKit Array.of isn't generic
$export($export.S + $export.F * require('./$.fails')(function(){
  function F(){}
  return !(Array.of.call(F) instanceof F);
}), 'Array', {
  // 22.1.2.3 Array.of( ...items)
  of: function of(/* ...args */){
    var index  = 0
      , $$     = arguments
      , $$len  = $$.length
      , result = new (typeof this == 'function' ? this : Array)($$len);
    while($$len > index)result[index] = $$[index++];
    result.length = $$len;
    return result;
  }
});
},{"./$.export":40,"./$.fails":42}],111:[function(require,module,exports){
require('./$.set-species')('Array');
},{"./$.set-species":83}],112:[function(require,module,exports){
'use strict';
var $             = require('./$')
  , isObject      = require('./$.is-object')
  , HAS_INSTANCE  = require('./$.wks')('hasInstance')
  , FunctionProto = Function.prototype;
// 19.2.3.6 Function.prototype[@@hasInstance](V)
if(!(HAS_INSTANCE in FunctionProto))$.setDesc(FunctionProto, HAS_INSTANCE, {value: function(O){
  if(typeof this != 'function' || !isObject(O))return false;
  if(!isObject(this.prototype))return O instanceof this;
  // for environment w/o native `@@hasInstance` logic enough `instanceof`, but add this:
  while(O = $.getProto(O))if(this.prototype === O)return true;
  return false;
}});
},{"./$":64,"./$.is-object":56,"./$.wks":101}],113:[function(require,module,exports){
var setDesc    = require('./$').setDesc
  , createDesc = require('./$.property-desc')
  , has        = require('./$.has')
  , FProto     = Function.prototype
  , nameRE     = /^\s*function ([^ (]*)/
  , NAME       = 'name';
// 19.2.4.2 name
NAME in FProto || require('./$.descriptors') && setDesc(FProto, NAME, {
  configurable: true,
  get: function(){
    var match = ('' + this).match(nameRE)
      , name  = match ? match[1] : '';
    has(this, NAME) || setDesc(this, NAME, createDesc(5, name));
    return name;
  }
});
},{"./$":64,"./$.descriptors":37,"./$.has":48,"./$.property-desc":77}],114:[function(require,module,exports){
'use strict';
var strong = require('./$.collection-strong');

// 23.1 Map Objects
require('./$.collection')('Map', function(get){
  return function Map(){ return get(this, arguments.length > 0 ? arguments[0] : undefined); };
}, {
  // 23.1.3.6 Map.prototype.get(key)
  get: function get(key){
    var entry = strong.getEntry(this, key);
    return entry && entry.v;
  },
  // 23.1.3.9 Map.prototype.set(key, value)
  set: function set(key, value){
    return strong.def(this, key === 0 ? 0 : key, value);
  }
}, strong, true);
},{"./$.collection":33,"./$.collection-strong":30}],115:[function(require,module,exports){
// 20.2.2.3 Math.acosh(x)
var $export = require('./$.export')
  , log1p   = require('./$.math-log1p')
  , sqrt    = Math.sqrt
  , $acosh  = Math.acosh;

// V8 bug https://code.google.com/p/v8/issues/detail?id=3509
$export($export.S + $export.F * !($acosh && Math.floor($acosh(Number.MAX_VALUE)) == 710), 'Math', {
  acosh: function acosh(x){
    return (x = +x) < 1 ? NaN : x > 94906265.62425156
      ? Math.log(x) + Math.LN2
      : log1p(x - 1 + sqrt(x - 1) * sqrt(x + 1));
  }
});
},{"./$.export":40,"./$.math-log1p":68}],116:[function(require,module,exports){
// 20.2.2.5 Math.asinh(x)
var $export = require('./$.export');

function asinh(x){
  return !isFinite(x = +x) || x == 0 ? x : x < 0 ? -asinh(-x) : Math.log(x + Math.sqrt(x * x + 1));
}

$export($export.S, 'Math', {asinh: asinh});
},{"./$.export":40}],117:[function(require,module,exports){
// 20.2.2.7 Math.atanh(x)
var $export = require('./$.export');

$export($export.S, 'Math', {
  atanh: function atanh(x){
    return (x = +x) == 0 ? x : Math.log((1 + x) / (1 - x)) / 2;
  }
});
},{"./$.export":40}],118:[function(require,module,exports){
// 20.2.2.9 Math.cbrt(x)
var $export = require('./$.export')
  , sign    = require('./$.math-sign');

$export($export.S, 'Math', {
  cbrt: function cbrt(x){
    return sign(x = +x) * Math.pow(Math.abs(x), 1 / 3);
  }
});
},{"./$.export":40,"./$.math-sign":69}],119:[function(require,module,exports){
// 20.2.2.11 Math.clz32(x)
var $export = require('./$.export');

$export($export.S, 'Math', {
  clz32: function clz32(x){
    return (x >>>= 0) ? 31 - Math.floor(Math.log(x + 0.5) * Math.LOG2E) : 32;
  }
});
},{"./$.export":40}],120:[function(require,module,exports){
// 20.2.2.12 Math.cosh(x)
var $export = require('./$.export')
  , exp     = Math.exp;

$export($export.S, 'Math', {
  cosh: function cosh(x){
    return (exp(x = +x) + exp(-x)) / 2;
  }
});
},{"./$.export":40}],121:[function(require,module,exports){
// 20.2.2.14 Math.expm1(x)
var $export = require('./$.export');

$export($export.S, 'Math', {expm1: require('./$.math-expm1')});
},{"./$.export":40,"./$.math-expm1":67}],122:[function(require,module,exports){
// 20.2.2.16 Math.fround(x)
var $export   = require('./$.export')
  , sign      = require('./$.math-sign')
  , pow       = Math.pow
  , EPSILON   = pow(2, -52)
  , EPSILON32 = pow(2, -23)
  , MAX32     = pow(2, 127) * (2 - EPSILON32)
  , MIN32     = pow(2, -126);

var roundTiesToEven = function(n){
  return n + 1 / EPSILON - 1 / EPSILON;
};


$export($export.S, 'Math', {
  fround: function fround(x){
    var $abs  = Math.abs(x)
      , $sign = sign(x)
      , a, result;
    if($abs < MIN32)return $sign * roundTiesToEven($abs / MIN32 / EPSILON32) * MIN32 * EPSILON32;
    a = (1 + EPSILON32 / EPSILON) * $abs;
    result = a - (a - $abs);
    if(result > MAX32 || result != result)return $sign * Infinity;
    return $sign * result;
  }
});
},{"./$.export":40,"./$.math-sign":69}],123:[function(require,module,exports){
// 20.2.2.17 Math.hypot([value1[, value2[,  ]]])
var $export = require('./$.export')
  , abs     = Math.abs;

$export($export.S, 'Math', {
  hypot: function hypot(value1, value2){ // eslint-disable-line no-unused-vars
    var sum   = 0
      , i     = 0
      , $$    = arguments
      , $$len = $$.length
      , larg  = 0
      , arg, div;
    while(i < $$len){
      arg = abs($$[i++]);
      if(larg < arg){
        div  = larg / arg;
        sum  = sum * div * div + 1;
        larg = arg;
      } else if(arg > 0){
        div  = arg / larg;
        sum += div * div;
      } else sum += arg;
    }
    return larg === Infinity ? Infinity : larg * Math.sqrt(sum);
  }
});
},{"./$.export":40}],124:[function(require,module,exports){
// 20.2.2.18 Math.imul(x, y)
var $export = require('./$.export')
  , $imul   = Math.imul;

// some WebKit versions fails with big numbers, some has wrong arity
$export($export.S + $export.F * require('./$.fails')(function(){
  return $imul(0xffffffff, 5) != -5 || $imul.length != 2;
}), 'Math', {
  imul: function imul(x, y){
    var UINT16 = 0xffff
      , xn = +x
      , yn = +y
      , xl = UINT16 & xn
      , yl = UINT16 & yn;
    return 0 | xl * yl + ((UINT16 & xn >>> 16) * yl + xl * (UINT16 & yn >>> 16) << 16 >>> 0);
  }
});
},{"./$.export":40,"./$.fails":42}],125:[function(require,module,exports){
// 20.2.2.21 Math.log10(x)
var $export = require('./$.export');

$export($export.S, 'Math', {
  log10: function log10(x){
    return Math.log(x) / Math.LN10;
  }
});
},{"./$.export":40}],126:[function(require,module,exports){
// 20.2.2.20 Math.log1p(x)
var $export = require('./$.export');

$export($export.S, 'Math', {log1p: require('./$.math-log1p')});
},{"./$.export":40,"./$.math-log1p":68}],127:[function(require,module,exports){
// 20.2.2.22 Math.log2(x)
var $export = require('./$.export');

$export($export.S, 'Math', {
  log2: function log2(x){
    return Math.log(x) / Math.LN2;
  }
});
},{"./$.export":40}],128:[function(require,module,exports){
// 20.2.2.28 Math.sign(x)
var $export = require('./$.export');

$export($export.S, 'Math', {sign: require('./$.math-sign')});
},{"./$.export":40,"./$.math-sign":69}],129:[function(require,module,exports){
// 20.2.2.30 Math.sinh(x)
var $export = require('./$.export')
  , expm1   = require('./$.math-expm1')
  , exp     = Math.exp;

// V8 near Chromium 38 has a problem with very small numbers
$export($export.S + $export.F * require('./$.fails')(function(){
  return !Math.sinh(-2e-17) != -2e-17;
}), 'Math', {
  sinh: function sinh(x){
    return Math.abs(x = +x) < 1
      ? (expm1(x) - expm1(-x)) / 2
      : (exp(x - 1) - exp(-x - 1)) * (Math.E / 2);
  }
});
},{"./$.export":40,"./$.fails":42,"./$.math-expm1":67}],130:[function(require,module,exports){
// 20.2.2.33 Math.tanh(x)
var $export = require('./$.export')
  , expm1   = require('./$.math-expm1')
  , exp     = Math.exp;

$export($export.S, 'Math', {
  tanh: function tanh(x){
    var a = expm1(x = +x)
      , b = expm1(-x);
    return a == Infinity ? 1 : b == Infinity ? -1 : (a - b) / (exp(x) + exp(-x));
  }
});
},{"./$.export":40,"./$.math-expm1":67}],131:[function(require,module,exports){
// 20.2.2.34 Math.trunc(x)
var $export = require('./$.export');

$export($export.S, 'Math', {
  trunc: function trunc(it){
    return (it > 0 ? Math.floor : Math.ceil)(it);
  }
});
},{"./$.export":40}],132:[function(require,module,exports){
'use strict';
var $           = require('./$')
  , global      = require('./$.global')
  , has         = require('./$.has')
  , cof         = require('./$.cof')
  , toPrimitive = require('./$.to-primitive')
  , fails       = require('./$.fails')
  , $trim       = require('./$.string-trim').trim
  , NUMBER      = 'Number'
  , $Number     = global[NUMBER]
  , Base        = $Number
  , proto       = $Number.prototype
  // Opera ~12 has broken Object#toString
  , BROKEN_COF  = cof($.create(proto)) == NUMBER
  , TRIM        = 'trim' in String.prototype;

// 7.1.3 ToNumber(argument)
var toNumber = function(argument){
  var it = toPrimitive(argument, false);
  if(typeof it == 'string' && it.length > 2){
    it = TRIM ? it.trim() : $trim(it, 3);
    var first = it.charCodeAt(0)
      , third, radix, maxCode;
    if(first === 43 || first === 45){
      third = it.charCodeAt(2);
      if(third === 88 || third === 120)return NaN; // Number('+0x1') should be NaN, old V8 fix
    } else if(first === 48){
      switch(it.charCodeAt(1)){
        case 66 : case 98  : radix = 2; maxCode = 49; break; // fast equal /^0b[01]+$/i
        case 79 : case 111 : radix = 8; maxCode = 55; break; // fast equal /^0o[0-7]+$/i
        default : return +it;
      }
      for(var digits = it.slice(2), i = 0, l = digits.length, code; i < l; i++){
        code = digits.charCodeAt(i);
        // parseInt parses a string to a first unavailable symbol
        // but ToNumber should return NaN if a string contains unavailable symbols
        if(code < 48 || code > maxCode)return NaN;
      } return parseInt(digits, radix);
    }
  } return +it;
};

if(!$Number(' 0o1') || !$Number('0b1') || $Number('+0x1')){
  $Number = function Number(value){
    var it = arguments.length < 1 ? 0 : value
      , that = this;
    return that instanceof $Number
      // check on 1..constructor(foo) case
      && (BROKEN_COF ? fails(function(){ proto.valueOf.call(that); }) : cof(that) != NUMBER)
        ? new Base(toNumber(it)) : toNumber(it);
  };
  $.each.call(require('./$.descriptors') ? $.getNames(Base) : (
    // ES3:
    'MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,' +
    // ES6 (in case, if modules with ES6 Number statics required before):
    'EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,' +
    'MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger'
  ).split(','), function(key){
    if(has(Base, key) && !has($Number, key)){
      $.setDesc($Number, key, $.getDesc(Base, key));
    }
  });
  $Number.prototype = proto;
  proto.constructor = $Number;
  require('./$.redefine')(global, NUMBER, $Number);
}
},{"./$":64,"./$.cof":29,"./$.descriptors":37,"./$.fails":42,"./$.global":47,"./$.has":48,"./$.redefine":79,"./$.string-trim":92,"./$.to-primitive":99}],133:[function(require,module,exports){
// 20.1.2.1 Number.EPSILON
var $export = require('./$.export');

$export($export.S, 'Number', {EPSILON: Math.pow(2, -52)});
},{"./$.export":40}],134:[function(require,module,exports){
// 20.1.2.2 Number.isFinite(number)
var $export   = require('./$.export')
  , _isFinite = require('./$.global').isFinite;

$export($export.S, 'Number', {
  isFinite: function isFinite(it){
    return typeof it == 'number' && _isFinite(it);
  }
});
},{"./$.export":40,"./$.global":47}],135:[function(require,module,exports){
// 20.1.2.3 Number.isInteger(number)
var $export = require('./$.export');

$export($export.S, 'Number', {isInteger: require('./$.is-integer')});
},{"./$.export":40,"./$.is-integer":55}],136:[function(require,module,exports){
// 20.1.2.4 Number.isNaN(number)
var $export = require('./$.export');

$export($export.S, 'Number', {
  isNaN: function isNaN(number){
    return number != number;
  }
});
},{"./$.export":40}],137:[function(require,module,exports){
// 20.1.2.5 Number.isSafeInteger(number)
var $export   = require('./$.export')
  , isInteger = require('./$.is-integer')
  , abs       = Math.abs;

$export($export.S, 'Number', {
  isSafeInteger: function isSafeInteger(number){
    return isInteger(number) && abs(number) <= 0x1fffffffffffff;
  }
});
},{"./$.export":40,"./$.is-integer":55}],138:[function(require,module,exports){
// 20.1.2.6 Number.MAX_SAFE_INTEGER
var $export = require('./$.export');

$export($export.S, 'Number', {MAX_SAFE_INTEGER: 0x1fffffffffffff});
},{"./$.export":40}],139:[function(require,module,exports){
// 20.1.2.10 Number.MIN_SAFE_INTEGER
var $export = require('./$.export');

$export($export.S, 'Number', {MIN_SAFE_INTEGER: -0x1fffffffffffff});
},{"./$.export":40}],140:[function(require,module,exports){
// 20.1.2.12 Number.parseFloat(string)
var $export = require('./$.export');

$export($export.S, 'Number', {parseFloat: parseFloat});
},{"./$.export":40}],141:[function(require,module,exports){
// 20.1.2.13 Number.parseInt(string, radix)
var $export = require('./$.export');

$export($export.S, 'Number', {parseInt: parseInt});
},{"./$.export":40}],142:[function(require,module,exports){
// 19.1.3.1 Object.assign(target, source)
var $export = require('./$.export');

$export($export.S + $export.F, 'Object', {assign: require('./$.object-assign')});
},{"./$.export":40,"./$.object-assign":71}],143:[function(require,module,exports){
// 19.1.2.5 Object.freeze(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('freeze', function($freeze){
  return function freeze(it){
    return $freeze && isObject(it) ? $freeze(it) : it;
  };
});
},{"./$.is-object":56,"./$.object-sap":72}],144:[function(require,module,exports){
// 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
var toIObject = require('./$.to-iobject');

require('./$.object-sap')('getOwnPropertyDescriptor', function($getOwnPropertyDescriptor){
  return function getOwnPropertyDescriptor(it, key){
    return $getOwnPropertyDescriptor(toIObject(it), key);
  };
});
},{"./$.object-sap":72,"./$.to-iobject":96}],145:[function(require,module,exports){
// 19.1.2.7 Object.getOwnPropertyNames(O)
require('./$.object-sap')('getOwnPropertyNames', function(){
  return require('./$.get-names').get;
});
},{"./$.get-names":46,"./$.object-sap":72}],146:[function(require,module,exports){
// 19.1.2.9 Object.getPrototypeOf(O)
var toObject = require('./$.to-object');

require('./$.object-sap')('getPrototypeOf', function($getPrototypeOf){
  return function getPrototypeOf(it){
    return $getPrototypeOf(toObject(it));
  };
});
},{"./$.object-sap":72,"./$.to-object":98}],147:[function(require,module,exports){
// 19.1.2.11 Object.isExtensible(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('isExtensible', function($isExtensible){
  return function isExtensible(it){
    return isObject(it) ? $isExtensible ? $isExtensible(it) : true : false;
  };
});
},{"./$.is-object":56,"./$.object-sap":72}],148:[function(require,module,exports){
// 19.1.2.12 Object.isFrozen(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('isFrozen', function($isFrozen){
  return function isFrozen(it){
    return isObject(it) ? $isFrozen ? $isFrozen(it) : false : true;
  };
});
},{"./$.is-object":56,"./$.object-sap":72}],149:[function(require,module,exports){
// 19.1.2.13 Object.isSealed(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('isSealed', function($isSealed){
  return function isSealed(it){
    return isObject(it) ? $isSealed ? $isSealed(it) : false : true;
  };
});
},{"./$.is-object":56,"./$.object-sap":72}],150:[function(require,module,exports){
// 19.1.3.10 Object.is(value1, value2)
var $export = require('./$.export');
$export($export.S, 'Object', {is: require('./$.same-value')});
},{"./$.export":40,"./$.same-value":81}],151:[function(require,module,exports){
// 19.1.2.14 Object.keys(O)
var toObject = require('./$.to-object');

require('./$.object-sap')('keys', function($keys){
  return function keys(it){
    return $keys(toObject(it));
  };
});
},{"./$.object-sap":72,"./$.to-object":98}],152:[function(require,module,exports){
// 19.1.2.15 Object.preventExtensions(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('preventExtensions', function($preventExtensions){
  return function preventExtensions(it){
    return $preventExtensions && isObject(it) ? $preventExtensions(it) : it;
  };
});
},{"./$.is-object":56,"./$.object-sap":72}],153:[function(require,module,exports){
// 19.1.2.17 Object.seal(O)
var isObject = require('./$.is-object');

require('./$.object-sap')('seal', function($seal){
  return function seal(it){
    return $seal && isObject(it) ? $seal(it) : it;
  };
});
},{"./$.is-object":56,"./$.object-sap":72}],154:[function(require,module,exports){
// 19.1.3.19 Object.setPrototypeOf(O, proto)
var $export = require('./$.export');
$export($export.S, 'Object', {setPrototypeOf: require('./$.set-proto').set});
},{"./$.export":40,"./$.set-proto":82}],155:[function(require,module,exports){
'use strict';
// 19.1.3.6 Object.prototype.toString()
var classof = require('./$.classof')
  , test    = {};
test[require('./$.wks')('toStringTag')] = 'z';
if(test + '' != '[object z]'){
  require('./$.redefine')(Object.prototype, 'toString', function toString(){
    return '[object ' + classof(this) + ']';
  }, true);
}
},{"./$.classof":28,"./$.redefine":79,"./$.wks":101}],156:[function(require,module,exports){
'use strict';
var $          = require('./$')
  , LIBRARY    = require('./$.library')
  , global     = require('./$.global')
  , ctx        = require('./$.ctx')
  , classof    = require('./$.classof')
  , $export    = require('./$.export')
  , isObject   = require('./$.is-object')
  , anObject   = require('./$.an-object')
  , aFunction  = require('./$.a-function')
  , strictNew  = require('./$.strict-new')
  , forOf      = require('./$.for-of')
  , setProto   = require('./$.set-proto').set
  , same       = require('./$.same-value')
  , SPECIES    = require('./$.wks')('species')
  , speciesConstructor = require('./$.species-constructor')
  , asap       = require('./$.microtask')
  , PROMISE    = 'Promise'
  , process    = global.process
  , isNode     = classof(process) == 'process'
  , P          = global[PROMISE]
  , Wrapper;

var testResolve = function(sub){
  var test = new P(function(){});
  if(sub)test.constructor = Object;
  return P.resolve(test) === test;
};

var USE_NATIVE = function(){
  var works = false;
  function P2(x){
    var self = new P(x);
    setProto(self, P2.prototype);
    return self;
  }
  try {
    works = P && P.resolve && testResolve();
    setProto(P2, P);
    P2.prototype = $.create(P.prototype, {constructor: {value: P2}});
    // actual Firefox has broken subclass support, test that
    if(!(P2.resolve(5).then(function(){}) instanceof P2)){
      works = false;
    }
    // actual V8 bug, https://code.google.com/p/v8/issues/detail?id=4162
    if(works && require('./$.descriptors')){
      var thenableThenGotten = false;
      P.resolve($.setDesc({}, 'then', {
        get: function(){ thenableThenGotten = true; }
      }));
      works = thenableThenGotten;
    }
  } catch(e){ works = false; }
  return works;
}();

// helpers
var sameConstructor = function(a, b){
  // library wrapper special case
  if(LIBRARY && a === P && b === Wrapper)return true;
  return same(a, b);
};
var getConstructor = function(C){
  var S = anObject(C)[SPECIES];
  return S != undefined ? S : C;
};
var isThenable = function(it){
  var then;
  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;
};
var PromiseCapability = function(C){
  var resolve, reject;
  this.promise = new C(function($$resolve, $$reject){
    if(resolve !== undefined || reject !== undefined)throw TypeError('Bad Promise constructor');
    resolve = $$resolve;
    reject  = $$reject;
  });
  this.resolve = aFunction(resolve),
  this.reject  = aFunction(reject)
};
var perform = function(exec){
  try {
    exec();
  } catch(e){
    return {error: e};
  }
};
var notify = function(record, isReject){
  if(record.n)return;
  record.n = true;
  var chain = record.c;
  asap(function(){
    var value = record.v
      , ok    = record.s == 1
      , i     = 0;
    var run = function(reaction){
      var handler = ok ? reaction.ok : reaction.fail
        , resolve = reaction.resolve
        , reject  = reaction.reject
        , result, then;
      try {
        if(handler){
          if(!ok)record.h = true;
          result = handler === true ? value : handler(value);
          if(result === reaction.promise){
            reject(TypeError('Promise-chain cycle'));
          } else if(then = isThenable(result)){
            then.call(result, resolve, reject);
          } else resolve(result);
        } else reject(value);
      } catch(e){
        reject(e);
      }
    };
    while(chain.length > i)run(chain[i++]); // variable length - can't use forEach
    chain.length = 0;
    record.n = false;
    if(isReject)setTimeout(function(){
      var promise = record.p
        , handler, console;
      if(isUnhandled(promise)){
        if(isNode){
          process.emit('unhandledRejection', value, promise);
        } else if(handler = global.onunhandledrejection){
          handler({promise: promise, reason: value});
        } else if((console = global.console) && console.error){
          console.error('Unhandled promise rejection', value);
        }
      } record.a = undefined;
    }, 1);
  });
};
var isUnhandled = function(promise){
  var record = promise._d
    , chain  = record.a || record.c
    , i      = 0
    , reaction;
  if(record.h)return false;
  while(chain.length > i){
    reaction = chain[i++];
    if(reaction.fail || !isUnhandled(reaction.promise))return false;
  } return true;
};
var $reject = function(value){
  var record = this;
  if(record.d)return;
  record.d = true;
  record = record.r || record; // unwrap
  record.v = value;
  record.s = 2;
  record.a = record.c.slice();
  notify(record, true);
};
var $resolve = function(value){
  var record = this
    , then;
  if(record.d)return;
  record.d = true;
  record = record.r || record; // unwrap
  try {
    if(record.p === value)throw TypeError("Promise can't be resolved itself");
    if(then = isThenable(value)){
      asap(function(){
        var wrapper = {r: record, d: false}; // wrap
        try {
          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));
        } catch(e){
          $reject.call(wrapper, e);
        }
      });
    } else {
      record.v = value;
      record.s = 1;
      notify(record, false);
    }
  } catch(e){
    $reject.call({r: record, d: false}, e); // wrap
  }
};

// constructor polyfill
if(!USE_NATIVE){
  // 25.4.3.1 Promise(executor)
  P = function Promise(executor){
    aFunction(executor);
    var record = this._d = {
      p: strictNew(this, P, PROMISE),         // <- promise
      c: [],                                  // <- awaiting reactions
      a: undefined,                           // <- checked in isUnhandled reactions
      s: 0,                                   // <- state
      d: false,                               // <- done
      v: undefined,                           // <- value
      h: false,                               // <- handled rejection
      n: false                                // <- notify
    };
    try {
      executor(ctx($resolve, record, 1), ctx($reject, record, 1));
    } catch(err){
      $reject.call(record, err);
    }
  };
  require('./$.redefine-all')(P.prototype, {
    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)
    then: function then(onFulfilled, onRejected){
      var reaction = new PromiseCapability(speciesConstructor(this, P))
        , promise  = reaction.promise
        , record   = this._d;
      reaction.ok   = typeof onFulfilled == 'function' ? onFulfilled : true;
      reaction.fail = typeof onRejected == 'function' && onRejected;
      record.c.push(reaction);
      if(record.a)record.a.push(reaction);
      if(record.s)notify(record, false);
      return promise;
    },
    // 25.4.5.1 Promise.prototype.catch(onRejected)
    'catch': function(onRejected){
      return this.then(undefined, onRejected);
    }
  });
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, {Promise: P});
require('./$.set-to-string-tag')(P, PROMISE);
require('./$.set-species')(PROMISE);
Wrapper = require('./$.core')[PROMISE];

// statics
$export($export.S + $export.F * !USE_NATIVE, PROMISE, {
  // 25.4.4.5 Promise.reject(r)
  reject: function reject(r){
    var capability = new PromiseCapability(this)
      , $$reject   = capability.reject;
    $$reject(r);
    return capability.promise;
  }
});
$export($export.S + $export.F * (!USE_NATIVE || testResolve(true)), PROMISE, {
  // 25.4.4.6 Promise.resolve(x)
  resolve: function resolve(x){
    // instanceof instead of internal slot check because we should fix it without replacement native Promise core
    if(x instanceof P && sameConstructor(x.constructor, this))return x;
    var capability = new PromiseCapability(this)
      , $$resolve  = capability.resolve;
    $$resolve(x);
    return capability.promise;
  }
});
$export($export.S + $export.F * !(USE_NATIVE && require('./$.iter-detect')(function(iter){
  P.all(iter)['catch'](function(){});
})), PROMISE, {
  // 25.4.4.1 Promise.all(iterable)
  all: function all(iterable){
    var C          = getConstructor(this)
      , capability = new PromiseCapability(C)
      , resolve    = capability.resolve
      , reject     = capability.reject
      , values     = [];
    var abrupt = perform(function(){
      forOf(iterable, false, values.push, values);
      var remaining = values.length
        , results   = Array(remaining);
      if(remaining)$.each.call(values, function(promise, index){
        var alreadyCalled = false;
        C.resolve(promise).then(function(value){
          if(alreadyCalled)return;
          alreadyCalled = true;
          results[index] = value;
          --remaining || resolve(results);
        }, reject);
      });
      else resolve(results);
    });
    if(abrupt)reject(abrupt.error);
    return capability.promise;
  },
  // 25.4.4.4 Promise.race(iterable)
  race: function race(iterable){
    var C          = getConstructor(this)
      , capability = new PromiseCapability(C)
      , reject     = capability.reject;
    var abrupt = perform(function(){
      forOf(iterable, false, function(promise){
        C.resolve(promise).then(capability.resolve, reject);
      });
    });
    if(abrupt)reject(abrupt.error);
    return capability.promise;
  }
});
},{"./$":64,"./$.a-function":20,"./$.an-object":22,"./$.classof":28,"./$.core":34,"./$.ctx":35,"./$.descriptors":37,"./$.export":40,"./$.for-of":45,"./$.global":47,"./$.is-object":56,"./$.iter-detect":61,"./$.library":66,"./$.microtask":70,"./$.redefine-all":78,"./$.same-value":81,"./$.set-proto":82,"./$.set-species":83,"./$.set-to-string-tag":84,"./$.species-constructor":86,"./$.strict-new":87,"./$.wks":101}],157:[function(require,module,exports){
// 26.1.1 Reflect.apply(target, thisArgument, argumentsList)
var $export = require('./$.export')
  , _apply  = Function.apply;

$export($export.S, 'Reflect', {
  apply: function apply(target, thisArgument, argumentsList){
    return _apply.call(target, thisArgument, argumentsList);
  }
});
},{"./$.export":40}],158:[function(require,module,exports){
// 26.1.2 Reflect.construct(target, argumentsList [, newTarget])
var $         = require('./$')
  , $export   = require('./$.export')
  , aFunction = require('./$.a-function')
  , anObject  = require('./$.an-object')
  , isObject  = require('./$.is-object')
  , bind      = Function.bind || require('./$.core').Function.prototype.bind;

// MS Edge supports only 2 arguments
// FF Nightly sets third argument as `new.target`, but does not create `this` from it
$export($export.S + $export.F * require('./$.fails')(function(){
  function F(){}
  return !(Reflect.construct(function(){}, [], F) instanceof F);
}), 'Reflect', {
  construct: function construct(Target, args /*, newTarget*/){
    aFunction(Target);
    var newTarget = arguments.length < 3 ? Target : aFunction(arguments[2]);
    if(Target == newTarget){
      // w/o altered newTarget, optimization for 0-4 arguments
      if(args != undefined)switch(anObject(args).length){
        case 0: return new Target;
        case 1: return new Target(args[0]);
        case 2: return new Target(args[0], args[1]);
        case 3: return new Target(args[0], args[1], args[2]);
        case 4: return new Target(args[0], args[1], args[2], args[3]);
      }
      // w/o altered newTarget, lot of arguments case
      var $args = [null];
      $args.push.apply($args, args);
      return new (bind.apply(Target, $args));
    }
    // with altered newTarget, not support built-in constructors
    var proto    = newTarget.prototype
      , instance = $.create(isObject(proto) ? proto : Object.prototype)
      , result   = Function.apply.call(Target, instance, args);
    return isObject(result) ? result : instance;
  }
});
},{"./$":64,"./$.a-function":20,"./$.an-object":22,"./$.core":34,"./$.export":40,"./$.fails":42,"./$.is-object":56}],159:[function(require,module,exports){
// 26.1.3 Reflect.defineProperty(target, propertyKey, attributes)
var $        = require('./$')
  , $export  = require('./$.export')
  , anObject = require('./$.an-object');

// MS Edge has broken Reflect.defineProperty - throwing instead of returning false
$export($export.S + $export.F * require('./$.fails')(function(){
  Reflect.defineProperty($.setDesc({}, 1, {value: 1}), 1, {value: 2});
}), 'Reflect', {
  defineProperty: function defineProperty(target, propertyKey, attributes){
    anObject(target);
    try {
      $.setDesc(target, propertyKey, attributes);
      return true;
    } catch(e){
      return false;
    }
  }
});
},{"./$":64,"./$.an-object":22,"./$.export":40,"./$.fails":42}],160:[function(require,module,exports){
// 26.1.4 Reflect.deleteProperty(target, propertyKey)
var $export  = require('./$.export')
  , getDesc  = require('./$').getDesc
  , anObject = require('./$.an-object');

$export($export.S, 'Reflect', {
  deleteProperty: function deleteProperty(target, propertyKey){
    var desc = getDesc(anObject(target), propertyKey);
    return desc && !desc.configurable ? false : delete target[propertyKey];
  }
});
},{"./$":64,"./$.an-object":22,"./$.export":40}],161:[function(require,module,exports){
'use strict';
// 26.1.5 Reflect.enumerate(target)
var $export  = require('./$.export')
  , anObject = require('./$.an-object');
var Enumerate = function(iterated){
  this._t = anObject(iterated); // target
  this._i = 0;                  // next index
  var keys = this._k = []       // keys
    , key;
  for(key in iterated)keys.push(key);
};
require('./$.iter-create')(Enumerate, 'Object', function(){
  var that = this
    , keys = that._k
    , key;
  do {
    if(that._i >= keys.length)return {value: undefined, done: true};
  } while(!((key = keys[that._i++]) in that._t));
  return {value: key, done: false};
});

$export($export.S, 'Reflect', {
  enumerate: function enumerate(target){
    return new Enumerate(target);
  }
});
},{"./$.an-object":22,"./$.export":40,"./$.iter-create":59}],162:[function(require,module,exports){
// 26.1.7 Reflect.getOwnPropertyDescriptor(target, propertyKey)
var $        = require('./$')
  , $export  = require('./$.export')
  , anObject = require('./$.an-object');

$export($export.S, 'Reflect', {
  getOwnPropertyDescriptor: function getOwnPropertyDescriptor(target, propertyKey){
    return $.getDesc(anObject(target), propertyKey);
  }
});
},{"./$":64,"./$.an-object":22,"./$.export":40}],163:[function(require,module,exports){
// 26.1.8 Reflect.getPrototypeOf(target)
var $export  = require('./$.export')
  , getProto = require('./$').getProto
  , anObject = require('./$.an-object');

$export($export.S, 'Reflect', {
  getPrototypeOf: function getPrototypeOf(target){
    return getProto(anObject(target));
  }
});
},{"./$":64,"./$.an-object":22,"./$.export":40}],164:[function(require,module,exports){
// 26.1.6 Reflect.get(target, propertyKey [, receiver])
var $        = require('./$')
  , has      = require('./$.has')
  , $export  = require('./$.export')
  , isObject = require('./$.is-object')
  , anObject = require('./$.an-object');

function get(target, propertyKey/*, receiver*/){
  var receiver = arguments.length < 3 ? target : arguments[2]
    , desc, proto;
  if(anObject(target) === receiver)return target[propertyKey];
  if(desc = $.getDesc(target, propertyKey))return has(desc, 'value')
    ? desc.value
    : desc.get !== undefined
      ? desc.get.call(receiver)
      : undefined;
  if(isObject(proto = $.getProto(target)))return get(proto, propertyKey, receiver);
}

$export($export.S, 'Reflect', {get: get});
},{"./$":64,"./$.an-object":22,"./$.export":40,"./$.has":48,"./$.is-object":56}],165:[function(require,module,exports){
// 26.1.9 Reflect.has(target, propertyKey)
var $export = require('./$.export');

$export($export.S, 'Reflect', {
  has: function has(target, propertyKey){
    return propertyKey in target;
  }
});
},{"./$.export":40}],166:[function(require,module,exports){
// 26.1.10 Reflect.isExtensible(target)
var $export       = require('./$.export')
  , anObject      = require('./$.an-object')
  , $isExtensible = Object.isExtensible;

$export($export.S, 'Reflect', {
  isExtensible: function isExtensible(target){
    anObject(target);
    return $isExtensible ? $isExtensible(target) : true;
  }
});
},{"./$.an-object":22,"./$.export":40}],167:[function(require,module,exports){
// 26.1.11 Reflect.ownKeys(target)
var $export = require('./$.export');

$export($export.S, 'Reflect', {ownKeys: require('./$.own-keys')});
},{"./$.export":40,"./$.own-keys":74}],168:[function(require,module,exports){
// 26.1.12 Reflect.preventExtensions(target)
var $export            = require('./$.export')
  , anObject           = require('./$.an-object')
  , $preventExtensions = Object.preventExtensions;

$export($export.S, 'Reflect', {
  preventExtensions: function preventExtensions(target){
    anObject(target);
    try {
      if($preventExtensions)$preventExtensions(target);
      return true;
    } catch(e){
      return false;
    }
  }
});
},{"./$.an-object":22,"./$.export":40}],169:[function(require,module,exports){
// 26.1.14 Reflect.setPrototypeOf(target, proto)
var $export  = require('./$.export')
  , setProto = require('./$.set-proto');

if(setProto)$export($export.S, 'Reflect', {
  setPrototypeOf: function setPrototypeOf(target, proto){
    setProto.check(target, proto);
    try {
      setProto.set(target, proto);
      return true;
    } catch(e){
      return false;
    }
  }
});
},{"./$.export":40,"./$.set-proto":82}],170:[function(require,module,exports){
// 26.1.13 Reflect.set(target, propertyKey, V [, receiver])
var $          = require('./$')
  , has        = require('./$.has')
  , $export    = require('./$.export')
  , createDesc = require('./$.property-desc')
  , anObject   = require('./$.an-object')
  , isObject   = require('./$.is-object');

function set(target, propertyKey, V/*, receiver*/){
  var receiver = arguments.length < 4 ? target : arguments[3]
    , ownDesc  = $.getDesc(anObject(target), propertyKey)
    , existingDescriptor, proto;
  if(!ownDesc){
    if(isObject(proto = $.getProto(target))){
      return set(proto, propertyKey, V, receiver);
    }
    ownDesc = createDesc(0);
  }
  if(has(ownDesc, 'value')){
    if(ownDesc.writable === false || !isObject(receiver))return false;
    existingDescriptor = $.getDesc(receiver, propertyKey) || createDesc(0);
    existingDescriptor.value = V;
    $.setDesc(receiver, propertyKey, existingDescriptor);
    return true;
  }
  return ownDesc.set === undefined ? false : (ownDesc.set.call(receiver, V), true);
}

$export($export.S, 'Reflect', {set: set});
},{"./$":64,"./$.an-object":22,"./$.export":40,"./$.has":48,"./$.is-object":56,"./$.property-desc":77}],171:[function(require,module,exports){
var $        = require('./$')
  , global   = require('./$.global')
  , isRegExp = require('./$.is-regexp')
  , $flags   = require('./$.flags')
  , $RegExp  = global.RegExp
  , Base     = $RegExp
  , proto    = $RegExp.prototype
  , re1      = /a/g
  , re2      = /a/g
  // "new" creates a new object, old webkit buggy here
  , CORRECT_NEW = new $RegExp(re1) !== re1;

if(require('./$.descriptors') && (!CORRECT_NEW || require('./$.fails')(function(){
  re2[require('./$.wks')('match')] = false;
  // RegExp constructor can alter flags and IsRegExp works correct with @@match
  return $RegExp(re1) != re1 || $RegExp(re2) == re2 || $RegExp(re1, 'i') != '/a/i';
}))){
  $RegExp = function RegExp(p, f){
    var piRE = isRegExp(p)
      , fiU  = f === undefined;
    return !(this instanceof $RegExp) && piRE && p.constructor === $RegExp && fiU ? p
      : CORRECT_NEW
        ? new Base(piRE && !fiU ? p.source : p, f)
        : Base((piRE = p instanceof $RegExp) ? p.source : p, piRE && fiU ? $flags.call(p) : f);
  };
  $.each.call($.getNames(Base), function(key){
    key in $RegExp || $.setDesc($RegExp, key, {
      configurable: true,
      get: function(){ return Base[key]; },
      set: function(it){ Base[key] = it; }
    });
  });
  proto.constructor = $RegExp;
  $RegExp.prototype = proto;
  require('./$.redefine')(global, 'RegExp', $RegExp);
}

require('./$.set-species')('RegExp');
},{"./$":64,"./$.descriptors":37,"./$.fails":42,"./$.flags":44,"./$.global":47,"./$.is-regexp":57,"./$.redefine":79,"./$.set-species":83,"./$.wks":101}],172:[function(require,module,exports){
// 21.2.5.3 get RegExp.prototype.flags()
var $ = require('./$');
if(require('./$.descriptors') && /./g.flags != 'g')$.setDesc(RegExp.prototype, 'flags', {
  configurable: true,
  get: require('./$.flags')
});
},{"./$":64,"./$.descriptors":37,"./$.flags":44}],173:[function(require,module,exports){
// @@match logic
require('./$.fix-re-wks')('match', 1, function(defined, MATCH){
  // 21.1.3.11 String.prototype.match(regexp)
  return function match(regexp){
    'use strict';
    var O  = defined(this)
      , fn = regexp == undefined ? undefined : regexp[MATCH];
    return fn !== undefined ? fn.call(regexp, O) : new RegExp(regexp)[MATCH](String(O));
  };
});
},{"./$.fix-re-wks":43}],174:[function(require,module,exports){
// @@replace logic
require('./$.fix-re-wks')('replace', 2, function(defined, REPLACE, $replace){
  // 21.1.3.14 String.prototype.replace(searchValue, replaceValue)
  return function replace(searchValue, replaceValue){
    'use strict';
    var O  = defined(this)
      , fn = searchValue == undefined ? undefined : searchValue[REPLACE];
    return fn !== undefined
      ? fn.call(searchValue, O, replaceValue)
      : $replace.call(String(O), searchValue, replaceValue);
  };
});
},{"./$.fix-re-wks":43}],175:[function(require,module,exports){
// @@search logic
require('./$.fix-re-wks')('search', 1, function(defined, SEARCH){
  // 21.1.3.15 String.prototype.search(regexp)
  return function search(regexp){
    'use strict';
    var O  = defined(this)
      , fn = regexp == undefined ? undefined : regexp[SEARCH];
    return fn !== undefined ? fn.call(regexp, O) : new RegExp(regexp)[SEARCH](String(O));
  };
});
},{"./$.fix-re-wks":43}],176:[function(require,module,exports){
// @@split logic
require('./$.fix-re-wks')('split', 2, function(defined, SPLIT, $split){
  // 21.1.3.17 String.prototype.split(separator, limit)
  return function split(separator, limit){
    'use strict';
    var O  = defined(this)
      , fn = separator == undefined ? undefined : separator[SPLIT];
    return fn !== undefined
      ? fn.call(separator, O, limit)
      : $split.call(String(O), separator, limit);
  };
});
},{"./$.fix-re-wks":43}],177:[function(require,module,exports){
'use strict';
var strong = require('./$.collection-strong');

// 23.2 Set Objects
require('./$.collection')('Set', function(get){
  return function Set(){ return get(this, arguments.length > 0 ? arguments[0] : undefined); };
}, {
  // 23.2.3.1 Set.prototype.add(value)
  add: function add(value){
    return strong.def(this, value = value === 0 ? 0 : value, value);
  }
}, strong);
},{"./$.collection":33,"./$.collection-strong":30}],178:[function(require,module,exports){
'use strict';
var $export = require('./$.export')
  , $at     = require('./$.string-at')(false);
$export($export.P, 'String', {
  // 21.1.3.3 String.prototype.codePointAt(pos)
  codePointAt: function codePointAt(pos){
    return $at(this, pos);
  }
});
},{"./$.export":40,"./$.string-at":88}],179:[function(require,module,exports){
// 21.1.3.6 String.prototype.endsWith(searchString [, endPosition])
'use strict';
var $export   = require('./$.export')
  , toLength  = require('./$.to-length')
  , context   = require('./$.string-context')
  , ENDS_WITH = 'endsWith'
  , $endsWith = ''[ENDS_WITH];

$export($export.P + $export.F * require('./$.fails-is-regexp')(ENDS_WITH), 'String', {
  endsWith: function endsWith(searchString /*, endPosition = @length */){
    var that = context(this, searchString, ENDS_WITH)
      , $$   = arguments
      , endPosition = $$.length > 1 ? $$[1] : undefined
      , len    = toLength(that.length)
      , end    = endPosition === undefined ? len : Math.min(toLength(endPosition), len)
      , search = String(searchString);
    return $endsWith
      ? $endsWith.call(that, search, end)
      : that.slice(end - search.length, end) === search;
  }
});
},{"./$.export":40,"./$.fails-is-regexp":41,"./$.string-context":89,"./$.to-length":97}],180:[function(require,module,exports){
var $export        = require('./$.export')
  , toIndex        = require('./$.to-index')
  , fromCharCode   = String.fromCharCode
  , $fromCodePoint = String.fromCodePoint;

// length should be 1, old FF problem
$export($export.S + $export.F * (!!$fromCodePoint && $fromCodePoint.length != 1), 'String', {
  // 21.1.2.2 String.fromCodePoint(...codePoints)
  fromCodePoint: function fromCodePoint(x){ // eslint-disable-line no-unused-vars
    var res   = []
      , $$    = arguments
      , $$len = $$.length
      , i     = 0
      , code;
    while($$len > i){
      code = +$$[i++];
      if(toIndex(code, 0x10ffff) !== code)throw RangeError(code + ' is not a valid code point');
      res.push(code < 0x10000
        ? fromCharCode(code)
        : fromCharCode(((code -= 0x10000) >> 10) + 0xd800, code % 0x400 + 0xdc00)
      );
    } return res.join('');
  }
});
},{"./$.export":40,"./$.to-index":94}],181:[function(require,module,exports){
// 21.1.3.7 String.prototype.includes(searchString, position = 0)
'use strict';
var $export  = require('./$.export')
  , context  = require('./$.string-context')
  , INCLUDES = 'includes';

$export($export.P + $export.F * require('./$.fails-is-regexp')(INCLUDES), 'String', {
  includes: function includes(searchString /*, position = 0 */){
    return !!~context(this, searchString, INCLUDES)
      .indexOf(searchString, arguments.length > 1 ? arguments[1] : undefined);
  }
});
},{"./$.export":40,"./$.fails-is-regexp":41,"./$.string-context":89}],182:[function(require,module,exports){
'use strict';
var $at  = require('./$.string-at')(true);

// 21.1.3.27 String.prototype[@@iterator]()
require('./$.iter-define')(String, 'String', function(iterated){
  this._t = String(iterated); // target
  this._i = 0;                // next index
// 21.1.5.2.1 %StringIteratorPrototype%.next()
}, function(){
  var O     = this._t
    , index = this._i
    , point;
  if(index >= O.length)return {value: undefined, done: true};
  point = $at(O, index);
  this._i += point.length;
  return {value: point, done: false};
});
},{"./$.iter-define":60,"./$.string-at":88}],183:[function(require,module,exports){
var $export   = require('./$.export')
  , toIObject = require('./$.to-iobject')
  , toLength  = require('./$.to-length');

$export($export.S, 'String', {
  // 21.1.2.4 String.raw(callSite, ...substitutions)
  raw: function raw(callSite){
    var tpl   = toIObject(callSite.raw)
      , len   = toLength(tpl.length)
      , $$    = arguments
      , $$len = $$.length
      , res   = []
      , i     = 0;
    while(len > i){
      res.push(String(tpl[i++]));
      if(i < $$len)res.push(String($$[i]));
    } return res.join('');
  }
});
},{"./$.export":40,"./$.to-iobject":96,"./$.to-length":97}],184:[function(require,module,exports){
var $export = require('./$.export');

$export($export.P, 'String', {
  // 21.1.3.13 String.prototype.repeat(count)
  repeat: require('./$.string-repeat')
});
},{"./$.export":40,"./$.string-repeat":91}],185:[function(require,module,exports){
// 21.1.3.18 String.prototype.startsWith(searchString [, position ])
'use strict';
var $export     = require('./$.export')
  , toLength    = require('./$.to-length')
  , context     = require('./$.string-context')
  , STARTS_WITH = 'startsWith'
  , $startsWith = ''[STARTS_WITH];

$export($export.P + $export.F * require('./$.fails-is-regexp')(STARTS_WITH), 'String', {
  startsWith: function startsWith(searchString /*, position = 0 */){
    var that   = context(this, searchString, STARTS_WITH)
      , $$     = arguments
      , index  = toLength(Math.min($$.length > 1 ? $$[1] : undefined, that.length))
      , search = String(searchString);
    return $startsWith
      ? $startsWith.call(that, search, index)
      : that.slice(index, index + search.length) === search;
  }
});
},{"./$.export":40,"./$.fails-is-regexp":41,"./$.string-context":89,"./$.to-length":97}],186:[function(require,module,exports){
'use strict';
// 21.1.3.25 String.prototype.trim()
require('./$.string-trim')('trim', function($trim){
  return function trim(){
    return $trim(this, 3);
  };
});
},{"./$.string-trim":92}],187:[function(require,module,exports){
'use strict';
// ECMAScript 6 symbols shim
var $              = require('./$')
  , global         = require('./$.global')
  , has            = require('./$.has')
  , DESCRIPTORS    = require('./$.descriptors')
  , $export        = require('./$.export')
  , redefine       = require('./$.redefine')
  , $fails         = require('./$.fails')
  , shared         = require('./$.shared')
  , setToStringTag = require('./$.set-to-string-tag')
  , uid            = require('./$.uid')
  , wks            = require('./$.wks')
  , keyOf          = require('./$.keyof')
  , $names         = require('./$.get-names')
  , enumKeys       = require('./$.enum-keys')
  , isArray        = require('./$.is-array')
  , anObject       = require('./$.an-object')
  , toIObject      = require('./$.to-iobject')
  , createDesc     = require('./$.property-desc')
  , getDesc        = $.getDesc
  , setDesc        = $.setDesc
  , _create        = $.create
  , getNames       = $names.get
  , $Symbol        = global.Symbol
  , $JSON          = global.JSON
  , _stringify     = $JSON && $JSON.stringify
  , setter         = false
  , HIDDEN         = wks('_hidden')
  , isEnum         = $.isEnum
  , SymbolRegistry = shared('symbol-registry')
  , AllSymbols     = shared('symbols')
  , useNative      = typeof $Symbol == 'function'
  , ObjectProto    = Object.prototype;

// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687
var setSymbolDesc = DESCRIPTORS && $fails(function(){
  return _create(setDesc({}, 'a', {
    get: function(){ return setDesc(this, 'a', {value: 7}).a; }
  })).a != 7;
}) ? function(it, key, D){
  var protoDesc = getDesc(ObjectProto, key);
  if(protoDesc)delete ObjectProto[key];
  setDesc(it, key, D);
  if(protoDesc && it !== ObjectProto)setDesc(ObjectProto, key, protoDesc);
} : setDesc;

var wrap = function(tag){
  var sym = AllSymbols[tag] = _create($Symbol.prototype);
  sym._k = tag;
  DESCRIPTORS && setter && setSymbolDesc(ObjectProto, tag, {
    configurable: true,
    set: function(value){
      if(has(this, HIDDEN) && has(this[HIDDEN], tag))this[HIDDEN][tag] = false;
      setSymbolDesc(this, tag, createDesc(1, value));
    }
  });
  return sym;
};

var isSymbol = function(it){
  return typeof it == 'symbol';
};

var $defineProperty = function defineProperty(it, key, D){
  if(D && has(AllSymbols, key)){
    if(!D.enumerable){
      if(!has(it, HIDDEN))setDesc(it, HIDDEN, createDesc(1, {}));
      it[HIDDEN][key] = true;
    } else {
      if(has(it, HIDDEN) && it[HIDDEN][key])it[HIDDEN][key] = false;
      D = _create(D, {enumerable: createDesc(0, false)});
    } return setSymbolDesc(it, key, D);
  } return setDesc(it, key, D);
};
var $defineProperties = function defineProperties(it, P){
  anObject(it);
  var keys = enumKeys(P = toIObject(P))
    , i    = 0
    , l = keys.length
    , key;
  while(l > i)$defineProperty(it, key = keys[i++], P[key]);
  return it;
};
var $create = function create(it, P){
  return P === undefined ? _create(it) : $defineProperties(_create(it), P);
};
var $propertyIsEnumerable = function propertyIsEnumerable(key){
  var E = isEnum.call(this, key);
  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key]
    ? E : true;
};
var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key){
  var D = getDesc(it = toIObject(it), key);
  if(D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key]))D.enumerable = true;
  return D;
};
var $getOwnPropertyNames = function getOwnPropertyNames(it){
  var names  = getNames(toIObject(it))
    , result = []
    , i      = 0
    , key;
  while(names.length > i)if(!has(AllSymbols, key = names[i++]) && key != HIDDEN)result.push(key);
  return result;
};
var $getOwnPropertySymbols = function getOwnPropertySymbols(it){
  var names  = getNames(toIObject(it))
    , result = []
    , i      = 0
    , key;
  while(names.length > i)if(has(AllSymbols, key = names[i++]))result.push(AllSymbols[key]);
  return result;
};
var $stringify = function stringify(it){
  if(it === undefined || isSymbol(it))return; // IE8 returns string on undefined
  var args = [it]
    , i    = 1
    , $$   = arguments
    , replacer, $replacer;
  while($$.length > i)args.push($$[i++]);
  replacer = args[1];
  if(typeof replacer == 'function')$replacer = replacer;
  if($replacer || !isArray(replacer))replacer = function(key, value){
    if($replacer)value = $replacer.call(this, key, value);
    if(!isSymbol(value))return value;
  };
  args[1] = replacer;
  return _stringify.apply($JSON, args);
};
var buggyJSON = $fails(function(){
  var S = $Symbol();
  // MS Edge converts symbol values to JSON as {}
  // WebKit converts symbol values to JSON as null
  // V8 throws on boxed symbols
  return _stringify([S]) != '[null]' || _stringify({a: S}) != '{}' || _stringify(Object(S)) != '{}';
});

// 19.4.1.1 Symbol([description])
if(!useNative){
  $Symbol = function Symbol(){
    if(isSymbol(this))throw TypeError('Symbol is not a constructor');
    return wrap(uid(arguments.length > 0 ? arguments[0] : undefined));
  };
  redefine($Symbol.prototype, 'toString', function toString(){
    return this._k;
  });

  isSymbol = function(it){
    return it instanceof $Symbol;
  };

  $.create     = $create;
  $.isEnum     = $propertyIsEnumerable;
  $.getDesc    = $getOwnPropertyDescriptor;
  $.setDesc    = $defineProperty;
  $.setDescs   = $defineProperties;
  $.getNames   = $names.get = $getOwnPropertyNames;
  $.getSymbols = $getOwnPropertySymbols;

  if(DESCRIPTORS && !require('./$.library')){
    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);
  }
}

var symbolStatics = {
  // 19.4.2.1 Symbol.for(key)
  'for': function(key){
    return has(SymbolRegistry, key += '')
      ? SymbolRegistry[key]
      : SymbolRegistry[key] = $Symbol(key);
  },
  // 19.4.2.5 Symbol.keyFor(sym)
  keyFor: function keyFor(key){
    return keyOf(SymbolRegistry, key);
  },
  useSetter: function(){ setter = true; },
  useSimple: function(){ setter = false; }
};
// 19.4.2.2 Symbol.hasInstance
// 19.4.2.3 Symbol.isConcatSpreadable
// 19.4.2.4 Symbol.iterator
// 19.4.2.6 Symbol.match
// 19.4.2.8 Symbol.replace
// 19.4.2.9 Symbol.search
// 19.4.2.10 Symbol.species
// 19.4.2.11 Symbol.split
// 19.4.2.12 Symbol.toPrimitive
// 19.4.2.13 Symbol.toStringTag
// 19.4.2.14 Symbol.unscopables
$.each.call((
  'hasInstance,isConcatSpreadable,iterator,match,replace,search,' +
  'species,split,toPrimitive,toStringTag,unscopables'
).split(','), function(it){
  var sym = wks(it);
  symbolStatics[it] = useNative ? sym : wrap(sym);
});

setter = true;

$export($export.G + $export.W, {Symbol: $Symbol});

$export($export.S, 'Symbol', symbolStatics);

$export($export.S + $export.F * !useNative, 'Object', {
  // 19.1.2.2 Object.create(O [, Properties])
  create: $create,
  // 19.1.2.4 Object.defineProperty(O, P, Attributes)
  defineProperty: $defineProperty,
  // 19.1.2.3 Object.defineProperties(O, Properties)
  defineProperties: $defineProperties,
  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,
  // 19.1.2.7 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $getOwnPropertyNames,
  // 19.1.2.8 Object.getOwnPropertySymbols(O)
  getOwnPropertySymbols: $getOwnPropertySymbols
});

// 24.3.2 JSON.stringify(value [, replacer [, space]])
$JSON && $export($export.S + $export.F * (!useNative || buggyJSON), 'JSON', {stringify: $stringify});

// 19.4.3.5 Symbol.prototype[@@toStringTag]
setToStringTag($Symbol, 'Symbol');
// 20.2.1.9 Math[@@toStringTag]
setToStringTag(Math, 'Math', true);
// 24.3.3 JSON[@@toStringTag]
setToStringTag(global.JSON, 'JSON', true);
},{"./$":64,"./$.an-object":22,"./$.descriptors":37,"./$.enum-keys":39,"./$.export":40,"./$.fails":42,"./$.get-names":46,"./$.global":47,"./$.has":48,"./$.is-array":54,"./$.keyof":65,"./$.library":66,"./$.property-desc":77,"./$.redefine":79,"./$.set-to-string-tag":84,"./$.shared":85,"./$.to-iobject":96,"./$.uid":100,"./$.wks":101}],188:[function(require,module,exports){
'use strict';
var $            = require('./$')
  , redefine     = require('./$.redefine')
  , weak         = require('./$.collection-weak')
  , isObject     = require('./$.is-object')
  , has          = require('./$.has')
  , frozenStore  = weak.frozenStore
  , WEAK         = weak.WEAK
  , isExtensible = Object.isExtensible || isObject
  , tmp          = {};

// 23.3 WeakMap Objects
var $WeakMap = require('./$.collection')('WeakMap', function(get){
  return function WeakMap(){ return get(this, arguments.length > 0 ? arguments[0] : undefined); };
}, {
  // 23.3.3.3 WeakMap.prototype.get(key)
  get: function get(key){
    if(isObject(key)){
      if(!isExtensible(key))return frozenStore(this).get(key);
      if(has(key, WEAK))return key[WEAK][this._i];
    }
  },
  // 23.3.3.5 WeakMap.prototype.set(key, value)
  set: function set(key, value){
    return weak.def(this, key, value);
  }
}, weak, true, true);

// IE11 WeakMap frozen keys fix
if(new $WeakMap().set((Object.freeze || Object)(tmp), 7).get(tmp) != 7){
  $.each.call(['delete', 'has', 'get', 'set'], function(key){
    var proto  = $WeakMap.prototype
      , method = proto[key];
    redefine(proto, key, function(a, b){
      // store frozen objects on leaky map
      if(isObject(a) && !isExtensible(a)){
        var result = frozenStore(this)[key](a, b);
        return key == 'set' ? this : result;
      // store all the rest on native weakmap
      } return method.call(this, a, b);
    });
  });
}
},{"./$":64,"./$.collection":33,"./$.collection-weak":32,"./$.has":48,"./$.is-object":56,"./$.redefine":79}],189:[function(require,module,exports){
'use strict';
var weak = require('./$.collection-weak');

// 23.4 WeakSet Objects
require('./$.collection')('WeakSet', function(get){
  return function WeakSet(){ return get(this, arguments.length > 0 ? arguments[0] : undefined); };
}, {
  // 23.4.3.1 WeakSet.prototype.add(value)
  add: function add(value){
    return weak.def(this, value, true);
  }
}, weak, false, true);
},{"./$.collection":33,"./$.collection-weak":32}],190:[function(require,module,exports){
'use strict';
var $export   = require('./$.export')
  , $includes = require('./$.array-includes')(true);

$export($export.P, 'Array', {
  // https://github.com/domenic/Array.prototype.includes
  includes: function includes(el /*, fromIndex = 0 */){
    return $includes(this, el, arguments.length > 1 ? arguments[1] : undefined);
  }
});

require('./$.add-to-unscopables')('includes');
},{"./$.add-to-unscopables":21,"./$.array-includes":25,"./$.export":40}],191:[function(require,module,exports){
// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var $export  = require('./$.export');

$export($export.P, 'Map', {toJSON: require('./$.collection-to-json')('Map')});
},{"./$.collection-to-json":31,"./$.export":40}],192:[function(require,module,exports){
// http://goo.gl/XkBrjD
var $export  = require('./$.export')
  , $entries = require('./$.object-to-array')(true);

$export($export.S, 'Object', {
  entries: function entries(it){
    return $entries(it);
  }
});
},{"./$.export":40,"./$.object-to-array":73}],193:[function(require,module,exports){
// https://gist.github.com/WebReflection/9353781
var $          = require('./$')
  , $export    = require('./$.export')
  , ownKeys    = require('./$.own-keys')
  , toIObject  = require('./$.to-iobject')
  , createDesc = require('./$.property-desc');

$export($export.S, 'Object', {
  getOwnPropertyDescriptors: function getOwnPropertyDescriptors(object){
    var O       = toIObject(object)
      , setDesc = $.setDesc
      , getDesc = $.getDesc
      , keys    = ownKeys(O)
      , result  = {}
      , i       = 0
      , key, D;
    while(keys.length > i){
      D = getDesc(O, key = keys[i++]);
      if(key in result)setDesc(result, key, createDesc(0, D));
      else result[key] = D;
    } return result;
  }
});
},{"./$":64,"./$.export":40,"./$.own-keys":74,"./$.property-desc":77,"./$.to-iobject":96}],194:[function(require,module,exports){
// http://goo.gl/XkBrjD
var $export = require('./$.export')
  , $values = require('./$.object-to-array')(false);

$export($export.S, 'Object', {
  values: function values(it){
    return $values(it);
  }
});
},{"./$.export":40,"./$.object-to-array":73}],195:[function(require,module,exports){
// https://github.com/benjamingr/RexExp.escape
var $export = require('./$.export')
  , $re     = require('./$.replacer')(/[\\^$*+?.()|[\]{}]/g, '\\$&');

$export($export.S, 'RegExp', {escape: function escape(it){ return $re(it); }});

},{"./$.export":40,"./$.replacer":80}],196:[function(require,module,exports){
// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var $export  = require('./$.export');

$export($export.P, 'Set', {toJSON: require('./$.collection-to-json')('Set')});
},{"./$.collection-to-json":31,"./$.export":40}],197:[function(require,module,exports){
'use strict';
// https://github.com/mathiasbynens/String.prototype.at
var $export = require('./$.export')
  , $at     = require('./$.string-at')(true);

$export($export.P, 'String', {
  at: function at(pos){
    return $at(this, pos);
  }
});
},{"./$.export":40,"./$.string-at":88}],198:[function(require,module,exports){
'use strict';
var $export = require('./$.export')
  , $pad    = require('./$.string-pad');

$export($export.P, 'String', {
  padLeft: function padLeft(maxLength /*, fillString = ' ' */){
    return $pad(this, maxLength, arguments.length > 1 ? arguments[1] : undefined, true);
  }
});
},{"./$.export":40,"./$.string-pad":90}],199:[function(require,module,exports){
'use strict';
var $export = require('./$.export')
  , $pad    = require('./$.string-pad');

$export($export.P, 'String', {
  padRight: function padRight(maxLength /*, fillString = ' ' */){
    return $pad(this, maxLength, arguments.length > 1 ? arguments[1] : undefined, false);
  }
});
},{"./$.export":40,"./$.string-pad":90}],200:[function(require,module,exports){
'use strict';
// https://github.com/sebmarkbage/ecmascript-string-left-right-trim
require('./$.string-trim')('trimLeft', function($trim){
  return function trimLeft(){
    return $trim(this, 1);
  };
});
},{"./$.string-trim":92}],201:[function(require,module,exports){
'use strict';
// https://github.com/sebmarkbage/ecmascript-string-left-right-trim
require('./$.string-trim')('trimRight', function($trim){
  return function trimRight(){
    return $trim(this, 2);
  };
});
},{"./$.string-trim":92}],202:[function(require,module,exports){
// JavaScript 1.6 / Strawman array statics shim
var $       = require('./$')
  , $export = require('./$.export')
  , $ctx    = require('./$.ctx')
  , $Array  = require('./$.core').Array || Array
  , statics = {};
var setStatics = function(keys, length){
  $.each.call(keys.split(','), function(key){
    if(length == undefined && key in $Array)statics[key] = $Array[key];
    else if(key in [])statics[key] = $ctx(Function.call, [][key], length);
  });
};
setStatics('pop,reverse,shift,keys,values,entries', 1);
setStatics('indexOf,every,some,forEach,map,filter,find,findIndex,includes', 3);
setStatics('join,slice,concat,push,splice,unshift,sort,lastIndexOf,' +
           'reduce,reduceRight,copyWithin,fill');
$export($export.S, 'Array', statics);
},{"./$":64,"./$.core":34,"./$.ctx":35,"./$.export":40}],203:[function(require,module,exports){
require('./es6.array.iterator');
var global      = require('./$.global')
  , hide        = require('./$.hide')
  , Iterators   = require('./$.iterators')
  , ITERATOR    = require('./$.wks')('iterator')
  , NL          = global.NodeList
  , HTC         = global.HTMLCollection
  , NLProto     = NL && NL.prototype
  , HTCProto    = HTC && HTC.prototype
  , ArrayValues = Iterators.NodeList = Iterators.HTMLCollection = Iterators.Array;
if(NLProto && !NLProto[ITERATOR])hide(NLProto, ITERATOR, ArrayValues);
if(HTCProto && !HTCProto[ITERATOR])hide(HTCProto, ITERATOR, ArrayValues);
},{"./$.global":47,"./$.hide":49,"./$.iterators":63,"./$.wks":101,"./es6.array.iterator":109}],204:[function(require,module,exports){
var $export = require('./$.export')
  , $task   = require('./$.task');
$export($export.G + $export.B, {
  setImmediate:   $task.set,
  clearImmediate: $task.clear
});
},{"./$.export":40,"./$.task":93}],205:[function(require,module,exports){
// ie9- setTimeout & setInterval additional parameters fix
var global     = require('./$.global')
  , $export    = require('./$.export')
  , invoke     = require('./$.invoke')
  , partial    = require('./$.partial')
  , navigator  = global.navigator
  , MSIE       = !!navigator && /MSIE .\./.test(navigator.userAgent); // <- dirty ie9- check
var wrap = function(set){
  return MSIE ? function(fn, time /*, ...args */){
    return set(invoke(
      partial,
      [].slice.call(arguments, 2),
      typeof fn == 'function' ? fn : Function(fn)
    ), time);
  } : set;
};
$export($export.G + $export.B + $export.F * MSIE, {
  setTimeout:  wrap(global.setTimeout),
  setInterval: wrap(global.setInterval)
});
},{"./$.export":40,"./$.global":47,"./$.invoke":51,"./$.partial":75}],206:[function(require,module,exports){
require('./modules/es5');
require('./modules/es6.symbol');
require('./modules/es6.object.assign');
require('./modules/es6.object.is');
require('./modules/es6.object.set-prototype-of');
require('./modules/es6.object.to-string');
require('./modules/es6.object.freeze');
require('./modules/es6.object.seal');
require('./modules/es6.object.prevent-extensions');
require('./modules/es6.object.is-frozen');
require('./modules/es6.object.is-sealed');
require('./modules/es6.object.is-extensible');
require('./modules/es6.object.get-own-property-descriptor');
require('./modules/es6.object.get-prototype-of');
require('./modules/es6.object.keys');
require('./modules/es6.object.get-own-property-names');
require('./modules/es6.function.name');
require('./modules/es6.function.has-instance');
require('./modules/es6.number.constructor');
require('./modules/es6.number.epsilon');
require('./modules/es6.number.is-finite');
require('./modules/es6.number.is-integer');
require('./modules/es6.number.is-nan');
require('./modules/es6.number.is-safe-integer');
require('./modules/es6.number.max-safe-integer');
require('./modules/es6.number.min-safe-integer');
require('./modules/es6.number.parse-float');
require('./modules/es6.number.parse-int');
require('./modules/es6.math.acosh');
require('./modules/es6.math.asinh');
require('./modules/es6.math.atanh');
require('./modules/es6.math.cbrt');
require('./modules/es6.math.clz32');
require('./modules/es6.math.cosh');
require('./modules/es6.math.expm1');
require('./modules/es6.math.fround');
require('./modules/es6.math.hypot');
require('./modules/es6.math.imul');
require('./modules/es6.math.log10');
require('./modules/es6.math.log1p');
require('./modules/es6.math.log2');
require('./modules/es6.math.sign');
require('./modules/es6.math.sinh');
require('./modules/es6.math.tanh');
require('./modules/es6.math.trunc');
require('./modules/es6.string.from-code-point');
require('./modules/es6.string.raw');
require('./modules/es6.string.trim');
require('./modules/es6.string.iterator');
require('./modules/es6.string.code-point-at');
require('./modules/es6.string.ends-with');
require('./modules/es6.string.includes');
require('./modules/es6.string.repeat');
require('./modules/es6.string.starts-with');
require('./modules/es6.array.from');
require('./modules/es6.array.of');
require('./modules/es6.array.iterator');
require('./modules/es6.array.species');
require('./modules/es6.array.copy-within');
require('./modules/es6.array.fill');
require('./modules/es6.array.find');
require('./modules/es6.array.find-index');
require('./modules/es6.regexp.constructor');
require('./modules/es6.regexp.flags');
require('./modules/es6.regexp.match');
require('./modules/es6.regexp.replace');
require('./modules/es6.regexp.search');
require('./modules/es6.regexp.split');
require('./modules/es6.promise');
require('./modules/es6.map');
require('./modules/es6.set');
require('./modules/es6.weak-map');
require('./modules/es6.weak-set');
require('./modules/es6.reflect.apply');
require('./modules/es6.reflect.construct');
require('./modules/es6.reflect.define-property');
require('./modules/es6.reflect.delete-property');
require('./modules/es6.reflect.enumerate');
require('./modules/es6.reflect.get');
require('./modules/es6.reflect.get-own-property-descriptor');
require('./modules/es6.reflect.get-prototype-of');
require('./modules/es6.reflect.has');
require('./modules/es6.reflect.is-extensible');
require('./modules/es6.reflect.own-keys');
require('./modules/es6.reflect.prevent-extensions');
require('./modules/es6.reflect.set');
require('./modules/es6.reflect.set-prototype-of');
require('./modules/es7.array.includes');
require('./modules/es7.string.at');
require('./modules/es7.string.pad-left');
require('./modules/es7.string.pad-right');
require('./modules/es7.string.trim-left');
require('./modules/es7.string.trim-right');
require('./modules/es7.regexp.escape');
require('./modules/es7.object.get-own-property-descriptors');
require('./modules/es7.object.values');
require('./modules/es7.object.entries');
require('./modules/es7.map.to-json');
require('./modules/es7.set.to-json');
require('./modules/js.array.statics');
require('./modules/web.timers');
require('./modules/web.immediate');
require('./modules/web.dom.iterable');
module.exports = require('./modules/$.core');
},{"./modules/$.core":34,"./modules/es5":103,"./modules/es6.array.copy-within":104,"./modules/es6.array.fill":105,"./modules/es6.array.find":107,"./modules/es6.array.find-index":106,"./modules/es6.array.from":108,"./modules/es6.array.iterator":109,"./modules/es6.array.of":110,"./modules/es6.array.species":111,"./modules/es6.function.has-instance":112,"./modules/es6.function.name":113,"./modules/es6.map":114,"./modules/es6.math.acosh":115,"./modules/es6.math.asinh":116,"./modules/es6.math.atanh":117,"./modules/es6.math.cbrt":118,"./modules/es6.math.clz32":119,"./modules/es6.math.cosh":120,"./modules/es6.math.expm1":121,"./modules/es6.math.fround":122,"./modules/es6.math.hypot":123,"./modules/es6.math.imul":124,"./modules/es6.math.log10":125,"./modules/es6.math.log1p":126,"./modules/es6.math.log2":127,"./modules/es6.math.sign":128,"./modules/es6.math.sinh":129,"./modules/es6.math.tanh":130,"./modules/es6.math.trunc":131,"./modules/es6.number.constructor":132,"./modules/es6.number.epsilon":133,"./modules/es6.number.is-finite":134,"./modules/es6.number.is-integer":135,"./modules/es6.number.is-nan":136,"./modules/es6.number.is-safe-integer":137,"./modules/es6.number.max-safe-integer":138,"./modules/es6.number.min-safe-integer":139,"./modules/es6.number.parse-float":140,"./modules/es6.number.parse-int":141,"./modules/es6.object.assign":142,"./modules/es6.object.freeze":143,"./modules/es6.object.get-own-property-descriptor":144,"./modules/es6.object.get-own-property-names":145,"./modules/es6.object.get-prototype-of":146,"./modules/es6.object.is":150,"./modules/es6.object.is-extensible":147,"./modules/es6.object.is-frozen":148,"./modules/es6.object.is-sealed":149,"./modules/es6.object.keys":151,"./modules/es6.object.prevent-extensions":152,"./modules/es6.object.seal":153,"./modules/es6.object.set-prototype-of":154,"./modules/es6.object.to-string":155,"./modules/es6.promise":156,"./modules/es6.reflect.apply":157,"./modules/es6.reflect.construct":158,"./modules/es6.reflect.define-property":159,"./modules/es6.reflect.delete-property":160,"./modules/es6.reflect.enumerate":161,"./modules/es6.reflect.get":164,"./modules/es6.reflect.get-own-property-descriptor":162,"./modules/es6.reflect.get-prototype-of":163,"./modules/es6.reflect.has":165,"./modules/es6.reflect.is-extensible":166,"./modules/es6.reflect.own-keys":167,"./modules/es6.reflect.prevent-extensions":168,"./modules/es6.reflect.set":170,"./modules/es6.reflect.set-prototype-of":169,"./modules/es6.regexp.constructor":171,"./modules/es6.regexp.flags":172,"./modules/es6.regexp.match":173,"./modules/es6.regexp.replace":174,"./modules/es6.regexp.search":175,"./modules/es6.regexp.split":176,"./modules/es6.set":177,"./modules/es6.string.code-point-at":178,"./modules/es6.string.ends-with":179,"./modules/es6.string.from-code-point":180,"./modules/es6.string.includes":181,"./modules/es6.string.iterator":182,"./modules/es6.string.raw":183,"./modules/es6.string.repeat":184,"./modules/es6.string.starts-with":185,"./modules/es6.string.trim":186,"./modules/es6.symbol":187,"./modules/es6.weak-map":188,"./modules/es6.weak-set":189,"./modules/es7.array.includes":190,"./modules/es7.map.to-json":191,"./modules/es7.object.entries":192,"./modules/es7.object.get-own-property-descriptors":193,"./modules/es7.object.values":194,"./modules/es7.regexp.escape":195,"./modules/es7.set.to-json":196,"./modules/es7.string.at":197,"./modules/es7.string.pad-left":198,"./modules/es7.string.pad-right":199,"./modules/es7.string.trim-left":200,"./modules/es7.string.trim-right":201,"./modules/js.array.statics":202,"./modules/web.dom.iterable":203,"./modules/web.immediate":204,"./modules/web.timers":205}],207:[function(require,module,exports){
// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.

function EventEmitter() {
  this._events = this._events || {};
  this._maxListeners = this._maxListeners || undefined;
}
module.exports = EventEmitter;

// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter = EventEmitter;

EventEmitter.prototype._events = undefined;
EventEmitter.prototype._maxListeners = undefined;

// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
EventEmitter.defaultMaxListeners = 10;

// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners = function(n) {
  if (!isNumber(n) || n < 0 || isNaN(n))
    throw TypeError('n must be a positive number');
  this._maxListeners = n;
  return this;
};

EventEmitter.prototype.emit = function(type) {
  var er, handler, len, args, i, listeners;

  if (!this._events)
    this._events = {};

  // If there is no 'error' event listener then throw.
  if (type === 'error') {
    if (!this._events.error ||
        (isObject(this._events.error) && !this._events.error.length)) {
      er = arguments[1];
      if (er instanceof Error) {
        throw er; // Unhandled 'error' event
      }
      throw TypeError('Uncaught, unspecified "error" event.');
    }
  }

  handler = this._events[type];

  if (isUndefined(handler))
    return false;

  if (isFunction(handler)) {
    switch (arguments.length) {
      // fast cases
      case 1:
        handler.call(this);
        break;
      case 2:
        handler.call(this, arguments[1]);
        break;
      case 3:
        handler.call(this, arguments[1], arguments[2]);
        break;
      // slower
      default:
        args = Array.prototype.slice.call(arguments, 1);
        handler.apply(this, args);
    }
  } else if (isObject(handler)) {
    args = Array.prototype.slice.call(arguments, 1);
    listeners = handler.slice();
    len = listeners.length;
    for (i = 0; i < len; i++)
      listeners[i].apply(this, args);
  }

  return true;
};

EventEmitter.prototype.addListener = function(type, listener) {
  var m;

  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  if (!this._events)
    this._events = {};

  // To avoid recursion in the case that type === "newListener"! Before
  // adding it to the listeners, first emit "newListener".
  if (this._events.newListener)
    this.emit('newListener', type,
              isFunction(listener.listener) ?
              listener.listener : listener);

  if (!this._events[type])
    // Optimize the case of one listener. Don't need the extra array object.
    this._events[type] = listener;
  else if (isObject(this._events[type]))
    // If we've already got an array, just append.
    this._events[type].push(listener);
  else
    // Adding the second element, need to change to array.
    this._events[type] = [this._events[type], listener];

  // Check for listener leak
  if (isObject(this._events[type]) && !this._events[type].warned) {
    if (!isUndefined(this._maxListeners)) {
      m = this._maxListeners;
    } else {
      m = EventEmitter.defaultMaxListeners;
    }

    if (m && m > 0 && this._events[type].length > m) {
      this._events[type].warned = true;
      console.error('(node) warning: possible EventEmitter memory ' +
                    'leak detected. %d listeners added. ' +
                    'Use emitter.setMaxListeners() to increase limit.',
                    this._events[type].length);
      if (typeof console.trace === 'function') {
        // not supported in IE 10
        console.trace();
      }
    }
  }

  return this;
};

EventEmitter.prototype.on = EventEmitter.prototype.addListener;

EventEmitter.prototype.once = function(type, listener) {
  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  var fired = false;

  function g() {
    this.removeListener(type, g);

    if (!fired) {
      fired = true;
      listener.apply(this, arguments);
    }
  }

  g.listener = listener;
  this.on(type, g);

  return this;
};

// emits a 'removeListener' event iff the listener was removed
EventEmitter.prototype.removeListener = function(type, listener) {
  var list, position, length, i;

  if (!isFunction(listener))
    throw TypeError('listener must be a function');

  if (!this._events || !this._events[type])
    return this;

  list = this._events[type];
  length = list.length;
  position = -1;

  if (list === listener ||
      (isFunction(list.listener) && list.listener === listener)) {
    delete this._events[type];
    if (this._events.removeListener)
      this.emit('removeListener', type, listener);

  } else if (isObject(list)) {
    for (i = length; i-- > 0;) {
      if (list[i] === listener ||
          (list[i].listener && list[i].listener === listener)) {
        position = i;
        break;
      }
    }

    if (position < 0)
      return this;

    if (list.length === 1) {
      list.length = 0;
      delete this._events[type];
    } else {
      list.splice(position, 1);
    }

    if (this._events.removeListener)
      this.emit('removeListener', type, listener);
  }

  return this;
};

EventEmitter.prototype.removeAllListeners = function(type) {
  var key, listeners;

  if (!this._events)
    return this;

  // not listening for removeListener, no need to emit
  if (!this._events.removeListener) {
    if (arguments.length === 0)
      this._events = {};
    else if (this._events[type])
      delete this._events[type];
    return this;
  }

  // emit removeListener for all listeners on all events
  if (arguments.length === 0) {
    for (key in this._events) {
      if (key === 'removeListener') continue;
      this.removeAllListeners(key);
    }
    this.removeAllListeners('removeListener');
    this._events = {};
    return this;
  }

  listeners = this._events[type];

  if (isFunction(listeners)) {
    this.removeListener(type, listeners);
  } else if (listeners) {
    // LIFO order
    while (listeners.length)
      this.removeListener(type, listeners[listeners.length - 1]);
  }
  delete this._events[type];

  return this;
};

EventEmitter.prototype.listeners = function(type) {
  var ret;
  if (!this._events || !this._events[type])
    ret = [];
  else if (isFunction(this._events[type]))
    ret = [this._events[type]];
  else
    ret = this._events[type].slice();
  return ret;
};

EventEmitter.prototype.listenerCount = function(type) {
  if (this._events) {
    var evlistener = this._events[type];

    if (isFunction(evlistener))
      return 1;
    else if (evlistener)
      return evlistener.length;
  }
  return 0;
};

EventEmitter.listenerCount = function(emitter, type) {
  return emitter.listenerCount(type);
};

function isFunction(arg) {
  return typeof arg === 'function';
}

function isNumber(arg) {
  return typeof arg === 'number';
}

function isObject(arg) {
  return typeof arg === 'object' && arg !== null;
}

function isUndefined(arg) {
  return arg === void 0;
}

},{}],208:[function(require,module,exports){
;(function () {
	'use strict';

	/**
	 * @preserve FastClick: polyfill to remove click delays on browsers with touch UIs.
	 *
	 * @codingstandard ftlabs-jsv2
	 * @copyright The Financial Times Limited [All Rights Reserved]
	 * @license MIT License (see LICENSE.txt)
	 */

	/*jslint browser:true, node:true*/
	/*global define, Event, Node*/


	/**
	 * Instantiate fast-clicking listeners on the specified layer.
	 *
	 * @constructor
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	function FastClick(layer, options) {
		var oldOnClick;

		options = options || {};

		/**
		 * Whether a click is currently being tracked.
		 *
		 * @type boolean
		 */
		this.trackingClick = false;


		/**
		 * Timestamp for when click tracking started.
		 *
		 * @type number
		 */
		this.trackingClickStart = 0;


		/**
		 * The element being tracked for a click.
		 *
		 * @type EventTarget
		 */
		this.targetElement = null;


		/**
		 * X-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartX = 0;


		/**
		 * Y-coordinate of touch start event.
		 *
		 * @type number
		 */
		this.touchStartY = 0;


		/**
		 * ID of the last touch, retrieved from Touch.identifier.
		 *
		 * @type number
		 */
		this.lastTouchIdentifier = 0;


		/**
		 * Touchmove boundary, beyond which a click will be cancelled.
		 *
		 * @type number
		 */
		this.touchBoundary = options.touchBoundary || 10;


		/**
		 * The FastClick layer.
		 *
		 * @type Element
		 */
		this.layer = layer;

		/**
		 * The minimum time between tap(touchstart and touchend) events
		 *
		 * @type number
		 */
		this.tapDelay = options.tapDelay || 200;

		/**
		 * The maximum time for a tap
		 *
		 * @type number
		 */
		this.tapTimeout = options.tapTimeout || 700;

		if (FastClick.notNeeded(layer)) {
			return;
		}

		// Some old versions of Android don't have Function.prototype.bind
		function bind(method, context) {
			return function() { return method.apply(context, arguments); };
		}


		var methods = ['onMouse', 'onClick', 'onTouchStart', 'onTouchMove', 'onTouchEnd', 'onTouchCancel'];
		var context = this;
		for (var i = 0, l = methods.length; i < l; i++) {
			context[methods[i]] = bind(context[methods[i]], context);
		}

		// Set up event handlers as required
		if (deviceIsAndroid) {
			layer.addEventListener('mouseover', this.onMouse, true);
			layer.addEventListener('mousedown', this.onMouse, true);
			layer.addEventListener('mouseup', this.onMouse, true);
		}

		layer.addEventListener('click', this.onClick, true);
		layer.addEventListener('touchstart', this.onTouchStart, false);
		layer.addEventListener('touchmove', this.onTouchMove, false);
		layer.addEventListener('touchend', this.onTouchEnd, false);
		layer.addEventListener('touchcancel', this.onTouchCancel, false);

		// Hack is required for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
		// which is how FastClick normally stops click events bubbling to callbacks registered on the FastClick
		// layer when they are cancelled.
		if (!Event.prototype.stopImmediatePropagation) {
			layer.removeEventListener = function(type, callback, capture) {
				var rmv = Node.prototype.removeEventListener;
				if (type === 'click') {
					rmv.call(layer, type, callback.hijacked || callback, capture);
				} else {
					rmv.call(layer, type, callback, capture);
				}
			};

			layer.addEventListener = function(type, callback, capture) {
				var adv = Node.prototype.addEventListener;
				if (type === 'click') {
					adv.call(layer, type, callback.hijacked || (callback.hijacked = function(event) {
						if (!event.propagationStopped) {
							callback(event);
						}
					}), capture);
				} else {
					adv.call(layer, type, callback, capture);
				}
			};
		}

		// If a handler is already declared in the element's onclick attribute, it will be fired before
		// FastClick's onClick handler. Fix this by pulling out the user-defined handler function and
		// adding it as listener.
		if (typeof layer.onclick === 'function') {

			// Android browser on at least 3.2 requires a new reference to the function in layer.onclick
			// - the old one won't work if passed to addEventListener directly.
			oldOnClick = layer.onclick;
			layer.addEventListener('click', function(event) {
				oldOnClick(event);
			}, false);
			layer.onclick = null;
		}
	}

	/**
	* Windows Phone 8.1 fakes user agent string to look like Android and iPhone.
	*
	* @type boolean
	*/
	var deviceIsWindowsPhone = navigator.userAgent.indexOf("Windows Phone") >= 0;

	/**
	 * Android requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsAndroid = navigator.userAgent.indexOf('Android') > 0 && !deviceIsWindowsPhone;


	/**
	 * iOS requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsIOS = /iP(ad|hone|od)/.test(navigator.userAgent) && !deviceIsWindowsPhone;


	/**
	 * iOS 4 requires an exception for select elements.
	 *
	 * @type boolean
	 */
	var deviceIsIOS4 = deviceIsIOS && (/OS 4_\d(_\d)?/).test(navigator.userAgent);


	/**
	 * iOS 6.0-7.* requires the target element to be manually derived
	 *
	 * @type boolean
	 */
	var deviceIsIOSWithBadTarget = deviceIsIOS && (/OS [6-7]_\d/).test(navigator.userAgent);

	/**
	 * BlackBerry requires exceptions.
	 *
	 * @type boolean
	 */
	var deviceIsBlackBerry10 = navigator.userAgent.indexOf('BB10') > 0;

	/**
	 * Determine whether a given element requires a native click.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element needs a native click
	 */
	FastClick.prototype.needsClick = function(target) {
		switch (target.nodeName.toLowerCase()) {

		// Don't send a synthetic click to disabled inputs (issue #62)
		case 'button':
		case 'select':
		case 'textarea':
			if (target.disabled) {
				return true;
			}

			break;
		case 'input':

			// File inputs need real clicks on iOS 6 due to a browser bug (issue #68)
			if ((deviceIsIOS && target.type === 'file') || target.disabled) {
				return true;
			}

			break;
		case 'label':
		case 'iframe': // iOS8 homescreen apps can prevent events bubbling into frames
		case 'video':
			return true;
		}

		return (/\bneedsclick\b/).test(target.className);
	};


	/**
	 * Determine whether a given element requires a call to focus to simulate click into element.
	 *
	 * @param {EventTarget|Element} target Target DOM element
	 * @returns {boolean} Returns true if the element requires a call to focus to simulate native click.
	 */
	FastClick.prototype.needsFocus = function(target) {
		switch (target.nodeName.toLowerCase()) {
		case 'textarea':
			return true;
		case 'select':
			return !deviceIsAndroid;
		case 'input':
			switch (target.type) {
			case 'button':
			case 'checkbox':
			case 'file':
			case 'image':
			case 'radio':
			case 'submit':
				return false;
			}

			// No point in attempting to focus disabled inputs
			return !target.disabled && !target.readOnly;
		default:
			return (/\bneedsfocus\b/).test(target.className);
		}
	};


	/**
	 * Send a click event to the specified element.
	 *
	 * @param {EventTarget|Element} targetElement
	 * @param {Event} event
	 */
	FastClick.prototype.sendClick = function(targetElement, event) {
		var clickEvent, touch;

		// On some Android devices activeElement needs to be blurred otherwise the synthetic click will have no effect (#24)
		if (document.activeElement && document.activeElement !== targetElement) {
			document.activeElement.blur();
		}

		touch = event.changedTouches[0];

		// Synthesise a click event, with an extra attribute so it can be tracked
		clickEvent = document.createEvent('MouseEvents');
		clickEvent.initMouseEvent(this.determineEventType(targetElement), true, true, window, 1, touch.screenX, touch.screenY, touch.clientX, touch.clientY, false, false, false, false, 0, null);
		clickEvent.forwardedTouchEvent = true;
		targetElement.dispatchEvent(clickEvent);
	};

	FastClick.prototype.determineEventType = function(targetElement) {

		//Issue #159: Android Chrome Select Box does not open with a synthetic click event
		if (deviceIsAndroid && targetElement.tagName.toLowerCase() === 'select') {
			return 'mousedown';
		}

		return 'click';
	};


	/**
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.focus = function(targetElement) {
		var length;

		// Issue #160: on iOS 7, some input elements (e.g. date datetime month) throw a vague TypeError on setSelectionRange. These elements don't have an integer value for the selectionStart and selectionEnd properties, but unfortunately that can't be used for detection because accessing the properties also throws a TypeError. Just check the type instead. Filed as Apple bug #15122724.
		if (deviceIsIOS && targetElement.setSelectionRange && targetElement.type.indexOf('date') !== 0 && targetElement.type !== 'time' && targetElement.type !== 'month') {
			length = targetElement.value.length;
			targetElement.setSelectionRange(length, length);
		} else {
			targetElement.focus();
		}
	};


	/**
	 * Check whether the given target element is a child of a scrollable layer and if so, set a flag on it.
	 *
	 * @param {EventTarget|Element} targetElement
	 */
	FastClick.prototype.updateScrollParent = function(targetElement) {
		var scrollParent, parentElement;

		scrollParent = targetElement.fastClickScrollParent;

		// Attempt to discover whether the target element is contained within a scrollable layer. Re-check if the
		// target element was moved to another parent.
		if (!scrollParent || !scrollParent.contains(targetElement)) {
			parentElement = targetElement;
			do {
				if (parentElement.scrollHeight > parentElement.offsetHeight) {
					scrollParent = parentElement;
					targetElement.fastClickScrollParent = parentElement;
					break;
				}

				parentElement = parentElement.parentElement;
			} while (parentElement);
		}

		// Always update the scroll top tracker if possible.
		if (scrollParent) {
			scrollParent.fastClickLastScrollTop = scrollParent.scrollTop;
		}
	};


	/**
	 * @param {EventTarget} targetElement
	 * @returns {Element|EventTarget}
	 */
	FastClick.prototype.getTargetElementFromEventTarget = function(eventTarget) {

		// On some older browsers (notably Safari on iOS 4.1 - see issue #56) the event target may be a text node.
		if (eventTarget.nodeType === Node.TEXT_NODE) {
			return eventTarget.parentNode;
		}

		return eventTarget;
	};


	/**
	 * On touch start, record the position and scroll offset.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchStart = function(event) {
		var targetElement, touch, selection;

		// Ignore multiple touches, otherwise pinch-to-zoom is prevented if both fingers are on the FastClick element (issue #111).
		if (event.targetTouches.length > 1) {
			return true;
		}

		targetElement = this.getTargetElementFromEventTarget(event.target);
		touch = event.targetTouches[0];

		if (deviceIsIOS) {

			// Only trusted events will deselect text on iOS (issue #49)
			selection = window.getSelection();
			if (selection.rangeCount && !selection.isCollapsed) {
				return true;
			}

			if (!deviceIsIOS4) {

				// Weird things happen on iOS when an alert or confirm dialog is opened from a click event callback (issue #23):
				// when the user next taps anywhere else on the page, new touchstart and touchend events are dispatched
				// with the same identifier as the touch event that previously triggered the click that triggered the alert.
				// Sadly, there is an issue on iOS 4 that causes some normal touch events to have the same identifier as an
				// immediately preceeding touch event (issue #52), so this fix is unavailable on that platform.
				// Issue 120: touch.identifier is 0 when Chrome dev tools 'Emulate touch events' is set with an iOS device UA string,
				// which causes all touch events to be ignored. As this block only applies to iOS, and iOS identifiers are always long,
				// random integers, it's safe to to continue if the identifier is 0 here.
				if (touch.identifier && touch.identifier === this.lastTouchIdentifier) {
					event.preventDefault();
					return false;
				}

				this.lastTouchIdentifier = touch.identifier;

				// If the target element is a child of a scrollable layer (using -webkit-overflow-scrolling: touch) and:
				// 1) the user does a fling scroll on the scrollable layer
				// 2) the user stops the fling scroll with another tap
				// then the event.target of the last 'touchend' event will be the element that was under the user's finger
				// when the fling scroll was started, causing FastClick to send a click event to that layer - unless a check
				// is made to ensure that a parent layer was not scrolled before sending a synthetic click (issue #42).
				this.updateScrollParent(targetElement);
			}
		}

		this.trackingClick = true;
		this.trackingClickStart = event.timeStamp;
		this.targetElement = targetElement;

		this.touchStartX = touch.pageX;
		this.touchStartY = touch.pageY;

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			event.preventDefault();
		}

		return true;
	};


	/**
	 * Based on a touchmove event object, check whether the touch has moved past a boundary since it started.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.touchHasMoved = function(event) {
		var touch = event.changedTouches[0], boundary = this.touchBoundary;

		if (Math.abs(touch.pageX - this.touchStartX) > boundary || Math.abs(touch.pageY - this.touchStartY) > boundary) {
			return true;
		}

		return false;
	};


	/**
	 * Update the last position.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchMove = function(event) {
		if (!this.trackingClick) {
			return true;
		}

		// If the touch has moved, cancel the click tracking
		if (this.targetElement !== this.getTargetElementFromEventTarget(event.target) || this.touchHasMoved(event)) {
			this.trackingClick = false;
			this.targetElement = null;
		}

		return true;
	};


	/**
	 * Attempt to find the labelled control for the given label element.
	 *
	 * @param {EventTarget|HTMLLabelElement} labelElement
	 * @returns {Element|null}
	 */
	FastClick.prototype.findControl = function(labelElement) {

		// Fast path for newer browsers supporting the HTML5 control attribute
		if (labelElement.control !== undefined) {
			return labelElement.control;
		}

		// All browsers under test that support touch events also support the HTML5 htmlFor attribute
		if (labelElement.htmlFor) {
			return document.getElementById(labelElement.htmlFor);
		}

		// If no for attribute exists, attempt to retrieve the first labellable descendant element
		// the list of which is defined here: http://www.w3.org/TR/html5/forms.html#category-label
		return labelElement.querySelector('button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea');
	};


	/**
	 * On touch end, determine whether to send a click event at once.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onTouchEnd = function(event) {
		var forElement, trackingClickStart, targetTagName, scrollParent, touch, targetElement = this.targetElement;

		if (!this.trackingClick) {
			return true;
		}

		// Prevent phantom clicks on fast double-tap (issue #36)
		if ((event.timeStamp - this.lastClickTime) < this.tapDelay) {
			this.cancelNextClick = true;
			return true;
		}

		if ((event.timeStamp - this.trackingClickStart) > this.tapTimeout) {
			return true;
		}

		// Reset to prevent wrong click cancel on input (issue #156).
		this.cancelNextClick = false;

		this.lastClickTime = event.timeStamp;

		trackingClickStart = this.trackingClickStart;
		this.trackingClick = false;
		this.trackingClickStart = 0;

		// On some iOS devices, the targetElement supplied with the event is invalid if the layer
		// is performing a transition or scroll, and has to be re-detected manually. Note that
		// for this to function correctly, it must be called *after* the event target is checked!
		// See issue #57; also filed as rdar://13048589 .
		if (deviceIsIOSWithBadTarget) {
			touch = event.changedTouches[0];

			// In certain cases arguments of elementFromPoint can be negative, so prevent setting targetElement to null
			targetElement = document.elementFromPoint(touch.pageX - window.pageXOffset, touch.pageY - window.pageYOffset) || targetElement;
			targetElement.fastClickScrollParent = this.targetElement.fastClickScrollParent;
		}

		targetTagName = targetElement.tagName.toLowerCase();
		if (targetTagName === 'label') {
			forElement = this.findControl(targetElement);
			if (forElement) {
				this.focus(targetElement);
				if (deviceIsAndroid) {
					return false;
				}

				targetElement = forElement;
			}
		} else if (this.needsFocus(targetElement)) {

			// Case 1: If the touch started a while ago (best guess is 100ms based on tests for issue #36) then focus will be triggered anyway. Return early and unset the target element reference so that the subsequent click will be allowed through.
			// Case 2: Without this exception for input elements tapped when the document is contained in an iframe, then any inputted text won't be visible even though the value attribute is updated as the user types (issue #37).
			if ((event.timeStamp - trackingClickStart) > 100 || (deviceIsIOS && window.top !== window && targetTagName === 'input')) {
				this.targetElement = null;
				return false;
			}

			this.focus(targetElement);
			this.sendClick(targetElement, event);

			// Select elements need the event to go through on iOS 4, otherwise the selector menu won't open.
			// Also this breaks opening selects when VoiceOver is active on iOS6, iOS7 (and possibly others)
			if (!deviceIsIOS || targetTagName !== 'select') {
				this.targetElement = null;
				event.preventDefault();
			}

			return false;
		}

		if (deviceIsIOS && !deviceIsIOS4) {

			// Don't send a synthetic click event if the target element is contained within a parent layer that was scrolled
			// and this tap is being used to stop the scrolling (usually initiated by a fling - issue #42).
			scrollParent = targetElement.fastClickScrollParent;
			if (scrollParent && scrollParent.fastClickLastScrollTop !== scrollParent.scrollTop) {
				return true;
			}
		}

		// Prevent the actual click from going though - unless the target node is marked as requiring
		// real clicks or if it is in the whitelist in which case only non-programmatic clicks are permitted.
		if (!this.needsClick(targetElement)) {
			event.preventDefault();
			this.sendClick(targetElement, event);
		}

		return false;
	};


	/**
	 * On touch cancel, stop tracking the click.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.onTouchCancel = function() {
		this.trackingClick = false;
		this.targetElement = null;
	};


	/**
	 * Determine mouse events which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onMouse = function(event) {

		// If a target element was never set (because a touch event was never fired) allow the event
		if (!this.targetElement) {
			return true;
		}

		if (event.forwardedTouchEvent) {
			return true;
		}

		// Programmatically generated events targeting a specific element should be permitted
		if (!event.cancelable) {
			return true;
		}

		// Derive and check the target element to see whether the mouse event needs to be permitted;
		// unless explicitly enabled, prevent non-touch click events from triggering actions,
		// to prevent ghost/doubleclicks.
		if (!this.needsClick(this.targetElement) || this.cancelNextClick) {

			// Prevent any user-added listeners declared on FastClick element from being fired.
			if (event.stopImmediatePropagation) {
				event.stopImmediatePropagation();
			} else {

				// Part of the hack for browsers that don't support Event#stopImmediatePropagation (e.g. Android 2)
				event.propagationStopped = true;
			}

			// Cancel the event
			event.stopPropagation();
			event.preventDefault();

			return false;
		}

		// If the mouse event is permitted, return true for the action to go through.
		return true;
	};


	/**
	 * On actual clicks, determine whether this is a touch-generated click, a click action occurring
	 * naturally after a delay after a touch (which needs to be cancelled to avoid duplication), or
	 * an actual click which should be permitted.
	 *
	 * @param {Event} event
	 * @returns {boolean}
	 */
	FastClick.prototype.onClick = function(event) {
		var permitted;

		// It's possible for another FastClick-like library delivered with third-party code to fire a click event before FastClick does (issue #44). In that case, set the click-tracking flag back to false and return early. This will cause onTouchEnd to return early.
		if (this.trackingClick) {
			this.targetElement = null;
			this.trackingClick = false;
			return true;
		}

		// Very odd behaviour on iOS (issue #18): if a submit element is present inside a form and the user hits enter in the iOS simulator or clicks the Go button on the pop-up OS keyboard the a kind of 'fake' click event will be triggered with the submit-type input element as the target.
		if (event.target.type === 'submit' && event.detail === 0) {
			return true;
		}

		permitted = this.onMouse(event);

		// Only unset targetElement if the click is not permitted. This will ensure that the check for !targetElement in onMouse fails and the browser's click doesn't go through.
		if (!permitted) {
			this.targetElement = null;
		}

		// If clicks are permitted, return true for the action to go through.
		return permitted;
	};


	/**
	 * Remove all FastClick's event listeners.
	 *
	 * @returns {void}
	 */
	FastClick.prototype.destroy = function() {
		var layer = this.layer;

		if (deviceIsAndroid) {
			layer.removeEventListener('mouseover', this.onMouse, true);
			layer.removeEventListener('mousedown', this.onMouse, true);
			layer.removeEventListener('mouseup', this.onMouse, true);
		}

		layer.removeEventListener('click', this.onClick, true);
		layer.removeEventListener('touchstart', this.onTouchStart, false);
		layer.removeEventListener('touchmove', this.onTouchMove, false);
		layer.removeEventListener('touchend', this.onTouchEnd, false);
		layer.removeEventListener('touchcancel', this.onTouchCancel, false);
	};


	/**
	 * Check whether FastClick is needed.
	 *
	 * @param {Element} layer The layer to listen on
	 */
	FastClick.notNeeded = function(layer) {
		var metaViewport;
		var chromeVersion;
		var blackberryVersion;
		var firefoxVersion;

		// Devices that don't support touch don't need FastClick
		if (typeof window.ontouchstart === 'undefined') {
			return true;
		}

		// Chrome version - zero for other browsers
		chromeVersion = +(/Chrome\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (chromeVersion) {

			if (deviceIsAndroid) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// Chrome on Android with user-scalable="no" doesn't need FastClick (issue #89)
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// Chrome 32 and above with width=device-width or less don't need FastClick
					if (chromeVersion > 31 && document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}

			// Chrome desktop doesn't need FastClick (issue #15)
			} else {
				return true;
			}
		}

		if (deviceIsBlackBerry10) {
			blackberryVersion = navigator.userAgent.match(/Version\/([0-9]*)\.([0-9]*)/);

			// BlackBerry 10.3+ does not require Fastclick library.
			// https://github.com/ftlabs/fastclick/issues/251
			if (blackberryVersion[1] >= 10 && blackberryVersion[2] >= 3) {
				metaViewport = document.querySelector('meta[name=viewport]');

				if (metaViewport) {
					// user-scalable=no eliminates click delay.
					if (metaViewport.content.indexOf('user-scalable=no') !== -1) {
						return true;
					}
					// width=device-width (or less than device-width) eliminates click delay.
					if (document.documentElement.scrollWidth <= window.outerWidth) {
						return true;
					}
				}
			}
		}

		// IE10 with -ms-touch-action: none or manipulation, which disables double-tap-to-zoom (issue #97)
		if (layer.style.msTouchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		// Firefox version - zero for other browsers
		firefoxVersion = +(/Firefox\/([0-9]+)/.exec(navigator.userAgent) || [,0])[1];

		if (firefoxVersion >= 27) {
			// Firefox 27+ does not have tap delay if the content is not zoomable - https://bugzilla.mozilla.org/show_bug.cgi?id=922896

			metaViewport = document.querySelector('meta[name=viewport]');
			if (metaViewport && (metaViewport.content.indexOf('user-scalable=no') !== -1 || document.documentElement.scrollWidth <= window.outerWidth)) {
				return true;
			}
		}

		// IE11: prefixed -ms-touch-action is no longer supported and it's recomended to use non-prefixed version
		// http://msdn.microsoft.com/en-us/library/windows/apps/Hh767313.aspx
		if (layer.style.touchAction === 'none' || layer.style.touchAction === 'manipulation') {
			return true;
		}

		return false;
	};


	/**
	 * Factory method for creating a FastClick object
	 *
	 * @param {Element} layer The layer to listen on
	 * @param {Object} [options={}] The options to override the defaults
	 */
	FastClick.attach = function(layer, options) {
		return new FastClick(layer, options);
	};


	if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {

		// AMD. Register as an anonymous module.
		define(function() {
			return FastClick;
		});
	} else if (typeof module !== 'undefined' && module.exports) {
		module.exports = FastClick.attach;
		module.exports.FastClick = FastClick;
	} else {
		window.FastClick = FastClick;
	}
}());

},{}],209:[function(require,module,exports){
/*!
 * JavaScript Cookie v2.0.4
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		define(factory);
	} else if (typeof exports === 'object') {
		module.exports = factory();
	} else {
		var _OldCookies = window.Cookies;
		var api = window.Cookies = factory();
		api.noConflict = function () {
			window.Cookies = _OldCookies;
			return api;
		};
	}
}(function () {
	function extend () {
		var i = 0;
		var result = {};
		for (; i < arguments.length; i++) {
			var attributes = arguments[ i ];
			for (var key in attributes) {
				result[key] = attributes[key];
			}
		}
		return result;
	}

	function init (converter) {
		function api (key, value, attributes) {
			var result;

			// Write

			if (arguments.length > 1) {
				attributes = extend({
					path: '/'
				}, api.defaults, attributes);

				if (typeof attributes.expires === 'number') {
					var expires = new Date();
					expires.setMilliseconds(expires.getMilliseconds() + attributes.expires * 864e+5);
					attributes.expires = expires;
				}

				try {
					result = JSON.stringify(value);
					if (/^[\{\[]/.test(result)) {
						value = result;
					}
				} catch (e) {}

				value = encodeURIComponent(String(value));
				value = value.replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g, decodeURIComponent);

				key = encodeURIComponent(String(key));
				key = key.replace(/%(23|24|26|2B|5E|60|7C)/g, decodeURIComponent);
				key = key.replace(/[\(\)]/g, escape);

				return (document.cookie = [
					key, '=', value,
					attributes.expires && '; expires=' + attributes.expires.toUTCString(), // use expires attribute, max-age is not supported by IE
					attributes.path    && '; path=' + attributes.path,
					attributes.domain  && '; domain=' + attributes.domain,
					attributes.secure ? '; secure' : ''
				].join(''));
			}

			// Read

			if (!key) {
				result = {};
			}

			// To prevent the for loop in the first place assign an empty array
			// in case there are no cookies at all. Also prevents odd result when
			// calling "get()"
			var cookies = document.cookie ? document.cookie.split('; ') : [];
			var rdecode = /(%[0-9A-Z]{2})+/g;
			var i = 0;

			for (; i < cookies.length; i++) {
				var parts = cookies[i].split('=');
				var name = parts[0].replace(rdecode, decodeURIComponent);
				var cookie = parts.slice(1).join('=');

				if (cookie.charAt(0) === '"') {
					cookie = cookie.slice(1, -1);
				}

				try {
					cookie = converter && converter(cookie, name) || cookie.replace(rdecode, decodeURIComponent);

					if (this.json) {
						try {
							cookie = JSON.parse(cookie);
						} catch (e) {}
					}

					if (key === name) {
						result = cookie;
						break;
					}

					if (!key) {
						result[name] = cookie;
					}
				} catch (e) {}
			}

			return result;
		}

		api.get = api.set = api;
		api.getJSON = function () {
			return api.apply({
				json: true
			}, [].slice.call(arguments));
		};
		api.defaults = {};

		api.remove = function (key, attributes) {
			api(key, '', extend(attributes, {
				expires: -1
			}));
		};

		api.withConverter = init;

		return api;
	}

	return init();
}));

},{}],210:[function(require,module,exports){
/**
 * https://github.com/cho45/micro-location.js
 * (c) cho45 http://cho45.github.com/mit-license
 */
// immutable object, should not assign a value to properties
function Location () { this.init.apply(this, arguments) }
Location.prototype = {
	init : function (protocol, host, hostname, port, pathname, search, hash) {
		this.protocol  = protocol;
		this.host      = host;
		this.hostname  = hostname;
		this.port      = port || "";
		this.pathname  = pathname || "";
		this.search    = search || "";
		this.hash      = hash || "";
		if (protocol) {
			with (this) this.href = protocol + '//' + host + pathname + search + hash;
		} else
		if (host) {
			with (this) this.href = '//' + host + pathname + search + hash;
		} else {
			with (this) this.href = pathname + search + hash;
		}
	},

	params : function (name) {
		if (!this._params) {
			var params = {};

			var pairs = this.search.substring(1).split(/[;&]/);
			for (var i = 0, len = pairs.length; i < len; i++) {
				if (!pairs[i]) continue;
				var pair = pairs[i].split(/=/);
				var key  = decodeURIComponent(pair[0].replace(/\+/g, '%20'));
				var val  = decodeURIComponent(pair[1].replace(/\+/g, '%20'));

				if (!params[key]) params[key] = [];
				params[key].push(val);
			}

			this._params = params;
		}

		switch (typeof name) {
			case "undefined": return this._params;
			case "object"   : return this.build(name);
		}
		return this._params[name] ? this._params[name][0] : null;
	},

	build : function (params) {
		if (!params) params = this._params;

		var ret = new Location();
		var _search = this.search;
		if (params) {
			var search = [];
			for (var key in params) if (params.hasOwnProperty(key)) {
				var val = params[key];
				switch (typeof val) {
					case "object":
						for (var i = 0, len = val.length; i < len; i++) {
							search.push(encodeURIComponent(key) + '=' + encodeURIComponent(val[i]));
						}
						break;
					default:
						search.push(encodeURIComponent(key) + '=' + encodeURIComponent(val));
				}
			}
			_search = '?' + search.join('&');
		}

		with (this) ret.init.apply(ret, [
			protocol,
			host,
			hostname,
			port,
			pathname,
			_search,
			hash
		]);
		return ret;
	}
};
Location.regexp = new RegExp('^(?:(https?:)//(([^:/]+)(:[^/]+)?))?([^#?]*)(\\?[^#]*)?(#.*)?$');
Location.parse = function (string) {
	var matched = String(string).match(this.regexp);
	var ret = new Location();
	ret.init.apply(ret, matched.slice(1));
	return ret;
};

(function (root, factory) {
	if (typeof module === "object" && module.exports) {
		module.exports = { 
			Location: factory()
		};
	} else if (typeof define === 'function' && define.amd) {
		define([], function () {
			return {
				Location: factory()
			}
		});
	} else {
		root.Location = factory();
	}
}(this, function () {
	return Location;
}));

},{}],211:[function(require,module,exports){
// shim for using process in browser

var process = module.exports = {};
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = setTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    clearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        setTimeout(drainQueue, 0);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };

},{}],212:[function(require,module,exports){
(function() {
  if (typeof twttr === "undefined" || twttr === null) {
    var twttr = {};
  }

  twttr.txt = {};
  twttr.txt.regexen = {};

  var HTML_ENTITIES = {
    '&': '&amp;',
    '>': '&gt;',
    '<': '&lt;',
    '"': '&quot;',
    "'": '&#39;'
  };

  // HTML escaping
  twttr.txt.htmlEscape = function(text) {
    return text && text.replace(/[&"'><]/g, function(character) {
      return HTML_ENTITIES[character];
    });
  };

  // Builds a RegExp
  function regexSupplant(regex, flags) {
    flags = flags || "";
    if (typeof regex !== "string") {
      if (regex.global && flags.indexOf("g") < 0) {
        flags += "g";
      }
      if (regex.ignoreCase && flags.indexOf("i") < 0) {
        flags += "i";
      }
      if (regex.multiline && flags.indexOf("m") < 0) {
        flags += "m";
      }

      regex = regex.source;
    }

    return new RegExp(regex.replace(/#\{(\w+)\}/g, function(match, name) {
      var newRegex = twttr.txt.regexen[name] || "";
      if (typeof newRegex !== "string") {
        newRegex = newRegex.source;
      }
      return newRegex;
    }), flags);
  }

  twttr.txt.regexSupplant = regexSupplant;

  // simple string interpolation
  function stringSupplant(str, values) {
    return str.replace(/#\{(\w+)\}/g, function(match, name) {
      return values[name] || "";
    });
  }

  twttr.txt.stringSupplant = stringSupplant;

  function addCharsToCharClass(charClass, start, end) {
    var s = String.fromCharCode(start);
    if (end !== start) {
      s += "-" + String.fromCharCode(end);
    }
    charClass.push(s);
    return charClass;
  }

  twttr.txt.addCharsToCharClass = addCharsToCharClass;

  // Space is more than %20, U+3000 for example is the full-width space used with Kanji. Provide a short-hand
  // to access both the list of characters and a pattern suitible for use with String#split
  // Taken from: ActiveSupport::Multibyte::Handlers::UTF8Handler::UNICODE_WHITESPACE
  var fromCode = String.fromCharCode;
  var UNICODE_SPACES = [
    fromCode(0x0020), // White_Space # Zs       SPACE
    fromCode(0x0085), // White_Space # Cc       <control-0085>
    fromCode(0x00A0), // White_Space # Zs       NO-BREAK SPACE
    fromCode(0x1680), // White_Space # Zs       OGHAM SPACE MARK
    fromCode(0x180E), // White_Space # Zs       MONGOLIAN VOWEL SEPARATOR
    fromCode(0x2028), // White_Space # Zl       LINE SEPARATOR
    fromCode(0x2029), // White_Space # Zp       PARAGRAPH SEPARATOR
    fromCode(0x202F), // White_Space # Zs       NARROW NO-BREAK SPACE
    fromCode(0x205F), // White_Space # Zs       MEDIUM MATHEMATICAL SPACE
    fromCode(0x3000)  // White_Space # Zs       IDEOGRAPHIC SPACE
  ];
  addCharsToCharClass(UNICODE_SPACES, 0x009, 0x00D); // White_Space # Cc   [5] <control-0009>..<control-000D>
  addCharsToCharClass(UNICODE_SPACES, 0x2000, 0x200A); // White_Space # Zs  [11] EN QUAD..HAIR SPACE

  var INVALID_CHARS = [
    fromCode(0xFFFE),
    fromCode(0xFEFF), // BOM
    fromCode(0xFFFF) // Special
  ];
  addCharsToCharClass(INVALID_CHARS, 0x202A, 0x202E); // Directional change

  twttr.txt.regexen.spaces_group = regexSupplant(UNICODE_SPACES.join(""));
  twttr.txt.regexen.spaces = regexSupplant("[" + UNICODE_SPACES.join("") + "]");
  twttr.txt.regexen.invalid_chars_group = regexSupplant(INVALID_CHARS.join(""));
  twttr.txt.regexen.punct = /\!'#%&'\(\)*\+,\\\-\.\/:;<=>\?@\[\]\^_{|}~\$/;
  twttr.txt.regexen.rtl_chars = /[\u0600-\u06FF]|[\u0750-\u077F]|[\u0590-\u05FF]|[\uFE70-\uFEFF]/mg;
  twttr.txt.regexen.non_bmp_code_pairs = /[\uD800-\uDBFF][\uDC00-\uDFFF]/mg;

  var latinAccentChars = [];
  // Latin accented characters (subtracted 0xD7 from the range, it's a confusable multiplication sign. Looks like "x")
  addCharsToCharClass(latinAccentChars, 0x00c0, 0x00d6);
  addCharsToCharClass(latinAccentChars, 0x00d8, 0x00f6);
  addCharsToCharClass(latinAccentChars, 0x00f8, 0x00ff);
  // Latin Extended A and B
  addCharsToCharClass(latinAccentChars, 0x0100, 0x024f);
  // assorted IPA Extensions
  addCharsToCharClass(latinAccentChars, 0x0253, 0x0254);
  addCharsToCharClass(latinAccentChars, 0x0256, 0x0257);
  addCharsToCharClass(latinAccentChars, 0x0259, 0x0259);
  addCharsToCharClass(latinAccentChars, 0x025b, 0x025b);
  addCharsToCharClass(latinAccentChars, 0x0263, 0x0263);
  addCharsToCharClass(latinAccentChars, 0x0268, 0x0268);
  addCharsToCharClass(latinAccentChars, 0x026f, 0x026f);
  addCharsToCharClass(latinAccentChars, 0x0272, 0x0272);
  addCharsToCharClass(latinAccentChars, 0x0289, 0x0289);
  addCharsToCharClass(latinAccentChars, 0x028b, 0x028b);
  // Okina for Hawaiian (it *is* a letter character)
  addCharsToCharClass(latinAccentChars, 0x02bb, 0x02bb);
  // Combining diacritics
  addCharsToCharClass(latinAccentChars, 0x0300, 0x036f);
  // Latin Extended Additional
  addCharsToCharClass(latinAccentChars, 0x1e00, 0x1eff);
  twttr.txt.regexen.latinAccentChars = regexSupplant(latinAccentChars.join(""));

  var unicodeLettersAndMarks = "A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0561-\u0587\u05D0-\u05EA\u05F0-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u08A0-\u08B2\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58\u0C59\u0C60\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D60\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E87\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA\u0EAB\u0EAD-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F4\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19C1-\u19C7\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5\u1CF6\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FCC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA78E\uA790-\uA7AD\uA7B0\uA7B1\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB5F\uAB64\uAB65\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C00-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D01-\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1AB0-\u1ABE\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1CF8\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9E5\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2D";
  var unicodeNumbers = "0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19";
  var hashtagSpecialChars = "_\u200c\u200d\ua67e\u05be\u05f3\u05f4\u309b\u309c\u30a0\u30fb\u3003\u0f0b\u0f0c\u00b7";

  // A hashtag must contain at least one unicode letter or mark, as well as numbers, underscores, and select special characters.
  twttr.txt.regexen.hashSigns = /[#]/;
  twttr.txt.regexen.hashtagAlpha = new RegExp("[" + unicodeLettersAndMarks + "]");
  twttr.txt.regexen.hashtagAlphaNumeric = new RegExp("[" + unicodeLettersAndMarks + unicodeNumbers + hashtagSpecialChars + "]");
  twttr.txt.regexen.endHashtagMatch = regexSupplant(/^(?:#{hashSigns}|:\/\/)/);
  twttr.txt.regexen.hashtagBoundary = new RegExp("(?:^|$|[^&" + unicodeLettersAndMarks + unicodeNumbers + hashtagSpecialChars + "])");
  twttr.txt.regexen.validHashtag = regexSupplant(/(#{hashtagBoundary})(#{hashSigns})(#{hashtagAlphaNumeric}*#{hashtagAlpha}#{hashtagAlphaNumeric}*)/gi);

  // Mention related regex collection
  twttr.txt.regexen.validMentionPrecedingChars = /(?:^|[^a-zA-Z0-9_!#$%&*@]|(?:^|[^a-zA-Z0-9_+~.-])(?:rt|RT|rT|Rt):?)/;
  twttr.txt.regexen.atSigns = /[@]/;
  twttr.txt.regexen.validMentionOrList = regexSupplant(
    '(#{validMentionPrecedingChars})' +  // $1: Preceding character
    '(#{atSigns})' +                     // $2: At mark
    '([a-zA-Z0-9_]{1,20})' +             // $3: Screen name
    '(\/[a-zA-Z][a-zA-Z0-9_\-]{0,24})?'  // $4: List (optional)
  , 'g');
  twttr.txt.regexen.validReply = regexSupplant(/^(?:#{spaces})*#{atSigns}([a-zA-Z0-9_]{1,20})/);
  twttr.txt.regexen.endMentionMatch = regexSupplant(/^(?:#{atSigns}|[#{latinAccentChars}]|:\/\/)/);

  // URL related regex collection
  twttr.txt.regexen.validUrlPrecedingChars = regexSupplant(/(?:[^A-Za-z0-9@$##{invalid_chars_group}]|^)/);
  twttr.txt.regexen.invalidUrlWithoutProtocolPrecedingChars = /[-_.\/]$/;
  twttr.txt.regexen.invalidDomainChars = stringSupplant("#{punct}#{spaces_group}#{invalid_chars_group}", twttr.txt.regexen);
  twttr.txt.regexen.validDomainChars = regexSupplant(/[^#{invalidDomainChars}]/);
  twttr.txt.regexen.validSubdomain = regexSupplant(/(?:(?:#{validDomainChars}(?:[_-]|#{validDomainChars})*)?#{validDomainChars}\.)/);
  twttr.txt.regexen.validDomainName = regexSupplant(/(?:(?:#{validDomainChars}(?:-|#{validDomainChars})*)?#{validDomainChars}\.)/);
  twttr.txt.regexen.validGTLD = regexSupplant(RegExp(
    '(?:(?:' +
    'abb|abbott|abogado|academy|accenture|accountant|accountants|aco|active|actor|ads|adult|aeg|aero|' +
    'afl|agency|aig|airforce|airtel|allfinanz|alsace|amsterdam|android|apartments|app|aquarelle|' +
    'archi|army|arpa|asia|associates|attorney|auction|audio|auto|autos|axa|azure|band|bank|bar|' +
    'barcelona|barclaycard|barclays|bargains|bauhaus|bayern|bbc|bbva|bcn|beer|bentley|berlin|best|' +
    'bet|bharti|bible|bid|bike|bing|bingo|bio|biz|black|blackfriday|bloomberg|blue|bmw|bnl|' +
    'bnpparibas|boats|bond|boo|boots|boutique|bradesco|bridgestone|broker|brother|brussels|budapest|' +
    'build|builders|business|buzz|bzh|cab|cafe|cal|camera|camp|cancerresearch|canon|capetown|capital|' +
    'caravan|cards|care|career|careers|cars|cartier|casa|cash|casino|cat|catering|cba|cbn|ceb|center|' +
    'ceo|cern|cfa|cfd|chanel|channel|chat|cheap|chloe|christmas|chrome|church|cisco|citic|city|' +
    'claims|cleaning|click|clinic|clothing|cloud|club|coach|codes|coffee|college|cologne|com|' +
    'commbank|community|company|computer|condos|construction|consulting|contractors|cooking|cool|' +
    'coop|corsica|country|coupons|courses|credit|creditcard|cricket|crown|crs|cruises|cuisinella|' +
    'cymru|cyou|dabur|dad|dance|date|dating|datsun|day|dclk|deals|degree|delivery|delta|democrat|' +
    'dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dnp|docs|dog|' +
    'doha|domains|doosan|download|drive|durban|dvag|earth|eat|edu|education|email|emerck|energy|' +
    'engineer|engineering|enterprises|epson|equipment|erni|esq|estate|eurovision|eus|events|everbank|' +
    'exchange|expert|exposed|express|fage|fail|faith|family|fan|fans|farm|fashion|feedback|film|' +
    'finance|financial|firmdale|fish|fishing|fit|fitness|flights|florist|flowers|flsmidth|fly|foo|' +
    'football|forex|forsale|forum|foundation|frl|frogans|fund|furniture|futbol|fyi|gal|gallery|game|' +
    'garden|gbiz|gdn|gent|genting|ggee|gift|gifts|gives|giving|glass|gle|global|globo|gmail|gmo|gmx|' +
    'gold|goldpoint|golf|goo|goog|google|gop|gov|graphics|gratis|green|gripe|group|guge|guide|' +
    'guitars|guru|hamburg|hangout|haus|healthcare|help|here|hermes|hiphop|hitachi|hiv|hockey|' +
    'holdings|holiday|homedepot|homes|honda|horse|host|hosting|hoteles|hotmail|house|how|hsbc|ibm|' +
    'icbc|ice|icu|ifm|iinet|immo|immobilien|industries|infiniti|info|ing|ink|institute|insure|int|' +
    'international|investments|ipiranga|irish|ist|istanbul|itau|iwc|java|jcb|jetzt|jewelry|jlc|jll|' +
    'jobs|joburg|jprs|juegos|kaufen|kddi|kim|kitchen|kiwi|koeln|komatsu|krd|kred|kyoto|lacaixa|' +
    'lancaster|land|lasalle|lat|latrobe|law|lawyer|lds|lease|leclerc|legal|lexus|lgbt|liaison|lidl|' +
    'life|lighting|limited|limo|link|live|lixil|loan|loans|lol|london|lotte|lotto|love|ltda|lupin|' +
    'luxe|luxury|madrid|maif|maison|man|management|mango|market|marketing|markets|marriott|mba|media|' +
    'meet|melbourne|meme|memorial|men|menu|miami|microsoft|mil|mini|mma|mobi|moda|moe|mom|monash|' +
    'money|montblanc|mormon|mortgage|moscow|motorcycles|mov|movie|movistar|mtn|mtpc|museum|nadex|' +
    'nagoya|name|navy|nec|net|netbank|network|neustar|new|news|nexus|ngo|nhk|nico|ninja|nissan|nokia|' +
    'nra|nrw|ntt|nyc|office|okinawa|omega|one|ong|onl|online|ooo|oracle|orange|org|organic|osaka|' +
    'otsuka|ovh|page|panerai|paris|partners|parts|party|pet|pharmacy|philips|photo|photography|' +
    'photos|physio|piaget|pics|pictet|pictures|pink|pizza|place|play|plumbing|plus|pohl|poker|porn|' +
    'post|praxi|press|pro|prod|productions|prof|properties|property|pub|qpon|quebec|racing|realtor|' +
    'realty|recipes|red|redstone|rehab|reise|reisen|reit|ren|rent|rentals|repair|report|republican|' +
    'rest|restaurant|review|reviews|rich|ricoh|rio|rip|rocks|rodeo|rsvp|ruhr|run|ryukyu|saarland|' +
    'sakura|sale|samsung|sandvik|sandvikcoromant|sanofi|sap|sarl|saxo|sca|scb|schmidt|scholarships|' +
    'school|schule|schwarz|science|scor|scot|seat|seek|sener|services|sew|sex|sexy|shiksha|shoes|' +
    'show|shriram|singles|site|ski|sky|skype|sncf|soccer|social|software|sohu|solar|solutions|sony|' +
    'soy|space|spiegel|spreadbetting|srl|starhub|statoil|studio|study|style|sucks|supplies|supply|' +
    'support|surf|surgery|suzuki|swatch|swiss|sydney|systems|taipei|tatamotors|tatar|tattoo|tax|taxi|' +
    'team|tech|technology|tel|telefonica|temasek|tennis|thd|theater|tickets|tienda|tips|tires|tirol|' +
    'today|tokyo|tools|top|toray|toshiba|tours|town|toyota|toys|trade|trading|training|travel|trust|' +
    'tui|ubs|university|uno|uol|vacations|vegas|ventures|vermgensberater|vermgensberatung|' +
    'versicherung|vet|viajes|video|villas|vin|vision|vista|vistaprint|vlaanderen|vodka|vote|voting|' +
    'voto|voyage|wales|walter|wang|watch|webcam|website|wed|wedding|weir|whoswho|wien|wiki|' +
    'williamhill|win|windows|wine|wme|work|works|world|wtc|wtf|xbox|xerox|xin|xperia|xxx|xyz|yachts|' +
    'yandex|yodobashi|yoga|yokohama|youtube|zip|zone|zuerich|||||||||' +
    '||||||||||||||||||||||||||' +
    '||||||||||||||||||||||||||onion' +
    ')(?=[^0-9a-zA-Z@]|$))'));
  twttr.txt.regexen.validCCTLD = regexSupplant(RegExp(
    '(?:(?:' +
    'ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bl|bm|bn|bo|bq|' +
    'br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|' +
    'ec|ee|eg|eh|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|' +
    'gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|' +
    'la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mf|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|' +
    'my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|' +
    'rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|ss|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|' +
    'tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw||' +
    '|||||||||||||||||' +
    '|||||||||||||||' +
    '||||||||||||' +
    ')(?=[^0-9a-zA-Z@]|$))'));
  twttr.txt.regexen.validPunycode = regexSupplant(/(?:xn--[0-9a-z]+)/);
  twttr.txt.regexen.validSpecialCCTLD = regexSupplant(RegExp(
    '(?:(?:co|tv)(?=[^0-9a-zA-Z@]|$))'));
  twttr.txt.regexen.validDomain = regexSupplant(/(?:#{validSubdomain}*#{validDomainName}(?:#{validGTLD}|#{validCCTLD}|#{validPunycode}))/);
  twttr.txt.regexen.validAsciiDomain = regexSupplant(/(?:(?:[\-a-z0-9#{latinAccentChars}]+)\.)+(?:#{validGTLD}|#{validCCTLD}|#{validPunycode})/gi);
  twttr.txt.regexen.invalidShortDomain = regexSupplant(/^#{validDomainName}#{validCCTLD}$/i);
  twttr.txt.regexen.validSpecialShortDomain = regexSupplant(/^#{validDomainName}#{validSpecialCCTLD}$/i);

  twttr.txt.regexen.validPortNumber = regexSupplant(/[0-9]+/);

  twttr.txt.regexen.validGeneralUrlPathChars = regexSupplant(/[a-z0-9!\*';:=\+,\.\$\/%#\[\]\-_~@|&#{latinAccentChars}]/i);
  // Allow URL paths to contain up to two nested levels of balanced parens
  //  1. Used in Wikipedia URLs like /Primer_(film)
  //  2. Used in IIS sessions like /S(dfd346)/
  //  3. Used in Rdio URLs like /track/We_Up_(Album_Version_(Edited))/
  twttr.txt.regexen.validUrlBalancedParens = regexSupplant(
    '\\('                                   +
      '(?:'                                 +
        '#{validGeneralUrlPathChars}+'      +
        '|'                                 +
        // allow one nested level of balanced parentheses
        '(?:'                               +
          '#{validGeneralUrlPathChars}*'    +
          '\\('                             +
            '#{validGeneralUrlPathChars}+'  +
          '\\)'                             +
          '#{validGeneralUrlPathChars}*'    +
        ')'                                 +
      ')'                                   +
    '\\)'
  , 'i');
  // Valid end-of-path chracters (so /foo. does not gobble the period).
  // 1. Allow =&# for empty URL parameters and other URL-join artifacts
  twttr.txt.regexen.validUrlPathEndingChars = regexSupplant(/[\+\-a-z0-9=_#\/#{latinAccentChars}]|(?:#{validUrlBalancedParens})/i);
  // Allow @ in a url, but only in the middle. Catch things like http://example.com/@user/
  twttr.txt.regexen.validUrlPath = regexSupplant('(?:' +
    '(?:' +
      '#{validGeneralUrlPathChars}*' +
        '(?:#{validUrlBalancedParens}#{validGeneralUrlPathChars}*)*' +
        '#{validUrlPathEndingChars}'+
      ')|(?:@#{validGeneralUrlPathChars}+\/)'+
    ')', 'i');

  twttr.txt.regexen.validUrlQueryChars = /[a-z0-9!?\*'@\(\);:&=\+\$\/%#\[\]\-_\.,~|]/i;
  twttr.txt.regexen.validUrlQueryEndingChars = /[a-z0-9_&=#\/]/i;
  twttr.txt.regexen.extractUrl = regexSupplant(
    '('                                                            + // $1 total match
      '(#{validUrlPrecedingChars})'                                + // $2 Preceeding chracter
      '('                                                          + // $3 URL
        '(https?:\\/\\/)?'                                         + // $4 Protocol (optional)
        '(#{validDomain})'                                         + // $5 Domain(s)
        '(?::(#{validPortNumber}))?'                               + // $6 Port number (optional)
        '(\\/#{validUrlPath}*)?'                                   + // $7 URL Path
        '(\\?#{validUrlQueryChars}*#{validUrlQueryEndingChars})?'  + // $8 Query String
      ')'                                                          +
    ')'
  , 'gi');

  twttr.txt.regexen.validTcoUrl = /^https?:\/\/t\.co\/[a-z0-9]+/i;
  twttr.txt.regexen.urlHasProtocol = /^https?:\/\//i;
  twttr.txt.regexen.urlHasHttps = /^https:\/\//i;

  // cashtag related regex
  twttr.txt.regexen.cashtag = /[a-z]{1,6}(?:[._][a-z]{1,2})?/i;
  twttr.txt.regexen.validCashtag = regexSupplant('(^|#{spaces})(\\$)(#{cashtag})(?=$|\\s|[#{punct}])', 'gi');

  // These URL validation pattern strings are based on the ABNF from RFC 3986
  twttr.txt.regexen.validateUrlUnreserved = /[a-z0-9\-._~]/i;
  twttr.txt.regexen.validateUrlPctEncoded = /(?:%[0-9a-f]{2})/i;
  twttr.txt.regexen.validateUrlSubDelims = /[!$&'()*+,;=]/i;
  twttr.txt.regexen.validateUrlPchar = regexSupplant('(?:' +
    '#{validateUrlUnreserved}|' +
    '#{validateUrlPctEncoded}|' +
    '#{validateUrlSubDelims}|' +
    '[:|@]' +
  ')', 'i');

  twttr.txt.regexen.validateUrlScheme = /(?:[a-z][a-z0-9+\-.]*)/i;
  twttr.txt.regexen.validateUrlUserinfo = regexSupplant('(?:' +
    '#{validateUrlUnreserved}|' +
    '#{validateUrlPctEncoded}|' +
    '#{validateUrlSubDelims}|' +
    ':' +
  ')*', 'i');

  twttr.txt.regexen.validateUrlDecOctet = /(?:[0-9]|(?:[1-9][0-9])|(?:1[0-9]{2})|(?:2[0-4][0-9])|(?:25[0-5]))/i;
  twttr.txt.regexen.validateUrlIpv4 = regexSupplant(/(?:#{validateUrlDecOctet}(?:\.#{validateUrlDecOctet}){3})/i);

  // Punting on real IPv6 validation for now
  twttr.txt.regexen.validateUrlIpv6 = /(?:\[[a-f0-9:\.]+\])/i;

  // Also punting on IPvFuture for now
  twttr.txt.regexen.validateUrlIp = regexSupplant('(?:' +
    '#{validateUrlIpv4}|' +
    '#{validateUrlIpv6}' +
  ')', 'i');

  // This is more strict than the rfc specifies
  twttr.txt.regexen.validateUrlSubDomainSegment = /(?:[a-z0-9](?:[a-z0-9_\-]*[a-z0-9])?)/i;
  twttr.txt.regexen.validateUrlDomainSegment = /(?:[a-z0-9](?:[a-z0-9\-]*[a-z0-9])?)/i;
  twttr.txt.regexen.validateUrlDomainTld = /(?:[a-z](?:[a-z0-9\-]*[a-z0-9])?)/i;
  twttr.txt.regexen.validateUrlDomain = regexSupplant(/(?:(?:#{validateUrlSubDomainSegment]}\.)*(?:#{validateUrlDomainSegment]}\.)#{validateUrlDomainTld})/i);

  twttr.txt.regexen.validateUrlHost = regexSupplant('(?:' +
    '#{validateUrlIp}|' +
    '#{validateUrlDomain}' +
  ')', 'i');

  // Unencoded internationalized domains - this doesn't check for invalid UTF-8 sequences
  twttr.txt.regexen.validateUrlUnicodeSubDomainSegment = /(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9_\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;
  twttr.txt.regexen.validateUrlUnicodeDomainSegment = /(?:(?:[a-z0-9]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;
  twttr.txt.regexen.validateUrlUnicodeDomainTld = /(?:(?:[a-z]|[^\u0000-\u007f])(?:(?:[a-z0-9\-]|[^\u0000-\u007f])*(?:[a-z0-9]|[^\u0000-\u007f]))?)/i;
  twttr.txt.regexen.validateUrlUnicodeDomain = regexSupplant(/(?:(?:#{validateUrlUnicodeSubDomainSegment}\.)*(?:#{validateUrlUnicodeDomainSegment}\.)#{validateUrlUnicodeDomainTld})/i);

  twttr.txt.regexen.validateUrlUnicodeHost = regexSupplant('(?:' +
    '#{validateUrlIp}|' +
    '#{validateUrlUnicodeDomain}' +
  ')', 'i');

  twttr.txt.regexen.validateUrlPort = /[0-9]{1,5}/;

  twttr.txt.regexen.validateUrlUnicodeAuthority = regexSupplant(
    '(?:(#{validateUrlUserinfo})@)?'  + // $1 userinfo
    '(#{validateUrlUnicodeHost})'     + // $2 host
    '(?::(#{validateUrlPort}))?'        //$3 port
  , "i");

  twttr.txt.regexen.validateUrlAuthority = regexSupplant(
    '(?:(#{validateUrlUserinfo})@)?' + // $1 userinfo
    '(#{validateUrlHost})'           + // $2 host
    '(?::(#{validateUrlPort}))?'       // $3 port
  , "i");

  twttr.txt.regexen.validateUrlPath = regexSupplant(/(\/#{validateUrlPchar}*)*/i);
  twttr.txt.regexen.validateUrlQuery = regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i);
  twttr.txt.regexen.validateUrlFragment = regexSupplant(/(#{validateUrlPchar}|\/|\?)*/i);

  // Modified version of RFC 3986 Appendix B
  twttr.txt.regexen.validateUrlUnencoded = regexSupplant(
    '^'                               + // Full URL
    '(?:'                             +
      '([^:/?#]+):\\/\\/'             + // $1 Scheme
    ')?'                              +
    '([^/?#]*)'                       + // $2 Authority
    '([^?#]*)'                        + // $3 Path
    '(?:'                             +
      '\\?([^#]*)'                    + // $4 Query
    ')?'                              +
    '(?:'                             +
      '#(.*)'                         + // $5 Fragment
    ')?$'
  , "i");


  // Default CSS class for auto-linked lists (along with the url class)
  var DEFAULT_LIST_CLASS = "tweet-url list-slug";
  // Default CSS class for auto-linked usernames (along with the url class)
  var DEFAULT_USERNAME_CLASS = "tweet-url username";
  // Default CSS class for auto-linked hashtags (along with the url class)
  var DEFAULT_HASHTAG_CLASS = "tweet-url hashtag";
  // Default CSS class for auto-linked cashtags (along with the url class)
  var DEFAULT_CASHTAG_CLASS = "tweet-url cashtag";
  // Options which should not be passed as HTML attributes
  var OPTIONS_NOT_ATTRIBUTES = {'urlClass':true, 'listClass':true, 'usernameClass':true, 'hashtagClass':true, 'cashtagClass':true,
                            'usernameUrlBase':true, 'listUrlBase':true, 'hashtagUrlBase':true, 'cashtagUrlBase':true,
                            'usernameUrlBlock':true, 'listUrlBlock':true, 'hashtagUrlBlock':true, 'linkUrlBlock':true,
                            'usernameIncludeSymbol':true, 'suppressLists':true, 'suppressNoFollow':true, 'targetBlank':true,
                            'suppressDataScreenName':true, 'urlEntities':true, 'symbolTag':true, 'textWithSymbolTag':true, 'urlTarget':true,
                            'invisibleTagAttrs':true, 'linkAttributeBlock':true, 'linkTextBlock': true, 'htmlEscapeNonEntities': true
                            };

  var BOOLEAN_ATTRIBUTES = {'disabled':true, 'readonly':true, 'multiple':true, 'checked':true};

  // Simple object cloning function for simple objects
  function clone(o) {
    var r = {};
    for (var k in o) {
      if (o.hasOwnProperty(k)) {
        r[k] = o[k];
      }
    }

    return r;
  }

  twttr.txt.tagAttrs = function(attributes) {
    var htmlAttrs = "";
    for (var k in attributes) {
      var v = attributes[k];
      if (BOOLEAN_ATTRIBUTES[k]) {
        v = v ? k : null;
      }
      if (v == null) continue;
      htmlAttrs += " " + twttr.txt.htmlEscape(k) + "=\"" + twttr.txt.htmlEscape(v.toString()) + "\"";
    }
    return htmlAttrs;
  };

  twttr.txt.linkToText = function(entity, text, attributes, options) {
    if (!options.suppressNoFollow) {
      attributes.rel = "nofollow";
    }
    // if linkAttributeBlock is specified, call it to modify the attributes
    if (options.linkAttributeBlock) {
      options.linkAttributeBlock(entity, attributes);
    }
    // if linkTextBlock is specified, call it to get a new/modified link text
    if (options.linkTextBlock) {
      text = options.linkTextBlock(entity, text);
    }
    var d = {
      text: text,
      attr: twttr.txt.tagAttrs(attributes)
    };
    return stringSupplant("<a#{attr}>#{text}</a>", d);
  };

  twttr.txt.linkToTextWithSymbol = function(entity, symbol, text, attributes, options) {
    var taggedSymbol = options.symbolTag ? "<" + options.symbolTag + ">" + symbol + "</"+ options.symbolTag + ">" : symbol;
    text = twttr.txt.htmlEscape(text);
    var taggedText = options.textWithSymbolTag ? "<" + options.textWithSymbolTag + ">" + text + "</"+ options.textWithSymbolTag + ">" : text;

    if (options.usernameIncludeSymbol || !symbol.match(twttr.txt.regexen.atSigns)) {
      return twttr.txt.linkToText(entity, taggedSymbol + taggedText, attributes, options);
    } else {
      return taggedSymbol + twttr.txt.linkToText(entity, taggedText, attributes, options);
    }
  };

  twttr.txt.linkToHashtag = function(entity, text, options) {
    var hash = text.substring(entity.indices[0], entity.indices[0] + 1);
    var hashtag = twttr.txt.htmlEscape(entity.hashtag);
    var attrs = clone(options.htmlAttrs || {});
    attrs.href = options.hashtagUrlBase + hashtag;
    attrs.title = "#" + hashtag;
    attrs["class"] = options.hashtagClass;
    if (hashtag.charAt(0).match(twttr.txt.regexen.rtl_chars)){
      attrs["class"] += " rtl";
    }
    if (options.targetBlank) {
      attrs.target = '_blank';
    }

    return twttr.txt.linkToTextWithSymbol(entity, hash, hashtag, attrs, options);
  };

  twttr.txt.linkToCashtag = function(entity, text, options) {
    var cashtag = twttr.txt.htmlEscape(entity.cashtag);
    var attrs = clone(options.htmlAttrs || {});
    attrs.href = options.cashtagUrlBase + cashtag;
    attrs.title = "$" + cashtag;
    attrs["class"] =  options.cashtagClass;
    if (options.targetBlank) {
      attrs.target = '_blank';
    }

    return twttr.txt.linkToTextWithSymbol(entity, "$", cashtag, attrs, options);
  };

  twttr.txt.linkToMentionAndList = function(entity, text, options) {
    var at = text.substring(entity.indices[0], entity.indices[0] + 1);
    var user = twttr.txt.htmlEscape(entity.screenName);
    var slashListname = twttr.txt.htmlEscape(entity.listSlug);
    var isList = entity.listSlug && !options.suppressLists;
    var attrs = clone(options.htmlAttrs || {});
    attrs["class"] = (isList ? options.listClass : options.usernameClass);
    attrs.href = isList ? options.listUrlBase + user + slashListname : options.usernameUrlBase + user;
    if (!isList && !options.suppressDataScreenName) {
      attrs['data-screen-name'] = user;
    }
    if (options.targetBlank) {
      attrs.target = '_blank';
    }

    return twttr.txt.linkToTextWithSymbol(entity, at, isList ? user + slashListname : user, attrs, options);
  };

  twttr.txt.linkToUrl = function(entity, text, options) {
    var url = entity.url;
    var displayUrl = url;
    var linkText = twttr.txt.htmlEscape(displayUrl);

    // If the caller passed a urlEntities object (provided by a Twitter API
    // response with include_entities=true), we use that to render the display_url
    // for each URL instead of it's underlying t.co URL.
    var urlEntity = (options.urlEntities && options.urlEntities[url]) || entity;
    if (urlEntity.display_url) {
      linkText = twttr.txt.linkTextWithEntity(urlEntity, options);
    }

    var attrs = clone(options.htmlAttrs || {});

    if (!url.match(twttr.txt.regexen.urlHasProtocol)) {
      url = "http://" + url;
    }
    attrs.href = url;

    if (options.targetBlank) {
      attrs.target = '_blank';
    }

    // set class only if urlClass is specified.
    if (options.urlClass) {
      attrs["class"] = options.urlClass;
    }

    // set target only if urlTarget is specified.
    if (options.urlTarget) {
      attrs.target = options.urlTarget;
    }

    if (!options.title && urlEntity.display_url) {
      attrs.title = urlEntity.expanded_url;
    }

    return twttr.txt.linkToText(entity, linkText, attrs, options);
  };

  twttr.txt.linkTextWithEntity = function (entity, options) {
    var displayUrl = entity.display_url;
    var expandedUrl = entity.expanded_url;

    // Goal: If a user copies and pastes a tweet containing t.co'ed link, the resulting paste
    // should contain the full original URL (expanded_url), not the display URL.
    //
    // Method: Whenever possible, we actually emit HTML that contains expanded_url, and use
    // font-size:0 to hide those parts that should not be displayed (because they are not part of display_url).
    // Elements with font-size:0 get copied even though they are not visible.
    // Note that display:none doesn't work here. Elements with display:none don't get copied.
    //
    // Additionally, we want to *display* ellipses, but we don't want them copied.  To make this happen we
    // wrap the ellipses in a tco-ellipsis class and provide an onCopy handler that sets display:none on
    // everything with the tco-ellipsis class.
    //
    // Exception: pic.twitter.com images, for which expandedUrl = "https://twitter.com/#!/username/status/1234/photo/1
    // For those URLs, display_url is not a substring of expanded_url, so we don't do anything special to render the elided parts.
    // For a pic.twitter.com URL, the only elided part will be the "https://", so this is fine.

    var displayUrlSansEllipses = displayUrl.replace(//g, ""); // We have to disregard ellipses for matching
    // Note: we currently only support eliding parts of the URL at the beginning or the end.
    // Eventually we may want to elide parts of the URL in the *middle*.  If so, this code will
    // become more complicated.  We will probably want to create a regexp out of display URL,
    // replacing every ellipsis with a ".*".
    if (expandedUrl.indexOf(displayUrlSansEllipses) != -1) {
      var displayUrlIndex = expandedUrl.indexOf(displayUrlSansEllipses);
      var v = {
        displayUrlSansEllipses: displayUrlSansEllipses,
        // Portion of expandedUrl that precedes the displayUrl substring
        beforeDisplayUrl: expandedUrl.substr(0, displayUrlIndex),
        // Portion of expandedUrl that comes after displayUrl
        afterDisplayUrl: expandedUrl.substr(displayUrlIndex + displayUrlSansEllipses.length),
        precedingEllipsis: displayUrl.match(/^/) ? "" : "",
        followingEllipsis: displayUrl.match(/$/) ? "" : ""
      };
      for (var k in v) {
        if (v.hasOwnProperty(k)) {
          v[k] = twttr.txt.htmlEscape(v[k]);
        }
      }
      // As an example: The user tweets "hi http://longdomainname.com/foo"
      // This gets shortened to "hi http://t.co/xyzabc", with display_url = "nname.com/foo"
      // This will get rendered as:
      // <span class='tco-ellipsis'> <!-- This stuff should get displayed but not copied -->
      //   
      //   <!-- There's a chance the onCopy event handler might not fire. In case that happens,
      //        we include an &nbsp; here so that the  doesn't bump up against the URL and ruin it.
      //        The &nbsp; is inside the tco-ellipsis span so that when the onCopy handler *does*
      //        fire, it doesn't get copied.  Otherwise the copied text would have two spaces in a row,
      //        e.g. "hi  http://longdomainname.com/foo".
      //   <span style='font-size:0'>&nbsp;</span>
      // </span>
      // <span style='font-size:0'>  <!-- This stuff should get copied but not displayed -->
      //   http://longdomai
      // </span>
      // <span class='js-display-url'> <!-- This stuff should get displayed *and* copied -->
      //   nname.com/foo
      // </span>
      // <span class='tco-ellipsis'> <!-- This stuff should get displayed but not copied -->
      //   <span style='font-size:0'>&nbsp;</span>
      //   
      // </span>
      v['invisible'] = options.invisibleTagAttrs;
      return stringSupplant("<span class='tco-ellipsis'>#{precedingEllipsis}<span #{invisible}>&nbsp;</span></span><span #{invisible}>#{beforeDisplayUrl}</span><span class='js-display-url'>#{displayUrlSansEllipses}</span><span #{invisible}>#{afterDisplayUrl}</span><span class='tco-ellipsis'><span #{invisible}>&nbsp;</span>#{followingEllipsis}</span>", v);
    }
    return displayUrl;
  };

  twttr.txt.autoLinkEntities = function(text, entities, options) {
    options = clone(options || {});

    options.hashtagClass = options.hashtagClass || DEFAULT_HASHTAG_CLASS;
    options.hashtagUrlBase = options.hashtagUrlBase || "https://twitter.com/#!/search?q=%23";
    options.cashtagClass = options.cashtagClass || DEFAULT_CASHTAG_CLASS;
    options.cashtagUrlBase = options.cashtagUrlBase || "https://twitter.com/#!/search?q=%24";
    options.listClass = options.listClass || DEFAULT_LIST_CLASS;
    options.usernameClass = options.usernameClass || DEFAULT_USERNAME_CLASS;
    options.usernameUrlBase = options.usernameUrlBase || "https://twitter.com/";
    options.listUrlBase = options.listUrlBase || "https://twitter.com/";
    options.htmlAttrs = twttr.txt.extractHtmlAttrsFromOptions(options);
    options.invisibleTagAttrs = options.invisibleTagAttrs || "style='position:absolute;left:-9999px;'";

    // remap url entities to hash
    var urlEntities, i, len;
    if(options.urlEntities) {
      urlEntities = {};
      for(i = 0, len = options.urlEntities.length; i < len; i++) {
        urlEntities[options.urlEntities[i].url] = options.urlEntities[i];
      }
      options.urlEntities = urlEntities;
    }

    var result = "";
    var beginIndex = 0;

    // sort entities by start index
    entities.sort(function(a,b){ return a.indices[0] - b.indices[0]; });

    var nonEntity = options.htmlEscapeNonEntities ? twttr.txt.htmlEscape : function(text) {
      return text;
    };

    for (var i = 0; i < entities.length; i++) {
      var entity = entities[i];
      result += nonEntity(text.substring(beginIndex, entity.indices[0]));

      if (entity.url) {
        result += twttr.txt.linkToUrl(entity, text, options);
      } else if (entity.hashtag) {
        result += twttr.txt.linkToHashtag(entity, text, options);
      } else if (entity.screenName) {
        result += twttr.txt.linkToMentionAndList(entity, text, options);
      } else if (entity.cashtag) {
        result += twttr.txt.linkToCashtag(entity, text, options);
      }
      beginIndex = entity.indices[1];
    }
    result += nonEntity(text.substring(beginIndex, text.length));
    return result;
  };

  twttr.txt.autoLinkWithJSON = function(text, json, options) {
    // map JSON entity to twitter-text entity
    if (json.user_mentions) {
      for (var i = 0; i < json.user_mentions.length; i++) {
        // this is a @mention
        json.user_mentions[i].screenName = json.user_mentions[i].screen_name;
      }
    }

    if (json.hashtags) {
      for (var i = 0; i < json.hashtags.length; i++) {
        // this is a #hashtag
        json.hashtags[i].hashtag = json.hashtags[i].text;
      }
    }

    if (json.symbols) {
      for (var i = 0; i < json.symbols.length; i++) {
        // this is a $CASH tag
        json.symbols[i].cashtag = json.symbols[i].text;
      }
    }

    // concatenate all entities
    var entities = [];
    for (var key in json) {
      entities = entities.concat(json[key]);
    }

    // modify indices to UTF-16
    twttr.txt.modifyIndicesFromUnicodeToUTF16(text, entities);

    return twttr.txt.autoLinkEntities(text, entities, options);
  };

  twttr.txt.extractHtmlAttrsFromOptions = function(options) {
    var htmlAttrs = {};
    for (var k in options) {
      var v = options[k];
      if (OPTIONS_NOT_ATTRIBUTES[k]) continue;
      if (BOOLEAN_ATTRIBUTES[k]) {
        v = v ? k : null;
      }
      if (v == null) continue;
      htmlAttrs[k] = v;
    }
    return htmlAttrs;
  };

  twttr.txt.autoLink = function(text, options) {
    var entities = twttr.txt.extractEntitiesWithIndices(text, {extractUrlsWithoutProtocol: false});
    return twttr.txt.autoLinkEntities(text, entities, options);
  };

  twttr.txt.autoLinkUsernamesOrLists = function(text, options) {
    var entities = twttr.txt.extractMentionsOrListsWithIndices(text);
    return twttr.txt.autoLinkEntities(text, entities, options);
  };

  twttr.txt.autoLinkHashtags = function(text, options) {
    var entities = twttr.txt.extractHashtagsWithIndices(text);
    return twttr.txt.autoLinkEntities(text, entities, options);
  };

  twttr.txt.autoLinkCashtags = function(text, options) {
    var entities = twttr.txt.extractCashtagsWithIndices(text);
    return twttr.txt.autoLinkEntities(text, entities, options);
  };

  twttr.txt.autoLinkUrlsCustom = function(text, options) {
    var entities = twttr.txt.extractUrlsWithIndices(text, {extractUrlsWithoutProtocol: false});
    return twttr.txt.autoLinkEntities(text, entities, options);
  };

  twttr.txt.removeOverlappingEntities = function(entities) {
    entities.sort(function(a,b){ return a.indices[0] - b.indices[0]; });

    var prev = entities[0];
    for (var i = 1; i < entities.length; i++) {
      if (prev.indices[1] > entities[i].indices[0]) {
        entities.splice(i, 1);
        i--;
      } else {
        prev = entities[i];
      }
    }
  };

  twttr.txt.extractEntitiesWithIndices = function(text, options) {
    var entities = twttr.txt.extractUrlsWithIndices(text, options)
                    .concat(twttr.txt.extractMentionsOrListsWithIndices(text))
                    .concat(twttr.txt.extractHashtagsWithIndices(text, {checkUrlOverlap: false}))
                    .concat(twttr.txt.extractCashtagsWithIndices(text));

    if (entities.length == 0) {
      return [];
    }

    twttr.txt.removeOverlappingEntities(entities);
    return entities;
  };

  twttr.txt.extractMentions = function(text) {
    var screenNamesOnly = [],
        screenNamesWithIndices = twttr.txt.extractMentionsWithIndices(text);

    for (var i = 0; i < screenNamesWithIndices.length; i++) {
      var screenName = screenNamesWithIndices[i].screenName;
      screenNamesOnly.push(screenName);
    }

    return screenNamesOnly;
  };

  twttr.txt.extractMentionsWithIndices = function(text) {
    var mentions = [],
        mentionOrList,
        mentionsOrLists = twttr.txt.extractMentionsOrListsWithIndices(text);

    for (var i = 0 ; i < mentionsOrLists.length; i++) {
      mentionOrList = mentionsOrLists[i];
      if (mentionOrList.listSlug == '') {
        mentions.push({
          screenName: mentionOrList.screenName,
          indices: mentionOrList.indices
        });
      }
    }

    return mentions;
  };

  /**
   * Extract list or user mentions.
   * (Presence of listSlug indicates a list)
   */
  twttr.txt.extractMentionsOrListsWithIndices = function(text) {
    if (!text || !text.match(twttr.txt.regexen.atSigns)) {
      return [];
    }

    var possibleNames = [],
        slashListname;

    text.replace(twttr.txt.regexen.validMentionOrList, function(match, before, atSign, screenName, slashListname, offset, chunk) {
      var after = chunk.slice(offset + match.length);
      if (!after.match(twttr.txt.regexen.endMentionMatch)) {
        slashListname = slashListname || '';
        var startPosition = offset + before.length;
        var endPosition = startPosition + screenName.length + slashListname.length + 1;
        possibleNames.push({
          screenName: screenName,
          listSlug: slashListname,
          indices: [startPosition, endPosition]
        });
      }
    });

    return possibleNames;
  };


  twttr.txt.extractReplies = function(text) {
    if (!text) {
      return null;
    }

    var possibleScreenName = text.match(twttr.txt.regexen.validReply);
    if (!possibleScreenName ||
        RegExp.rightContext.match(twttr.txt.regexen.endMentionMatch)) {
      return null;
    }

    return possibleScreenName[1];
  };

  twttr.txt.extractUrls = function(text, options) {
    var urlsOnly = [],
        urlsWithIndices = twttr.txt.extractUrlsWithIndices(text, options);

    for (var i = 0; i < urlsWithIndices.length; i++) {
      urlsOnly.push(urlsWithIndices[i].url);
    }

    return urlsOnly;
  };

  twttr.txt.extractUrlsWithIndices = function(text, options) {
    if (!options) {
      options = {extractUrlsWithoutProtocol: true};
    }
    if (!text || (options.extractUrlsWithoutProtocol ? !text.match(/\./) : !text.match(/:/))) {
      return [];
    }

    var urls = [];

    while (twttr.txt.regexen.extractUrl.exec(text)) {
      var before = RegExp.$2, url = RegExp.$3, protocol = RegExp.$4, domain = RegExp.$5, path = RegExp.$7;
      var endPosition = twttr.txt.regexen.extractUrl.lastIndex,
          startPosition = endPosition - url.length;

      // if protocol is missing and domain contains non-ASCII characters,
      // extract ASCII-only domains.
      if (!protocol) {
        if (!options.extractUrlsWithoutProtocol
            || before.match(twttr.txt.regexen.invalidUrlWithoutProtocolPrecedingChars)) {
          continue;
        }
        var lastUrl = null,
            asciiEndPosition = 0;
        domain.replace(twttr.txt.regexen.validAsciiDomain, function(asciiDomain) {
          var asciiStartPosition = domain.indexOf(asciiDomain, asciiEndPosition);
          asciiEndPosition = asciiStartPosition + asciiDomain.length;
          lastUrl = {
            url: asciiDomain,
            indices: [startPosition + asciiStartPosition, startPosition + asciiEndPosition]
          };
          if (path
              || asciiDomain.match(twttr.txt.regexen.validSpecialShortDomain)
              || !asciiDomain.match(twttr.txt.regexen.invalidShortDomain)) {
            urls.push(lastUrl);
          }
        });

        // no ASCII-only domain found. Skip the entire URL.
        if (lastUrl == null) {
          continue;
        }

        // lastUrl only contains domain. Need to add path and query if they exist.
        if (path) {
          lastUrl.url = url.replace(domain, lastUrl.url);
          lastUrl.indices[1] = endPosition;
        }
      } else {
        // In the case of t.co URLs, don't allow additional path characters.
        if (url.match(twttr.txt.regexen.validTcoUrl)) {
          url = RegExp.lastMatch;
          endPosition = startPosition + url.length;
        }
        urls.push({
          url: url,
          indices: [startPosition, endPosition]
        });
      }
    }

    return urls;
  };

  twttr.txt.extractHashtags = function(text) {
    var hashtagsOnly = [],
        hashtagsWithIndices = twttr.txt.extractHashtagsWithIndices(text);

    for (var i = 0; i < hashtagsWithIndices.length; i++) {
      hashtagsOnly.push(hashtagsWithIndices[i].hashtag);
    }

    return hashtagsOnly;
  };

  twttr.txt.extractHashtagsWithIndices = function(text, options) {
    if (!options) {
      options = {checkUrlOverlap: true};
    }

    if (!text || !text.match(twttr.txt.regexen.hashSigns)) {
      return [];
    }

    var tags = [];

    text.replace(twttr.txt.regexen.validHashtag, function(match, before, hash, hashText, offset, chunk) {
      var after = chunk.slice(offset + match.length);
      if (after.match(twttr.txt.regexen.endHashtagMatch))
        return;
      var startPosition = offset + before.length;
      var endPosition = startPosition + hashText.length + 1;
      tags.push({
        hashtag: hashText,
        indices: [startPosition, endPosition]
      });
    });

    if (options.checkUrlOverlap) {
      // also extract URL entities
      var urls = twttr.txt.extractUrlsWithIndices(text);
      if (urls.length > 0) {
        var entities = tags.concat(urls);
        // remove overlap
        twttr.txt.removeOverlappingEntities(entities);
        // only push back hashtags
        tags = [];
        for (var i = 0; i < entities.length; i++) {
          if (entities[i].hashtag) {
            tags.push(entities[i]);
          }
        }
      }
    }

    return tags;
  };

  twttr.txt.extractCashtags = function(text) {
    var cashtagsOnly = [],
        cashtagsWithIndices = twttr.txt.extractCashtagsWithIndices(text);

    for (var i = 0; i < cashtagsWithIndices.length; i++) {
      cashtagsOnly.push(cashtagsWithIndices[i].cashtag);
    }

    return cashtagsOnly;
  };

  twttr.txt.extractCashtagsWithIndices = function(text) {
    if (!text || text.indexOf("$") == -1) {
      return [];
    }

    var tags = [];

    text.replace(twttr.txt.regexen.validCashtag, function(match, before, dollar, cashtag, offset, chunk) {
      var startPosition = offset + before.length;
      var endPosition = startPosition + cashtag.length + 1;
      tags.push({
        cashtag: cashtag,
        indices: [startPosition, endPosition]
      });
    });

    return tags;
  };

  twttr.txt.modifyIndicesFromUnicodeToUTF16 = function(text, entities) {
    twttr.txt.convertUnicodeIndices(text, entities, false);
  };

  twttr.txt.modifyIndicesFromUTF16ToUnicode = function(text, entities) {
    twttr.txt.convertUnicodeIndices(text, entities, true);
  };

  twttr.txt.getUnicodeTextLength = function(text) {
    return text.replace(twttr.txt.regexen.non_bmp_code_pairs, ' ').length;
  };

  twttr.txt.convertUnicodeIndices = function(text, entities, indicesInUTF16) {
    if (entities.length == 0) {
      return;
    }

    var charIndex = 0;
    var codePointIndex = 0;

    // sort entities by start index
    entities.sort(function(a,b){ return a.indices[0] - b.indices[0]; });
    var entityIndex = 0;
    var entity = entities[0];

    while (charIndex < text.length) {
      if (entity.indices[0] == (indicesInUTF16 ? charIndex : codePointIndex)) {
        var len = entity.indices[1] - entity.indices[0];
        entity.indices[0] = indicesInUTF16 ? codePointIndex : charIndex;
        entity.indices[1] = entity.indices[0] + len;

        entityIndex++;
        if (entityIndex == entities.length) {
          // no more entity
          break;
        }
        entity = entities[entityIndex];
      }

      var c = text.charCodeAt(charIndex);
      if (0xD800 <= c && c <= 0xDBFF && charIndex < text.length - 1) {
        // Found high surrogate char
        c = text.charCodeAt(charIndex + 1);
        if (0xDC00 <= c && c <= 0xDFFF) {
          // Found surrogate pair
          charIndex++;
        }
      }
      codePointIndex++;
      charIndex++;
    }
  };

  // this essentially does text.split(/<|>/)
  // except that won't work in IE, where empty strings are ommitted
  // so "<>".split(/<|>/) => [] in IE, but is ["", "", ""] in all others
  // but "<<".split("<") => ["", "", ""]
  twttr.txt.splitTags = function(text) {
    var firstSplits = text.split("<"),
        secondSplits,
        allSplits = [],
        split;

    for (var i = 0; i < firstSplits.length; i += 1) {
      split = firstSplits[i];
      if (!split) {
        allSplits.push("");
      } else {
        secondSplits = split.split(">");
        for (var j = 0; j < secondSplits.length; j += 1) {
          allSplits.push(secondSplits[j]);
        }
      }
    }

    return allSplits;
  };

  twttr.txt.hitHighlight = function(text, hits, options) {
    var defaultHighlightTag = "em";

    hits = hits || [];
    options = options || {};

    if (hits.length === 0) {
      return text;
    }

    var tagName = options.tag || defaultHighlightTag,
        tags = ["<" + tagName + ">", "</" + tagName + ">"],
        chunks = twttr.txt.splitTags(text),
        i,
        j,
        result = "",
        chunkIndex = 0,
        chunk = chunks[0],
        prevChunksLen = 0,
        chunkCursor = 0,
        startInChunk = false,
        chunkChars = chunk,
        flatHits = [],
        index,
        hit,
        tag,
        placed,
        hitSpot;

    for (i = 0; i < hits.length; i += 1) {
      for (j = 0; j < hits[i].length; j += 1) {
        flatHits.push(hits[i][j]);
      }
    }

    for (index = 0; index < flatHits.length; index += 1) {
      hit = flatHits[index];
      tag = tags[index % 2];
      placed = false;

      while (chunk != null && hit >= prevChunksLen + chunk.length) {
        result += chunkChars.slice(chunkCursor);
        if (startInChunk && hit === prevChunksLen + chunkChars.length) {
          result += tag;
          placed = true;
        }

        if (chunks[chunkIndex + 1]) {
          result += "<" + chunks[chunkIndex + 1] + ">";
        }

        prevChunksLen += chunkChars.length;
        chunkCursor = 0;
        chunkIndex += 2;
        chunk = chunks[chunkIndex];
        chunkChars = chunk;
        startInChunk = false;
      }

      if (!placed && chunk != null) {
        hitSpot = hit - prevChunksLen;
        result += chunkChars.slice(chunkCursor, hitSpot) + tag;
        chunkCursor = hitSpot;
        if (index % 2 === 0) {
          startInChunk = true;
        } else {
          startInChunk = false;
        }
      } else if(!placed) {
        placed = true;
        result += tag;
      }
    }

    if (chunk != null) {
      if (chunkCursor < chunkChars.length) {
        result += chunkChars.slice(chunkCursor);
      }
      for (index = chunkIndex + 1; index < chunks.length; index += 1) {
        result += (index % 2 === 0 ? chunks[index] : "<" + chunks[index] + ">");
      }
    }

    return result;
  };

  var MAX_LENGTH = 140;

  // Characters not allowed in Tweets
  var INVALID_CHARACTERS = [
    // BOM
    fromCode(0xFFFE),
    fromCode(0xFEFF),

    // Special
    fromCode(0xFFFF),

    // Directional Change
    fromCode(0x202A),
    fromCode(0x202B),
    fromCode(0x202C),
    fromCode(0x202D),
    fromCode(0x202E)
  ];

  // Returns the length of Tweet text with consideration to t.co URL replacement
  // and chars outside the basic multilingual plane that use 2 UTF16 code points
  twttr.txt.getTweetLength = function(text, options) {
    if (!options) {
      options = {
          // These come from https://api.twitter.com/1/help/configuration.json
          // described by https://dev.twitter.com/docs/api/1/get/help/configuration
          short_url_length: 23,
          short_url_length_https: 23
      };
    }
    var textLength = twttr.txt.getUnicodeTextLength(text),
        urlsWithIndices = twttr.txt.extractUrlsWithIndices(text);
    twttr.txt.modifyIndicesFromUTF16ToUnicode(text, urlsWithIndices);

    for (var i = 0; i < urlsWithIndices.length; i++) {
    	// Subtract the length of the original URL
      textLength += urlsWithIndices[i].indices[0] - urlsWithIndices[i].indices[1];

      // Add 23 characters for URL starting with https://
      // http:// URLs still use https://t.co so they are 23 characters as well
      if (urlsWithIndices[i].url.toLowerCase().match(twttr.txt.regexen.urlHasHttps)) {
         textLength += options.short_url_length_https;
      } else {
        textLength += options.short_url_length;
      }
    }

    return textLength;
  };

  // Check the text for any reason that it may not be valid as a Tweet. This is meant as a pre-validation
  // before posting to api.twitter.com. There are several server-side reasons for Tweets to fail but this pre-validation
  // will allow quicker feedback.
  //
  // Returns false if this text is valid. Otherwise one of the following strings will be returned:
  //
  //   "too_long": if the text is too long
  //   "empty": if the text is nil or empty
  //   "invalid_characters": if the text contains non-Unicode or any of the disallowed Unicode characters
  twttr.txt.isInvalidTweet = function(text) {
    if (!text) {
      return "empty";
    }

    // Determine max length independent of URL length
    if (twttr.txt.getTweetLength(text) > MAX_LENGTH) {
      return "too_long";
    }

    if (twttr.txt.hasInvalidCharacters(text)) {
      return "invalid_characters";
    }

    return false;
  };

  twttr.txt.hasInvalidCharacters = function(text) {
    for (var i = 0; i < INVALID_CHARACTERS.length; i++) {
      if (text.indexOf(INVALID_CHARACTERS[i]) >= 0) {
        return true;
      }
    }
    return false;
  };

  twttr.txt.isValidTweetText = function(text) {
    return !twttr.txt.isInvalidTweet(text);
  };

  twttr.txt.isValidUsername = function(username) {
    if (!username) {
      return false;
    }

    var extracted = twttr.txt.extractMentions(username);

    // Should extract the username minus the @ sign, hence the .slice(1)
    return extracted.length === 1 && extracted[0] === username.slice(1);
  };

  var VALID_LIST_RE = regexSupplant(/^#{validMentionOrList}$/);

  twttr.txt.isValidList = function(usernameList) {
    var match = usernameList.match(VALID_LIST_RE);

    // Must have matched and had nothing before or after
    return !!(match && match[1] == "" && match[4]);
  };

  twttr.txt.isValidHashtag = function(hashtag) {
    if (!hashtag) {
      return false;
    }

    var extracted = twttr.txt.extractHashtags(hashtag);

    // Should extract the hashtag minus the # sign, hence the .slice(1)
    return extracted.length === 1 && extracted[0] === hashtag.slice(1);
  };

  twttr.txt.isValidUrl = function(url, unicodeDomains, requireProtocol) {
    if (unicodeDomains == null) {
      unicodeDomains = true;
    }

    if (requireProtocol == null) {
      requireProtocol = true;
    }

    if (!url) {
      return false;
    }

    var urlParts = url.match(twttr.txt.regexen.validateUrlUnencoded);

    if (!urlParts || urlParts[0] !== url) {
      return false;
    }

    var scheme = urlParts[1],
        authority = urlParts[2],
        path = urlParts[3],
        query = urlParts[4],
        fragment = urlParts[5];

    if (!(
      (!requireProtocol || (isValidMatch(scheme, twttr.txt.regexen.validateUrlScheme) && scheme.match(/^https?$/i))) &&
      isValidMatch(path, twttr.txt.regexen.validateUrlPath) &&
      isValidMatch(query, twttr.txt.regexen.validateUrlQuery, true) &&
      isValidMatch(fragment, twttr.txt.regexen.validateUrlFragment, true)
    )) {
      return false;
    }

    return (unicodeDomains && isValidMatch(authority, twttr.txt.regexen.validateUrlUnicodeAuthority)) ||
           (!unicodeDomains && isValidMatch(authority, twttr.txt.regexen.validateUrlAuthority));
  };

  function isValidMatch(string, regex, optional) {
    if (!optional) {
      // RegExp["$&"] is the text of the last match
      // blank strings are ok, but are falsy, so we check stringiness instead of truthiness
      return ((typeof string === "string") && string.match(regex) && RegExp["$&"] === string);
    }

    // RegExp["$&"] is the text of the last match
    return (!string || (string.match(regex) && RegExp["$&"] === string));
  }

  if (typeof module != 'undefined' && module.exports) {
    module.exports = twttr.txt;
  }

  if (typeof define == 'function' && define.amd) {
    define([], twttr.txt);
  }

  if (typeof window != 'undefined') {
    if (window.twttr) {
      for (var prop in twttr) {
        window.twttr[prop] = twttr[prop];
      }
    } else {
      window.twttr = twttr;
    }
  }
})();

},{}],213:[function(require,module,exports){
//     Underscore.js 1.8.3
//     http://underscorejs.org
//     (c) 2009-2015 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
//     Underscore may be freely distributed under the MIT license.

(function() {

  // Baseline setup
  // --------------

  // Establish the root object, `window` in the browser, or `exports` on the server.
  var root = this;

  // Save the previous value of the `_` variable.
  var previousUnderscore = root._;

  // Save bytes in the minified (but not gzipped) version:
  var ArrayProto = Array.prototype, ObjProto = Object.prototype, FuncProto = Function.prototype;

  // Create quick reference variables for speed access to core prototypes.
  var
    push             = ArrayProto.push,
    slice            = ArrayProto.slice,
    toString         = ObjProto.toString,
    hasOwnProperty   = ObjProto.hasOwnProperty;

  // All **ECMAScript 5** native function implementations that we hope to use
  // are declared here.
  var
    nativeIsArray      = Array.isArray,
    nativeKeys         = Object.keys,
    nativeBind         = FuncProto.bind,
    nativeCreate       = Object.create;

  // Naked function reference for surrogate-prototype-swapping.
  var Ctor = function(){};

  // Create a safe reference to the Underscore object for use below.
  var _ = function(obj) {
    if (obj instanceof _) return obj;
    if (!(this instanceof _)) return new _(obj);
    this._wrapped = obj;
  };

  // Export the Underscore object for **Node.js**, with
  // backwards-compatibility for the old `require()` API. If we're in
  // the browser, add `_` as a global object.
  if (typeof exports !== 'undefined') {
    if (typeof module !== 'undefined' && module.exports) {
      exports = module.exports = _;
    }
    exports._ = _;
  } else {
    root._ = _;
  }

  // Current version.
  _.VERSION = '1.8.3';

  // Internal function that returns an efficient (for current engines) version
  // of the passed-in callback, to be repeatedly applied in other Underscore
  // functions.
  var optimizeCb = function(func, context, argCount) {
    if (context === void 0) return func;
    switch (argCount == null ? 3 : argCount) {
      case 1: return function(value) {
        return func.call(context, value);
      };
      case 2: return function(value, other) {
        return func.call(context, value, other);
      };
      case 3: return function(value, index, collection) {
        return func.call(context, value, index, collection);
      };
      case 4: return function(accumulator, value, index, collection) {
        return func.call(context, accumulator, value, index, collection);
      };
    }
    return function() {
      return func.apply(context, arguments);
    };
  };

  // A mostly-internal function to generate callbacks that can be applied
  // to each element in a collection, returning the desired result  either
  // identity, an arbitrary callback, a property matcher, or a property accessor.
  var cb = function(value, context, argCount) {
    if (value == null) return _.identity;
    if (_.isFunction(value)) return optimizeCb(value, context, argCount);
    if (_.isObject(value)) return _.matcher(value);
    return _.property(value);
  };
  _.iteratee = function(value, context) {
    return cb(value, context, Infinity);
  };

  // An internal function for creating assigner functions.
  var createAssigner = function(keysFunc, undefinedOnly) {
    return function(obj) {
      var length = arguments.length;
      if (length < 2 || obj == null) return obj;
      for (var index = 1; index < length; index++) {
        var source = arguments[index],
            keys = keysFunc(source),
            l = keys.length;
        for (var i = 0; i < l; i++) {
          var key = keys[i];
          if (!undefinedOnly || obj[key] === void 0) obj[key] = source[key];
        }
      }
      return obj;
    };
  };

  // An internal function for creating a new object that inherits from another.
  var baseCreate = function(prototype) {
    if (!_.isObject(prototype)) return {};
    if (nativeCreate) return nativeCreate(prototype);
    Ctor.prototype = prototype;
    var result = new Ctor;
    Ctor.prototype = null;
    return result;
  };

  var property = function(key) {
    return function(obj) {
      return obj == null ? void 0 : obj[key];
    };
  };

  // Helper for collection methods to determine whether a collection
  // should be iterated as an array or as an object
  // Related: http://people.mozilla.org/~jorendorff/es6-draft.html#sec-tolength
  // Avoids a very nasty iOS 8 JIT bug on ARM-64. #2094
  var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;
  var getLength = property('length');
  var isArrayLike = function(collection) {
    var length = getLength(collection);
    return typeof length == 'number' && length >= 0 && length <= MAX_ARRAY_INDEX;
  };

  // Collection Functions
  // --------------------

  // The cornerstone, an `each` implementation, aka `forEach`.
  // Handles raw objects in addition to array-likes. Treats all
  // sparse array-likes as if they were dense.
  _.each = _.forEach = function(obj, iteratee, context) {
    iteratee = optimizeCb(iteratee, context);
    var i, length;
    if (isArrayLike(obj)) {
      for (i = 0, length = obj.length; i < length; i++) {
        iteratee(obj[i], i, obj);
      }
    } else {
      var keys = _.keys(obj);
      for (i = 0, length = keys.length; i < length; i++) {
        iteratee(obj[keys[i]], keys[i], obj);
      }
    }
    return obj;
  };

  // Return the results of applying the iteratee to each element.
  _.map = _.collect = function(obj, iteratee, context) {
    iteratee = cb(iteratee, context);
    var keys = !isArrayLike(obj) && _.keys(obj),
        length = (keys || obj).length,
        results = Array(length);
    for (var index = 0; index < length; index++) {
      var currentKey = keys ? keys[index] : index;
      results[index] = iteratee(obj[currentKey], currentKey, obj);
    }
    return results;
  };

  // Create a reducing function iterating left or right.
  function createReduce(dir) {
    // Optimized iterator function as using arguments.length
    // in the main function will deoptimize the, see #1991.
    function iterator(obj, iteratee, memo, keys, index, length) {
      for (; index >= 0 && index < length; index += dir) {
        var currentKey = keys ? keys[index] : index;
        memo = iteratee(memo, obj[currentKey], currentKey, obj);
      }
      return memo;
    }

    return function(obj, iteratee, memo, context) {
      iteratee = optimizeCb(iteratee, context, 4);
      var keys = !isArrayLike(obj) && _.keys(obj),
          length = (keys || obj).length,
          index = dir > 0 ? 0 : length - 1;
      // Determine the initial value if none is provided.
      if (arguments.length < 3) {
        memo = obj[keys ? keys[index] : index];
        index += dir;
      }
      return iterator(obj, iteratee, memo, keys, index, length);
    };
  }

  // **Reduce** builds up a single result from a list of values, aka `inject`,
  // or `foldl`.
  _.reduce = _.foldl = _.inject = createReduce(1);

  // The right-associative version of reduce, also known as `foldr`.
  _.reduceRight = _.foldr = createReduce(-1);

  // Return the first value which passes a truth test. Aliased as `detect`.
  _.find = _.detect = function(obj, predicate, context) {
    var key;
    if (isArrayLike(obj)) {
      key = _.findIndex(obj, predicate, context);
    } else {
      key = _.findKey(obj, predicate, context);
    }
    if (key !== void 0 && key !== -1) return obj[key];
  };

  // Return all the elements that pass a truth test.
  // Aliased as `select`.
  _.filter = _.select = function(obj, predicate, context) {
    var results = [];
    predicate = cb(predicate, context);
    _.each(obj, function(value, index, list) {
      if (predicate(value, index, list)) results.push(value);
    });
    return results;
  };

  // Return all the elements for which a truth test fails.
  _.reject = function(obj, predicate, context) {
    return _.filter(obj, _.negate(cb(predicate)), context);
  };

  // Determine whether all of the elements match a truth test.
  // Aliased as `all`.
  _.every = _.all = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var keys = !isArrayLike(obj) && _.keys(obj),
        length = (keys || obj).length;
    for (var index = 0; index < length; index++) {
      var currentKey = keys ? keys[index] : index;
      if (!predicate(obj[currentKey], currentKey, obj)) return false;
    }
    return true;
  };

  // Determine if at least one element in the object matches a truth test.
  // Aliased as `any`.
  _.some = _.any = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var keys = !isArrayLike(obj) && _.keys(obj),
        length = (keys || obj).length;
    for (var index = 0; index < length; index++) {
      var currentKey = keys ? keys[index] : index;
      if (predicate(obj[currentKey], currentKey, obj)) return true;
    }
    return false;
  };

  // Determine if the array or object contains a given item (using `===`).
  // Aliased as `includes` and `include`.
  _.contains = _.includes = _.include = function(obj, item, fromIndex, guard) {
    if (!isArrayLike(obj)) obj = _.values(obj);
    if (typeof fromIndex != 'number' || guard) fromIndex = 0;
    return _.indexOf(obj, item, fromIndex) >= 0;
  };

  // Invoke a method (with arguments) on every item in a collection.
  _.invoke = function(obj, method) {
    var args = slice.call(arguments, 2);
    var isFunc = _.isFunction(method);
    return _.map(obj, function(value) {
      var func = isFunc ? method : value[method];
      return func == null ? func : func.apply(value, args);
    });
  };

  // Convenience version of a common use case of `map`: fetching a property.
  _.pluck = function(obj, key) {
    return _.map(obj, _.property(key));
  };

  // Convenience version of a common use case of `filter`: selecting only objects
  // containing specific `key:value` pairs.
  _.where = function(obj, attrs) {
    return _.filter(obj, _.matcher(attrs));
  };

  // Convenience version of a common use case of `find`: getting the first object
  // containing specific `key:value` pairs.
  _.findWhere = function(obj, attrs) {
    return _.find(obj, _.matcher(attrs));
  };

  // Return the maximum element (or element-based computation).
  _.max = function(obj, iteratee, context) {
    var result = -Infinity, lastComputed = -Infinity,
        value, computed;
    if (iteratee == null && obj != null) {
      obj = isArrayLike(obj) ? obj : _.values(obj);
      for (var i = 0, length = obj.length; i < length; i++) {
        value = obj[i];
        if (value > result) {
          result = value;
        }
      }
    } else {
      iteratee = cb(iteratee, context);
      _.each(obj, function(value, index, list) {
        computed = iteratee(value, index, list);
        if (computed > lastComputed || computed === -Infinity && result === -Infinity) {
          result = value;
          lastComputed = computed;
        }
      });
    }
    return result;
  };

  // Return the minimum element (or element-based computation).
  _.min = function(obj, iteratee, context) {
    var result = Infinity, lastComputed = Infinity,
        value, computed;
    if (iteratee == null && obj != null) {
      obj = isArrayLike(obj) ? obj : _.values(obj);
      for (var i = 0, length = obj.length; i < length; i++) {
        value = obj[i];
        if (value < result) {
          result = value;
        }
      }
    } else {
      iteratee = cb(iteratee, context);
      _.each(obj, function(value, index, list) {
        computed = iteratee(value, index, list);
        if (computed < lastComputed || computed === Infinity && result === Infinity) {
          result = value;
          lastComputed = computed;
        }
      });
    }
    return result;
  };

  // Shuffle a collection, using the modern version of the
  // [Fisher-Yates shuffle](http://en.wikipedia.org/wiki/FisherYates_shuffle).
  _.shuffle = function(obj) {
    var set = isArrayLike(obj) ? obj : _.values(obj);
    var length = set.length;
    var shuffled = Array(length);
    for (var index = 0, rand; index < length; index++) {
      rand = _.random(0, index);
      if (rand !== index) shuffled[index] = shuffled[rand];
      shuffled[rand] = set[index];
    }
    return shuffled;
  };

  // Sample **n** random values from a collection.
  // If **n** is not specified, returns a single random element.
  // The internal `guard` argument allows it to work with `map`.
  _.sample = function(obj, n, guard) {
    if (n == null || guard) {
      if (!isArrayLike(obj)) obj = _.values(obj);
      return obj[_.random(obj.length - 1)];
    }
    return _.shuffle(obj).slice(0, Math.max(0, n));
  };

  // Sort the object's values by a criterion produced by an iteratee.
  _.sortBy = function(obj, iteratee, context) {
    iteratee = cb(iteratee, context);
    return _.pluck(_.map(obj, function(value, index, list) {
      return {
        value: value,
        index: index,
        criteria: iteratee(value, index, list)
      };
    }).sort(function(left, right) {
      var a = left.criteria;
      var b = right.criteria;
      if (a !== b) {
        if (a > b || a === void 0) return 1;
        if (a < b || b === void 0) return -1;
      }
      return left.index - right.index;
    }), 'value');
  };

  // An internal function used for aggregate "group by" operations.
  var group = function(behavior) {
    return function(obj, iteratee, context) {
      var result = {};
      iteratee = cb(iteratee, context);
      _.each(obj, function(value, index) {
        var key = iteratee(value, index, obj);
        behavior(result, value, key);
      });
      return result;
    };
  };

  // Groups the object's values by a criterion. Pass either a string attribute
  // to group by, or a function that returns the criterion.
  _.groupBy = group(function(result, value, key) {
    if (_.has(result, key)) result[key].push(value); else result[key] = [value];
  });

  // Indexes the object's values by a criterion, similar to `groupBy`, but for
  // when you know that your index values will be unique.
  _.indexBy = group(function(result, value, key) {
    result[key] = value;
  });

  // Counts instances of an object that group by a certain criterion. Pass
  // either a string attribute to count by, or a function that returns the
  // criterion.
  _.countBy = group(function(result, value, key) {
    if (_.has(result, key)) result[key]++; else result[key] = 1;
  });

  // Safely create a real, live array from anything iterable.
  _.toArray = function(obj) {
    if (!obj) return [];
    if (_.isArray(obj)) return slice.call(obj);
    if (isArrayLike(obj)) return _.map(obj, _.identity);
    return _.values(obj);
  };

  // Return the number of elements in an object.
  _.size = function(obj) {
    if (obj == null) return 0;
    return isArrayLike(obj) ? obj.length : _.keys(obj).length;
  };

  // Split a collection into two arrays: one whose elements all satisfy the given
  // predicate, and one whose elements all do not satisfy the predicate.
  _.partition = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var pass = [], fail = [];
    _.each(obj, function(value, key, obj) {
      (predicate(value, key, obj) ? pass : fail).push(value);
    });
    return [pass, fail];
  };

  // Array Functions
  // ---------------

  // Get the first element of an array. Passing **n** will return the first N
  // values in the array. Aliased as `head` and `take`. The **guard** check
  // allows it to work with `_.map`.
  _.first = _.head = _.take = function(array, n, guard) {
    if (array == null) return void 0;
    if (n == null || guard) return array[0];
    return _.initial(array, array.length - n);
  };

  // Returns everything but the last entry of the array. Especially useful on
  // the arguments object. Passing **n** will return all the values in
  // the array, excluding the last N.
  _.initial = function(array, n, guard) {
    return slice.call(array, 0, Math.max(0, array.length - (n == null || guard ? 1 : n)));
  };

  // Get the last element of an array. Passing **n** will return the last N
  // values in the array.
  _.last = function(array, n, guard) {
    if (array == null) return void 0;
    if (n == null || guard) return array[array.length - 1];
    return _.rest(array, Math.max(0, array.length - n));
  };

  // Returns everything but the first entry of the array. Aliased as `tail` and `drop`.
  // Especially useful on the arguments object. Passing an **n** will return
  // the rest N values in the array.
  _.rest = _.tail = _.drop = function(array, n, guard) {
    return slice.call(array, n == null || guard ? 1 : n);
  };

  // Trim out all falsy values from an array.
  _.compact = function(array) {
    return _.filter(array, _.identity);
  };

  // Internal implementation of a recursive `flatten` function.
  var flatten = function(input, shallow, strict, startIndex) {
    var output = [], idx = 0;
    for (var i = startIndex || 0, length = getLength(input); i < length; i++) {
      var value = input[i];
      if (isArrayLike(value) && (_.isArray(value) || _.isArguments(value))) {
        //flatten current level of array or arguments object
        if (!shallow) value = flatten(value, shallow, strict);
        var j = 0, len = value.length;
        output.length += len;
        while (j < len) {
          output[idx++] = value[j++];
        }
      } else if (!strict) {
        output[idx++] = value;
      }
    }
    return output;
  };

  // Flatten out an array, either recursively (by default), or just one level.
  _.flatten = function(array, shallow) {
    return flatten(array, shallow, false);
  };

  // Return a version of the array that does not contain the specified value(s).
  _.without = function(array) {
    return _.difference(array, slice.call(arguments, 1));
  };

  // Produce a duplicate-free version of the array. If the array has already
  // been sorted, you have the option of using a faster algorithm.
  // Aliased as `unique`.
  _.uniq = _.unique = function(array, isSorted, iteratee, context) {
    if (!_.isBoolean(isSorted)) {
      context = iteratee;
      iteratee = isSorted;
      isSorted = false;
    }
    if (iteratee != null) iteratee = cb(iteratee, context);
    var result = [];
    var seen = [];
    for (var i = 0, length = getLength(array); i < length; i++) {
      var value = array[i],
          computed = iteratee ? iteratee(value, i, array) : value;
      if (isSorted) {
        if (!i || seen !== computed) result.push(value);
        seen = computed;
      } else if (iteratee) {
        if (!_.contains(seen, computed)) {
          seen.push(computed);
          result.push(value);
        }
      } else if (!_.contains(result, value)) {
        result.push(value);
      }
    }
    return result;
  };

  // Produce an array that contains the union: each distinct element from all of
  // the passed-in arrays.
  _.union = function() {
    return _.uniq(flatten(arguments, true, true));
  };

  // Produce an array that contains every item shared between all the
  // passed-in arrays.
  _.intersection = function(array) {
    var result = [];
    var argsLength = arguments.length;
    for (var i = 0, length = getLength(array); i < length; i++) {
      var item = array[i];
      if (_.contains(result, item)) continue;
      for (var j = 1; j < argsLength; j++) {
        if (!_.contains(arguments[j], item)) break;
      }
      if (j === argsLength) result.push(item);
    }
    return result;
  };

  // Take the difference between one array and a number of other arrays.
  // Only the elements present in just the first array will remain.
  _.difference = function(array) {
    var rest = flatten(arguments, true, true, 1);
    return _.filter(array, function(value){
      return !_.contains(rest, value);
    });
  };

  // Zip together multiple lists into a single array -- elements that share
  // an index go together.
  _.zip = function() {
    return _.unzip(arguments);
  };

  // Complement of _.zip. Unzip accepts an array of arrays and groups
  // each array's elements on shared indices
  _.unzip = function(array) {
    var length = array && _.max(array, getLength).length || 0;
    var result = Array(length);

    for (var index = 0; index < length; index++) {
      result[index] = _.pluck(array, index);
    }
    return result;
  };

  // Converts lists into objects. Pass either a single array of `[key, value]`
  // pairs, or two parallel arrays of the same length -- one of keys, and one of
  // the corresponding values.
  _.object = function(list, values) {
    var result = {};
    for (var i = 0, length = getLength(list); i < length; i++) {
      if (values) {
        result[list[i]] = values[i];
      } else {
        result[list[i][0]] = list[i][1];
      }
    }
    return result;
  };

  // Generator function to create the findIndex and findLastIndex functions
  function createPredicateIndexFinder(dir) {
    return function(array, predicate, context) {
      predicate = cb(predicate, context);
      var length = getLength(array);
      var index = dir > 0 ? 0 : length - 1;
      for (; index >= 0 && index < length; index += dir) {
        if (predicate(array[index], index, array)) return index;
      }
      return -1;
    };
  }

  // Returns the first index on an array-like that passes a predicate test
  _.findIndex = createPredicateIndexFinder(1);
  _.findLastIndex = createPredicateIndexFinder(-1);

  // Use a comparator function to figure out the smallest index at which
  // an object should be inserted so as to maintain order. Uses binary search.
  _.sortedIndex = function(array, obj, iteratee, context) {
    iteratee = cb(iteratee, context, 1);
    var value = iteratee(obj);
    var low = 0, high = getLength(array);
    while (low < high) {
      var mid = Math.floor((low + high) / 2);
      if (iteratee(array[mid]) < value) low = mid + 1; else high = mid;
    }
    return low;
  };

  // Generator function to create the indexOf and lastIndexOf functions
  function createIndexFinder(dir, predicateFind, sortedIndex) {
    return function(array, item, idx) {
      var i = 0, length = getLength(array);
      if (typeof idx == 'number') {
        if (dir > 0) {
            i = idx >= 0 ? idx : Math.max(idx + length, i);
        } else {
            length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;
        }
      } else if (sortedIndex && idx && length) {
        idx = sortedIndex(array, item);
        return array[idx] === item ? idx : -1;
      }
      if (item !== item) {
        idx = predicateFind(slice.call(array, i, length), _.isNaN);
        return idx >= 0 ? idx + i : -1;
      }
      for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {
        if (array[idx] === item) return idx;
      }
      return -1;
    };
  }

  // Return the position of the first occurrence of an item in an array,
  // or -1 if the item is not included in the array.
  // If the array is large and already in sort order, pass `true`
  // for **isSorted** to use binary search.
  _.indexOf = createIndexFinder(1, _.findIndex, _.sortedIndex);
  _.lastIndexOf = createIndexFinder(-1, _.findLastIndex);

  // Generate an integer Array containing an arithmetic progression. A port of
  // the native Python `range()` function. See
  // [the Python documentation](http://docs.python.org/library/functions.html#range).
  _.range = function(start, stop, step) {
    if (stop == null) {
      stop = start || 0;
      start = 0;
    }
    step = step || 1;

    var length = Math.max(Math.ceil((stop - start) / step), 0);
    var range = Array(length);

    for (var idx = 0; idx < length; idx++, start += step) {
      range[idx] = start;
    }

    return range;
  };

  // Function (ahem) Functions
  // ------------------

  // Determines whether to execute a function as a constructor
  // or a normal function with the provided arguments
  var executeBound = function(sourceFunc, boundFunc, context, callingContext, args) {
    if (!(callingContext instanceof boundFunc)) return sourceFunc.apply(context, args);
    var self = baseCreate(sourceFunc.prototype);
    var result = sourceFunc.apply(self, args);
    if (_.isObject(result)) return result;
    return self;
  };

  // Create a function bound to a given object (assigning `this`, and arguments,
  // optionally). Delegates to **ECMAScript 5**'s native `Function.bind` if
  // available.
  _.bind = function(func, context) {
    if (nativeBind && func.bind === nativeBind) return nativeBind.apply(func, slice.call(arguments, 1));
    if (!_.isFunction(func)) throw new TypeError('Bind must be called on a function');
    var args = slice.call(arguments, 2);
    var bound = function() {
      return executeBound(func, bound, context, this, args.concat(slice.call(arguments)));
    };
    return bound;
  };

  // Partially apply a function by creating a version that has had some of its
  // arguments pre-filled, without changing its dynamic `this` context. _ acts
  // as a placeholder, allowing any combination of arguments to be pre-filled.
  _.partial = function(func) {
    var boundArgs = slice.call(arguments, 1);
    var bound = function() {
      var position = 0, length = boundArgs.length;
      var args = Array(length);
      for (var i = 0; i < length; i++) {
        args[i] = boundArgs[i] === _ ? arguments[position++] : boundArgs[i];
      }
      while (position < arguments.length) args.push(arguments[position++]);
      return executeBound(func, bound, this, this, args);
    };
    return bound;
  };

  // Bind a number of an object's methods to that object. Remaining arguments
  // are the method names to be bound. Useful for ensuring that all callbacks
  // defined on an object belong to it.
  _.bindAll = function(obj) {
    var i, length = arguments.length, key;
    if (length <= 1) throw new Error('bindAll must be passed function names');
    for (i = 1; i < length; i++) {
      key = arguments[i];
      obj[key] = _.bind(obj[key], obj);
    }
    return obj;
  };

  // Memoize an expensive function by storing its results.
  _.memoize = function(func, hasher) {
    var memoize = function(key) {
      var cache = memoize.cache;
      var address = '' + (hasher ? hasher.apply(this, arguments) : key);
      if (!_.has(cache, address)) cache[address] = func.apply(this, arguments);
      return cache[address];
    };
    memoize.cache = {};
    return memoize;
  };

  // Delays a function for the given number of milliseconds, and then calls
  // it with the arguments supplied.
  _.delay = function(func, wait) {
    var args = slice.call(arguments, 2);
    return setTimeout(function(){
      return func.apply(null, args);
    }, wait);
  };

  // Defers a function, scheduling it to run after the current call stack has
  // cleared.
  _.defer = _.partial(_.delay, _, 1);

  // Returns a function, that, when invoked, will only be triggered at most once
  // during a given window of time. Normally, the throttled function will run
  // as much as it can, without ever going more than once per `wait` duration;
  // but if you'd like to disable the execution on the leading edge, pass
  // `{leading: false}`. To disable execution on the trailing edge, ditto.
  _.throttle = function(func, wait, options) {
    var context, args, result;
    var timeout = null;
    var previous = 0;
    if (!options) options = {};
    var later = function() {
      previous = options.leading === false ? 0 : _.now();
      timeout = null;
      result = func.apply(context, args);
      if (!timeout) context = args = null;
    };
    return function() {
      var now = _.now();
      if (!previous && options.leading === false) previous = now;
      var remaining = wait - (now - previous);
      context = this;
      args = arguments;
      if (remaining <= 0 || remaining > wait) {
        if (timeout) {
          clearTimeout(timeout);
          timeout = null;
        }
        previous = now;
        result = func.apply(context, args);
        if (!timeout) context = args = null;
      } else if (!timeout && options.trailing !== false) {
        timeout = setTimeout(later, remaining);
      }
      return result;
    };
  };

  // Returns a function, that, as long as it continues to be invoked, will not
  // be triggered. The function will be called after it stops being called for
  // N milliseconds. If `immediate` is passed, trigger the function on the
  // leading edge, instead of the trailing.
  _.debounce = function(func, wait, immediate) {
    var timeout, args, context, timestamp, result;

    var later = function() {
      var last = _.now() - timestamp;

      if (last < wait && last >= 0) {
        timeout = setTimeout(later, wait - last);
      } else {
        timeout = null;
        if (!immediate) {
          result = func.apply(context, args);
          if (!timeout) context = args = null;
        }
      }
    };

    return function() {
      context = this;
      args = arguments;
      timestamp = _.now();
      var callNow = immediate && !timeout;
      if (!timeout) timeout = setTimeout(later, wait);
      if (callNow) {
        result = func.apply(context, args);
        context = args = null;
      }

      return result;
    };
  };

  // Returns the first function passed as an argument to the second,
  // allowing you to adjust arguments, run code before and after, and
  // conditionally execute the original function.
  _.wrap = function(func, wrapper) {
    return _.partial(wrapper, func);
  };

  // Returns a negated version of the passed-in predicate.
  _.negate = function(predicate) {
    return function() {
      return !predicate.apply(this, arguments);
    };
  };

  // Returns a function that is the composition of a list of functions, each
  // consuming the return value of the function that follows.
  _.compose = function() {
    var args = arguments;
    var start = args.length - 1;
    return function() {
      var i = start;
      var result = args[start].apply(this, arguments);
      while (i--) result = args[i].call(this, result);
      return result;
    };
  };

  // Returns a function that will only be executed on and after the Nth call.
  _.after = function(times, func) {
    return function() {
      if (--times < 1) {
        return func.apply(this, arguments);
      }
    };
  };

  // Returns a function that will only be executed up to (but not including) the Nth call.
  _.before = function(times, func) {
    var memo;
    return function() {
      if (--times > 0) {
        memo = func.apply(this, arguments);
      }
      if (times <= 1) func = null;
      return memo;
    };
  };

  // Returns a function that will be executed at most one time, no matter how
  // often you call it. Useful for lazy initialization.
  _.once = _.partial(_.before, 2);

  // Object Functions
  // ----------------

  // Keys in IE < 9 that won't be iterated by `for key in ...` and thus missed.
  var hasEnumBug = !{toString: null}.propertyIsEnumerable('toString');
  var nonEnumerableProps = ['valueOf', 'isPrototypeOf', 'toString',
                      'propertyIsEnumerable', 'hasOwnProperty', 'toLocaleString'];

  function collectNonEnumProps(obj, keys) {
    var nonEnumIdx = nonEnumerableProps.length;
    var constructor = obj.constructor;
    var proto = (_.isFunction(constructor) && constructor.prototype) || ObjProto;

    // Constructor is a special case.
    var prop = 'constructor';
    if (_.has(obj, prop) && !_.contains(keys, prop)) keys.push(prop);

    while (nonEnumIdx--) {
      prop = nonEnumerableProps[nonEnumIdx];
      if (prop in obj && obj[prop] !== proto[prop] && !_.contains(keys, prop)) {
        keys.push(prop);
      }
    }
  }

  // Retrieve the names of an object's own properties.
  // Delegates to **ECMAScript 5**'s native `Object.keys`
  _.keys = function(obj) {
    if (!_.isObject(obj)) return [];
    if (nativeKeys) return nativeKeys(obj);
    var keys = [];
    for (var key in obj) if (_.has(obj, key)) keys.push(key);
    // Ahem, IE < 9.
    if (hasEnumBug) collectNonEnumProps(obj, keys);
    return keys;
  };

  // Retrieve all the property names of an object.
  _.allKeys = function(obj) {
    if (!_.isObject(obj)) return [];
    var keys = [];
    for (var key in obj) keys.push(key);
    // Ahem, IE < 9.
    if (hasEnumBug) collectNonEnumProps(obj, keys);
    return keys;
  };

  // Retrieve the values of an object's properties.
  _.values = function(obj) {
    var keys = _.keys(obj);
    var length = keys.length;
    var values = Array(length);
    for (var i = 0; i < length; i++) {
      values[i] = obj[keys[i]];
    }
    return values;
  };

  // Returns the results of applying the iteratee to each element of the object
  // In contrast to _.map it returns an object
  _.mapObject = function(obj, iteratee, context) {
    iteratee = cb(iteratee, context);
    var keys =  _.keys(obj),
          length = keys.length,
          results = {},
          currentKey;
      for (var index = 0; index < length; index++) {
        currentKey = keys[index];
        results[currentKey] = iteratee(obj[currentKey], currentKey, obj);
      }
      return results;
  };

  // Convert an object into a list of `[key, value]` pairs.
  _.pairs = function(obj) {
    var keys = _.keys(obj);
    var length = keys.length;
    var pairs = Array(length);
    for (var i = 0; i < length; i++) {
      pairs[i] = [keys[i], obj[keys[i]]];
    }
    return pairs;
  };

  // Invert the keys and values of an object. The values must be serializable.
  _.invert = function(obj) {
    var result = {};
    var keys = _.keys(obj);
    for (var i = 0, length = keys.length; i < length; i++) {
      result[obj[keys[i]]] = keys[i];
    }
    return result;
  };

  // Return a sorted list of the function names available on the object.
  // Aliased as `methods`
  _.functions = _.methods = function(obj) {
    var names = [];
    for (var key in obj) {
      if (_.isFunction(obj[key])) names.push(key);
    }
    return names.sort();
  };

  // Extend a given object with all the properties in passed-in object(s).
  _.extend = createAssigner(_.allKeys);

  // Assigns a given object with all the own properties in the passed-in object(s)
  // (https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)
  _.extendOwn = _.assign = createAssigner(_.keys);

  // Returns the first key on an object that passes a predicate test
  _.findKey = function(obj, predicate, context) {
    predicate = cb(predicate, context);
    var keys = _.keys(obj), key;
    for (var i = 0, length = keys.length; i < length; i++) {
      key = keys[i];
      if (predicate(obj[key], key, obj)) return key;
    }
  };

  // Return a copy of the object only containing the whitelisted properties.
  _.pick = function(object, oiteratee, context) {
    var result = {}, obj = object, iteratee, keys;
    if (obj == null) return result;
    if (_.isFunction(oiteratee)) {
      keys = _.allKeys(obj);
      iteratee = optimizeCb(oiteratee, context);
    } else {
      keys = flatten(arguments, false, false, 1);
      iteratee = function(value, key, obj) { return key in obj; };
      obj = Object(obj);
    }
    for (var i = 0, length = keys.length; i < length; i++) {
      var key = keys[i];
      var value = obj[key];
      if (iteratee(value, key, obj)) result[key] = value;
    }
    return result;
  };

   // Return a copy of the object without the blacklisted properties.
  _.omit = function(obj, iteratee, context) {
    if (_.isFunction(iteratee)) {
      iteratee = _.negate(iteratee);
    } else {
      var keys = _.map(flatten(arguments, false, false, 1), String);
      iteratee = function(value, key) {
        return !_.contains(keys, key);
      };
    }
    return _.pick(obj, iteratee, context);
  };

  // Fill in a given object with default properties.
  _.defaults = createAssigner(_.allKeys, true);

  // Creates an object that inherits from the given prototype object.
  // If additional properties are provided then they will be added to the
  // created object.
  _.create = function(prototype, props) {
    var result = baseCreate(prototype);
    if (props) _.extendOwn(result, props);
    return result;
  };

  // Create a (shallow-cloned) duplicate of an object.
  _.clone = function(obj) {
    if (!_.isObject(obj)) return obj;
    return _.isArray(obj) ? obj.slice() : _.extend({}, obj);
  };

  // Invokes interceptor with the obj, and then returns obj.
  // The primary purpose of this method is to "tap into" a method chain, in
  // order to perform operations on intermediate results within the chain.
  _.tap = function(obj, interceptor) {
    interceptor(obj);
    return obj;
  };

  // Returns whether an object has a given set of `key:value` pairs.
  _.isMatch = function(object, attrs) {
    var keys = _.keys(attrs), length = keys.length;
    if (object == null) return !length;
    var obj = Object(object);
    for (var i = 0; i < length; i++) {
      var key = keys[i];
      if (attrs[key] !== obj[key] || !(key in obj)) return false;
    }
    return true;
  };


  // Internal recursive comparison function for `isEqual`.
  var eq = function(a, b, aStack, bStack) {
    // Identical objects are equal. `0 === -0`, but they aren't identical.
    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).
    if (a === b) return a !== 0 || 1 / a === 1 / b;
    // A strict comparison is necessary because `null == undefined`.
    if (a == null || b == null) return a === b;
    // Unwrap any wrapped objects.
    if (a instanceof _) a = a._wrapped;
    if (b instanceof _) b = b._wrapped;
    // Compare `[[Class]]` names.
    var className = toString.call(a);
    if (className !== toString.call(b)) return false;
    switch (className) {
      // Strings, numbers, regular expressions, dates, and booleans are compared by value.
      case '[object RegExp]':
      // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')
      case '[object String]':
        // Primitives and their corresponding object wrappers are equivalent; thus, `"5"` is
        // equivalent to `new String("5")`.
        return '' + a === '' + b;
      case '[object Number]':
        // `NaN`s are equivalent, but non-reflexive.
        // Object(NaN) is equivalent to NaN
        if (+a !== +a) return +b !== +b;
        // An `egal` comparison is performed for other numeric values.
        return +a === 0 ? 1 / +a === 1 / b : +a === +b;
      case '[object Date]':
      case '[object Boolean]':
        // Coerce dates and booleans to numeric primitive values. Dates are compared by their
        // millisecond representations. Note that invalid dates with millisecond representations
        // of `NaN` are not equivalent.
        return +a === +b;
    }

    var areArrays = className === '[object Array]';
    if (!areArrays) {
      if (typeof a != 'object' || typeof b != 'object') return false;

      // Objects with different constructors are not equivalent, but `Object`s or `Array`s
      // from different frames are.
      var aCtor = a.constructor, bCtor = b.constructor;
      if (aCtor !== bCtor && !(_.isFunction(aCtor) && aCtor instanceof aCtor &&
                               _.isFunction(bCtor) && bCtor instanceof bCtor)
                          && ('constructor' in a && 'constructor' in b)) {
        return false;
      }
    }
    // Assume equality for cyclic structures. The algorithm for detecting cyclic
    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.

    // Initializing stack of traversed objects.
    // It's done here since we only need them for objects and arrays comparison.
    aStack = aStack || [];
    bStack = bStack || [];
    var length = aStack.length;
    while (length--) {
      // Linear search. Performance is inversely proportional to the number of
      // unique nested structures.
      if (aStack[length] === a) return bStack[length] === b;
    }

    // Add the first object to the stack of traversed objects.
    aStack.push(a);
    bStack.push(b);

    // Recursively compare objects and arrays.
    if (areArrays) {
      // Compare array lengths to determine if a deep comparison is necessary.
      length = a.length;
      if (length !== b.length) return false;
      // Deep compare the contents, ignoring non-numeric properties.
      while (length--) {
        if (!eq(a[length], b[length], aStack, bStack)) return false;
      }
    } else {
      // Deep compare objects.
      var keys = _.keys(a), key;
      length = keys.length;
      // Ensure that both objects contain the same number of properties before comparing deep equality.
      if (_.keys(b).length !== length) return false;
      while (length--) {
        // Deep compare each member
        key = keys[length];
        if (!(_.has(b, key) && eq(a[key], b[key], aStack, bStack))) return false;
      }
    }
    // Remove the first object from the stack of traversed objects.
    aStack.pop();
    bStack.pop();
    return true;
  };

  // Perform a deep comparison to check if two objects are equal.
  _.isEqual = function(a, b) {
    return eq(a, b);
  };

  // Is a given array, string, or object empty?
  // An "empty" object has no enumerable own-properties.
  _.isEmpty = function(obj) {
    if (obj == null) return true;
    if (isArrayLike(obj) && (_.isArray(obj) || _.isString(obj) || _.isArguments(obj))) return obj.length === 0;
    return _.keys(obj).length === 0;
  };

  // Is a given value a DOM element?
  _.isElement = function(obj) {
    return !!(obj && obj.nodeType === 1);
  };

  // Is a given value an array?
  // Delegates to ECMA5's native Array.isArray
  _.isArray = nativeIsArray || function(obj) {
    return toString.call(obj) === '[object Array]';
  };

  // Is a given variable an object?
  _.isObject = function(obj) {
    var type = typeof obj;
    return type === 'function' || type === 'object' && !!obj;
  };

  // Add some isType methods: isArguments, isFunction, isString, isNumber, isDate, isRegExp, isError.
  _.each(['Arguments', 'Function', 'String', 'Number', 'Date', 'RegExp', 'Error'], function(name) {
    _['is' + name] = function(obj) {
      return toString.call(obj) === '[object ' + name + ']';
    };
  });

  // Define a fallback version of the method in browsers (ahem, IE < 9), where
  // there isn't any inspectable "Arguments" type.
  if (!_.isArguments(arguments)) {
    _.isArguments = function(obj) {
      return _.has(obj, 'callee');
    };
  }

  // Optimize `isFunction` if appropriate. Work around some typeof bugs in old v8,
  // IE 11 (#1621), and in Safari 8 (#1929).
  if (typeof /./ != 'function' && typeof Int8Array != 'object') {
    _.isFunction = function(obj) {
      return typeof obj == 'function' || false;
    };
  }

  // Is a given object a finite number?
  _.isFinite = function(obj) {
    return isFinite(obj) && !isNaN(parseFloat(obj));
  };

  // Is the given value `NaN`? (NaN is the only number which does not equal itself).
  _.isNaN = function(obj) {
    return _.isNumber(obj) && obj !== +obj;
  };

  // Is a given value a boolean?
  _.isBoolean = function(obj) {
    return obj === true || obj === false || toString.call(obj) === '[object Boolean]';
  };

  // Is a given value equal to null?
  _.isNull = function(obj) {
    return obj === null;
  };

  // Is a given variable undefined?
  _.isUndefined = function(obj) {
    return obj === void 0;
  };

  // Shortcut function for checking if an object has a given property directly
  // on itself (in other words, not on a prototype).
  _.has = function(obj, key) {
    return obj != null && hasOwnProperty.call(obj, key);
  };

  // Utility Functions
  // -----------------

  // Run Underscore.js in *noConflict* mode, returning the `_` variable to its
  // previous owner. Returns a reference to the Underscore object.
  _.noConflict = function() {
    root._ = previousUnderscore;
    return this;
  };

  // Keep the identity function around for default iteratees.
  _.identity = function(value) {
    return value;
  };

  // Predicate-generating functions. Often useful outside of Underscore.
  _.constant = function(value) {
    return function() {
      return value;
    };
  };

  _.noop = function(){};

  _.property = property;

  // Generates a function for a given object that returns a given property.
  _.propertyOf = function(obj) {
    return obj == null ? function(){} : function(key) {
      return obj[key];
    };
  };

  // Returns a predicate for checking whether an object has a given set of
  // `key:value` pairs.
  _.matcher = _.matches = function(attrs) {
    attrs = _.extendOwn({}, attrs);
    return function(obj) {
      return _.isMatch(obj, attrs);
    };
  };

  // Run a function **n** times.
  _.times = function(n, iteratee, context) {
    var accum = Array(Math.max(0, n));
    iteratee = optimizeCb(iteratee, context, 1);
    for (var i = 0; i < n; i++) accum[i] = iteratee(i);
    return accum;
  };

  // Return a random integer between min and max (inclusive).
  _.random = function(min, max) {
    if (max == null) {
      max = min;
      min = 0;
    }
    return min + Math.floor(Math.random() * (max - min + 1));
  };

  // A (possibly faster) way to get the current timestamp as an integer.
  _.now = Date.now || function() {
    return new Date().getTime();
  };

   // List of HTML entities for escaping.
  var escapeMap = {
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#x27;',
    '`': '&#x60;'
  };
  var unescapeMap = _.invert(escapeMap);

  // Functions for escaping and unescaping strings to/from HTML interpolation.
  var createEscaper = function(map) {
    var escaper = function(match) {
      return map[match];
    };
    // Regexes for identifying a key that needs to be escaped
    var source = '(?:' + _.keys(map).join('|') + ')';
    var testRegexp = RegExp(source);
    var replaceRegexp = RegExp(source, 'g');
    return function(string) {
      string = string == null ? '' : '' + string;
      return testRegexp.test(string) ? string.replace(replaceRegexp, escaper) : string;
    };
  };
  _.escape = createEscaper(escapeMap);
  _.unescape = createEscaper(unescapeMap);

  // If the value of the named `property` is a function then invoke it with the
  // `object` as context; otherwise, return it.
  _.result = function(object, property, fallback) {
    var value = object == null ? void 0 : object[property];
    if (value === void 0) {
      value = fallback;
    }
    return _.isFunction(value) ? value.call(object) : value;
  };

  // Generate a unique integer id (unique within the entire client session).
  // Useful for temporary DOM ids.
  var idCounter = 0;
  _.uniqueId = function(prefix) {
    var id = ++idCounter + '';
    return prefix ? prefix + id : id;
  };

  // By default, Underscore uses ERB-style template delimiters, change the
  // following template settings to use alternative delimiters.
  _.templateSettings = {
    evaluate    : /<%([\s\S]+?)%>/g,
    interpolate : /<%=([\s\S]+?)%>/g,
    escape      : /<%-([\s\S]+?)%>/g
  };

  // When customizing `templateSettings`, if you don't want to define an
  // interpolation, evaluation or escaping regex, we need one that is
  // guaranteed not to match.
  var noMatch = /(.)^/;

  // Certain characters need to be escaped so that they can be put into a
  // string literal.
  var escapes = {
    "'":      "'",
    '\\':     '\\',
    '\r':     'r',
    '\n':     'n',
    '\u2028': 'u2028',
    '\u2029': 'u2029'
  };

  var escaper = /\\|'|\r|\n|\u2028|\u2029/g;

  var escapeChar = function(match) {
    return '\\' + escapes[match];
  };

  // JavaScript micro-templating, similar to John Resig's implementation.
  // Underscore templating handles arbitrary delimiters, preserves whitespace,
  // and correctly escapes quotes within interpolated code.
  // NB: `oldSettings` only exists for backwards compatibility.
  _.template = function(text, settings, oldSettings) {
    if (!settings && oldSettings) settings = oldSettings;
    settings = _.defaults({}, settings, _.templateSettings);

    // Combine delimiters into one regular expression via alternation.
    var matcher = RegExp([
      (settings.escape || noMatch).source,
      (settings.interpolate || noMatch).source,
      (settings.evaluate || noMatch).source
    ].join('|') + '|$', 'g');

    // Compile the template source, escaping string literals appropriately.
    var index = 0;
    var source = "__p+='";
    text.replace(matcher, function(match, escape, interpolate, evaluate, offset) {
      source += text.slice(index, offset).replace(escaper, escapeChar);
      index = offset + match.length;

      if (escape) {
        source += "'+\n((__t=(" + escape + "))==null?'':_.escape(__t))+\n'";
      } else if (interpolate) {
        source += "'+\n((__t=(" + interpolate + "))==null?'':__t)+\n'";
      } else if (evaluate) {
        source += "';\n" + evaluate + "\n__p+='";
      }

      // Adobe VMs need the match returned to produce the correct offest.
      return match;
    });
    source += "';\n";

    // If a variable is not specified, place data values in local scope.
    if (!settings.variable) source = 'with(obj||{}){\n' + source + '}\n';

    source = "var __t,__p='',__j=Array.prototype.join," +
      "print=function(){__p+=__j.call(arguments,'');};\n" +
      source + 'return __p;\n';

    try {
      var render = new Function(settings.variable || 'obj', '_', source);
    } catch (e) {
      e.source = source;
      throw e;
    }

    var template = function(data) {
      return render.call(this, data, _);
    };

    // Provide the compiled source as a convenience for precompilation.
    var argument = settings.variable || 'obj';
    template.source = 'function(' + argument + '){\n' + source + '}';

    return template;
  };

  // Add a "chain" function. Start chaining a wrapped Underscore object.
  _.chain = function(obj) {
    var instance = _(obj);
    instance._chain = true;
    return instance;
  };

  // OOP
  // ---------------
  // If Underscore is called as a function, it returns a wrapped object that
  // can be used OO-style. This wrapper holds altered versions of all the
  // underscore functions. Wrapped objects may be chained.

  // Helper function to continue chaining intermediate results.
  var result = function(instance, obj) {
    return instance._chain ? _(obj).chain() : obj;
  };

  // Add your own custom functions to the Underscore object.
  _.mixin = function(obj) {
    _.each(_.functions(obj), function(name) {
      var func = _[name] = obj[name];
      _.prototype[name] = function() {
        var args = [this._wrapped];
        push.apply(args, arguments);
        return result(this, func.apply(_, args));
      };
    });
  };

  // Add all of the Underscore functions to the wrapper object.
  _.mixin(_);

  // Add all mutator Array functions to the wrapper.
  _.each(['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'], function(name) {
    var method = ArrayProto[name];
    _.prototype[name] = function() {
      var obj = this._wrapped;
      method.apply(obj, arguments);
      if ((name === 'shift' || name === 'splice') && obj.length === 0) delete obj[0];
      return result(this, obj);
    };
  });

  // Add all accessor Array functions to the wrapper.
  _.each(['concat', 'join', 'slice'], function(name) {
    var method = ArrayProto[name];
    _.prototype[name] = function() {
      return result(this, method.apply(this._wrapped, arguments));
    };
  });

  // Extracts the result from a wrapped and chained object.
  _.prototype.value = function() {
    return this._wrapped;
  };

  // Provide unwrapping proxy for some methods used in engine operations
  // such as arithmetic and JSON stringification.
  _.prototype.valueOf = _.prototype.toJSON = _.prototype.value;

  _.prototype.toString = function() {
    return '' + this._wrapped;
  };

  // AMD registration happens at the end for compatibility with AMD loaders
  // that may not enforce next-turn semantics on modules. Even though general
  // practice for AMD registration is to be anonymous, underscore registers
  // as a named module because, like jQuery, it is a base library that is
  // popular enough to be bundled in a third party lib, but not be part of
  // an AMD load request. Those cases could generate an error when an
  // anonymous define() is called outside of a loader request.
  if (typeof define === 'function' && define.amd) {
    define('underscore', [], function() {
      return _;
    });
  }
}.call(this));

},{}],214:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * similar to _.findIndex(), but returns array size if no element pass the test.
 * @param {Array} array
 * @param {function} test
 * @return {number}
 */
var findIndex = function findIndex(array, test) {
    for (var i = 0; i < array.length; i++) {
        if (test(array[i])) {
            return i;
        }
    }
    return i;
};

/**
 * 
 * $.plot 
 */

var AccessLogViewer = (function () {

    /**
     * 
     * @param {[number]} counts - 
     * @param {Object} opts
     * @param {number} opts.unit                 -  msec
     * @param {number} opts.number               - 
     * @param {jQuery} opts.parent               - 
     * @param {number} opts.barWidth             - $.plot
     * @param {number} opts.minTickSize          - $.plot
     * @param {number} opts.timeformat           - $.plot
     * @param {number} opts.graphAreaMarginRight - $.plot
     */

    function AccessLogViewer(counts, opts) {
        _classCallCheck(this, AccessLogViewer);

        // 
        this.data = this.generateData(counts, opts.unit, opts.number);

        // 
        this.$parent = opts.parent;
        this.$parent.css({
            width: this.$parent.parent().width() - (opts.graphAreaMarginRight || 50),
            height: +this.$parent.attr('data-graph-height')
        }).show();

        // 
        this.graph = this.plot(opts.barWidth, opts.minTickSize, opts.timeformat);

        // tooltip
        this.$tooltip = this.$parent.find('.tooltip');
        if (this.$tooltip.length === 0) {
            this.$tooltip = $('<div class="tooltip"></div>');
            this.$tooltip.appendTo(this.$parent).hide();
        }

        // hovertooltip
        this.$parent.on('plothover', this.onMouseOver.bind(this));
    }

    /** @static */

    /**
     * $.plot
     *
     * @param {[number]} counts   - 
     * @param {number}   unit     -  msec
     * @param {number}   interval - start  end 
     */

    _createClass(AccessLogViewer, [{
        key: 'generateData',
        value: function generateData(counts, unit, number) {
            var end = Math.floor(new Date().getTime() / unit) * unit + unit;
            var start = end - unit * number;
            var offset = new Date().getTimezoneOffset() * 60 * 1000;
            var logInterval = 60 * 15 * 1000; // 15

            var data = [];
            var acc = 0;

            for (var t = start; t <= end; t += logInterval) {
                acc += counts[t] || 0;

                // jQuery flot  UTC 
                //  offset  epoch 
                var epoch = t - offset;
                if (epoch % unit === 0) {
                    data.push([epoch - unit, acc]);
                    acc = 0;
                }
            }

            return data;
        }

        /**
         * $.plot
         * @param {number} barWidth
         * @param {[number, string]} minTickSize
         * @param {string} timeformat
         */
    }, {
        key: 'plot',
        value: function plot(barWidth, minTickSize, timeformat) {
            return $.plot(this.$parent, [{
                label: '',
                data: this.data,
                bars: { show: true, lineWidth: barWidth || 15 },
                legend: { show: false }
            }], {
                xaxis: {
                    mode: 'time',
                    minTickSize: minTickSize,
                    timeformat: timeformat
                },
                yaxis: {
                    min: 0,
                    minTickSize: 1,
                    autoscaleMargin: 0.5,
                    labelWidth: +this.$parent.attr('data-yaxis-width'),
                    tickFormatter: function tickFormatter(number) {
                        return number.toString();
                    }
                },
                grid: {
                    axisMargin: 5,
                    labelMargin: 5,
                    minBorderMargin: 0,
                    borderWidth: 1,
                    borderColor: '#CCCCCC',
                    hoverable: true
                }
            });
        }

        /**
         * hovertooltip
         * @param {Event} e
         * @param {{x: number, y: number}} pos
         */
    }, {
        key: 'onMouseOver',
        value: function onMouseOver(e, pos) {
            var axes = this.graph.getAxes();

            if (pos.x < axes.xaxis.min || pos.x > axes.xaxis.max) {
                return;
            }
            if (pos.y < axes.yaxis.min || pos.y > axes.yaxis.max) {
                return;
            }

            var series = this.graph.getData()[0];

            // 
            var n = findIndex(series.data, function (data) {
                return data[0] > pos.x;
            });

            //  && 
            var p1 = series.data[n - 1],
                p2 = series.data[n];

            if (!p1 && !p2) {
                return;
            }

            var p = !p1 ? p2 : !p2 ? p1 : pos.x - p1[0] < p2[0] - pos.x ? p1 : p2;

            // tooltip
            this.showTooltip(axes.xaxis.p2c(p[0]), axes.yaxis.p2c(p[1]), p[1]);
        }

        /**
         * tooltip
         * @param {number} x
         * @param {number} y
         * @param {string} contents
         */
    }, {
        key: 'showTooltip',
        value: function showTooltip(x, y, contents) {
            this.$tooltip.css({
                position: 'absolute',
                top: y - 25,
                left: x + 13
            }).text(contents).show();
        }
    }]);

    return AccessLogViewer;
})();

AccessLogViewer.showGraph = function (counts, opts) {
    return new AccessLogViewer(counts, opts);
};

module.exports = AccessLogViewer;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],215:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Cookie = require('js-cookie');
var Logger = require('js/Base/Logger');
var globalData = require('js/Base/globalData');
var decodeParam = require('js/Util/decodeParam');

/**
 * 
 * 
 */

var BackupData = (function () {

    /**
     * @param {string} args.id       - formdata-backup-id
     * @param {string} args.data     - form
     * @param {Number} args.modified - epoch
     */

    function BackupData(args) {
        _classCallCheck(this, BackupData);

        this.id = args.id;
        this.data = args.data;
        this.modified = args.modified;
    }

    _createClass(BackupData, [{
        key: 'toJSON',
        value: function toJSON() {
            return {
                id: this.id,
                data: this.data,
                modified: this.modified
            };
        }
    }]);

    return BackupData;
})();

var Backup = (function () {
    function Backup($form) {
        _classCallCheck(this, Backup);

        this.$form = $form;

        this.localStorageKey = 'backup'; // formId

        // backup
        // return
        if (!this.localStorageEnabled()) {
            return;
        }

        $(document).on('clearBackup', this.clearBackup.bind(this));

        this.deletePreviousBackup();
    }

    /**
     * form
     * watch
     * @public
     */

    _createClass(Backup, [{
        key: 'watch',
        value: function watch() {
            var _this = this;

            if (this.timer) {
                return;
            }

            // localStorage
            var defaultInterval = this.localStorageEnabled() ? 3000 : 9000;
            var interval = +this.$form.attr('data-backup-interval') * 1000 || defaultInterval;
            this.timer = setInterval(function () {
                return _this.save();
            }, interval);
        }
    }, {
        key: 'localStorageEnabled',
        value: function localStorageEnabled() {
            // localStorage
            // 
            var enabled = false;
            try {
                enabled = window.localStorage && globalData('page') !== 'user-blog-config-design-detail';
            } catch (ignore) {}
            return enabled;
        }

        /**
         * localStorage
         * @public
         */
    }, {
        key: 'clearBackup',
        value: function clearBackup() {
            localStorage.removeItem(this.localStorageKey);
        }

        /**
         * localStorage
         * cookie
         */
    }, {
        key: 'deletePreviousBackup',
        value: function deletePreviousBackup() {
            if (!Cookie.get('clear_backup')) {
                return;
            }

            localStorage.removeItem(this.localStorageKey);
            Cookie.remove('clear_backup', { path: '/' });
        }

        /**
         * formlocalStorage
         * @return {$.Promise<BackupData>}
         */
    }, {
        key: 'load',
        value: function load() {
            var _this2 = this;

            var backupId = this.$form.attr('data-backup-id');
            this.$form.data('backup', this.serialize());

            var loaded = $.Deferred();

            _.defer(function () {
                var backup;
                try {
                    var values = JSON.parse(localStorage.getItem(_this2.localStorageKey));
                    backup = new BackupData(values);
                } catch (ignore) {}

                // formid
                if (!backup || backup.id !== backupId) {
                    loaded.reject();return;
                }

                // reject
                var backupTime = new Date(+backup.modified * 1000);
                if (new Date() - backupTime > 1000 * 60 * 60) {
                    loaded.reject();return;
                }

                Logger.LOG(['backup.load', backup]);
                loaded.resolve(backup);
            });

            return loaded.promise();
        }

        /**
         * localStorageBackupDatabackup-save
         * @return {undefined}
         */
    }, {
        key: 'save',
        value: function save(force) {
            var id = this.$form.attr('data-backup-id');
            var prev = this.$form.data('backup');
            var now = this.serialize();

            // 
            if (prev === now && !force) {
                return;
            }

            this.$form.trigger('backup-presave');

            this.$form.data('backup', now);

            var backupTime = Math.floor(new Date().getTime() / 1000);

            var backup = new BackupData({
                id: id,
                data: now,
                modified: backupTime
            });
            localStorage.setItem(this.localStorageKey, JSON.stringify(backup));

            Logger.LOG(['backup.save', backup]);
            this.$form.trigger('backup-save');
        }

        /**
         * form
         * @return {string}
         */
    }, {
        key: 'serialize',
        value: function serialize() {
            var values = [];
            var $inputs = this.$form.find('input[type="text"], textarea, input[data-with-backup], input[type="hidden"].backup, input[type="radio"].backup, input[type="checkbox"].backup-button');

            _.each($inputs, function (it) {
                if (!it.name) {
                    return;
                }
                if (it.type === 'radio' && !it.checked) {
                    return;
                }

                // select0
                if (it.type === 'checkbox' && !it.checked) {
                    values.push({ name: it.name, value: 0 });
                    return;
                }
                values.push({ name: it.name, value: it.value });
            });

            _.each(this.$form.find('select'), function (select) {
                var $select = $(select);
                if (select.getAttribute('data-without-backup') !== null) {
                    return;
                }

                var selectItem = $select.find('option:selected');
                if (selectItem.length === 0) {
                    return;
                }

                values.push({ name: select.name, value: $(selectItem[0]).val() });
            });

            return $.param(values);
        }

        /**
         * @param {string} formData - form
         * @public
         */
    }, {
        key: 'restoreBackup',
        value: function restoreBackup(formData) {
            Logger.LOG('restore backup');
            this.formDataBeforeRestore = this.serialize(); // restore
            this.assignData(formData);
        }

        /**
         * restore
         * @param {string} prevFormData - restoreform
         * @public
         */
    }, {
        key: 'clearRestore',
        value: function clearRestore() {
            Logger.LOG('clear restore');
            this.assignData(this.formDataBeforeRestore);
        }

        /**
         * form
         * @param {string} formData - restoreform
         * @private
         */
    }, {
        key: 'assignData',
        value: function assignData(formData) {
            var params = decodeParam(formData);
            // XXX
            // categorybackupCategoryEditor.append
            // CategoryEditorbackup-restore-paramslistenappendSKIP
            for (var name in params) if (params.hasOwnProperty(name) && name !== 'category') {
                this.$form.find('input[name="' + name + '"], textarea[name="' + name + '"]').val(params[name]);
            }

            this.$form.data('backup', formData);
            this.$form.trigger('backup-restore', formData);
            this.$form.trigger('backup-restore-params', [params]);
        }
    }]);

    return Backup;
})();

module.exports = Backup;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js-cookie":209,"js/Base/Logger":293,"js/Base/globalData":302,"js/Util/decodeParam":573,"underscore":213}],216:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var Backup = require('./Backup');

/**
 * 
 * ViewController
 */

var BackupMessage = (function () {

    /**
     * @param {jQuery} $form
     * @param {jQuery} [$editarea]
     * @param {Editor} [editor]
     */

    function BackupMessage($form, $editarea, editor) {
        _classCallCheck(this, BackupMessage);

        this.$form = $form;
        this.$editarea = $editarea;
        this.editor = editor;

        this.model = new Backup($form);
        this.restore();
        this.model.watch();
    }

    /**
     * localStorageform
     * @public
     */

    _createClass(BackupMessage, [{
        key: 'restore',
        value: function restore() {
            var _this = this;

            var backupData;
            return this.model.load().then(function (res) {
                backupData = res;

                //  or 
                if (_this.shouldAutoRestore()) {
                    _this.promptAutoRestored(res);
                    return true;
                } else {
                    return _this.promptRestore(res);
                }
            }).then(function () {
                _this.model.restoreBackup(backupData.data);
            }).always(function () {
                // resize
                // this.model.load()
                if (!_this.editor) {
                    return;
                }
                _this.editor.emit('resizeRequired');
            });
        }

        /**
         * 
         * UIModel
         * @return {Boolean}
         */
    }, {
        key: 'shouldAutoRestore',
        value: function shouldAutoRestore() {}

        /**
         * 
         * @param {BackupData} backupData - 
         * @return {$.Promise<Boolean>}
         */
    }, {
        key: 'promptRestore',
        value: function promptRestore() {}

        /**
         * 
         * 
         * @param {BackupData} backupData - 
         */
    }, {
        key: 'promptAutoRestored',
        value: function promptAutoRestored(backupData) {}
    }]);

    return BackupMessage;
})();

module.exports = BackupMessage;

},{"./Backup":215}],217:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var URLGenerator = require('js/Base/URLGenerator');

var BackupMessage = require('./BackupMessage');

var BackupMessagePC = (function (_BackupMessage) {
    _inherits(BackupMessagePC, _BackupMessage);

    function BackupMessagePC($form, $editarea, editor) {
        _classCallCheck(this, BackupMessagePC);

        _get(Object.getPrototypeOf(BackupMessagePC.prototype), 'constructor', this).call(this, $form, $editarea, editor);
        this.initMessage();
    }

    _createClass(BackupMessagePC, [{
        key: 'initMessage',
        value: function initMessage() {
            var _this = this;

            this.$message = $('<div class="backup-message" style="display: none; margin-buttom: -1px;" />');
            this.$closeButton = $('<div class="backup-message-close">' + '  <img src="' + URLGenerator.static_url('/images/admin/close.gif') + '" />' + '</div>');
            this.$message.append(this.$closeButton).insertBefore(this.$editarea);

            // editarea,
            // , 
            this.height = this.$message.outerHeight() - (parseInt(this.$message.css('border-width'), 10) || 1);

            this.$form.data('backup-message', this.$message);

            // 
            this.$form.on('backup-presave', function () {
                return _this.closeMessage();
            });

            // 
            this.$closeButton.on('click', function () {
                return _this.closeMessage();
            });

            // 
            $('#editor-main .ui-tabs').on('tabsactivate', function (event, ui) {
                if (ui.newPanel.attr('aria-labelledby') === 'ui-id-1') {
                    _this.$message.show();
                } else {
                    _this.$message.hide();
                }
            });
        }
    }, {
        key: 'closeMessage',
        value: function closeMessage() {
            this.$message.remove();
            this.editor.emit('resizeRequired');
        }

        /**
         * 
         * 
         * @return {Boolean}
         */
    }, {
        key: 'shouldAutoRestore',
        value: function shouldAutoRestore() {
            var newEntryBackupIDRegex = new RegExp('user/blog/edit-\\d+-new');
            var isNewEntry = newEntryBackupIDRegex.test(this.$form.attr('data-backup-id'));

            var $title = this.$form.find(':input[name="title"]');
            var titleIsEmpty = $title[0] && $title.val().length === 0;

            var $body = this.$form.find(':input[name="body"]');
            var bodyIsEmpty = $body[0] && $body.val().length === 0;

            return isNewEntry && titleIsEmpty && bodyIsEmpty;
        }

        /**
         * 
         * @param {BackupData} backupData - 
         * @return {$.Promise<Boolean>}
         */
    }, {
        key: 'promptRestore',
        value: function promptRestore(backupData) {
            var _this2 = this;

            var backupTime = new Date(+backupData.modified * 1000);

            var d = $.Deferred();

            var time = Locale.text('backup.notice', '<time data-relative data-epoch="' + backupTime.getTime() + '"></time>');
            var $restore = $('<a href="javascript:void(0)">(' + Locale.text('backup.restore') + ')</a>');
            this.$message.prepend(time, $restore).show();

            Locale.updateTimestamps(this.$message[0]);

            $restore.on('click', function () {
                d.resolve();
                _this2.closeMessage();
            });

            return d.promise();
        }

        /**
         * 
         * 
         * @param {BackupData} backupData - 
         */
    }, {
        key: 'promptAutoRestored',
        value: function promptAutoRestored(backupData) {
            var _this3 = this;

            var backupTime = new Date(+backupData.modified * 1000);

            var time = Locale.text('backup.notice.auto_restored', '<time data-relative data-epoch="' + backupTime.getTime() + '"></time>');
            var $clear = $('<a href="javascript:void(0)">(' + Locale.text('backup.clear_restore') + ')</a>');
            this.$message.prepend(time, $clear).show();

            Locale.updateTimestamps(this.$message[0]);

            $clear.on('click', function () {
                _this3.model.clearRestore();
                _this3.closeMessage();
            });
        }
    }]);

    return BackupMessagePC;
})(BackupMessage);

module.exports = BackupMessagePC;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./BackupMessage":216,"js/Base/URLGenerator":298,"js/Locale":561}],218:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');

var BackupMessage = require('./BackupMessage');

var BackupMessageTouch = (function (_BackupMessage) {
  _inherits(BackupMessageTouch, _BackupMessage);

  function BackupMessageTouch() {
    _classCallCheck(this, BackupMessageTouch);

    _get(Object.getPrototypeOf(BackupMessageTouch.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(BackupMessageTouch, [{
    key: 'shouldAutoRestore',

    /**
     * 
     * touch
     * @return {Boolean}
     */
    value: function shouldAutoRestore() {
      return false;
    }

    /**
     * 
     * @param {BackupData} backupData - 
     * @return {$.Promise<Boolean>}
     */
  }, {
    key: 'promptRestore',
    value: function promptRestore(backupData) {
      var d = $.Deferred();

      var backupTime = new Date(+backupData.modified * 1000);
      if (window.confirm(Locale.text('backup.notice.ask_restore', backupTime))) {
        d.resolve();
      }

      return d.promise();
    }

    /**
     * Touch
     */
  }, {
    key: 'promptAutoRestored',
    value: function promptAutoRestored() {}
  }]);

  return BackupMessageTouch;
})(BackupMessage);

module.exports = BackupMessageTouch;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./BackupMessage":216,"js/Locale":561}],219:[function(require,module,exports){
'use strict';

var Pages = require('js/Base/Pages');

var BackupMessagePC = require('./BackupMessagePC');
var BackupMessageTouch = require('./BackupMessageTouch');

module.exports = {
    createMessage: function createMessage($form, $editarea, editor) {
        if (Pages.device() === 'pc') {
            return new BackupMessagePC($form, $editarea, editor);
        } else {
            return new BackupMessageTouch($form);
        }
    }
};

},{"./BackupMessagePC":217,"./BackupMessageTouch":218,"js/Base/Pages":295}],220:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * 
 */
var BlogPermission = function BlogPermission() {
    this.init.apply(this, arguments);
};

BlogPermission.prototype = {

    /**
     * @constructor
     * @param {jQuery} $element
     */
    init: function init($element) {
        this.$element = $element;

        // authconfig = 
        this.$authconfigs = this.$element.find('.permission-authconfigs');
        this.$newAuthconfig = this.$element.find('#new-authconfig');
        this.$authconfigSelect = this.$element.find('#viewable-id-select');

        // 
        this.$customConfigs = this.$element.find('#permission-custom-viewable-id');
        this.$newCustomConfig = this.$element.find('.authconfig-detail-new');

        this.$checkboxes = this.$element.find('[name = "permission"]');
        this.$customCheckbox = this.$element.find('#permission-custom');
        this.$publicCheckbox = this.$element.find('#permission-public');

        this.$inputOverlay = this.$element.find('.config-private-overlay');

        this.initEvents();
    },

    initEvents: function initEvents() {
        var self = this;

        this.$newAuthconfig.on('click', function () {
            self.$element.find('#create-authconfig').submit();
        });

        // 
        this.$authconfigSelect.on('change', function () {
            var selected = $(this).find('option:selected');
            var detailId = selected.attr('data-ac');
            self.$authconfigs.find('.authconfig-detail').addClass('hide');
            self.$authconfigs.find('.' + detailId).removeClass('hide');
        }).change();

        this.$checkboxes.on('change', function () {
            if (self.$publicCheckbox.prop('checked')) {
                self.$inputOverlay.show();
            } else {
                self.$inputOverlay.hide();
            }

            // /
            // UI
            if (self.customAuthConfigExists()) {
                if (self.$customCheckbox.prop('checked')) {
                    self.$customConfigs.show();
                } else {
                    self.$customConfigs.hide();
                }
            } else {
                self.$customConfigs.show();
                self.$newCustomConfig.show();
            }
        }).change();
    },

    // 
    // disabled
    customAuthConfigExists: function customAuthConfigExists() {
        return !this.$customCheckbox.attr('disabled');
    }

};

module.exports = BlogPermission;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],221:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Rule = require('./Rule');
var RuleEditor = require('./RuleEditor');

// 
// RuleEditor

var NewRuleEditor = (function (_RuleEditor) {
    _inherits(NewRuleEditor, _RuleEditor);

    function NewRuleEditor(rule) {
        _classCallCheck(this, NewRuleEditor);

        _get(Object.getPrototypeOf(NewRuleEditor.prototype), 'constructor', this).call(this, rule);
        this.isEditingNewRule = true;
        this.startEdit();
    }

    // true

    _createClass(NewRuleEditor, [{
        key: 'isEditing',
        value: function isEditing() {
            return true;
        }

        // pageType
    }, {
        key: 'canSetPageType',
        value: function canSetPageType() {
            return true;
        }

        // entrycategory
    }, {
        key: 'canSetCategory',
        value: function canSetCategory() {
            return _.include(['entry', 'category'], this.editingRule.pageType);
        }

        // editingRule
    }, {
        key: 'startEdit',
        value: function startEdit() {
            this.editingRule = new Rule('all', null, []);
        }

        // 
    }, {
        key: 'save',
        value: function save() {
            this.startEdit();
        }

        // 
    }, {
        key: 'revert',
        value: function revert() {
            this.startEdit();
        }

        // false
    }, {
        key: 'canDestroy',
        value: function canDestroy() {
            return false;
        }

        // 
    }, {
        key: 'asDefaultEditor',
        value: function asDefaultEditor() {
            return new Rule(this.editingRule);
        }
    }]);

    return NewRuleEditor;
})(RuleEditor);

module.exports = NewRuleEditor;

},{"./Rule":222,"./RuleEditor":223}],222:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _ = require('underscore');

// 
// pageType, category, items 

var Rule = (function () {
    function Rule(pageType, category, items) {
        _classCallCheck(this, Rule);

        this.pageType = pageType;
        this.category = category;
        this.items = items;
    }

    // itemspading

    _createClass(Rule, [{
        key: 'getItemsWithFilledLength',
        value: function getItemsWithFilledLength(lengthExpect) {
            var items = _.clone(this.items);

            _.times(lengthExpect - items.length, function () {
                return items.push({});
            });

            return items;
        }

        // itemsitemitemitem
    }, {
        key: 'getItemsForEdit',
        value: function getItemsForEdit(lengthExpect) {
            var items = this.getItemsWithFilledLength(lengthExpect);

            var lastItem = items[items.length - 1] || {};
            if (items.length === 0 || lastItem.label || lastItem.uri) {
                items.push({});
            }

            return items;
        }

        // items
    }, {
        key: 'getItemsLength',
        value: function getItemsLength() {
            return this.items.length;
        }

        // itemsitem
    }, {
        key: 'getItemsLengthForEdit',
        value: function getItemsLengthForEdit() {
            var items = this.items;
            var lastItem = items[items.length - 1];
            if (items.length === 0 || lastItem.label || lastItem.uri) {
                return items.length + 1;
            }
            return items.length;
        }

        // 
    }, {
        key: 'equals',
        value: function equals(rule) {
            return this.pageType === rule.pageType && this.category === rule.category && _.isEqual(this.items, rule.items);
        }

        // JSONObject
    }, {
        key: 'toJSON',
        value: function toJSON() {
            return {
                pageType: this.pageType,
                category: this.category,
                items: this.items
            };
        }

        // itemsArray
    }, {
        key: 'clone',
        value: function clone() {
            return new Rule(this.pageType, this.category, _.clone(this.items));
        }

        // pageType
    }, {
        key: 'setPageType',
        value: function setPageType(pageType) {
            this.pageType = pageType;
        }

        // category
    }, {
        key: 'setCategory',
        value: function setCategory(category) {
            this.category = category;
        }

        // indexitemlabel
        // items[index]item
    }, {
        key: 'setItemLabel',
        value: function setItemLabel(index, label) {
            var _this = this;

            _.times(index - this.items.length + 1, function () {
                return _this.items.push({});
            });
            this.items[index].label = label;
            this._trimItems();
        }

        // indexitemuri
        // items[index]item
    }, {
        key: 'setItemURI',
        value: function setItemURI(index, uri) {
            var _this2 = this;

            _.times(index - this.items.length + 1, function () {
                return _this2.items.push({});
            });
            this.items[index].uri = uri;
            this._trimItems();
        }

        // item
    }, {
        key: '_trimItems',
        value: function _trimItems() {
            var items = this.items;
            var lastItem = items[items.length - 1];

            while (lastItem && !lastItem.label && !lastItem.uri) {
                items.pop();
                lastItem = items[items.length - 1];
            }
        }
    }]);

    return Rule;
})();

module.exports = Rule;

},{"underscore":213}],223:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _ = require('underscore');

// 2
// rule: 
// editingRule: 

var RuleEditor = (function () {
    function RuleEditor(rule) {
        _classCallCheck(this, RuleEditor);

        this.rule = rule;
        this.editingRule = null;
        this.id = RuleEditor.generateId();
    }

    // pageType

    _createClass(RuleEditor, [{
        key: 'canSetPageType',
        value: function canSetPageType() {
            return false;
        }

        // category
    }, {
        key: 'canSetCategory',
        value: function canSetCategory() {
            return false;
        }

        // 
    }, {
        key: 'isEditing',
        value: function isEditing() {
            return !!this.editingRule;
        }

        // editingRuleruleclone
    }, {
        key: 'startEdit',
        value: function startEdit() {
            this.editingRule = this.rule.clone();
        }

        // editingRulerule
    }, {
        key: 'save',
        value: function save() {
            this.rule = this.editingRule;
            this.editingRule = null;
        }

        // editingRulenull
    }, {
        key: 'revert',
        value: function revert() {
            this.editingRule = null;
        }

        // 
    }, {
        key: 'canDestroy',
        value: function canDestroy() {
            return true;
        }

        // padding
    }, {
        key: 'getItemsLength',
        value: function getItemsLength() {
            if (this.isEditing()) {
                return this.editingRule.getItemsLengthForEdit();
            } else {
                return this.rule.getItemsLength();
            }
        }
    }]);

    return RuleEditor;
})();

var editorId = 0;

// id
RuleEditor.generateId = function () {
    return "RuleEditor-" + editorId++;
};

module.exports = RuleEditor;

},{"underscore":213}],224:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var EventEmitter = require('events').EventEmitter;
var Location = require('js/Base/Location');
var Rule = require('./Rule');
var globalData = require('js/Base/globalData');

// ActionsrulesLoaded

var RuleEditorActions = (function (_EventEmitter) {
    _inherits(RuleEditorActions, _EventEmitter);

    function RuleEditorActions() {
        _classCallCheck(this, RuleEditorActions);

        _get(Object.getPrototypeOf(RuleEditorActions.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(RuleEditorActions, [{
        key: 'loadRules',

        // rulesLoadedemit
        value: function loadRules() {
            var _this = this;

            $.ajax({
                url: 'rules.json',
                data: {
                    spreadsheet_uri: Location.param('spreadsheet_uri')
                },
                dataType: 'json'
            }).done(function (rules) {
                var rulesObjects = _.map(rules, function (rule) {
                    return new Rule(rule.pageType, rule.category, rule.items);
                });
                _this.emit('rulesLoaded', rulesObjects);
            });
        }

        // /

        // 
    }, {
        key: 'startEdit',
        value: function startEdit(editor) {
            this.emit('startEdit', editor);
        }

        // 
    }, {
        key: 'revert',
        value: function revert(editor) {
            this.emit('revert', editor);
        }

        // 
    }, {
        key: 'create',
        value: function create(editor) {
            var _this2 = this;

            this.postEditingRule('rules/register.json', editor.editingRule).done(function (rules) {
                var rulesObjects = _.map(rules, function (rule) {
                    return new Rule(rule.pageType, rule.category, rule.items);
                });
                _this2.emit('rulesLoaded', rulesObjects);
            }).error(function () {
                alert('error');
            });
        }

        // 
    }, {
        key: 'save',
        value: function save(editor) {
            var _this3 = this;

            this.postEditingRule('rules/register.json', editor.editingRule).done(function (rules) {
                var rulesObjects = _.map(rules, function (rule) {
                    return new Rule(rule.pageType, rule.category, rule.items);
                });
                _this3.emit('rulesLoaded', rulesObjects);
            }).error(function () {
                alert('error');
            });
        }

        // 
    }, {
        key: 'destroy',
        value: function destroy(editor) {
            var _this4 = this;

            this.postEditingRule('rules/delete.json', editor.editingRule).done(function () {
                _this4.emit('destroy', editor);
                _this4.loadRules();
            }).error(function () {
                alert('error');
            });
        }
    }, {
        key: 'postEditingRule',
        value: function postEditingRule(path, editingRule) {
            return $.ajax({
                url: path,
                method: 'POST',
                data: {
                    page_type: editingRule.pageType,
                    category: editingRule.category,
                    items: JSON.stringify(editingRule.items),
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                },
                dataType: 'json',
                cache: false
            });
        }

        // 

    }, {
        key: 'setPageType',
        value: function setPageType(editor, pageType) {
            this.emit('setPageType', editor, pageType);
        }
    }, {
        key: 'setCategory',
        value: function setCategory(editor, category) {
            this.emit('setCategory', editor, category);
        }
    }, {
        key: 'setItemLabel',
        value: function setItemLabel(editor, itemIndex, label) {
            this.emit('setItemLabel', editor, itemIndex, label);
        }
    }, {
        key: 'setItemURI',
        value: function setItemURI(editor, itemIndex, uri) {
            this.emit('setItemURI', editor, itemIndex, uri);
        }
    }]);

    return RuleEditorActions;
})(EventEmitter);

module.exports = new RuleEditorActions();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Rule":222,"events":207,"js/Base/Location":292,"js/Base/globalData":302}],225:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _ = require('underscore');

var EventEmitter = require('events').EventEmitter;

var RuleEditorActions = require('./RuleEditorActions');

var RuleEditor = require('./RuleEditor');
var NewRuleEditor = require('./NewRuleEditor');

// Store
// state
//   rules: JSON
//   maxItemsLength: 

var Store = (function (_EventEmitter) {
    _inherits(Store, _EventEmitter);

    function Store() {
        var _this = this;

        _classCallCheck(this, Store);

        _get(Object.getPrototypeOf(Store.prototype), 'constructor', this).call(this);

        this.ruleEditors = [];
        this.newRuleEditor = new NewRuleEditor();

        // 

        // ruleRuleEditoreditors
        RuleEditorActions.on('rulesLoaded', function (rules) {
            var editors = rules.map(function (rule) {
                return new RuleEditor(rule);
            });
            _this.setEditors(editors);
            _this.emit('change');
        });

        // /

        // startEditeditorstartEdit
        RuleEditorActions.on('startEdit', function (editor) {
            editor.startEdit();
            _this.emit('change');
        });

        // revertrevert
        RuleEditorActions.on('revert', function (editor) {
            editor.revert();
            _this.emit('change');
        });

        // createeditors
        RuleEditorActions.on('create', function (editor) {
            var newEditor = new RuleEditor(editor.editingRule);
            var editors = _this.ruleEditors.concat(newEditor);
            _this.setEditors(editors);

            editor.save();

            _this.emit('change');
        });

        // savechangeemit
        RuleEditorActions.on('save', function (editor) {
            editor.save();

            _this.emit('change');
        });

        // destroy
        RuleEditorActions.on('destroy', function (editor) {
            var editors = _.reject(_this.ruleEditors, function (_editor) {
                return editor === _editor;
            });
            _this.setEditors(editors);
            _this.emit('change');
        });

        // 

        RuleEditorActions.on('setPageType', function (editor, pageType) {
            editor.editingRule.setPageType(pageType);
            _this.emit('change');
        });

        RuleEditorActions.on('setCategory', function (editor, category) {
            editor.editingRule.setCategory(category);
            _this.emit('change');
        });

        RuleEditorActions.on('setItemLabel', function (editor, itemIndex, label) {
            editor.editingRule.setItemLabel(itemIndex, label);
            _this.emit('change');
        });

        RuleEditorActions.on('setItemURI', function (editor, itemIndex, uri) {
            editor.editingRule.setItemURI(itemIndex, uri);
            _this.emit('change');
        });
    }

    _createClass(Store, [{
        key: 'initialize',
        value: function initialize() {
            RuleEditorActions.loadRules();
        }

        /**
         * rules
         * @param {Array[{page_id, category, rules}} rules
         */
    }, {
        key: 'setEditors',
        value: function setEditors(editors) {
            this.ruleEditors = editors;
        }
    }, {
        key: 'getState',
        value: function getState() {
            return {
                ruleEditors: this.ruleEditors,
                newRuleEditor: this.newRuleEditor,
                itemsLength: this.getItemsLength()
            };
        }
    }, {
        key: 'getItemsLength',
        value: function getItemsLength() {
            var lengthes = this.ruleEditors.map(function (editor) {
                return editor.getItemsLength();
            });
            lengthes.push(this.newRuleEditor.getItemsLength());
            return Math.max.apply(Math, _toConsumableArray(lengthes));
        }
    }]);

    return Store;
})(EventEmitter);

module.exports = new Store();

},{"./NewRuleEditor":221,"./RuleEditor":223,"./RuleEditorActions":224,"events":207,"underscore":213}],226:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var RuleEditorActions = require('../RuleEditorActions');

// item(labeluri)UI

var ItemEditor = (function (_React$Component) {
    _inherits(ItemEditor, _React$Component);

    function ItemEditor() {
        _classCallCheck(this, ItemEditor);

        _get(Object.getPrototypeOf(ItemEditor.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(ItemEditor, [{
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'td',
                { className: 'item-editor' },
                React.createElement(
                    'div',
                    { className: 'label-container' },
                    React.createElement('input', {
                        type: 'text',
                        placeholder: 'Label',
                        ref: 'label',
                        value: this.props.label,
                        onChange: function (e) {
                            return _this.onLabelChanged(e);
                        } })
                ),
                React.createElement(
                    'div',
                    { className: 'uri-container' },
                    React.createElement('input', {
                        type: 'text',
                        placeholder: 'URI',
                        ref: 'uri',
                        value: this.props.uri,
                        onChange: function (e) {
                            return _this.onURIChanged(e);
                        } })
                )
            );
        }
    }, {
        key: 'onLabelChanged',
        value: function onLabelChanged(e) {
            RuleEditorActions.setItemLabel(this.props.editor, this.props.itemIndex, e.target.value);
        }
    }, {
        key: 'onURIChanged',
        value: function onURIChanged(e) {
            RuleEditorActions.setItemURI(this.props.editor, this.props.itemIndex, e.target.value);
        }
    }]);

    return ItemEditor;
})(React.Component);

ItemEditor.defaultProps = {
    label: '',
    uri: ''
};

ItemEditor.propTypes = {
    label: React.PropTypes.string,
    uri: React.PropTypes.string,
    editor: React.PropTypes.object,
    itemIndex: React.PropTypes.number
};

module.exports = ItemEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../RuleEditorActions":224}],227:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ItemEditor = require('./ItemEditor');

var RuleEditorActions = require('../RuleEditorActions');

// 
// pageType, category
// itemsItemEditor

var RuleEditorRow = (function (_React$Component) {
    _inherits(RuleEditorRow, _React$Component);

    function RuleEditorRow() {
        _classCallCheck(this, RuleEditorRow);

        _get(Object.getPrototypeOf(RuleEditorRow.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(RuleEditorRow, [{
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'tr',
                { className: 'rule-editor-row' },
                this.renderPageType(),
                this.renderCategory(),
                this.renderRules(),
                React.createElement(
                    'td',
                    null,
                    React.createElement('input', {
                        type: 'submit',
                        value: 'Save',
                        onClick: function (e) {
                            return _this.onSaveClicked(e);
                        },
                        className: 'save' }),
                    this.renderDeleteButton(),
                    React.createElement('input', {
                        type: 'submit', onClick: function (e) {
                            return _this.onRevertClicked(e);
                        },
                        value: 'Cancel',
                        className: 'cancel' })
                )
            );
        }
    }, {
        key: 'renderDeleteButton',
        value: function renderDeleteButton() {
            var _this2 = this;

            if (!this.props.editor.canDestroy()) {
                return null;
            }

            return React.createElement('input', {
                type: 'submit',
                onClick: function (e) {
                    return _this2.onDeleteClicked(e);
                },
                value: 'Delete',
                className: 'delete' });
        }
    }, {
        key: 'renderPageType',
        value: function renderPageType() {
            var _this3 = this;

            var editor = this.props.editor;
            var rule = editor.editingRule;

            if (editor.canSetPageType()) {
                return React.createElement(
                    'th',
                    { className: 'page-type editing' },
                    React.createElement(
                        'select',
                        {
                            ref: 'pageType',
                            value: rule.pageType,
                            onChange: function (e) {
                                return _this3.onPageTypeChanged(e);
                            } },
                        React.createElement(
                            'option',
                            { value: 'all' },
                            'All'
                        ),
                        React.createElement(
                            'option',
                            { value: 'top' },
                            'Top'
                        ),
                        React.createElement(
                            'option',
                            { value: 'archive' },
                            'Archive'
                        ),
                        React.createElement(
                            'option',
                            { value: 'entry' },
                            'Entry'
                        ),
                        React.createElement(
                            'option',
                            { value: 'category' },
                            'Category'
                        )
                    )
                );
            } else {
                return React.createElement(
                    'th',
                    { className: 'page-type' },
                    rule.pageType
                );
            }
        }
    }, {
        key: 'renderCategory',
        value: function renderCategory() {
            var _this4 = this;

            var editor = this.props.editor;
            var rule = this.props.editor.editingRule;

            if (editor.canSetCategory()) {
                return React.createElement(
                    'th',
                    { className: 'category editing' },
                    React.createElement('input', {
                        type: 'text',
                        placeholder: 'Category',
                        ref: 'category',
                        value: rule.category, onChange: function (e) {
                            return _this4.onCategoryChanged(e);
                        } })
                );
            } else {
                return React.createElement(
                    'th',
                    { className: 'category' },
                    rule.category
                );
            }
        }
    }, {
        key: 'renderRules',
        value: function renderRules() {
            var _this5 = this;

            var items = this.props.editor.editingRule.getItemsForEdit(this.props.itemsLength);

            return items.map(function (item, index) {
                return React.createElement(ItemEditor, {
                    key: index,
                    label: item.label,
                    uri: item.uri,
                    editor: _this5.props.editor,
                    itemIndex: index });
            });
        }
    }, {
        key: 'onPageTypeChanged',
        value: function onPageTypeChanged(e) {
            RuleEditorActions.setPageType(this.props.editor, e.target.value);
        }
    }, {
        key: 'onCategoryChanged',
        value: function onCategoryChanged(e) {
            RuleEditorActions.setCategory(this.props.editor, e.target.value);
        }
    }, {
        key: 'onSaveClicked',
        value: function onSaveClicked(e) {
            e.preventDefault();

            if (this.props.editor.isEditingNewRule) {
                RuleEditorActions.create(this.props.editor);
            } else {
                RuleEditorActions.save(this.props.editor);
            }
        }
    }, {
        key: 'onDeleteClicked',
        value: function onDeleteClicked(e) {
            e.preventDefault();

            if (window.confirm('Are you sure to delete this rule?')) {
                RuleEditorActions.destroy(this.props.editor);
            }
        }
    }, {
        key: 'onRevertClicked',
        value: function onRevertClicked(e) {
            e.preventDefault();

            RuleEditorActions.revert(this.props.editor);
        }
    }]);

    return RuleEditorRow;
})(React.Component);

RuleEditorRow.propTypes = {
    editor: React.PropTypes.object,
    itemsLength: React.PropTypes.number
};

module.exports = RuleEditorRow;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../RuleEditorActions":224,"./ItemEditor":226}],228:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var RuleEditorActions = require('../RuleEditorActions');
var Store = require('../Store');
var RuleEditorRow = require('./RuleEditorRow');
var URLGenerator = require('js/Base/URLGenerator');

// ()
// RuleEditorRowrender

var RuleRow = (function (_React$Component) {
    _inherits(RuleRow, _React$Component);

    function RuleRow() {
        _classCallCheck(this, RuleRow);

        _get(Object.getPrototypeOf(RuleRow.prototype), 'constructor', this).call(this);
    }

    _createClass(RuleRow, [{
        key: 'startEdit',
        value: function startEdit() {
            RuleEditorActions.startEdit(this.props.editor);
        }
    }, {
        key: 'render',
        value: function render() {
            if (this.props.editor.isEditing()) {
                return this.renderEditing();
            } else {
                return this.renderNotEditing();
            }
        }
    }, {
        key: 'renderEditing',
        value: function renderEditing() {
            return React.createElement(RuleEditorRow, {
                editor: this.props.editor,
                itemsLength: this.props.itemsLength });
        }
    }, {
        key: 'renderNotEditing',
        value: function renderNotEditing() {
            var _this = this;

            var rule = this.props.editor.rule;
            return React.createElement(
                'tr',
                { className: 'rule-row' },
                React.createElement(
                    'th',
                    { className: 'page-type' },
                    rule.pageType
                ),
                React.createElement(
                    'td',
                    { className: 'category' },
                    rule.category
                ),
                this.renderItems(),
                React.createElement(
                    'td',
                    null,
                    React.createElement(
                        'button',
                        {
                            type: 'button',
                            onClick: function () {
                                return _this.startEdit();
                            },
                            className: 'edit' },
                        'Edit'
                    )
                )
            );
        }
    }, {
        key: 'renderItems',
        value: function renderItems() {
            var _this2 = this;

            var rule = this.props.editor.rule;
            var items = rule.getItemsWithFilledLength(Store.getItemsLength());

            return items.map(function (item, index) {
                if (item.label) {
                    return React.createElement(
                        'td',
                        { key: index, className: 'item' },
                        React.createElement(
                            'div',
                            { className: 'label' },
                            _this2.formatLabel(item.label)
                        ),
                        React.createElement(
                            'div',
                            { className: 'uri' },
                            _this2.renderLink(item.uri)
                        )
                    );
                } else {
                    return React.createElement('td', { className: 'empty-item', key: index });
                }
            });
        }
    }, {
        key: 'formatLabel',
        value: function formatLabel(label) {
            if (!label) {
                return label;
            }

            if (label.match(/^:/)) {
                return React.createElement(
                    'i',
                    null,
                    label
                );
            }

            return React.createElement(
                'b',
                null,
                label
            );
        }
    }, {
        key: 'renderLink',
        value: function renderLink(uri) {
            if (!uri) {
                return uri;
            }

            if (uri.match(/^:/)) {
                return React.createElement(
                    'i',
                    null,
                    uri
                );
            }

            var label = uri;
            var href = uri;
            if (href[0] === '/') {
                href = URLGenerator.user_blog_url(href);
            }
            return React.createElement(
                'a',
                { href: href, target: '_blank' },
                label
            );
        }
    }]);

    return RuleRow;
})(React.Component);

RuleRow.propTypes = {
    editor: React.PropTypes.object,
    itemsLength: React.PropTypes.number
};

module.exports = RuleRow;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../RuleEditorActions":224,"../Store":225,"./RuleEditorRow":227,"js/Base/URLGenerator":298}],229:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _ = require('underscore');

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var RuleRow = require('./RuleRow');
var RuleEditorRow = require('./RuleEditorRow');

var Store = require('../Store');

// 

var RulesTable = (function (_React$Component) {
    _inherits(RulesTable, _React$Component);

    function RulesTable() {
        _classCallCheck(this, RulesTable);

        _get(Object.getPrototypeOf(RulesTable.prototype), 'constructor', this).call(this);
        this.state = Store.getState();

        this.updateState = this._updateState.bind(this);
    }

    _createClass(RulesTable, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            Store.on('change', this.updateState);
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            Store.removeListener('change', this.updateState);
        }
    }, {
        key: '_updateState',
        value: function _updateState() {
            var newState = Store.getState();
            this.setState(newState);
        }
    }, {
        key: 'render',
        value: function render() {
            return React.createElement(
                'div',
                null,
                React.createElement(
                    'table',
                    { className: 'rules-table' },
                    React.createElement(
                        'thead',
                        null,
                        this.renderHeader()
                    ),
                    React.createElement(
                        'tbody',
                        null,
                        this.renderRules(),
                        React.createElement(RuleEditorRow, {
                            editor: this.state.newRuleEditor,
                            itemsLength: this.state.itemsLength,
                            key: this.state.newRuleEditor.id })
                    )
                )
            );
        }
    }, {
        key: 'renderHeader',
        value: function renderHeader() {
            return React.createElement(
                'tr',
                { className: 'header' },
                React.createElement(
                    'th',
                    { className: 'page-type' },
                    'pageType'
                ),
                React.createElement(
                    'th',
                    { className: 'category' },
                    'category'
                ),
                _.times(this.state.itemsLength, function (i) {
                    return React.createElement(
                        'th',
                        { key: i },
                        'item',
                        i + 1
                    );
                }),
                React.createElement('th', { className: 'buttons' })
            );
        }
    }, {
        key: 'renderRules',
        value: function renderRules() {
            var _this = this;

            return this.state.ruleEditors.map(function (editor) {
                return React.createElement(RuleRow, {
                    editor: editor,
                    itemsLength: _this.state.itemsLength,
                    key: editor.id });
            });
        }
    }]);

    return RulesTable;
})(React.Component);

module.exports = RulesTable;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Store":225,"./RuleEditorRow":227,"./RuleRow":228,"underscore":213}],230:[function(require,module,exports){
(function (global){
'use strict';

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactDOM = (typeof window !== "undefined" ? window['ReactDOM'] : typeof global !== "undefined" ? global['ReactDOM'] : null);
var RulesTable = require('./components/RulesTable');
var Store = require('./Store');

/**
 * 
 */
var BreadcrumbEditor = {
    init: function init(containerElement) {
        Store.initialize();

        ReactDOM.render(React.createElement(RulesTable, null), containerElement);
    }
};

module.exports = BreadcrumbEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Store":225,"./components/RulesTable":229}],231:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');

var Comments = {

    init: function init() {
        $('button[name="mode"][value="delete"]').on('click', function () {
            return confirm(Locale.text('admin.comments.delete.confirm'));
        });

        var $buttons = $(':submit');
        var $deleteButtons = $('.js-delete-entries-button');

        // disabledbtn-danger
        var render = function render() {
            var checked = $('input[name="comment"]:checked').get(0);
            $buttons.prop('disabled', !checked);
            $buttons.toggleClass('disabled', !checked);

            $deleteButtons.toggleClass('btn-danger', checked);
        };

        $('input[name="comment"]').on('change', render);

        render();
    }
};

module.exports = Comments;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],232:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var globalData = require('js/Base/globalData');

/**
 * @constant
 */
var CONTAINER_CLASS = {
    user: 'module-category-sortable-container'
};
var ITEM_CLASS = {
    user: 'module-category-sortable-item'
};

/**
 * , sortable
 */

var CategoryEditor = (function () {
    function CategoryEditor() {
        _classCallCheck(this, CategoryEditor);

        this.categoryTemplate = _.template($('.js-categories-template').html());
        this.$categoryContainer = $('.js-categories-container');
    }

    _createClass(CategoryEditor, [{
        key: 'updateCategoryPreview',
        value: function updateCategoryPreview() {
            var _this = this;

            var orderType = $('.js-categories-order-type option:selected').val();

            // 
            $.ajax({
                url: this.$categoryContainer.data('getUrl'),
                data: {
                    order_type: orderType
                }
            }).done(function (data) {
                // data.categories
                // { count : , name :  }
                // 
                _this.$categoryContainer.html(_this.categoryTemplate({
                    categories: data.categories,
                    sortableContainerClass: CONTAINER_CLASS[orderType] || '',
                    sortableItemClass: ITEM_CLASS[orderType] || ''
                }));

                if (orderType === 'user') {
                    _this.setupSortable();
                }
            });
        }
    }, {
        key: 'setupSortable',
        value: function setupSortable() {
            var _this2 = this;

            var $sortableContainer = this.$categoryContainer.find('.js-categories-sortable');

            $sortableContainer.sortable({
                stop: function stop() {
                    var $sortedItems = _this2.$categoryContainer.find('.js-categories-sortable-item');

                    var sortedCategoryNames = $sortedItems.map(function (idx, element) {
                        return $(element).data('categoryName');
                    }).get();

                    $.ajax({
                        type: 'POST',
                        url: $sortableContainer.data('sortUrl'),
                        data: {
                            category_names: sortedCategoryNames,
                            rkm: globalData('rkm'),
                            rkc: globalData('rkc')
                        },
                        traditional: true
                    });
                }
            });
        }
    }]);

    return CategoryEditor;
})();

module.exports = CategoryEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"underscore":213}],233:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');
var Locale = require('js/Locale');

/**
 * fotolife
 */
var FotoUploader = {

    /**
     * 
     *  { syntax, url, thumbnail_url } notify
     * @param {jQuery} args.$input - <input type=file /> 
     * @param {number} args.size   - 
     * @returns {$.Deferred}
     */
    init: function init(args) {
        var $input = args.$input;
        var size = args.size;

        var uploaded = $.Deferred();
        var isSupportedFile = typeof FormData !== 'undefined';

        var callback = function callback(fid) {
            var match = fid.match(/f:id:([^:]+):(\d+)([jpg]):image/);
            if (!match) {
                return;
            }

            var name = match[1];
            var id = match[2];
            var type = match[3];

            var extension = {
                j: '.jpg',
                p: '.png',
                g: '.gif'
            };

            var path = [name.substring(0, 1), name, id.substring(0, 8), id].join('/');
            var url = 'http://cdn-ak.f.st-hatena.com/images/fotolife/' + path + extension[type];
            var thumbnail_url = 'http://cdn-ak.f.st-hatena.com/images/fotolife/' + path + '_120.jpg';

            uploaded.notify({
                fid: fid,
                url: url,
                thumbnail_url: thumbnail_url
            });
        };

        if (isSupportedFile) {
            $input.on('change', function () {
                var input = this;
                if (!this.files.length) {
                    return;
                }
                FotoUploader.uploadImage({
                    file: $input[0],
                    $input: $input,
                    folder: 'Hatena Blog',
                    fotosize: size,
                    callback: callback
                });
                return false;
            });
        } else {
            FotoUploader.setIframeUploader({
                $fileInput: $input,
                fotosize: size,
                callback: callback
            });
        }

        return uploaded.promise();
    },

    // 
    uploadImage: function uploadImage(args) {
        var file = args.file;
        var folder = args.folder;
        var fotosize = args.fotosize;
        var $input = args.$input;
        var callback = args.callback;

        $input.prop('disabled', true);

        var data = new FormData();
        data.append('rkm', globalData('rkm'));
        data.append('append', 1);
        data.append('fototitle', '');
        data.append('folder', folder);
        data.append('fotosize', fotosize);
        data.append('image', file.files[0]);
        data.append('delete-gps', 1);

        var $grandparent = $(file).parent().parent();
        var $progress = $grandparent.find('.progress');
        $progress.show();

        var $bar = $progress.find('div.bar');
        $bar.width('0%');

        var $percent = $progress.find('div.percent');

        var updateProgress = function updateProgress(progress) {
            if (progress > 100) {
                progress = 100;
            }
            $bar.width(progress + '%');
            $percent.text(Locale.text('uploading'));
        };

        var xhr = new XMLHttpRequest();

        xhr.upload.addEventListener('progress', function (e) {
            var percent = e.lengthComputable ? e.loaded / e.total * 100 : NaN;
            updateProgress(percent);
        }, false);

        xhr.addEventListener('load', function (e) {
            $input.prop('disabled', false);
            $input.val('');
            updateProgress(100);
            callback(xhr.responseText);
            $progress.hide();
            _.defer(function () {
                updateProgress(0);
            });
        }, false);

        xhr.addEventListener("error", function (e) {
            $progress.addClass('error');
            $input.val('');
            $percent.text('error');
            $input.prop('disabled', false);
        }, false);

        xhr.open('POST', '/f/' + globalData('name') + '/upbysmart');
        xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
        xhr.send(data);
    },

    // IEiframe
    setIframeUploader: function setIframeUploader(args) {
        var $fileInput = args.$fileInput;
        var fotosize = args.fotosize;
        var callback = args.callback;

        var $iframe = $('<iframe/>');
        $fileInput.replaceWith($iframe);

        var src = "/api/upload/fotolife_smart";
        $iframe.attr('src', src);
        $iframe.addClass('uploader');

        $iframe.load(function () {
            var document;
            if ($iframe[0].contentDocument) {
                document = $iframe[0].contentDocument;
            } else if ($iframe[0].contentWindow) {
                document = $iframe[0].contentWindow.document;
            } else {
                return;
            }

            if (document.body.innerHTML.match(/^\s*(f:id:\S+)/)) {
                $iframe[0].contentWindow.location.replace(src);
            }

            callback(document.body.innerHTML);

            $(document).find('input[name="fotosize"]').val(fotosize);
            var images = $(document).find('input[type="file"]');
            $(images[0]).change(function () {
                $(document).find('#fotolife-upload-form').submit();
                $(images[0]).replaceWith($('<h5>').text(Locale.text('uploading')));
            });
        });
    }

};

module.exports = FotoUploader;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/Locale":561}],234:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

// inputupdated
// display_areaPCtouch
// imageSize: {width, height}
var HeaderImage = function HeaderImage($container, imageSize) {
    var self = this;
    self.imageSize = imageSize;
    self.$container = $container;
    self.$image_src = $container.find('.js-image-src');
    self.$image_id = $container.find('.js-image-id');
    self.$display_area = $container.find('.js-display-area');
    _.defer(function () {
        // observe
        self.updated();
    });
};
HeaderImage.prototype = {
    setImage: function setImage(src, id) {
        this.$image_src.val(src);
        this.$image_id.val(id);
        this.$display_area.val('');
        if (this.$display_area.length) {
            // displayAreaupdate
        } else {
                // update
                this.updated();
            }
    },
    // displayArea: { x, y, x2, y2 }
    setDisplayArea: function setDisplayArea(area) {
        this.$display_area.val(JSON.stringify(area));
        this.updated();
    },
    // 
    clear: function clear() {
        this.$image_src.val('');
        this.$image_id.val('');
        this.$display_area.val('');
        this.updated();
    },
    getImageSrc: function getImageSrc() {
        return this.$image_src.val();
    },
    getThumbnailSrc: function getThumbnailSrc() {
        return this.getImageSrc().replace(/\.(jpg|png|gif)$/, '_120.jpg');
    },
    getImageId: function getImageId() {
        return this.$image_id.val();
    },
    // displayArea: { x, y, x2, y2 }
    getDisplayArea: function getDisplayArea() {
        var value;
        try {
            value = JSON.parse(this.$display_area.val());
        } catch (ignore) {}
        return value;
    },
    // trimmingArea: [ x, y, x2, y2 ] TrimmingWindow
    // 
    getTrimmingArea: function getTrimmingArea() {
        var area = this.getDisplayArea();
        if (area) {
            return [area.x, area.y, area.x2, area.y2];
        } else {
            return [0, 0, this.imageSize.width, this.imageSize.height];
        }
    },
    updated: function updated() {
        var self = this;
        $(self).triggerHandler('updated');
    }
};

module.exports = HeaderImage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],235:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var loadImages = require('js/Util/loadImages');

var HeaderImagePreview = function HeaderImagePreview($container) {
    this.$container = $container;
    this.jcrop = $.Jcrop(this.$container.find('.js-header-image-thumbnail'), {
        bgOpacity: '0.4',
        addClass: 'jcrop-dark',
        allowSelect: false,
        allowResize: false,
        allowMove: false
    });
};

HeaderImagePreview.prototype = {
    // url: URL
    // thumbnailUrl: URL
    // (area):  {x, y, x2, y2}
    render: function render(url, thumbnailUrl, area) {
        var self = this;
        if (url) {
            self.jcrop.setImage(thumbnailUrl, function () {
                if (area) {
                    self.setArea(url, thumbnailUrl, area);
                }
            });
        } else if (area) {
            self.setArea(url, thumbnailUrl, area);
        }
        self.$container.show();
    },
    clear: function clear() {
        var self = this;
        self.$container.hide();
    },
    // 
    setArea: function setArea(url, thumbnailUrl, area) {
        var self = this;

        loadImages([url, thumbnailUrl]).done(function (imgs) {
            var image = imgs[0];
            var thumbnail = imgs[1];

            var rateY = thumbnail.height / image.height;

            var thumbnailArea = [0, area.y * rateY, area.w, area.y2 * rateY];
            self.jcrop.setSelect(thumbnailArea);
        });
    }
};

module.exports = HeaderImagePreview;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/loadImages":578}],236:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var EditDesign = require('../EditDesign');

/**
 * CSS
 */
var ListItemSelector = {

    init: function init() {
        var $css = $('#css');

        // 
        // CSS
        //  ui-selected 
        var themeListItems = $('#themes li');
        themeListItems.addClass('ui-selectee').on('click', function (e) {
            var $item = $(e.currentTarget);
            var link = $item.attr('data-css').replace(/\s+/g, ' ');
            var id = $item.attr('data-id');

            var design = new EditDesign($css.val());
            design.setData('theme', id, '@import "' + link + '";');
            $css.val(design.getCSS());
            $css.trigger('change');

            themeListItems.removeClass('ui-selected');
            $item.addClass('ui-selected');
        });

        var bgImageThumbnail = $('#background-image-thumbnail');
        var backgroundListItems = $('#backgrounds li');
        var backgroundColorListItems = $('#background-colors li');

        // 
        // 
        backgroundListItems.addClass('ui-selectee').on('click', function (e) {
            var $item = $(e.currentTarget);
            var style = $item.attr('data-css').replace(/\s+/g, ' ');
            var id = $item.attr('data-id');

            var design = new EditDesign($css.val());
            design.setData('background', id, style);
            $css.val(design.getCSS());
            $css.trigger('change');

            backgroundListItems.removeClass('ui-selected');
            backgroundColorListItems.removeClass('ui-selected');
            $item.addClass('ui-selected');

            // 
            bgImageThumbnail.removeClass('ui-selected');
            $('input[name="bg-image-selected"]').val(0);
        });

        // 
        // 
        backgroundColorListItems.addClass('ui-selectee').on('click', function (e) {
            var $item = $(e.currentTarget);
            var style = $item.attr('data-css').replace(/\s+/g, ' ');
            var id = $item.attr('data-id');
            var design = new EditDesign($css.val());

            // CSSbackground-color
            // CSS
            var backgroundContent = design.getData('background').content;
            if (bgImageThumbnail.hasClass('ui-selected') && backgroundContent) {
                style = backgroundContent.replace(/background-color:(.*?);/, 'background-color:#' + id + ';');

                id = 'custom';
            }
            backgroundListItems.removeClass('ui-selected');

            design.setData('background', id, style);
            $css.val(design.getCSS());
            $css.trigger('change');

            backgroundColorListItems.removeClass('ui-selected');
            $item.addClass('ui-selected');
        });

        //  ui-selected 
        var design = new EditDesign($css.val());

        var currentTheme = design.getData('theme').selected;
        if (currentTheme) {
            themeListItems.filter('[data-id="' + currentTheme + '"]').addClass('ui-selected');
        } else {
            themeListItems.removeClass('ui-selected');
        }

        var currentBackground = design.getData('background').selected;
        if (currentBackground) {
            $('#backgrounds, #background-colors').find('[data-id="' + currentBackground + '"]').addClass('ui-selected');
        } else {
            backgroundListItems.removeClass('ui-selected');
        }
    }

};

module.exports = ListItemSelector;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../EditDesign":244}],237:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');

var EventEmitter = require('events').EventEmitter;

/**
 * 1
 * type, title, value
 *
 * @property {jQuery} $element - .module DOM
 * @property {string} type     - "profile"
 * @property {string} title    - 
 * @property {Object} value
 */

var Module = (function (_EventEmitter) {
    _inherits(Module, _EventEmitter);

    function Module($element) {
        var _this = this;

        _classCallCheck(this, Module);

        _get(Object.getPrototypeOf(Module.prototype), 'constructor', this).call(this);

        this.$element = $element;

        this.type = this.$element.find('input.js-module-type').val();
        this.title = this.$element.find('input.js-module-title').val();
        this.value = {};

        try {
            this.value = JSON.parse(this.$element.find('input.js-module-value').val());
        } catch (ignore) {}

        this.$element.on('click', '.js-edit-module', function () {
            _this.edit();
            return false;
        }).on('click', '.js-remove-module', function () {
            if (confirm(Locale.text('blog.confirm.delete'))) {
                _this.remove();
            }
            return false;
        });
    }

    /**
     * DOM
     * modulesType: "sidebar"
     * @static
     * @param {string} position
     */

    /**
     * edit
     * modulesUI
     */

    _createClass(Module, [{
        key: 'edit',
        value: function edit() {
            this.emit('edit');
        }

        /**
         * elementremoved
         * modules
         */
    }, {
        key: 'remove',
        value: function remove() {
            this.$element.remove();
            this.emit('removed');
        }

        /**
         * 
         * @param {string} type
         * @param {string} title
         * @param {string} value
         */
    }, {
        key: 'update',
        value: function update(type, title, value) {
            this.type = type;
            this.title = title;
            this.value = value;
            this.render();
            this.emit('updated');
        }

        /**
         * 
         * @returns {boolean}
         */
    }, {
        key: 'isNewModule',
        value: function isNewModule() {
            return this.isNew;
        }

        /**
         * 
         */
    }, {
        key: 'setAsNewModule',
        value: function setAsNewModule() {
            this.isNew = true;
            this.$element.addClass('created');
        }

        /**
         * 
         */
    }, {
        key: 'unsetAsNewModule',
        value: function unsetAsNewModule() {
            this.isNew = false;
            this.$element.removeClass('created');
        }

        /**
         * ()
         */
    }, {
        key: 'setAsSelected',
        value: function setAsSelected() {
            this.$element.addClass('selected');
        }

        /**
         * ()
         */
    }, {
        key: 'unsetAsSelected',
        value: function unsetAsSelected() {
            this.$element.removeClass('selected');
        }

        /**
         * element
         * input
         */
    }, {
        key: 'render',
        value: function render() {
            this.$element.find('input.js-module-type').val(this.getType());
            this.$element.find('input.js-module-title').val(this.getTitle());
            this.$element.find('input.js-module-value').val(this.getValueAsJSON());
            this.$element.addClass(this.getType()); // 
            this.$element.find('.title, .clipped-content').text(this.getTitleForPreview());
        }

        /**
         * @returns {string}
         */
    }, {
        key: 'getType',
        value: function getType() {
            return this.type;
        }

        /**
         * @returns {string}
         */
    }, {
        key: 'getTitle',
        value: function getTitle() {
            return this.title;
        }

        /**
         * @returns {string}
         */
    }, {
        key: 'getValue',
        value: function getValue() {
            return this.value;
        }

        /**
         * @returns {jQuery}
         */
    }, {
        key: 'getElement',
        value: function getElement() {
            return this.$element;
        }

        /**
         * 
         * HTMLHTML"HTML"
         * @returns {string}
         */
    }, {
        key: 'getTitleForPreview',
        value: function getTitleForPreview() {
            var title = this.getTitle();
            if (!title && this.getType() === 'html') {
                title = this.removeTag(this.value['module-value'] || '') || Locale.text('blog.module.html');
            }
            return title;
        }

        /**
         * valueinputJSON
         * @returns {string}
         */
    }, {
        key: 'getValueAsJSON',
        value: function getValueAsJSON() {
            return JSON.stringify(this.value);
        }

        /**
         * HTML
         * @param {string} html
         * @returns {string}
         */
    }, {
        key: 'removeTag',
        value: function removeTag(html) {
            return html.replace(/<.*?>/g, '');
        }
    }]);

    return Module;
})(EventEmitter);

Module.initializeWithModulesPosition = function (position) {
    var template = $('.new-module-template').html();
    var moduleHtml = _.template(template)({ position: position });
    var $element = $($.parseHTML(moduleHtml));

    return new Module($element);
};

module.exports = Module;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"events":207,"js/Locale":561,"underscore":213}],238:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// module
// DOMhide-radiosUI
var ModuleEditor = function ModuleEditor($modalWindow) {
    var self = this;
    self.$modalWindow = $modalWindow;

    // $modalWindowposition: relativeoverlaybodyappend
    self.$modalWindow.appendTo(document.body);

    self.$dialogBox = self.$modalWindow.find('.dialog-box'); // box
    self.$dialogOverray = self.$modalWindow.find('.dialog-overray');
    self.$applyButton = self.$modalWindow.find('.submit button.apply');
    self.$cancelButton = self.$modalWindow.find('.submit button.cancel');
    self.$radios = self.$modalWindow.find('.radios');

    // sessionresolvereject
    // session
    self.session = $.Deferred();
    self.session.reject();

    self.init();
};

ModuleEditor.prototype = {
    init: function init() {
        var self = this;

        // change
        self.$radios.find('input:radio').change(function () {
            var $checked = self.$radios.find('input:radio:checked');
            var type = $checked.val();
            self.selectPanelByType(type);
        });

        // IEchangeclick
        self.$modalWindow.find('.radio').click(function () {
            var type = $(this).find('input:radio').val();
            self.selectPanelByType(type);
        });

        // 1
        self.$modalWindow.find('#module-value-component-link').each(function () {
            var $linkModule = $(this);
            $linkModule.find('#add-link-input-button').click(function () {
                var $linkInput = $linkModule.find('.link-input').eq(0).clone();
                $linkInput.find(':input').val('');
                $linkInput.insertAfter($linkModule.find('.link-input').eq(-1));

                var $scrolled = self.$modalWindow.find('.module-value-box-inner');
                $scrolled.scrollTop($scrolled[0].scrollHeight);
            });
        });

        // 
        self.$modalWindow.delegate('.delete-link-input-button', 'click', function () {
            // 1clone1
            if (self.$modalWindow.find('.link-input').length > 1) {
                $(this).closest('.link-input').remove();
            }
            return false;
        });

        // 
        self.$applyButton.click(function () {
            self.applyEdit();
        });
        self.$dialogOverray.click(function () {
            self.cancelEdit();
        });
        self.$cancelButton.click(function () {
            self.cancelEdit();
        });
        $(window).keyup(function (e) {
            if (keyString(e) == 'S-ESC') {
                self.cancelEdit();
            }
        });

        // 
        self.$modalWindow.find('.js-categories-order-type').change(function () {
            $(self).triggerHandler('change-category-order-type');
        });
    },
    // 
    editNewModule: function editNewModule(module) {
        var self = this;
        self.session.reject();
        self.session = $.Deferred();
        self.editingModule = module;

        self.setupValues();

        // createdhide-radios
        self.$modalWindow.addClass('created').removeClass('hide-radios');
        self.$cancelButton.show();

        self.show();

        return self.session.promise();
    },
    // 
    editModule: function editModule(module) {
        var self = this;
        self.session.reject();
        self.session = $.Deferred();
        self.editingModule = module;

        self.setupValues();

        // createdhide-radios
        self.$modalWindow.removeClass('created').addClass('hide-radios');
        self.$cancelButton.hide();

        self.selectPanelByType(module.getType());

        self.show();

        self.fillValuesFromModule(module);

        // order_type
        // module.value['order_type']
        $(self).triggerHandler('edit-new-module');

        return self.session.promise();
    },
    // type
    // type: "profile", "html"
    selectPanelByType: function selectPanelByType(type) {
        var self = this;

        self.$radios.find('.radio').removeClass('selected');
        var $selected_label = self.$radios.find('.radio.module-' + type).closest('.radio');
        $selected_label.addClass('selected');
        // propchange
        $selected_label.find('input:radio').prop('checked', true);

        self.$modalWindow.find('.module-value-component').hide();
        self.$modalWindow.find('#module-value-component-' + type).show();
    },
    // typenull
    getSelectedPanelType: function getSelectedPanelType() {
        var self = this;
        var $selected = self.$radios.find('input:enabled:checked');
        if ($selected.length) {
            return $selected.val();
        } else {
            return null;
        }
    },
    // input
    // 1
    setupValues: function setupValues() {
        var self = this;

        // text
        self.$modalWindow.find('textarea, input[type=text], input[type=number]').val('');
        // 
        self.$modalWindow.find('input[type=checkbox]').prop('checked', false);

        // 
        // data-default-option
        self.$modalWindow.find('select').each(function () {
            if ($(this).attr('data-default-option')) {
                // 
                $(this).val($(this).attr('data-default-option'));
            } else {
                // 
                $(this).find('option:first').prop('selected', true);
            }
        });

        // 
        if (!self.getSelectedPanelType()) {
            self.selectPanelByType('profile');
        }
    },
    // 
    show: function show() {
        var self = this;

        // 
        var $scrolled = $('#tab-customize');
        $scrolled.scrollTop($scrolled[0].scrollHeight);

        self.$modalWindow.show();
        self.setPosition();
        self.$dialogBox.find('input[type=text]:visible:first').focus();
    },
    // 
    setPosition: function setPosition() {
        var self = this;
        var winHeight = $(document).height();
        var winWidth = $(window).width();
        var dialogTop = winHeight / 2 - self.$dialogBox.height() / 2;
        var dialogLeft = winWidth / 2 - self.$dialogBox.width() / 2;
        self.$dialogBox.css({ top: dialogTop, left: dialogLeft });
        self.$dialogOverray.css({ height: winHeight, width: winWidth });
    },
    // inputsessionresolve
    applyEdit: function applyEdit() {
        var self = this;
        var data = self.extractInputToModuleValues();
        self.session.resolve(data);
        self.hide();
    },
    // 
    cancelEdit: function cancelEdit() {
        var self = this;
        self.session.reject();
        self.hide();
    },
    // 
    hide: function hide() {
        var self = this;
        self.$modalWindow.hide();
    },
    // 
    // :visibleshow()
    fillValuesFromModule: function fillValuesFromModule(module) {
        var self = this;
        var val = module.getValue();
        var moduleType = module.getType();
        for (var name in val) {

            if (moduleType === 'link' && (name === 'link_title' || name === 'link_url')) {
                self.setLinkInput(self.$dialogBox, val, name);
            } else {
                var $inputs = self.$dialogBox.find(':input:visible').filter(function () {
                    return $(this).attr('name') == name;
                });
                $inputs.eq(0).val(val[name]);
                if ($inputs.eq(0).attr('type') == 'checkbox' && val[name]) {
                    $inputs.eq(0).prop('checked', true);
                }
            }
        }
        // module-valuemodule-title
        self.$dialogBox.find('input[name=module-title]:visible').val(module.getTitle());
    },
    extractInputToModuleValues: function extractInputToModuleValues() {
        // input
        var self = this;

        var moduleTitle = self.$dialogBox.find('input[name=module-title]:visible').val();

        // DOM
        // moduletype
        var moduleType;
        if (self.editingModule.isNewModule()) {
            moduleType = self.getSelectedPanelType();
        } else {
            moduleType = self.editingModule.getType();
        }
        var moduleValue = {};

        // (HTML)
        if (!moduleTitle && moduleType !== 'html') {
            var defaultTitle = self.$radios.find('input:checked').attr('data-default-module-title');
            moduleTitle = defaultTitle;
        }

        self.$dialogBox.find(':input:visible').each(function () {
            var $input = $(this);
            var name = $input.attr('name');
            var val = $input.val();

            // module-titleinputdialogBox
            // input
            if (name === 'module-title') {
                return;
            }

            if ($input.attr('type') == 'checkbox') {
                if ($input.prop('checked')) {
                    val = 1;
                } else {
                    val = 0;
                }
            }

            if (!name) {
                return;
            }
            // array
            if (typeof moduleValue[name] === 'undefined') {
                moduleValue[name] = val;
            } else if (moduleValue[name] instanceof Array) {
                moduleValue[name].push(val);
            } else {
                moduleValue[name] = [moduleValue[name], val];
            }
        });

        return {
            type: moduleType,
            title: moduleTitle,
            value: moduleValue
        };
    },
    // 
    //  / URLlink-titlelink-value
    setLinkInput: function setLinkInput($dialogBox, val, name) {
        var $inputs = $dialogBox.find(':input:visible').filter(function () {
            return $(this).attr('name') == name;
        });
        var $linkInput;
        if (val[name] instanceof Array) {
            var addInput = val[name].length > $inputs.length ? true : false;
            var diff = addInput ? val[name].length - $inputs.length : $inputs.length - val[name].length;

            for (var i = 0; i < diff; i++) {
                if (addInput) {
                    $linkInput = $dialogBox.find('.link-input:visible').eq(0).clone();
                    $linkInput.find(':input').val('');
                    $linkInput.insertAfter($dialogBox.find('.link-input').eq(-1));
                } else {
                    $linkInput = $dialogBox.find('.link-input:visible').eq(-1);
                    $linkInput.remove();
                }
            }
            $inputs = $dialogBox.find(':input:visible').filter(function () {
                return $(this).attr('name') == name;
            });
            $inputs.each(function () {
                $(this).val(val[name].shift());
            });
        } else {
            // 1input
            while ($inputs.length > 1) {
                $linkInput = $dialogBox.find('.link-input:visible').eq(-1);
                $linkInput.remove();
                $inputs = $dialogBox.find(':input:visible').filter(function () {
                    return $(this).attr('name') == name;
                });
            }
            $inputs.eq(0).val(val[name]);
        }
    }
};

module.exports = ModuleEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],239:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Module = require('./Module');

// ()
// $elementdiv[data-modules-type="sidebar"].sidebar-box
// editor ModuleEditor
var Modules = function Modules($element, editor) {
    var self = this;
    self.$element = $element;
    self.editor = editor;
    self.init();
};

Modules.prototype = {
    init: function init() {
        var self = this;

        // "sidebar"
        self.position = self.$element.attr('data-modules-type');

        self.modules = [];

        // 
        self.$element.on('click', '.js-add-module', function () {
            self.addNewModule();
            return false;
        });

        self.$element.find('.module').each(function () {
            self.addModuleFromElement($(this));
        });

        // update
        self.$element.find('.modules').sortable({
            containment: 'parent',
            stop: function stop() {
                self.onSorted();
            }
        });
    },
    // DOM
    addModuleFromElement: function addModuleFromElement($element) {
        var self = this;
        var module = new Module($element);
        self.awareModule(module);
        module.render();
    },
    // 
    awareModule: function awareModule(module) {
        var self = this;
        self.modules.push(module);
        module.on('removed', function () {
            self.onModuleRemoved(module);
        }).on('updated', function () {
            self.onUpdated();
        }).on('edit', function () {
            self.editModule(module);
        });
    },
    // self.modulesDOM.modulesgetElement
    onSorted: function onSorted() {
        var self = this;

        var sortedModules = self.$element.find('.module').map(function () {
            var element = this;

            var matchedModule = _.find(self.modules, function (module) {
                return module.getElement()[0] === element;
            });

            return matchedModule;
        }).toArray();

        self.modules = sortedModules;

        self.onUpdated();
    },
    // modulesupdated
    onModuleRemoved: function onModuleRemoved(module) {
        var self = this;
        self.modules = _.difference(self.modules, [module]);
        self.onUpdated();
    },
    // editor
    editModule: function editModule(module) {
        var self = this;
        var session = self.editor.editModule(module);
        module.setAsSelected();
        session.done(function (data) {
            // data 
            module.update(data.type, data.title, data.value);
        }).always(function () {
            module.unsetAsSelected();
        });
    },
    // DOMeditor
    addNewModule: function addNewModule() {
        var self = this;
        var module = Module.initializeWithModulesPosition(self.position);
        module.setAsNewModule();
        module.setAsSelected();
        self.$element.find('.modules').append(module.getElement());
        var session = self.editor.editNewModule(module);
        session.done(function (data) {
            self.awareModule(module);
            module.update(data.type, data.title, data.value);
            module.unsetAsNewModule();
            module.unsetAsSelected();
        }).fail(function () {
            module.remove();
        });
    },
    // updated
    onUpdated: function onUpdated() {
        var self = this;
        $(self).triggerHandler('updated');
    }
};

module.exports = Modules;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Module":237,"underscore":213}],240:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

var PreviewUpdater = function PreviewUpdater(args) {
    this.$form = args.$form;
    this.$loading = args.$loading;
    this.$preview = args.$preview;
    this.formState = args.formState;
    this.$deviceInput = this.$form.find(':input[name=device]');
    this.device = this.$deviceInput.val();
    this.pageType = 'index';
    this.failedCount = 0;
};

PreviewUpdater.prototype = {
    // 
    setAsIndexPreview: function setAsIndexPreview() {
        var self = this;
        self.pageType = 'index';
    },
    // 
    setAsPermalinkPreview: function setAsPermalinkPreview() {
        var self = this;
        self.pageType = 'permalink';
    },
    getPageType: function getPageType() {
        var self = this;
        return self.pageType;
    },
    // PC
    setDeviceAsPC: function setDeviceAsPC() {
        var self = this;
        self._setDevice('pc');
    },
    // touch
    setDeviceAsTouch: function setDeviceAsTouch() {
        var self = this;
        self._setDevice('touch');
    },
    // 
    // input
    _setDevice: function _setDevice(device) {
        var self = this;
        self.device = device;
        self.$deviceInput.val(self.device);
        self.requestPreview();

        // touchiframe.device=touch
        self.$preview.toggleClass('device-touch', device === 'touch');
    },
    // previewform
    requestPreview: function requestPreview() {
        var self = this;

        var serialized = self.$form.serialize();
        if (serialized === self.serialized) return;
        self.serialized = serialized;

        self.preview();
    },
    // preview
    preview: function preview() {
        var self = this;

        if (self.failedCount > 10) return;

        self.showEffect();

        if (!self.serialized) {
            self.serialized = self.$form.serialize();
        }
        var serialized = self.serialized;

        var getSignature = self.getSignature(serialized);
        getSignature.done(function (signature) {
            self.onGotSignature(signature);
            self.failedCount = 0;
        }).fail(function () {
            self.failedCount++;
            self.requestPreview();
        });
    },
    // signatureresolveDeferred
    getSignature: function getSignature(serialized) {
        var self = this;

        var got = $.Deferred();

        $.ajax({
            url: '../../preview/design',
            type: "post",
            dataType: 'json',
            data: serialized
        }).done(function (data) {
            // 
            if (serialized === self.$form.serialize()) {
                got.resolve(data.signature);
            } else {
                got.reject();
            }
        }).fail(function () {
            got.reject();
        });

        return got.promise();
    },
    // signature
    // formactiontargetsignaturesubmit
    onGotSignature: function onGotSignature(signature) {
        var self = this;

        // iframeJSwindow.namesubmitwindow
        var $previewIframe = $('#preview-iframe');
        var $newPreviewIframe = $previewIframe.clone();
        $previewIframe.replaceWith($newPreviewIframe);
        self.$preview = $newPreviewIframe;

        var $form = self.$form;

        var actionBefore = $form.attr('action');
        var targetBefore = $form.attr('target');
        var isWatchingBefore = this.formState.isWatching;

        $form.attr('action', self.getAction());
        $form.attr('target', self.$preview.attr('name'));
        var $signature = $('<textarea/>').attr('name', 'signature').val(signature);
        $signature.appendTo($form);

        $form.submit();

        $signature.remove();
        $form.attr('action', actionBefore);
        $form.attr('target', targetBefore);
        this.formState.isWatching = isWatchingBefore;
    },
    // ()
    showEffect: function showEffect() {
        var self = this;
        self.$loading.fadeIn('fast');
        setTimeout(function () {
            self.$loading.fadeOut('fast');
        }, 1000);
    },
    // indexpermalink
    getAction: function getAction() {
        var self = this;
        var base = globalData('blogs-uri-base');
        return base + '/preview/' + self.pageType + '_design';
    }
};

module.exports = PreviewUpdater;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],241:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Window = require('js/Base/Window');

// 
var TrimmingWindow = function TrimmingWindow($container) {
    this.$container = $container;
    this.init();
};
TrimmingWindow.prototype = {
    init: function init() {
        var self = this;
        // 
        self.$container.appendTo(document.body);

        // sessionDeferreddonereject
        self.session = $.Deferred();
        self.session.reject();

        self.jcrop = $.Jcrop(self.$container.find('.js-header-image-resizer'), {
            bgOpacity: '0.4',
            addClass: 'jcrop-dark',
            allowSelect: false,
            keySupport: false,
            allowResize: false
        });

        self.$container.on('click', '.js-header-image-apply-button', function () {
            self.save();
            return false;
        }).on('click', '.js-header-image-cancel-button', function () {
            self.cancel();
            return false;
        });
    },
    // URL
    // returns: done, rejectDeferred
    trim: function trim(url, area) {
        var self = this;
        self.cancel();
        self.session = $.Deferred();
        self.session.always(function () {
            self._hide();
        });

        self.jcrop.setImage(url, function () {
            self.jcrop.setSelect(area);
            self._show();
        });

        return self.session.promise();
    },
    // 
    save: function save() {
        var self = this;
        self.session.resolve(self.jcrop.tellSelect());
    },
    cancel: function cancel() {
        var self = this;
        self.session.reject(self.jcrop.tellSelect());
    },
    _show: function _show() {
        var self = this;
        Window.show(self.$container, {
            center: true,
            showBackground: true,
            closeExplicitly: true
        });
    },
    _hide: function _hide() {
        var self = this;
        Window.hide(self.$container);
    }
};

module.exports = TrimmingWindow;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Window":299}],242:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

/**
 * HTML
 * PC
 */
var setupTextareaHider = function setupTextareaHider() {
    _.each([['header-touch-show-html-for-pc', '.js-hide-on-header-touch-show-html-for-pc'], ['display-touch', '.js-hide-on-display-touch'], ['footer-touch-show-html-for-pc', '.js-hide-on-footer-touch-show-html-for-pc'], ['header-touch-show-image-for-pc', '.js-hide-on-header-touch-show-image-for-pc']], function (rule) {
        var input_selector = rule[0];
        var target_selector = rule[1];

        var $input = $(':input[name=' + input_selector + ']');
        if (!$input.length) {
            return;
        }

        var $target = $(target_selector);
        if (!$target.length) {
            return;
        }

        var updateVisibility = function updateVisibility() {
            var $checked_input = $(':checked[name=' + input_selector + ']');
            if (!$checked_input.length) {
                return;
            }

            if (+$checked_input.val()) {
                $target.hide();
            } else {
                $target.show();
            }
        };

        // 
        // IEchange
        $input.on('change', function () {
            _.defer(updateVisibility);
        });

        // 
        updateVisibility();
    });
};

module.exports = setupTextareaHider;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],243:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var FotoUploader = require('./FotoUploader');
var HeaderImage = require('./HeaderImage');

// 
var setupTouchHeaderImageComponent = function setupTouchHeaderImageComponent(args) {
    var $container = args.$container;
    var previewUpdater = args.previewUpdater;

    var imageSize = {
        width: +$container.attr('data-max-width'),
        height: +$container.attr('data-max-height')
    };

    var image = new HeaderImage($container, imageSize);

    var $imageItem = $container.find('.js-header-image-item');
    var $thumbnail = $container.find('.js-header-image-thumbnail');

    $(image).on('updated', function () {
        if (image.getImageSrc()) {
            $thumbnail.attr('src', image.getThumbnailSrc()).show();
            $imageItem.show();
        } else {
            $thumbnail.hide();
            $imageItem.hide();
        }

        if (previewUpdater) {
            previewUpdater.requestPreview();
        }
    });

    var uploaded = FotoUploader.init({
        $input: $container.find('.js-header-image-input'),
        size: imageSize.width
    });

    // 
    uploaded.progress(function (foto) {
        image.setImage(foto.url, foto.fid);
    });

    $container.on('click', '.js-delete-header-image', function () {
        // 
        if (!confirm(Locale.text('admin.design.stop_header_image_confirm'))) {
            return false;
        }
        image.clear();
        return false;
    });
};

module.exports = setupTouchHeaderImageComponent;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./FotoUploader":233,"./HeaderImage":234,"js/Locale":561}],244:[function(require,module,exports){
'use strict';

var _slicedToArray = (function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i['return']) _i['return'](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError('Invalid attempt to destructure non-iterable instance'); } }; })();

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _ = require('underscore');

/**
 * CSS
 * CSS
 *
 * this.datasectionkeysection
 * section
 * ```
 * interface SectionData {
 *     selected : string;
 *     content  : string;
 * }
 * ```
 *
 * 
 *
 * - setDataSectionData
 * - getCSS()CSS
 * - 
 *
 * 
 */

var EditDesign = (function () {

    /**
     * sectionkeythis.dataCSS
     * @param {string} css - CSS
     */

    function EditDesign(css) {
        _classCallCheck(this, EditDesign);

        this.data = {};
        this.setCSS(css);
    }

    /**
     * section
     *  theme -> background 
     * @static
     */

    /**
     * CSSthis.userCSSthis.data
     * @param {string} css - CSS
     */

    _createClass(EditDesign, [{
        key: 'setCSS',
        value: function setCSS(css) {
            var _this = this;

            var _scanCSS = this.scanCSS(css);

            var userCSS = _scanCSS.userCSS;
            var sectionCSSList = _scanCSS.sectionCSSList;

            // CSS
            this.userCSS = userCSS;

            // sectionCSSthis.data
            sectionCSSList.forEach(function (sectionCSS) {
                var _scanSection = _this.scanSection(sectionCSS);

                var sectionName = _scanSection.sectionName;
                var selected = _scanSection.selected;
                var content = _scanSection.content;

                // section
                if (!sectionName) {
                    return;
                }

                _this.setData(sectionName, selected, content);
            });
        }

        /**
         * css <system> section
         * @param {string} css
         */
    }, {
        key: 'scanCSS',
        value: function scanCSS(css) {
            var sectionRE = /\n?\/\* <system([^>]+)> \*\/\n*([\s\S]+?)\n*\/\* <\/system> \*\/\n?/g;
            var sectionCSSList = [];

            var userCSS = css.replace(sectionRE, function (sectionCSS) {
                sectionCSSList.push(sectionCSS);
                return '';
            });

            return { userCSS: userCSS, sectionCSSList: sectionCSSList };
        }

        /**
         * <system> CSS
         * @param {string} sectionCSS
         * @returns {{sectionName: string, selected: string, content: string}}
         */
    }, {
        key: 'scanSection',
        value: function scanSection(sectionCSS) {
            var sectionRE = /\n?\/\* <system([^>]+)> \*\/\n*([\s\S]+?)\n*\/\* <\/system> \*\/\n?/;

            var _sectionCSS$match = sectionCSS.match(sectionRE);

            var _sectionCSS$match2 = _slicedToArray(_sectionCSS$match, 3);

            var _ = _sectionCSS$match2[0];
            var attributes = _sectionCSS$match2[1];
            var content = _sectionCSS$match2[2];

            var attrs = {};
            attributes.replace(/(\S+)="([^"]+)"/g, function (_, key, val) {
                attrs[key] = val;
            });

            return {
                sectionName: attrs.section,
                selected: attrs.selected,
                content: content
            };
        }

        /**
         * this.datathis.userCssCSS
         * @returns {string}
         */
    }, {
        key: 'getCSS',
        value: function getCSS() {
            var _this2 = this;

            // sectionCSS
            var sectionStyles = [];

            // section
            // EditDesign.sectionssection
            // EditDesign.sectionsuniq
            var sectionNames = _.uniq(_.flatten([EditDesign.sections, Object.keys(this.data).sort()]));

            // this.data
            sectionNames.forEach(function (sectionName) {
                sectionStyles.push(_this2.getSectionAsCSS(sectionName));
            });

            // CSS
            sectionStyles.push(this.userCSS);

            // 
            return sectionStyles.join('').trim();
        }

        /**
         * sectionCSS
         * @param   {string} sectionName
         * @returns {string}
         */
    }, {
        key: 'getSectionAsCSS',
        value: function getSectionAsCSS(sectionName) {
            if (!this.data[sectionName]) {
                return '';
            }

            var section = this.data[sectionName];
            return ['\n/* <system section="' + sectionName + '" selected="' + section.selected + '"> */', '' + section.content, '/* </system> */\n'].join('\n');
        }
    }, {
        key: 'getData',
        value: function getData(sectionName) {
            return this.data[sectionName] || {};
        }

        /**
         * section
         * @param {string} sectionName  - section
         * @param {string} selected     - DOMdata-id
         * @param {string} content      - CSS
         */
    }, {
        key: 'setData',
        value: function setData(sectionName, selected, content) {
            this.data[sectionName] = {
                selected: selected,
                content: content
            };
        }
    }]);

    return EditDesign;
})();

EditDesign.sections = ['theme', 'background'];

module.exports = EditDesign;

},{"underscore":213}],245:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var ExternalAuthModal = (function () {
    function ExternalAuthModal() {
        _classCallCheck(this, ExternalAuthModal);
    }

    _createClass(ExternalAuthModal, [{
        key: 'setModalDisabled',
        value: function setModalDisabled() {
            try {
                localStorage['Hatena.Diary.Admin.User.Blog.Edit.Done.ExternalAuthModal.disabled'] = true;
            } catch (ignore) {}
        }
    }, {
        key: 'isModalDisabled',
        value: function isModalDisabled() {
            try {
                var isDisabled = localStorage['Hatena.Diary.Admin.User.Blog.Edit.Done.ExternalAuthModal.disabled'];
                return !!isDisabled;
            } catch (ignore) {}
        }
    }]);

    return ExternalAuthModal;
})();

module.exports = ExternalAuthModal;

},{}],246:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var Window = require('js/Base/Window');

var ExternalAuthModal = require('./ExternalAuthModal');

var ExternalAuthModalHandler = (function () {
    function ExternalAuthModalHandler($el) {
        var _this = this;

        _classCallCheck(this, ExternalAuthModalHandler);

        this.$el = $el;
        this.modal = new ExternalAuthModal();

        // modal
        if (this.$el.length && !this.modal.isModalDisabled()) {
            this.showModal();
        }

        // modalclick
        // checkbox
        this.$el.on('click', function (event) {
            event.stopPropagation();
        });

        // 
        this.$el.on('click', '.js-skip-button', function () {
            // 
            // 
            if (_this.$el.find('.js-non-display-checkbox').prop('checked')) {
                _this.modal.setModalDisabled();
            }
            _this.hideModal();
            return false;
        });
    }

    _createClass(ExternalAuthModalHandler, [{
        key: 'showModal',
        value: function showModal() {
            Window.show(this.$el, { center: 1, showBackground: true });
        }
    }, {
        key: 'hideModal',
        value: function hideModal() {
            Window.hide(this.$el);
        }
    }]);

    return ExternalAuthModalHandler;
})();

module.exports = ExternalAuthModalHandler;

},{"./ExternalAuthModal":245,"js/Base/Window":299}],247:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var positionToString = require('js/Util/positionToString');

var OfficialShareWindow = (function () {
    function OfficialShareWindow(url, width, height, screenWidth, screenHeight) {
        _classCallCheck(this, OfficialShareWindow);

        this.url = url;
        this.width = width;
        this.height = height;
        this.screenWidth = screenWidth;
        this.screenHeight = screenHeight;

        this.setLeft();
        this.setTop();
        this.openWindow();
    }

    _createClass(OfficialShareWindow, [{
        key: 'setLeft',
        value: function setLeft() {
            this.left = Math.floor((this.screenWidth - this.width) / 2);
        }
    }, {
        key: 'setTop',
        value: function setTop() {
            this.top = Math.floor((this.screenHeight - this.height) / 2);
        }
    }, {
        key: 'openWindow',
        value: function openWindow() {
            window.open(this.url, 'share_window', positionToString({
                width: this.width,
                height: this.height,
                screen_width: this.screenWidth,
                screen_height: this.screenHeight,
                left: this.left,
                top: this.top,
                scrollbars: 'yes'
            }));
        }
    }]);

    return OfficialShareWindow;
})();

module.exports = OfficialShareWindow;

},{"js/Util/positionToString":584}],248:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var SelectText = (function () {
    function SelectText($el, start, end) {
        _classCallCheck(this, SelectText);

        this.$el = $el;
        this.start = start;
        this.end = end;
    }

    _createClass(SelectText, [{
        key: 'select',
        value: function select() {
            this.$el.focus();

            if (this.$el.createTextRange) {
                var range = this.$el.createTextRange();
                range.collapse(true);
                range.moveStart('character', this.start);
                range.moveEnd('character', this.end);
                range.select();
            } else {
                this.$el.selectionStart = this.start;
                this.$el.selectionEnd = this.end;
            }
        }
    }]);

    return SelectText;
})();

module.exports = SelectText;

},{}],249:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Window = require('js/Base/Window');
var Locale = require('js/Locale');
var globalData = require('js/Base/globalData');

var validateTweetLength = require('js/Base/validateTweetLength');

var ShareModal = (function () {
    function ShareModal($modal, $shareSuccessMessage, entryId, serviceName) {
        _classCallCheck(this, ShareModal);

        this.$modal = $modal;
        this.$textarea = this.$modal.find('.js-share-message');
        this.$shareSuccessMessage = $shareSuccessMessage;

        // 
        this.hideShareSuccessMessage();

        this.serviceName = serviceName;
        this.entryId = entryId;

        this.isAjaxRunning = false;
        this.isShareButtonDisabled = false;

        this.bindEvents();
        this.showModal();
    }

    _createClass(ShareModal, [{
        key: 'bindEvents',
        value: function bindEvents() {
            var _this = this;

            $(document).on('click', '.js-icon-close', function () {
                _this.hideModal();
            });

            this.$textarea.on('keyup', function () {
                if (_this.validateMessage(_this.$textarea.val()) === false) {
                    _this.$modal.find('.js-validation-error').show();
                    _this.isShareButtonDisabled = true;
                } else {
                    _this.$modal.find('.js-validation-error').hide();
                    _this.isShareButtonDisabled = false;
                }
            });

            $(document).on('click', '.js-share-execute-button', function () {
                // disabledreturn
                if (_this.isAjaxRunning === true || _this.isShareButtonDisabled === true) {
                    return false;
                }

                var message = _this.$textarea.val();
                if (_this.validateMessage(message) === true) {
                    _this.post(message);
                }

                return false;
            });
        }
    }, {
        key: 'showModal',
        value: function showModal() {
            Window.show(this.$modal);
        }
    }, {
        key: 'hideModal',
        value: function hideModal() {
            this.$modal.find('.js-validation-error').hide();
            Window.hideAll();
        }
    }, {
        key: 'validateMessage',
        value: function validateMessage(message) {
            if (this.serviceName === 'twitter') {
                return validateTweetLength(message);
            }

            return true;
        }
    }, {
        key: 'showShareSuccessMessage',
        value: function showShareSuccessMessage() {
            this.$shareSuccessMessage.find('p').text(Locale.text('blog.social.share.success', Locale.text('blog.social.service.name.' + this.serviceName)));
            this.$shareSuccessMessage.show();
        }
    }, {
        key: 'hideShareSuccessMessage',
        value: function hideShareSuccessMessage() {
            this.$shareSuccessMessage.hide();
        }
    }, {
        key: 'post',
        value: function post(message) {
            var _this2 = this;

            // disable
            this.isAjaxRunning = true;
            $.ajax({
                url: 'post_to_social_service',
                type: 'POST',
                data: {
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc'),
                    service_name: this.serviceName,
                    entry_id: this.entryId,
                    message: message
                }
            }).done(function () {
                _this2.hideModal();
                _this2.showShareSuccessMessage();
            }).fail(function () {
                // modalfailfalse
                _this2.isAjaxRunning = false;
            });
        }
    }]);

    return ShareModal;
})();

module.exports = ShareModal;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Window":299,"js/Base/globalData":302,"js/Base/validateTweetLength":307,"js/Locale":561}],250:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Category = require('./Category');
var Collections = require('./Collections');

var Categories = (function () {
    function Categories() {
        var _this = this;

        _classCallCheck(this, Categories);

        $.ajax({
            url: 'categories.json'
        }).done(function (data) {
            _this.onLoaded(data);
        });
    }

    // load

    _createClass(Categories, [{
        key: 'reload',
        value: function reload() {
            this.load();
        }

        /**
         * data = { categories: [ { name, count } ] }
         */
    }, {
        key: 'onLoaded',
        value: function onLoaded(data) {
            var _this2 = this;

            if (!this.categories) {
                // 
                this.categories = _.map(data.categories, function (categoryData) {
                    return new Category(categoryData);
                });
                this.newCategories = this.categories;
            } else {
                // 
                this.newCategories = [];

                _.each(data.categories, function (categoryData) {

                    var category = _this2.getCategory(categoryData.name);

                    if (category) {
                        category.setEntriesCount(categoryData.count);
                    } else {
                        category = new Category(categoryData);

                        _this2.categories.push(category);
                        _this2.newCategories.push(category);
                    }
                });
            }

            // CategoriesView.prototype.renderCollections
            Collections.categories = this;

            $(this).triggerHandler('loaded');
        }
    }, {
        key: 'getNewCategories',
        value: function getNewCategories() {
            return this.newCategories;
        }
    }, {
        key: 'getCategory',
        value: function getCategory(categoryName) {
            return _.find(this.categories, function (category) {
                return category.getName() === categoryName;
            });
        }
    }]);

    return Categories;
})();

module.exports = Categories;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Category":253,"./Collections":256,"underscore":213}],251:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// 

var CategoriesDropdownView = (function () {
    function CategoriesDropdownView() {
        var _this = this;

        _classCallCheck(this, CategoriesDropdownView);

        this.$dropdown = $('.js-category-dropdown-list');
        this.$dropdownToggle = $('.js-category-dropdown-toggle');

        this.$dropdownToggle.on('click', function () {
            _this.toggleDropdown();
            return false;
        });

        $(document).on('click', function () {
            _this.hideDropdown();
        });
    }

    _createClass(CategoriesDropdownView, [{
        key: 'toggleDropdown',
        value: function toggleDropdown() {
            this.$dropdown.toggle();
        }
    }, {
        key: 'hideDropdown',
        value: function hideDropdown() {
            this.$dropdown.hide();
        }
    }]);

    return CategoriesDropdownView;
})();

module.exports = CategoriesDropdownView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],252:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var CategoryAppenderView = require('./CategoryAppenderView');
var CategorySelectorView = require('./CategorySelectorView');

// View
// View2

var CategoriesView = (function () {
    function CategoriesView(categories, entries) {
        var _this = this;

        _classCallCheck(this, CategoriesView);

        this.categories = categories;
        this.entries = entries;

        this.$categoriesSelector = $('.js-categories-selector');
        this.$createNewCategory = $('.js-create-new-category');

        $(categories).on('loaded', function () {
            _this.render();
        });

        $('.js-create-new-category').on('click', function () {
            var categoryName = window.prompt(Locale.text('create_category'));
            if (!categoryName) {
                return;
            }

            var categoryAdded = _this.entries.addCategoryToSelectedEntries(categoryName);
            categoryAdded.always(function () {
                _this.categories.reload();
            });
        });
    }

    _createClass(CategoriesView, [{
        key: 'render',
        value: function render() {
            var _this2 = this;

            _.each(this.categories.getNewCategories(), function (category) {
                var selectorView = new CategorySelectorView(category);
                _this2.$categoriesSelector.append(selectorView.getElement());

                var appenderView = new CategoryAppenderView(category, _this2.entries);
                _this2.$createNewCategory.before(appenderView.getElement());
            });
        }
    }]);

    return CategoriesView;
})();

module.exports = CategoriesView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./CategoryAppenderView":254,"./CategorySelectorView":255,"js/Locale":561,"underscore":213}],253:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var Category = (function () {
    function Category(data) {
        _classCallCheck(this, Category);

        this.data = data;
    }

    _createClass(Category, [{
        key: 'getName',
        value: function getName() {
            return this.data.name;
        }
    }, {
        key: 'getEntriesCount',
        value: function getEntriesCount() {
            return this.data.count;
        }
    }, {
        key: 'setEntriesCount',
        value: function setEntriesCount(count) {
            this.data.count = count;
            $(this).triggerHandler('change');
        }
    }]);

    return Category;
})();

module.exports = Category;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],254:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var Collections = require('./Collections');

// view

var CategoryAppenderView = (function () {
    function CategoryAppenderView(category, entries) {
        var _this = this;

        _classCallCheck(this, CategoryAppenderView);

        this.category = category;
        this.entries = entries;
        this.render();

        this.$element.on('click', function () {
            var categoryAdded = _this.entries.addCategoryToSelectedEntries(_this.category.getName());
            categoryAdded.always(function () {
                Collections.categories.reload();
            });
        });

        $(this.category).on('change', function () {
            _this.render();
        });
    }

    _createClass(CategoryAppenderView, [{
        key: 'render',
        value: function render() {
            if (!this.$element) {
                this.$element = $('<li>');
            }

            var name = this.category.getName();
            var count = this.category.getEntriesCount();

            this.$element.text(name + ' (' + count + ')');
        }
    }, {
        key: 'getElement',
        value: function getElement() {
            return this.$element;
        }
    }]);

    return CategoryAppenderView;
})();

module.exports = CategoryAppenderView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Collections":256}],255:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// view

var CategorySelectorView = (function () {
    function CategorySelectorView(category) {
        var _this = this;

        _classCallCheck(this, CategorySelectorView);

        this.category = category;
        this.render();

        $(this.category).on('change', function () {
            _this.render();
        });
    }

    _createClass(CategorySelectorView, [{
        key: 'render',
        value: function render() {
            if (!this.$element) {
                this.$element = $('<option>').val(this.category.getName());
            }

            var name = this.category.getName();
            var count = this.category.getEntriesCount();

            this.$element.text(name + ' (' + count + ')');
        }
    }, {
        key: 'getElement',
        value: function getElement() {
            return this.$element;
        }
    }]);

    return CategorySelectorView;
})();

module.exports = CategorySelectorView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],256:[function(require,module,exports){
'use strict';

// (Entries, Categories)1Collections
// Model
// (EntriesViewentries)
var Collections = {
    entries: null,
    categories: null
};

module.exports = Collections;

},{}],257:[function(require,module,exports){
(function (global){
var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var globalData = require('js/Base/globalData');
var Entry = require('./Entry');
var Collections = require('./Collections');

// 

var Entries = (function () {
    function Entries() {
        _classCallCheck(this, Entries);
    }

    _createClass(Entries, [{
        key: 'load',

        // 
        value: function load() {
            var _this = this;

            var data = {};

            if (this.keyword) {
                data.q = this.keyword;
            }

            if (this.category) {
                data.category = this.category;
            }

            if (this.getPermission() !== 'all') {
                data.permission = this.getPermission();
            }

            var lastEntry = _.last(this.entries);
            if (lastEntry) {
                data.until = lastEntry.getCreatedDate().getTime() / 1000;
            }

            $.ajax({
                url: 'entries.json',
                data: data
            }).done(function (entries) {
                _this.onLoaded(entries);
            });
        }

        /**
         * data: { entries: [$entry], has_more: bool }
         */
    }, {
        key: 'onLoaded',
        value: function onLoaded(data) {
            var $this = $(this);

            this.receivedEntries = _.map(data.entries, function (entryData) {
                return new Entry(entryData);
            });

            $(this.receivedEntries).on('select', function () {
                $this.triggerHandler('select');
            }).on('remove', function () {
                $this.triggerHandler('remove');
            });

            if (!this.entries) {
                this.entries = [];
            }

            this.entries = this.entries.concat(this.receivedEntries);
            this.hasMore = data.has_more;

            // EntryView.prototype.renderCollections
            Collections.entries = this;

            $(this).triggerHandler('loaded');
        }

        // 
    }, {
        key: 'reset',
        value: function reset() {
            _.each(this.entries, function (entry) {
                entry.remove();
            });

            this.entries = [];
            this.receivedEntries = [];
            this.hasMore = undefined;

            $(this).triggerHandler('reset');

            this.load();
        }

        // 
    }, {
        key: 'getEntries',
        value: function getEntries() {
            return this.entries;
        }

        // Entry
    }, {
        key: 'getReceivedEntries',
        value: function getReceivedEntries() {
            return this.receivedEntries;
        }

        // 
    }, {
        key: 'hasMoreEntries',
        value: function hasMoreEntries() {
            return this.hasMore;
        }

        // 
    }, {
        key: 'setKeyword',
        value: function setKeyword(keyword) {
            this.keyword = keyword;
        }

        // 
    }, {
        key: 'getKeyword',
        value: function getKeyword() {
            return this.keyword;
        }

        // 
    }, {
        key: 'setCategory',
        value: function setCategory(category) {
            this.category = category;
        }

        // permission: all|public|draft
    }, {
        key: 'setPermission',
        value: function setPermission(permission) {
            this.permission = permission;
        }
    }, {
        key: 'getPermission',
        value: function getPermission() {
            return this.permission;
        }
    }, {
        key: 'getSelectedEntries',
        value: function getSelectedEntries() {
            return _.filter(this.entries, function (entry) {
                return entry.isSelected();
            });
        }

        // 
        // resolvedeferred
    }, {
        key: 'deleteSelectedEntries',
        value: function deleteSelectedEntries() {
            var _this2 = this;

            var entriesToDelete = this.getSelectedEntries();
            if (!entriesToDelete.length) {
                return;
            }

            var deleted = $.ajax({
                type: 'post',
                url: 'entries.delete.json',
                data: {
                    entry: _.map(entriesToDelete, function (entry) {
                        return entry.getUUID();
                    }),
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                },
                traditional: true
            });

            deleted.done(function () {
                _this2.entries = _.difference(_this2.entries, entriesToDelete);
                _.each(entriesToDelete, function (entry) {
                    entry.remove();
                });
            });

            return deleted;
        }

        // 
        // resolvedeferred
    }, {
        key: 'addCategoryToSelectedEntries',
        value: function addCategoryToSelectedEntries(categoryName) {
            var entriesToAddCategory = this.getSelectedEntries();
            if (!entriesToAddCategory.length) {
                return;
            }

            _.each(entriesToAddCategory, function (entry) {
                entry.addCategory(categoryName);
            });

            var categoryAdded = $.ajax({
                type: 'post',
                url: 'entries.add_category.json',
                data: {
                    entry: _.map(entriesToAddCategory, function (entry) {
                        return entry.getUUID();
                    }),
                    category: categoryName,
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                },
                traditional: true
            });

            return categoryAdded;
        }
    }]);

    return Entries;
})();

module.exports = Entries;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Collections":256,"./Entry":259,"js/Base/globalData":302,"underscore":213}],258:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');

var Collections = require('./Collections');
var EntryView = require('./EntryView');

var EntriesView = (function () {
    function EntriesView(entries) {
        var _this = this;

        _classCallCheck(this, EntriesView);

        this.entries = entries;
        var $entries = $(entries);

        this.$entriesContainer = $('.js-entries-container');

        this.$loadNextPage = $('.js-load-next-page');

        $entries.on('loaded', function () {
            _this.render();
        });
        $entries.on('select remove', function () {
            _this.renderButtons();
        });

        var $form = $('.js-entry-search-form');
        $('.js-categories-selector').on('change', function () {
            entries.setKeyword($form.find(':input[name="q"]').val());
            entries.setCategory($form.find(':input[name="category"]').val());
            entries.reset();
        });

        this.$loadNextPage.on('click', function () {
            _this.entries.load();
        });

        $('.js-delete-entries-button').on('click', function () {
            if (!confirm(Locale.text('epic.entry.delete.confirm'))) {
                return;
            }

            var deleted = _this.entries.deleteSelectedEntries();
            deleted.always(function () {
                Collections.categories.reload();
            });
        });

        $('.js-entry-search-form').on('submit', function (event) {
            event.preventDefault();
            entries.setKeyword($form.find(':input[name="q"]').val());
            entries.setCategory($form.find(':input[name="category"]').val());
            entries.reset();
        });

        $('.js-entry-search-box-input').on('search', function () {
            var keyword = $form.find(':input[name="q"]').val();
            if (keyword !== '') {
                return;
            }

            entries.setKeyword('');
            entries.reset();
        });

        $('.js-select-all-entries').on('change', function (e) {
            if ($(e.currentTarget).is(':checked')) {
                _.each(entries.getEntries(), function (entry) {
                    entry.select();
                });
            } else {
                _.each(entries.getEntries(), function (entry) {
                    entry.unselect();
                });
            }

            _this.renderButtons();
        });
    }

    _createClass(EntriesView, [{
        key: 'render',
        value: function render() {
            var _this2 = this;

            _.each(this.entries.getReceivedEntries(), function (entry) {
                var view = new EntryView(entry);
                _this2.$entriesContainer.append(view.getElement());
            });

            if (this.entries.hasMoreEntries()) {
                this.$loadNextPage.show();
            } else {
                this.$loadNextPage.hide();
            }

            this.renderButtons();
            $(this).triggerHandler('rendered');
        }

        // enable / disabled, 
        // 
    }, {
        key: 'renderButtons',
        value: function renderButtons() {
            var $deleteButton = $('.js-delete-entries-button');
            var $categoryButton = $('.js-category-dropdown-toggle');

            var selectedEntriesCount = this.entries.getSelectedEntries().length;
            if (selectedEntriesCount > 0) {
                $deleteButton.prop('disabled', false).removeClass('disabled').addClass('btn-danger');
                $categoryButton.prop('disabled', false).removeClass('disabled');
            } else {
                $deleteButton.prop('disabled', true).addClass('disabled').removeClass('btn-danger');
                $categoryButton.prop('disabled', true).addClass('disabled');
            }
        }
    }]);

    return EntriesView;
})();

module.exports = EntriesView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Collections":256,"./EntryView":261,"js/Locale":561,"underscore":213}],259:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var parseW3CDTF = require('js/Util/parseW3CDTF');

// 1

var Entry = (function () {
    function Entry(data) {
        _classCallCheck(this, Entry);

        this.data = data;
    }

    // 

    _createClass(Entry, [{
        key: 'getUUID',
        value: function getUUID() {
            return this.data.uuid;
        }
    }, {
        key: 'getURL',
        value: function getURL() {
            return this.data.url;
        }
    }, {
        key: 'getEditURL',
        value: function getEditURL() {
            return this.data.edit_url;
        }
    }, {
        key: 'getTitle',
        value: function getTitle() {
            return this.data.title;
        }
    }, {
        key: 'getSummary',
        value: function getSummary() {
            return this.data.summary;
        }
    }, {
        key: 'getCreated',
        value: function getCreated() {
            return this.data.created;
        }
    }, {
        key: 'getCreatedTime',
        value: function getCreatedTime() {
            // epoch * 1000
            return this.getCreatedDate().getTime();
        }
    }, {
        key: 'getCreatedDate',
        value: function getCreatedDate() {
            return parseW3CDTF(this.data.created);
        }

        // datetimenull
    }, {
        key: 'getDatetime',
        value: function getDatetime() {
            return this.data.datetime;
        }
    }, {
        key: 'getDatetimeTime',
        value: function getDatetimeTime() {
            // epoch * 1000
            var date = this.getDatetimeDate();

            if (date) {
                return date.getTime();
            } else {
                return null;
            }
        }
    }, {
        key: 'getDatetimeDate',
        value: function getDatetimeDate() {
            return parseW3CDTF(this.data.datetime);
        }
    }, {
        key: 'getAuthorName',
        value: function getAuthorName() {
            return this.data.author_name;
        }
    }, {
        key: 'getCommentCount',
        value: function getCommentCount() {
            return this.data.comment_count;
        }
    }, {
        key: 'getCategories',
        value: function getCategories() {
            return this.data.categories;
        }
    }, {
        key: 'isPublic',
        value: function isPublic() {
            return this.data.is_public;
        }
    }, {
        key: 'isScheduledEntry',
        value: function isScheduledEntry() {
            return this.data.is_scheduled_entry;
        }

        // 
    }, {
        key: 'select',
        value: function select() {
            this.data.isSelected = true;
            $(this).triggerHandler('change');
        }
    }, {
        key: 'unselect',
        value: function unselect() {
            this.data.isSelected = false;
            $(this).triggerHandler('change');
        }
    }, {
        key: 'isSelected',
        value: function isSelected() {
            return this.data.isSelected;
        }

        // 
        // DB
    }, {
        key: 'remove',
        value: function remove() {
            $(this).triggerHandler('remove');
        }

        // 
    }, {
        key: 'addCategory',
        value: function addCategory(categoryName) {
            if (_.contains(this.data.categories, categoryName)) {
                return;
            }

            if (!this.data.categories) {
                this.data.categories = [];
            }

            this.data.categories.push(categoryName);
            $(this).triggerHandler('change');
        }

        // 
    }, {
        key: 'canBeManageEntry',
        value: function canBeManageEntry() {
            return this.data.can_be_manage_entry;
        }

        // token
    }, {
        key: 'canCreateDraftPreviewToken',
        value: function canCreateDraftPreviewToken() {
            return this.data.can_create_draft_preview_token;
        }
    }]);

    return Entry;
})();

module.exports = Entry;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/parseW3CDTF":583,"underscore":213}],260:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var EntryTypeTabsView = (function () {
    function EntryTypeTabsView(entries) {
        var _this = this;

        _classCallCheck(this, EntryTypeTabsView);

        this.entries = entries;
        this.$tabs = $('.js-entry-type-select-tabs');

        this.$tabs.on('click', 'a', function (event) {
            _this.clicked(event);
        });

        // permission
        var permission = this.$tabs.find('.ui-tabs-active').find('a').attr('data-permission');
        this.entries.setPermission(permission);
    }

    _createClass(EntryTypeTabsView, [{
        key: 'clicked',
        value: function clicked(event) {
            event.preventDefault();

            this.$tabs.find('.ui-tabs-active').removeClass('ui-tabs-active');
            $(event.target).parents('li').addClass('ui-tabs-active');

            var permission = $(event.target).attr('data-permission');
            if (this.entries.getPermission() === permission) {
                return;
            }

            this.entries.setPermission(permission);
            this.entries.reset();
        }
    }]);

    return EntryTypeTabsView;
})();

module.exports = EntryTypeTabsView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],261:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var Collections = require('./Collections');

var EntryView = (function () {
    function EntryView(entry) {
        var _this = this;

        _classCallCheck(this, EntryView);

        this.entry = entry;

        this.rootTemplate = _.template($('.js-entry-root-template').html().replace(/^\s*/, '').replace(/\s*$/, ''));
        this.elementTemplate = _.template($('.js-entry-inner-template').html());

        this.render();

        $(this.entry).on('change', function () {
            _this.render();
        }).on('remove', function () {
            _this.remove();
        });

        this.$element.on('change', 'input', function (e) {
            var $input = $(e.currentTarget);
            if ($input.is(':checked')) {
                _this.entry.select();
            } else {
                _this.entry.unselect();
            }

            $(_this.entry).triggerHandler('select');
        });
    }

    _createClass(EntryView, [{
        key: 'render',
        value: function render() {
            // $element$element
            if (!this.$element) {
                this.$element = $($.parseHTML(this.rootTemplate({ entry: this.entry })));
            }

            this.$element.html(this.elementTemplate({ entry: this.entry }));

            // 
            if (Collections.entries && Collections.entries.getKeyword()) {
                var escapedKeyword = _.escape(Collections.entries.getKeyword());

                this.$element.find('.js-search-entry-title').html(function (i, html) {
                    var innerHTML = '<span class="entry-search-keyword">' + escapedKeyword + '</span>';
                    return html.split(escapedKeyword).join(innerHTML);
                });

                this.$element.find('.js-search-entry-body').html(function (i, html) {
                    var innerHTML = '<span class="entry-search-keyword">' + escapedKeyword + '</span>';
                    return html.split(escapedKeyword).join(innerHTML);
                });
            }

            Locale.updateTimestamps(this.$element[0]);
        }
    }, {
        key: 'remove',
        value: function remove() {
            this.$element.remove();
        }
    }, {
        key: 'getElement',
        value: function getElement() {
            return this.$element;
        }
    }]);

    return EntryView;
})();

module.exports = EntryView;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Collections":256,"js/Locale":561,"underscore":213}],262:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

var ShareDraftBox = (function () {
    function ShareDraftBox(entriesView) {
        var _this = this;

        _classCallCheck(this, ShareDraftBox);

        // 
        this.section = $('section')[0];

        this.$shareBoxWrapper = $('.js-share-draft-box-wrapper');
        this.$shareBox = $('.js-share-draft-box');
        this.$tokenInput = this.$shareBox.find('input');
        this.$closeButton = this.$shareBox.find('.btn-close');
        this.$mask = this.$shareBoxWrapper.find('.mask');

        // URL
        this.pos = {
            top: -9999,
            left: -9999
        };

        $(entriesView).on('rendered', function () {
            _this.initEvent();
        });
    }

    _createClass(ShareDraftBox, [{
        key: 'initEvent',
        value: function initEvent() {
            var _this2 = this;

            this.$shareButton = $('.js-icon-share-draft');

            this.$shareButton.on('click', function (e) {
                var button = e.currentTarget;

                // 
                var sectionRect = _this2.section.getBoundingClientRect();
                var rect = button.getBoundingClientRect();

                _this2.setWindowPosition({
                    top: rect.bottom - sectionRect.top,
                    left: rect.right - sectionRect.left
                });

                var entryId = $(button).data('entryId');
                _this2.openShareDraftWindow(e, entryId);
                return false;
            });

            this.$closeButton.on('click', function () {
                _this2.closeShareDraftWindow();
                return false;
            });

            this.$mask.on('click', function () {
                _this2.closeShareDraftWindow();
                return false;
            });
        }
    }, {
        key: 'setWindowPosition',
        value: function setWindowPosition(pos) {
            this.pos = pos;
        }
    }, {
        key: 'openShareDraftWindow',
        value: function openShareDraftWindow(e, entryId) {
            var _this3 = this;

            var data = {
                rkm: globalData('rkm'),
                rkc: globalData('rkc'),
                entry_id: entryId
            };

            // 
            $.ajax({
                url: './share_existing_draft',
                type: 'POST',
                dataType: 'json',
                data: data
            }).done(function (res) {
                _this3.$shareBoxWrapper.addClass('visible');

                // 
                var offset = +_this3.$shareBox.css('margin').slice(0, -2);
                var over = _this3.pos.top + _this3.$shareBox[0].getBoundingClientRect().height + offset * 2 - _this3.section.offsetHeight;

                if (over > 0) {
                    _this3.pos.top -= over + 10;
                }

                _this3.$shareBox.css(_this3.pos);

                var base = globalData('blogs-uri-base');
                var previewURL = base + '/draft/' + res.token;

                _this3.$tokenInput.val(previewURL).focus().select();
            }).fail(function () {
                console.log('ajax error!!');
            });
        }
    }, {
        key: 'closeShareDraftWindow',
        value: function closeShareDraftWindow() {
            this.$shareBoxWrapper.removeClass('visible');
        }
    }]);

    return ShareDraftBox;
})();

module.exports = ShareDraftBox;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],263:[function(require,module,exports){
'use strict';

var ProgressWatcher = require('./ProgressWatcher');

var ProgressBar = {

    /**
     * @param {jQuery} $bar          - 
     * @param {string} apiUrl        - API
     * @param {string} onCompleteUrl - URL
     */
    init: function init($bar, apiUrl, onCompleteUrl) {
        // 
        var watcher = new ProgressWatcher(apiUrl);

        watcher.on('progress', function (progress) {
            $bar.css('width', progress + '%');
        });

        watcher.on('complete', function () {
            setTimeout(function () {
                location.href = onCompleteUrl;
            }, 1500);
        });
    }

};

module.exports = ProgressBar;

},{"./ProgressWatcher":264}],264:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var EventEmitter = require('events').EventEmitter;

/**
 * API
 * 
 */

var ProgressWatcher = (function (_EventEmitter) {
    _inherits(ProgressWatcher, _EventEmitter);

    /**
     * @param {string} api_url - URL
     */

    function ProgressWatcher(url) {
        _classCallCheck(this, ProgressWatcher);

        _get(Object.getPrototypeOf(ProgressWatcher.prototype), 'constructor', this).call(this);
        this.url = url;

        this.checkProgress();
    }

    /**
     * API
     */

    _createClass(ProgressWatcher, [{
        key: 'checkProgress',
        value: function checkProgress() {
            var _this = this;

            $.ajax({
                url: this.url,
                type: 'GET',
                cache: false,
                dataType: 'json'
            }).done(function (res) {
                _this.handleResponse(res);
            });
        }

        /**
         * APIresponse
         * @param {string} res.status   - started|new|complete|failed
         * @param {number} res.progress - 0~100
         */
    }, {
        key: 'handleResponse',
        value: function handleResponse(res) {
            var _this2 = this;

            if (res.progress) {
                this.emit('progress', res.progress);
            }

            if (res.status === 'complete' || res.status === 'failed') {
                this.emit('complete');
            }
            if (res.status === 'started' || res.status === 'new') {
                setTimeout(function () {
                    return _this2.checkProgress();
                }, 1000);
            }
        }
    }]);

    return ProgressWatcher;
})(EventEmitter);

module.exports = ProgressWatcher;

},{"events":207}],265:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var globalData = require('js/Base/globalData');
var extend = require('js/Util/extend');

var Refusal = {

    init: function init() {

        var RefusedUser = function RefusedUser(name) {
            if (name.length < 2) throw "invalid name";
            this.name = name;
        };
        RefusedUser.prototype = {
            getName: function getName() {
                return this.name;
            },
            getProfileImage: function getProfileImage() {
                return 'http://cdn1.www.st-hatena.com/users/' + this.getName().substr(0, 2) + '/' + this.getName() + '/profile.gif';
            },
            getURL: function getURL() {
                return 'http://profile.hatena.ne.jp/' + this.getName() + '/';
            },
            getHatenaID: function getHatenaID() {
                return 'id:' + this.getName();
            },
            equals: function equals(user) {
                return this.name === user.name;
            }
        };
        RefusedUser.loadUserNames = function (userNames) {
            return _.map(userNames, function (name) {
                return new RefusedUser(name);
            });
        };

        var RefusalManager = function RefusalManager() {
            this.init.apply(this, arguments);
        };
        RefusalManager.prototype = {
            init: function init() {
                this.refusals = [];
            },
            load: function load(refusals) {
                this.refusals = refusals;
                $(this).trigger('refusalsChanged');
            },
            add: function add(refusal) {
                var self = this;
                if (self.isRefused(refusal)) return;

                var refusals = self.refusals.concat(refusal);
                this._save(refusals).done(function () {
                    $(self).trigger('refusalAdded');
                }).fail(function () {
                    $(self).trigger('refusalSaveFailed');
                });
            },
            remove: function remove(refusal) {
                var self = this;
                if (!self.isRefused(refusal)) return;

                var refusals = _.reject(self.refusals, function (target) {
                    return self.isEqual(refusal, target);
                });
                this._save(refusals).done(function () {
                    $(self).trigger('refusalRemoved');
                }).fail(function () {
                    $(self).trigger('refusalSaveFailed');
                });
            },
            isEqual: function isEqual(refusal, other) {
                return refusal === other;
            },
            isRefused: function isRefused(refusal) {
                var self = this;
                return _.find(this.refusals, function (target) {
                    return self.isEqual(refusal, target);
                });
            },
            getRefusals: function getRefusals() {
                return this.refusals;
            },
            _save_url: 'specify this',
            _getSaveParams: function _getSaveParams(refusals) {
                throw new Error('implement this');
            },
            _save: function _save(refusals) {
                var self = this;
                var saved = $.Deferred();
                $.ajax({
                    url: self._save_url,
                    type: 'POST',
                    data: _.extend(self._getSaveParams(refusals), {
                        rkm: globalData('rkm'),
                        rkc: globalData('rkc')
                    }),
                    traditional: true,
                    dataType: 'json'
                }).done(function () {
                    self.refusals = refusals;
                    $(self).trigger('refusalsChanged');
                    saved.resolve();
                }).fail(function () {
                    saved.reject();
                });
                return saved;
            }
        };

        var UserRefusalManager = function UserRefusalManager() {
            this.init.apply(this, arguments);
        };
        UserRefusalManager.prototype = {
            getUserNames: function getUserNames() {
                return _.map(this.refusals, function (user) {
                    return user.getName();
                });
            },
            isEqual: function isEqual(user, other) {
                return user.equals(other);
            },
            _save_url: '/-/refusal/save',
            _getSaveParams: function _getSaveParams(users) {
                return {
                    user_names: _.map(users, function (user) {
                        return user.getName();
                    })
                };
            }
        };
        extend(UserRefusalManager.prototype, RefusalManager.prototype);

        var IpRefusalManager = function IpRefusalManager() {
            this.init.apply(this, arguments);
        };
        IpRefusalManager.prototype = {
            _save_url: '/-/refusal/save_refused_ips',
            _getSaveParams: function _getSaveParams(ips) {
                return { ips: ips };
            }
        };
        extend(IpRefusalManager.prototype, RefusalManager.prototype);

        var RefusalManagerView = function RefusalManagerView($container, $alertContainer) {
            this.$refusalsContainer = $container.find('.js-refusals-container');
            this.refusalsTemplate = _.template($container.find('.js-refusals-template').html());
            this.$alertAdded = $alertContainer.find('.js-alert-added');
            this.$alertRemoved = $alertContainer.find('.js-alert-removed');
            this.$alertNotFound = $alertContainer.find('.js-alert-not-found');
        };
        RefusalManagerView.prototype = {
            onChanged: function onChanged(manager) {
                this.$refusalsContainer.html(this.refusalsTemplate({ refusals: manager.getRefusals() }));
            },
            onAdded: function onAdded(manager) {
                this.showAlert(this.$alertAdded);
            },
            onRemoved: function onRemoved(manager) {
                this.showAlert(this.$alertRemoved);
            },
            onNotFound: function onNotFound(manager) {
                this.showAlert(this.$alertNotFound);
            },
            showAlert: function showAlert($alert) {
                _.each([this.$alertAdded, this.$alertRemoved, this.$alertNotFound], function ($elem) {
                    $elem.hide();
                });
                $alert.show();
                setTimeout(function () {
                    $alert.fadeOut('slow');
                }, 3000);
            }
        };

        var user_manager = new UserRefusalManager();
        var ip_manager = new IpRefusalManager();
        var user_manager_view = new RefusalManagerView($('.js-refuse-users'), $('.js-refuse-users-alert-wrapper'));
        var ip_manager_view = new RefusalManagerView($('.js-refuse-ips'), $('.js-refuse-ips-alert-wrapper'));

        $(user_manager).on('refusalsChanged', function () {
            user_manager_view.onChanged(this);
        }).on('refusalAdded', function () {
            user_manager_view.onAdded(this);
        }).on('refusalRemoved', function () {
            user_manager_view.onRemoved(this);
        }).on('refusalSaveFailed', function () {
            user_manager_view.onNotFound(this);
        });

        $(ip_manager).on('refusalsChanged', function () {
            ip_manager_view.onChanged(this);
        }).on('refusalAdded', function () {
            ip_manager_view.onAdded(this);
        }).on('refusalRemoved', function () {
            ip_manager_view.onRemoved(this);
        }).on('refusalSaveFailed', function () {
            ip_manager_view.onNotFound(this);
        });

        // 
        var userNames = $('.js-refused-users-container').data('user-names');
        if (userNames.length > 0) {
            var users = RefusedUser.loadUserNames(userNames.split(','));
            user_manager.load(users);
        }

        var ips = $('.js-refused-ips-container').data('ips');
        if (ips.length > 0) {
            ip_manager.load(ips.split(','));
        }

        var isLikeIpAddress = function isLikeIpAddress(target) {
            // ipv6
            return (/^(\d{1,3}(\.\d{1,3}){3})|([0-9a-fA-F]{1,4}(:[0-9a-fA-F]{1,4})+)$/.test(target)
            );
        };

        // 
        $('.js-refuse-users').on('submit', function (event) {
            event.preventDefault();
            var $input = $('input[name="refusal_input"]');
            var name = $input.val();

            // IP':' '.', ID
            if (isLikeIpAddress(name)) {
                ip_manager.add(name);
            } else {
                var user;
                try {
                    user = new RefusedUser(name);
                } catch (ignore) {}
                if (user) user_manager.add(user);
            }
            $input.val('').focus();
            return false;
        });

        // 
        $('.js-refuse-users').on('click', '.js-delete-refused-user', function () {
            var name = $(this).closest('.refused-user').data('user-name');
            user_manager.remove(new RefusedUser(name));
        });

        $('.js-refuse-ips').on('click', '.js-delete-refusal', function () {
            var ip = $(this).closest('.refused-ip').data('ip');
            ip_manager.remove(ip);
        });
    }
};

module.exports = Refusal;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/Util/extend":574,"underscore":213}],266:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var positionToString = require('js/Util/positionToString');
var waitForResource = require('js/Util/waitForResource');

// 
var SocializeBox = {
    setup: function setup(entry_id) {
        var self = this;

        self.entry_id = entry_id;

        // 
        self.saveExternalAuthorizeConfig();

        // 
        self.setupExternalAuthLink();
    },
    setupExternalAuthLink: function setupExternalAuthLink() {
        var self = this;

        // Bwindow
        var external_auth_href = $('html').attr('data-admin-domain') + "/-/config/external?with_parent_window=1";
        $(document).on('click', '[data-open-external-auth-link=1]', function (e) {
            e.preventDefault();

            var options = { width: 900, height: 600, scrollbars: 'yes' };
            options.left = Math.floor((screen.width - options.width) / 2);
            options.top = Math.floor((screen.height - options.height) / 2);
            var external_auth_window = window.open(external_auth_href, 'external_auth', positionToString(options));

            // window
            // 
            waitForResource(function () {
                return external_auth_window.closed;
            }, function () {
                var $modal = $('.js-socialize-modal');
                // modal
                if ($modal.length > 0) {
                    $modal.hide();
                    $('.modal-window-background').fadeOut('fast');
                }

                // 
                self.getExternalAuthStatus().done(function (html) {
                    // 
                    self.saveExternalAuthorizeConfig();

                    self.refreshSocializeBox(html);

                    var isAuthorized = self.isExternalAuthorizeFinished();
                    if (isAuthorized) {
                        // 
                        var $external_auth_message = $('.js-socialize-box .js-external-auth-message');
                        var $external_auth_finish_message = $('.js-socialize-box .js-external-auth-finish-message');
                        $external_auth_message.hide();
                        $external_auth_finish_message.show();
                    }
                });
            });

            return false;
        });
    },
    refreshSocializeBox: function refreshSocializeBox(html) {
        $('.js-refresh-socialize-box').empty().html(html);
    },
    saveExternalAuthorizeConfig: function saveExternalAuthorizeConfig() {
        // 
        // 
        this.externalAuthorizeConfig = {
            twitter: $('.js-authenticated-twitter').size() == 1,
            facebook: $('.js-authenticated-facebook').size() == 1,
            mixi: $('.js-authenticated-mixi').size() == 1
        };
    },
    // true
    isExternalAuthorizeFinished: function isExternalAuthorizeFinished() {
        var config = this.externalAuthorizeConfig;

        return config.twitter === false && $('.js-authenticated-twitter').size() == 1 || config.facebook === false && $('.js-authenticated-facebook').size() == 1 || config.mixi === false && $('.js-authenticated-mixi').size() == 1;
    },
    // 
    getExternalAuthStatus: function getExternalAuthStatus() {
        var dfd = $.Deferred();
        $.ajax({
            url: 'socialize_box',
            type: 'GET',
            dataType: 'html',
            data: { entry_id: this.entry_id }
        }).done(function (data) {
            dfd.resolve(data);
        }).fail(function () {
            dfd.reject();
        });

        return dfd.promise();
    }
};

module.exports = SocializeBox;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/positionToString":584,"js/Util/waitForResource":592}],267:[function(require,module,exports){
(function (global){
Object.defineProperty(exports, '__esModule', {
    value: true
});

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

exports.attachSubscriptionConfig = attachSubscriptionConfig;

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var _require = require('underscore');

var bind = _require.bind;
var noop = _require.noop;

var globalData = require('js/Base/globalData');

var _require2 = require('js/Base/Logger');

var BUG = _require2.BUG;

// containerSelector: 

function attachSubscriptionConfig(observer, containerSelector) {
    $(observer).on('click', containerSelector, function (event) {
        var $current = $(event.currentTarget);

        if (UnsubscribeButton.shouldHandle(event, $current)) {
            var btn = UnsubscribeButton.newFromContainer($current);
            btn.unsubscribe().then(function () {
                $current.hide();
            }, noop);
        } else if (SubscriptionConfigDropdown.shouldHandle(event, $current)) {
            var dropdown = SubscriptionConfigDropdown.newFromContainer($current);
            dropdown.toggle();
        }
    });
    $(observer).on('click', function (event) {
        var containers = $('.js-subscription-config-dropdown-container').get();
        var clickFromOutside = containers.every(function (c) {
            return !$.contains(c, event.target);
        });
        if (clickFromOutside) {
            SubscriptionConfigDropdown.visibleDropdowns().addClass('is-hidden');
        }
    });
}

/**
 * 
 *  HTML :
 *
 * <E class="js-subscription-config-dropdown-container">
 *   <F class="js-subscription-config-dropdown-btn">...</F>
 *   <G class="js-subscription-config-dropdown-content">...</G>
 * </E>
 */

var SubscriptionConfigDropdown = (function () {
    _createClass(SubscriptionConfigDropdown, null, [{
        key: 'shouldHandle',
        value: function shouldHandle(event, $current) {
            var toggleButton = $current.find('.js-subscription-config-dropdown-btn');
            var identical = $(event.target).is(toggleButton); // Firefox  target  button
            var contained = $.contains(toggleButton.get(0), event.target); // Chrome  target  i 
            return identical || contained;
        }
    }, {
        key: 'visibleDropdowns',
        value: function visibleDropdowns() {
            return $('.js-subscription-config-dropdown-content:not(.is-hidden)');
        }
    }, {
        key: 'newFromContainer',
        value: function newFromContainer($container) {
            var $button = $container.find('.js-subscription-config-dropdown-btn');
            var $content = $container.find('.js-subscription-config-dropdown-content');
            var dropdown = new SubscriptionConfigDropdown($button, $content);
            return dropdown;
        }
    }]);

    function SubscriptionConfigDropdown($button, $content) {
        _classCallCheck(this, SubscriptionConfigDropdown);

        this.$button = $button;this.$content = $content;
    }

    _createClass(SubscriptionConfigDropdown, [{
        key: 'toggle',
        value: function toggle() {
            this.$content.toggleClass('is-hidden');
        }
    }]);

    return SubscriptionConfigDropdown;
})();

var RejectionAnswer = (function (_Error) {
    _inherits(RejectionAnswer, _Error);

    function RejectionAnswer() {
        _classCallCheck(this, RejectionAnswer);

        _get(Object.getPrototypeOf(RejectionAnswer.prototype), 'constructor', this).apply(this, arguments);
    }

    /**
     * 
     *  HTML :
     *
     *   <E class="js-unsubscribe-btn" data-completion-msg="..." data-confirm-msg="..." data-blog-uri="..."></E>
     */
    return RejectionAnswer;
})(Error);

var UnsubscribeButton = (function () {
    _createClass(UnsubscribeButton, null, [{
        key: 'shouldHandle',
        value: function shouldHandle(event, $current) {
            return $(event.target).is('.js-unsubscribe-btn');
        }
    }, {
        key: 'newFromContainer',
        value: function newFromContainer($container) {
            var $button = $container.find('.js-unsubscribe-btn');
            var unsubscribeButton = new UnsubscribeButton($button.get(0));
            return unsubscribeButton;
        }
    }]);

    function UnsubscribeButton(el) {
        _classCallCheck(this, UnsubscribeButton);

        this._$el = $(el);
    }

    _createClass(UnsubscribeButton, [{
        key: 'unsubscribe',
        value: function unsubscribe() {
            var _this = this;

            if (!this.confirmed()) {
                return Promise.reject(new RejectionAnswer());
            }
            var ops = [this.toggleState, this.requestUnsubscribe, this.notifyCompletion].map(function (op) {
                return bind(op, _this);
            });
            return ops.reduce(function (p, f) {
                return p.then(f);
            }, Promise.resolve())['catch'](this.onFailure.bind(this));
        }
    }, {
        key: 'onFailure',
        value: function onFailure(error) {
            this.toggleState();
            BUG(error, 'UnsubscribeButton');
        }
    }, {
        key: 'confirmed',
        value: function confirmed() {
            return window.confirm(this.confirmingMessage);
        }
    }, {
        key: 'toggleState',
        value: function toggleState() {
            this._$el.prop('disabled', !this._$el.prop('disabled'));
            this._$el.toggleClass('disabled');
        }
    }, {
        key: 'requestUnsubscribe',
        value: function requestUnsubscribe() {
            return $.ajax({
                type: 'POST',
                url: '/api/1/json/unsubscribe',
                data: {
                    uri: this.blogUri,
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                }
            });
        }
    }, {
        key: 'notifyCompletion',
        value: function notifyCompletion() {
            alert(this.completionMessage);
        }
    }, {
        key: 'blogUri',
        get: function get() {
            return this._$el.attr('data-blog-uri');
        }
    }, {
        key: 'confirmingMessage',
        get: function get() {
            return this._$el.attr('data-confirm-msg');
        }
    }, {
        key: 'completionMessage',
        get: function get() {
            return this._$el.attr('data-completion-msg');
        }
    }]);

    return UnsubscribeButton;
})();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Logger":293,"js/Base/globalData":302,"underscore":213}],268:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var AndroidAppBanner = {

    init: function init() {
        // Android

        var self = this;

        var $banner = $('#android-app-banner');

        if ($banner.length === 0) {
            return;
        }
        var $closeButton = $('#android-app-banner-close');

        $closeButton.click(function (e) {
            $banner.slideToggle(400);
            self.setDismiss(true);
        });

        if (!self.isDismissed()) {
            setTimeout(function () {
                $banner.slideToggle(400);
            }, 0);
        }
    },

    _localStorageKey: 'Hatena.Diary.Pages.AdminTouch.dismissAndroidAppBanner',

    _localStorageEnabled: function _localStorageEnabled() {
        try {
            if (window.localStorage) {
                return true;
            }
        } catch (ignore) {}
        return false;
    },

    isDismissed: function isDismissed() {
        // 
        var self = this;
        if (self._localStorageEnabled()) {
            return localStorage.getItem(self._localStorageKey) === 'true';
        }
        return false;
    },

    setDismiss: function setDismiss(dismissed) {
        // 
        var self = this;
        if (self._localStorageEnabled()) {
            localStorage.setItem(self._localStorageKey, dismissed ? 'true' : 'false');
        }
    }

};

module.exports = AndroidAppBanner;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],269:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');

// from editor/editor.js
var ColorPicker = {
    show: function show(position, callback) {
        var container = ColorPicker.container;
        if (!container) {
            container = $('<div class="hatena-diary-color-picker" tabindex="0"><a href="#" class="color-chip default" data-color="">' + Locale.text('default') + '</a></div>').appendTo(document.body).hide();
            container.delegate('.color-chip', 'click', function () {
                var color = $(this).attr('data-color');
                container.trigger('colorpick', color);
                container.hide();
                return false;
            });

            var padding = 8;
            var size = 30;

            var colors = [['#ffffff', '#cccccc', '#999999', '#666666', '#333333', '#000000'], ['#cc0000', '#cc00cc', '#0000cc', '#00cccc', '#00cc00', '#cccc00'], ['#990000', '#990099', '#000099', '#009999', '#008800', '#aaaa00'], ['#660000', '#660066', '#000066', '#006666', '#006600', '#666600'], ['#330000', '#330033', '#000033', '#003333', '#003300', '#333300']];

            container.css({
                width: colors[0].length * (size + padding) + padding,
                height: (colors.length + 1) * (size + padding) + padding
            });

            var defcol = container.find("a").css({
                top: padding,
                left: padding,
                height: size,
                width: container.width() - padding * 2
            });

            var chip = $('<a href="#" class="color-chip"></a>');
            for (var i = 0, it; it = colors[i]; i++) {
                for (var j = 0, col; col = it[j]; j++) {
                    chip.clone().attr('data-color', col).css({
                        top: (i + 1) * (size + padding) + padding,
                        left: j * (size + padding) + padding,
                        background: col,
                        width: size,
                        height: size
                    }).appendTo(container);
                }
            }

            ColorPicker.container = container;
        }

        container.unbind('colorpick');
        container.bind('colorpick', callback);

        container.css(position);
        container.fadeIn('fast');

        container.focus();
        $(container).one('blur', function () {
            container.hide();
        });
    }
};

module.exports = ColorPicker;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],270:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var EventTracker = require('js/Base/EventTracker');
var uploadImage = require('./uploadImage');

var Uploader = {

    init: function init(callback) {
        var can_upload_file = function can_upload_file() {
            // http://stackoverflow.com/questions/8077955/detect-if-input-type-file-is-supported
            var elem = document.createElement('input');
            elem.type = 'file';
            return !elem.disabled;
        };
        if (!can_upload_file()) return;

        var $container = $('.toolbar-container');
        $container.show();

        var can_use_form_data = typeof FormData != 'undefined';

        if (can_use_form_data) {
            Uploader.setupAjaxUpload(callback);
        } else {
            Uploader.setupIframeUpload(callback);
        }
    },

    setupAjaxUpload: function setupAjaxUpload(callback) {
        var $container = $('.toolbar-container');
        var $file_input = $container.find('input[type=file]');

        $file_input.change(function () {
            if (!this.files.length > 0) return;
            uploadImage({
                $input: $file_input,
                $progress: $container.find('.progress')
            }).done(callback).fail(function (res) {
                alert(Locale.text('admin.blog.config.image_upload_failure'));
            });
            EventTracker.trackEvent('upload-photo-smartphone');
        });
    },

    setupIframeUpload: function setupIframeUpload(callback) {
        var $container = $('.toolbar-container');
        var $file_input = $container.find('input[type=file]');

        $container.addClass('iframe-uploader');

        Uploader.setIframeUploader({
            fileinput: $container.find('.file-container'),
            fotosize: 1024,
            callback: callback
        });
    },

    // admin.js(callback)
    setIframeUploader: function setIframeUploader(args) {
        var fileinput = args.fileinput;
        var fotosize = args.fotosize;
        var callback = args.callback;

        var iframe = $('<iframe/>');
        fileinput.replaceWith(iframe);
        var src = "/api/upload/fotolife_smart";
        iframe.attr('src', src);
        iframe.addClass('uploader');
        iframe.load(function () {
            var document;
            if (iframe[0].contentDocument) {
                document = iframe[0].contentDocument;
            } else if (iframe[0].contentWindow) {
                document = iframe[0].contentWindow.document;
            } else {
                return;
            }
            if (document.body.innerHTML.match(/^\s*(f:id:\S+)/)) {
                iframe[0].contentWindow.location.replace(src);
            }
            if (document.body.innerHTML.match(/f:id:([^:]+):(\d+)([jpg]):image/)) {
                callback(document.body.innerHTML);
            }

            $(document).find('input[name="fotosize"]').val(fotosize);
            var images = $(document).find('input[type="file"]');
            $(images[0]).change(function () {
                $(document).find('#fotolife-upload-form').submit();
                $(images[0]).replaceWith($('<h5>').text(Locale.text('uploading')));
            });
        });
    }

};

module.exports = Uploader;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./uploadImage":274,"js/Base/EventTracker":284,"js/Locale":561}],271:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var canUseWysiwyg = function canUseWysiwyg() {
    var $editEntry = $('#edit-entry');

    // Android 
    // (Opera Mobile  contentEditable )
    var ua = navigator.userAgent;
    var isMobileSafari = /\b(?:iPhone|iPad)\b/.exec(ua) && /\bVersion\/(\d+\.\d+)/.exec(ua) && Number(RegExp.$1) >= 5.1;
    var isAndroidChrome = /\bAndroid\b/.exec(ua) && /\bChrome\b/.exec(ua);
    return $editEntry.attr('data-entry-syntax') === 'html' && 'contentEditable' in document.body && (isMobileSafari || isAndroidChrome);
};

module.exports = canUseWysiwyg;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],272:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var insertText = function insertText(text) {
    if ($('iframe#entry-html-body').length > 0) {
        insertText.contentEditable(text);
    } else if (navigator.userAgent.match(/3DS/)) {
        insertText.textarea3DS(text);
    } else {
        insertText.textarea(text);
    }
};

insertText.textarea = function (text) {
    var $textarea = $('textarea#entry-body');
    var textarea = $textarea[0];
    var val = $textarea.val();

    var range = {
        start: textarea.selectionStart,
        end: textarea.selectionEnd
    };

    $textarea.val(val.substring(0, range.start) + text + val.substring(range.end));
};

insertText.textarea3DS = function (text) {
    // 3DSselectionStart

    var $textarea = $('textarea#entry-body');
    var val = $textarea.val();

    var lastChar = val[val.length - 1];
    var middle = '';
    if (lastChar === "\n" || lastChar === undefined) {
        // do nothing
    } else {
            middle = "\n";
        }

    $textarea.val(val + middle + text + "\n");
};

insertText.contentEditable = function (text) {
    // : focusexecCommand
    var contentDocument = $('#entry-html-body').prop('contentDocument');
    contentDocument.body.focus();
    contentDocument.execCommand('insertHTML', false, text);
};

module.exports = insertText;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],273:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var setupDateTimeEditor = function setupDateTimeEditor() {
    $('.post-options .js-datetime').show();

    var $date = $('.js-datetime-input-date');
    var $time = $('.js-datetime-input-time');
    var $datetime = $('input[name=datetime]');

    // ,changeJSdatetimechange
    var setDatetime = function setDatetime(value) {
        $datetime.val(value).trigger('change');
    };

    // admin-user-blog-edit.js
    var todayString = function todayString() {
        var now = new Date();
        var date = [];
        date.push((1900 + now.getYear()).toString());
        date.push(('0' + (1 + now.getMonth()).toString()).slice(-2));
        date.push(('0' + now.getDate().toString()).slice(-2));
        return date.join('-');
    };

    // (), 
    var entry_datetime = $datetime.val() || '';
    var match_data = entry_datetime.match(/^(\d{4}-\d{2}-\d{2})T(\d{2}:\d{2}:\d{2})\+(\d{2}:\d{2})$/);
    if (match_data) {
        var date = match_data[1];
        var time = match_data[2];

        $date.val(date);
        $time.val(time);
    }

    $date.change(function () {
        var date = $date.val();
        var time = $time.val();

        // , 
        if (!date) {
            setDatetime(entry_datetime);
            return;
        }

        if (!time) {
            $time.val('00:00');
            time = '00:00';
        }

        setDatetime(date + 'T' + time);
    });

    $time.change(function () {
        var date = $date.val();
        var time = $time.val();

        // , 
        if (!time) {
            setDatetime(entry_datetime);
            return;
        }

        if (!date) {
            var today = todayString();
            $date.val(today);
            date = today;
        }

        setDatetime(date + 'T' + time);
    });
};

module.exports = setupDateTimeEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],274:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var globalData = require('js/Base/globalData');

// admin.js
var uploadImage = function uploadImage(args) {
    var folder = args.folder || "Hatena Blog";
    var fotosize = args.fotosize || 1024;
    var $input = args.$input;
    var image = $input.prop('files')[0];
    var $progress = args.$progress;

    var dfd = $.Deferred();

    $input.prop('disabled', true);

    var data = new FormData();
    data.append('rkm', globalData('rkm'));
    data.append('append', 1);
    data.append('fototitle', "");
    data.append('folder', folder);
    data.append('fotosize', fotosize);
    data.append('image', image);
    data.append('delete-gps', 1);

    $progress.show();
    var $bar = $progress.find('.bar');
    $bar.width('0%');
    var $percent = $progress.find('.percent');
    var updateProgress = function updateProgress(percent) {
        if (percent > 100) percent = 100;
        $bar.width(percent + '%');
        $percent.text(Locale.text('uploading'));
    };

    var xhr = new XMLHttpRequest();

    xhr.upload.addEventListener("progress", function (e) {
        var percent = e.lengthComputable ? e.loaded / e.total * 100 : NaN;
        updateProgress(percent);
    }, false);

    xhr.addEventListener("load", function (e) {
        updateProgress(100);
        $progress.hide();
        $input.prop('disabled', false);

        if (xhr.status !== 200) {
            dfd.reject(xhr.responseText);
            return;
        }

        var fotolife_syntax = xhr.responseText;
        dfd.resolve(fotolife_syntax);
    }, false);

    xhr.addEventListener("error", function (e) {
        $progress.hide();
        $input.prop('disabled', false);
        dfd.reject(e);
    }, false);

    xhr.open("POST", "/f/" + globalData('name') + "/upbysmart?dummy=" + new Date().getTime());
    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
    xhr.send(data);

    return dfd;
};

module.exports = uploadImage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/Locale":561}],275:[function(require,module,exports){
'use strict';

var validationTweetLength = require('js/Base/validateTweetLength');

/**
 * touch, twitter
 * TODO ES6 Class
 * : #10058
 */
var TwitterValidator = function TwitterValidator() {
    this.init.apply(this, arguments);
};
TwitterValidator.prototype = {
    init: function init($el) {
        this.$el = $el;
        this.$textarea = $el.find('textarea');
        this.$errorMessage = $el.find('.js-twitter-length-error');
        this.$checkBox = $el.find('input[name="post_to_twitter"]');
        this.$shareButton = $el.find('.js-touch-share-button');
        this.bindEvents();
    },
    bindEvents: function bindEvents() {
        var self = this;
        self.$textarea.keyup(function () {
            if (validationTweetLength(self.$textarea.val()) === false) {
                self.showErrorMessage();
                self.disabledCheckBox();
                self.disabledShareButton();
            } else {
                self.hideErrorMessage();
                self.enabledCheckBox();
                self.enabledShareButton();
            }
        });
    },
    hideErrorMessage: function hideErrorMessage() {
        this.$errorMessage.hide();
    },
    showErrorMessage: function showErrorMessage() {
        this.$errorMessage.show();
    },
    disabledCheckBox: function disabledCheckBox() {
        this.$checkBox.attr('disabled', true);
    },
    enabledCheckBox: function enabledCheckBox() {
        this.$checkBox.attr('disabled', false);
    },
    disabledShareButton: function disabledShareButton() {
        this.$shareButton.attr('disabled', true);
    },
    enabledShareButton: function enabledShareButton() {
        this.$shareButton.attr('disabled', false);
    }
};

module.exports = TwitterValidator;

},{"js/Base/validateTweetLength":307}],276:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

// 
var AppAPI = {

    _setup: function _setup() {
        if (this._reloadStarImplement) return;

        // 11
        this._reloadStarImplement = _.throttle(function () {
            // 
            var $body = $(document.body);
            var $starContainer = $body.find('span.hatena-star-comment-container, span.hatena-star-star-container');

            if ($starContainer.length > 0) {
                $starContainer.remove();
                Hatena.Star.EntryLoader.loadNewEntries($body[0]);
            }
        }, 1000);
    },

    reloadStar: function reloadStar() {
        this._setup();
        this._reloadStarImplement();
    }

};

module.exports = AppAPI;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],277:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * API
 */
var AccessLogger = {
    ping: function ping() {
        var adminDomain = $('html').attr('data-admin-domain');
        if (!adminDomain) return;

        var url = adminDomain + '/api/log';
        var data = {
            uri: location.href,
            referer: document.referrer
        };
        $.ajax({
            url: url,
            type: "get",
            cache: false,
            data: data,
            xhrFields: {
                withCredentials: true
            }
        }).fail(function (e) {
            data._ = new Date().getTime();
            new Image().src = url + '?' + $.param(data);
        });
    }
};

module.exports = AccessLogger;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],278:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var match = function match(str) {
    return navigator.userAgent.indexOf(str) !== -1;
};

// https://github.com/wakaba/opentenjs/blob/master/src/Ten.base.js
var Browser = {
    isIE: match('MSIE') || match('Trident/'),
    isIE6: match('MSIE 6.'),
    isIE7: match('MSIE 7.'),
    isIE8: match('MSIE 8.'),
    isIE9: match('MSIE 9.'),
    isIE10: match('MSIE 10.'),
    isIE11: match('Trident/') && match('rv:11.'),
    isMozilla: match('Mozilla') && !match('compatible') && !match('WebKit'),
    isOpera: !!window.opera,
    isSafari: match('WebKit') && match('Chrome/'),
    isChrome: match('Chrome/'),
    isFirefox: match('Firefox/'),
    isDSi: match('Nintendo DSi'),
    is3DS: match('Nintendo 3DS'),
    isWii: match('Nintendo Wii'),
    isAndroid: match('Android'),
    isAndroidMobile: match('Android') && match('Mobile'),
    isAndroidTablet: match('Android') && !match('Mobile'),
    isIPhone: match('iPod;') || match('iPhone;') || match('iPhone Simulator;'),
    isWindowsPhone: match('Windows Phone'),
    isIPad: match('iPad'),
    isSupportsXPath: !!document.evaluate,
    version: {
        string: (/(?:Firefox\/|MSIE |Opera\/|Chrome\/|Version\/)([\d.]+)/.exec(navigator.userAgent) || []).pop(),
        valueOf: function valueOf() {
            return parseFloat(this.string);
        },
        toString: function toString() {
            return this.string;
        }
    }
};
Browser.isTouch = Browser.isIPhone || Browser.isAndroidMobile || Browser.isDSi || Browser.is3DS || Browser.isWindowsPhone;
Browser.isSmartPhone = Browser.isIPhone || Browser.isAndroidMobile || Browser.isWindowsPhone;
Browser.isTablet = Browser.isAndroidTablet || Browser.isIPad;

// 
Browser.isObsolete = Browser.isIE6 || Browser.isIE7 || Browser.isIE8;

//  Pages.Blogs['*'].init  resolve
// true
// XXX 
Browser.thirdPartyCookiesBlocked = $.Deferred();

module.exports = Browser;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],279:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('./globalData');

var Circle = {
    updateMembershipCategory: function updateMembershipCategory($select) {
        var circleId = $select.attr('data-circle-id');
        var blogId = $select.attr('data-blog-id');
        var selection = $select.find('option:selected').val();

        var operation, categoryId;
        if (selection === 'delete') {
            operation = 'delete';
        } else {
            operation = 'update';
            categoryId = selection;
        }

        return $.ajax({
            url: '/api/circle/membership/category',
            type: 'POST',
            data: {
                rkm: globalData('rkm'),
                rkc: globalData('rkc'),
                operation: operation,
                circle_id: circleId,
                blog_id: blogId,
                category_id: categoryId
            }
        });
    }
};

module.exports = Circle;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./globalData":302}],280:[function(require,module,exports){
'use strict';

var Browser = require('./Browser');

var Devices = {

    // PC
    // - PC
    // - touchcookie, UA
    use: function use(device) {
        if (this.userAgent() == device) {
            document.cookie = 'device=' + encodeURIComponent(device) + '; expires=' + new Date(0).toUTCString() + '; path=/';
        } else {
            var expires = new Date();
            expires.setFullYear(expires.getFullYear() + 1);
            document.cookie = 'device=' + encodeURIComponent(device) + '; expires=' + expires.toUTCString() + '; path=/';
        }
        location.reload();
    },

    userAgent: function userAgent() {
        // admin
        if (Browser.isTouch) {
            return 'touch';
        } else {
            return 'pc';
        }
    }

};

module.exports = Devices;

},{"./Browser":278}],281:[function(require,module,exports){
'use strict';

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var EventEmitter = require('events').EventEmitter;

var Dispatcher = new EventEmitter();

Dispatcher.on('__DISPATCH__', function (action) {
    Dispatcher.emit(action.type, action.payload);
});

// Define Actions class bound with Dispatcher

var Actions = (function () {
    function Actions() {
        _classCallCheck(this, Actions);
    }

    _createClass(Actions, [{
        key: 'emit',
        value: function emit(actionType, payload) {
            Dispatcher.emit('__DISPATCH__', {
                type: actionType,
                payload: payload
            });
        }
    }]);

    return Actions;
})();

var Store = (function (_EventEmitter) {
    _inherits(Store, _EventEmitter);

    function Store() {
        _classCallCheck(this, Store);

        _get(Object.getPrototypeOf(Store.prototype), 'constructor', this).call(this);
        this.state = {};
    }

    _createClass(Store, [{
        key: 'getState',
        value: function getState() {
            return this.state;
        }
    }]);

    return Store;
})(EventEmitter);

Dispatcher.Actions = Actions;
Dispatcher.Store = Store;

module.exports = Dispatcher;

},{"events":207}],282:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Logger = require('./Logger');
var globalData = require('./globalData');
var Window = require('./Window');
var Messenger = require('js/Messenger');

var DROPDOWN_ID = 'hatena-diary-dropdown';

var Dropdown = {
    /*
     * options:
     * - show       [Boolean] dropdown  ()
     * - key        [String]   dropdown 
     * - parent     [String]   dropdown  id 
     * - className  [String]  container ("a-class b-class")
     * - callback   [function(dropdown, messenger)]
     */
    toggle: function toggle(uri, init, id, options) {
        id = DROPDOWN_ID + (id ? '-' + id : uri.replace(/\//, '-')); // /\//g 
        options = options || {};

        if (typeof options !== 'object') {
            Logger.BUG('Wrong type of options given: ' + options);
        }

        var $container = $(document.getElementById(id));

        if (options.key) {
            if ($container.length && $container.attr('data-dropdown-key') !== options.key) {
                $container.remove();
                $container = $();
            }
        }

        if ($container.length) {
            var show;
            if ('show' in options) {
                show = !!options.show;
            } else {
                show = !$container.is(':visible');
            }
            $container[show ? 'fadeIn' : 'fadeOut']('fast');
            $container.trigger('dropdown:' + (show ? 'show' : 'hide') + ':start');
        } else if ('show' in options && options.show === false) {
            // nop
        } else {
                $container = $('<div class="hatena-globalheader-window"></div>').hide().attr('id', id).appendTo(document.body);

                if (options.key) {
                    $container.attr('data-dropdown-key', options.key);
                }

                if (options.parent) {
                    var parent = document.getElementById(DROPDOWN_ID + '-' + options.parent);
                    $(parent).on('dropdown:hide:start', function () {
                        $container.fadeOut('fast');
                    });
                }

                if (options.className) {
                    $container.addClass(options.className);
                }

                var iframe = $('<iframe frameborder="0" width="150" height="300"></iframe>').appendTo($container);

                var dropdown = iframe[0];

                if (!/^https?:/.test(uri)) {
                    uri = globalData('admin-domain') + uri;
                }

                var messenger = Messenger.createForFrame(dropdown, uri);
                messenger.addEventListener('close', function () {
                    Window.hide(iframe);
                });

                messenger.addEventListener('init', function (css) {
                    if (css) $container.css(css);
                    messenger.send('init', init);
                });

                messenger.addEventListener('resize', function (css) {
                    if (css) $container.css(css);
                });

                messenger.addEventListener('reload', function (data) {
                    location.reload(true);
                });

                if (options.callback) {
                    options.callback(dropdown, messenger);
                }

                Window.show($container, {
                    destroy: function destroy() {
                        $container.remove();
                        messenger.destroy();
                    },
                    keepOthers: !!options.parent || false
                });

                if (init) {
                    if ('left' in init || 'right' in init || 'top' in init) {
                        var offset = $container.offset();
                        if ('left' in init) {
                            offset.left = init.left;
                        } else if ('right' in init) {
                            offset.left = init.right - $container.width();
                        }
                        if ('top' in init) {
                            offset.top = init.top;
                        }
                        $container.offset(offset);
                    }

                    if ('height' in init) {
                        $container.height(init.height);
                    }
                }
            }
    }
};

module.exports = Dropdown;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Logger":293,"./Window":299,"./globalData":302,"js/Messenger":562}],283:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var decodeParam = require('js/Util/decodeParam');
var Messenger = require('js/Messenger');
var Pages = require('js/Base/Pages');

var canUseWysiwyg = require('../AdminTouch/Editor/canUseWysiwyg');
var insertTextTouch = require('../AdminTouch/Editor/insertText');

// PCEditor
// null
var currentEditor = undefined;

// Hatena.Diary.Editor
var EditorConnector = {
    // 
    // PCtouchiOS
    // 
    // Array
    // data: { hatena: [], html: [], markdown: [] }
    insertLines: function insertLines(data) {
        this._validate(data);
        this._setup();
        this._insertLinesImplement(data);
    },

    // iOS
    // EditorConnector, 
    isiOS: function isiOS() {
        return decodeParam(location.search.substr(1))['ios'];
    },

    // Android
    isAndroid: function isAndroid() {
        return decodeParam(location.search.substr(1))['android'];
    },

    // URLwindow.open
    loadServiceOnChildWindow: function loadServiceOnChildWindow(url) {
        var self = this;
        var curationWindow = window.open();
        var messenger = Messenger.createForWindow(curationWindow, url);

        messenger.addEventListener('insertLines', function (data) {
            self.insertLines(data);
        });
    },

    _validate: function _validate(data) {
        _.each(['html', 'hatena', 'markdown'], function (mode) {
            if (!data[mode]) throw "missing " + mode;
        });
    },

    _setup: function _setup() {
        if (this._insertLinesImplement) return;

        // 
        var isPC = Pages.device() === 'pc' && currentEditor;

        var isTouchEditor = Pages.device() === 'touch';

        var isChildFrame = window.opener;

        // ?ios=1iOS
        var isiOS = this.isiOS();
        // ?android=1Android
        var isAndroid = this.isAndroid();

        if (isiOS || isAndroid) {
            // URL
            this._insertLinesImplement = this._insertLinesOpenURL;
        } else if (isPC) {
            // PC
            this._insertLinesImplement = this._insertLinesPC;
        } else if (isTouchEditor) {
            // touch
            this._insertLinesImplement = this._insertLinesTouch;
        } else if (isChildFrame) {
            // postMessage
            this._insertLinesImplement = this._insertLinesMessenger;
        } else {
            throw "handling failed";
        }
    },

    _insertLinesPC: function _insertLinesPC(data) {
        var mode = currentEditor.mode;
        var lines = data[mode];
        currentEditor.insertLines(lines);
    },
    _insertLinesTouch: function _insertLinesTouch(data) {
        var syntax = $('#edit-entry').attr('data-entry-syntax');

        // HTMLcontentEditable(Android)textarea
        if (syntax === 'html' && !canUseWysiwyg()) {
            syntax = 'hatena';
        }

        var lines = data[syntax] || data['hatena'] || data['markdown'];

        insertTextTouch(lines.join("\n"));
    },
    _insertLinesMessenger: function _insertLinesMessenger(data) {
        var messenger = Messenger.createForParent();
        messenger.send('insertLines', data);
        window.close();
    },
    _insertLinesOpenURL: function _insertLinesOpenURL(data) {
        var html_lines = _.map(data.html, function (line) {
            return '<p>' + line + '</p>';
        });
        location.href = 'hatenablog:/entry/body/insert?' + $.param({
            hatena: data.hatena.join("\n"),
            html: html_lines.join(''),
            markdown: data.markdown.join("\n\n"),
            version: 1
        });
    },

    /**
     * PCEditor
     * @param {Editor} editor
     */
    registerCurrentEditor: function registerCurrentEditor(editor) {
        currentEditor = editor;
    }

};

module.exports = EditorConnector;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../AdminTouch/Editor/canUseWysiwyg":271,"../AdminTouch/Editor/insertText":272,"js/Base/Pages":295,"js/Messenger":562,"js/Util/decodeParam":573,"underscore":213}],284:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var globalData = require('./globalData');

var EventTracker = {};

// 11
EventTracker.trackEvent = (function () {
    var trackNamesQueue = [];
    var timer = null;

    var postTrackNames = function postTrackNames() {
        timer = null;
        var img = new Image();
        img.src = (globalData('admin-domain') || '') + '/api/track?' + $.param({
            track_name: trackNamesQueue,
            blog: globalData('blogs-uri-base') || 'http://' + globalData('blog')
        });
        trackNamesQueue = [];
    };

    return function (trackNames) {
        if (!timer) {
            timer = setTimeout(postTrackNames, 1000);
        }
        _.each($.makeArray(trackNames), function (name) {
            trackNamesQueue.push(name);
        });
    };
})();

// data-track-selectorCSS
// 1adata-track-name
// returns: 
EventTracker.checkSelector = function ($container, $clicked) {
    var selector = $container.attr('data-track-selector');
    if (!selector) return true;

    // 
    var $candicates = $container.find(selector);

    // 
    return !!($candicates.is($clicked) || $candicates.find($clicked).get(0));
};

// data-track-name
EventTracker.getDataTrackNames = function ($element) {
    var dataTrackAttr = $element.attr('data-track-name');
    var trackNames = dataTrackAttr.split(/\s+/);
    return trackNames;
};

// 
// Array
// returns: dfd.promiseresolvereject
EventTracker.trackEventNow = function (trackNames) {
    var dfd = $.Deferred();

    var img = new Image();
    img.onload = function () {
        dfd.resolve();
    };
    img.onerror = function () {
        dfd.reject();
    };

    img.src = (globalData('admin-domain') || '') + '/api/track?' + $.param({
        track_name: $.makeArray(trackNames),
        blog: globalData('blogs-uri-base') || 'http://' + globalData('blog')
    });

    // reject
    setTimeout(function () {
        dfd.reject();
    }, 5000);

    return dfd.promise();
};

EventTracker.setupTrack = function () {
    $(document).on('mousedown', '[data-track-name]:not([data-track-once])', function (event) {
        if (event.which !== 1) return; // 
        var $element = $(this);
        if (!EventTracker.checkSelector($element, $(event.target))) return;

        var trackNames = EventTracker.getDataTrackNames($element);
        EventTracker.trackEvent(trackNames);
    });

    $(document).on('mousedown', '[data-track-name][data-track-once]:not([data-track-once-tracked])', function (event) {
        if (event.which !== 1) return; // 
        var $element = $(this);
        if (!EventTracker.checkSelector($element, $(event.target))) return;

        var trackNames = EventTracker.getDataTrackNames($element);
        EventTracker.trackEventNow(trackNames);

        // 
        $element.attr('data-track-once-tracked', '');
    });
};

module.exports = EventTracker;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./globalData":302,"underscore":213}],285:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Window = require('./Window');
var Messenger = require('js/Messenger');
var globalData = require('./globalData');

// constant
var FEEDBACK_ID = 'hatena-diary-feedback';

//  >  >  
var Feedback = {

    toggle: function toggle(uri) {
        var feedback = document.getElementById(FEEDBACK_ID);
        if (feedback) {
            $(feedback).fadeToggle('fast');
        } else {
            var iframe = $('<iframe frameborder="0" width="320" height="320"></iframe>').hide().attr('id', FEEDBACK_ID).appendTo(document.body);

            feedback = iframe[0];

            var messenger = Messenger.createForFrame(feedback, uri + '?uri=' + encodeURIComponent(location.href) + '&page_id=' + encodeURIComponent(globalData('page')));

            messenger.addEventListener('close', function () {
                Window.hide(iframe);
            });

            messenger.addEventListener('resize', function (css) {
                if (css) {
                    iframe.css(css);
                }
            });

            Window.show(iframe, {
                destroy: function destroy() {
                    iframe.remove();
                    messenger.destroy();
                },
                fixScroll: true
            });
        }
    }
};

module.exports = Feedback;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Window":299,"./globalData":302,"js/Messenger":562}],286:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// private
var scrollTop = 0;
var enabled = false;

var scrollHandler = function scrollHandler(event) {
    if ($(window).scrollTop() === scrollTop) {
        return;
    }

    $(window).scrollTop(scrollTop);
};

// 
var FixScroll = {
    enable: function enable() {
        if (enabled) {
            return;
        }

        scrollTop = $(window).scrollTop();
        $(window).bind('scroll', scrollHandler);
        enabled = true;
    },
    disable: function disable() {
        if (!enabled) {
            return;
        }

        $(window).unbind('scroll', scrollHandler);
        enabled = false;
    }
};

module.exports = FixScroll;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],287:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');

var PAGE_LEAVE_EVENT = window.onbeforeunload !== undefined ? 'beforeunload' : 'unload';

/**
 * confirm
 */

var FormState = (function () {

    /**
     * form 
     * @param {jQuery} $form - 
     */

    function FormState($form) {
        var _this = this;

        _classCallCheck(this, FormState);

        this.$form = $form;
        this.isWatching = true;

        this.commit();
        this.$form.on('submit', function () {
            _this.isWatching = false;
        });

        $(window).on(PAGE_LEAVE_EVENT, function () {
            return _this.confirm();
        });
    }

    /**
     * beforeunload
     * @return {string} confirm undefinedconfirm
     */

    _createClass(FormState, [{
        key: 'confirm',
        value: function confirm() {
            $(window).triggerHandler('close-preview-window');
            if (this.isWatching && this.hasFormChanged()) {
                return Locale.text('form.confirm.changed.epic');
            }
        }

        /**
         * @return {boolean} form
         */
    }, {
        key: 'hasFormChanged',
        value: function hasFormChanged() {
            return this.$form.serialize() !== this.initialState;
        }

        /**
         * form
         * confirm
         * JS
         */
    }, {
        key: 'commit',
        value: function commit() {
            this.initialState = this.$form.serialize();
        }
    }]);

    return FormState;
})();

module.exports = FormState;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],288:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var globalData = require('js/Base/globalData');
var Devices = require('js/Base/Devices');
var Logger = require('js/Base/Logger');
var SpeedTrack = require('js/Base/SpeedTrack');
var canonicalizeColor = require('js/Util/canonicalizeColor');
var Pages = require('js/Base/Pages');

/**
 * 
 */

var GlobalHeader = (function () {
    function GlobalHeader() {
        _classCallCheck(this, GlobalHeader);

        this.globalheader = this.createGlobalHeader();

        this.color = this.getColor();
        this.bgColor = this.getBackgroundColor();
        this.circleId = this.getCircleId();
        this.pageCategory = this.getPageCategory();

        this.params = this.getParams();

        Messenger.listenToFrame(this.globalheader, this.getURL());

        Messenger.addEventListener('init', function (info) {
            $(function () {
                Logger.LOG(['init', info]);
                Pages.resolveInfo(info);
                SpeedTrack.record('globalHeaderLoaded');
            });
        });

        SpeedTrack.record('loadGlobalHeader');
    }

    /**
     * 
     */

    _createClass(GlobalHeader, [{
        key: 'createGlobalHeader',
        value: function createGlobalHeader() {
            var globalheader = document.querySelector('iframe#globalheader');

            if (globalheader) {
                return globalheader;
            } else {
                // globalheader
                var $globalheader = $('<iframe id="globalheader" style="display: none"></iframe>');
                $globalheader.appendTo(document.body);
                return $globalheader[0];
            }
        }

        /**
         * 
         */
    }, {
        key: 'getColor',
        value: function getColor() {
            return canonicalizeColor($(this.globalheader).css('color')) || '000000';
        }

        /**
         * 
         */
    }, {
        key: 'getBackgroundColor',
        value: function getBackgroundColor() {
            var backgroundColor = null;

            var target = this.globalheader;
            while (!backgroundColor && target && target !== document.documentElement) {
                var css = $(target).css('backgroundColor');
                backgroundColor = canonicalizeColor(css);

                target = target.parentNode;
            }

            if (!backgroundColor) {
                backgroundColor = 'ffffff';
            }

            return backgroundColor;
        }

        /**
         * 
         */
    }, {
        key: 'getDevice',
        value: function getDevice() {
            var globalheaderType = globalData('globalheader-type') || 'auto';

            if (globalheaderType === 'auto') {
                return Devices.userAgent();
            } else {
                return globalheaderType;
            }
        }
    }, {
        key: 'getCircleId',
        value: function getCircleId() {
            return globalData('circle-id');
        }

        /**
         * 
         */
    }, {
        key: 'getPageCategory',
        value: function getPageCategory() {
            if (/\.hatena\.ne\.jp(:\d+)?$/.test(location.host)) {
                return 'admin';
            }
            if (globalData('blog')) {
                return 'blogs';
            }
            if (this.circleId) {
                return 'circle';
            }
            return 'global';
        }

        /**
         * pro
         */
    }, {
        key: 'showUpgradePro',
        value: function showUpgradePro() {
            return this.pageCategory === 'admin' && globalData('pro') && globalData('pro') === 'false';
        }
    }, {
        key: 'getBrand',
        value: function getBrand() {
            return globalData('brand');
        }
    }, {
        key: 'getParams',
        value: function getParams() {
            var params = {};
            params.device = this.getDevice();

            if (this.circleId) {
                params['circle_id'] = this.circleId;
            }

            if (this.showUpgradePro()) {
                params['show_upgrade_pro'] = 'yes';
            }

            if (globalData('brand')) {
                params['brand'] = globalData('brand');
            }

            return params;
        }

        /**
         * URL
         */
    }, {
        key: 'getURL',
        value: function getURL() {
            var adminDomain = globalData('admin-domain');
            var color = encodeURIComponent(this.color);
            var bgColor = encodeURIComponent(this.bgColor);
            var param = $.param(this.params);
            var hash = encodeURIComponent(location.href);

            return adminDomain + '/-/globalheader/' + color + '/' + bgColor + '/' + this.pageCategory + '?' + param + '#' + hash;
        }
    }]);

    return GlobalHeader;
})();

module.exports = GlobalHeader;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Devices":280,"js/Base/Logger":293,"js/Base/Pages":295,"js/Base/SpeedTrack":296,"js/Base/globalData":302,"js/Messenger":562,"js/Util/canonicalizeColor":572}],289:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var GlobalHeader = require('./GlobalHeader');

// id
// 
// JS
// 
var setupScrollAdjustForFixedGlobalHeader = function setupScrollAdjustForFixedGlobalHeader() {
    var $header = $('#globalheader-container');
    if ($header.css('position') !== 'fixed') return;

    var headerHeight = $('#globalheader-container').height();
    var $document = $(document);

    $document.on('click', 'a[href^="#"]', function () {
        var positionBefore = $document.scrollTop();
        var checkCount = 0;
        var check = function check() {
            if ($document.scrollTop() !== positionBefore) {
                window.scrollBy(0, -headerHeight);
            } else if (checkCount++ < 10) {
                setTimeout(check, 0);
            }
        };
        setTimeout(check, 0);
    });
};

module.exports = {

    init: function init() {
        setupScrollAdjustForFixedGlobalHeader();
        return new GlobalHeader();
    }

};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./GlobalHeader":288}],290:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var HtmlText = (function (_React$Component) {
    _inherits(HtmlText, _React$Component);

    function HtmlText() {
        _classCallCheck(this, HtmlText);

        _get(Object.getPrototypeOf(HtmlText.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(HtmlText, [{
        key: 'render',
        value: function render() {
            var _this = this;

            var body = function body() {
                return { __html: _this.props.body };
            };
            return React.createElement('span', { dangerouslySetInnerHTML: body() });
        }
    }]);

    return HtmlText;
})(React.Component);

module.exports = HtmlText;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],291:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// jQuery Deferred
var LazyList = function LazyList() {
    this.init.apply(this, arguments);
};
LazyList.prototype = {
    /**
     * 
     * @param  {Function} generator - prevPromise
     * @param  {LazyList} prev      - LazyList 
     */
    init: function init(generator, prev) {
        if (!$.isFunction(generator)) {
            throw "generator must be a function (" + generator + ")";
        }
        this.generator = generator;

        if (prev) {
            if (!(prev instanceof LazyList)) {
                throw "prev must be a instance of LazyList";
            }
            this._prev = prev;
        }
    },

    // promise
    promise: function promise() {
        if (!this._promise) {
            var dfd = this.generator(this.prev());
            if (!$.isFunction(dfd.promise)) {
                throw "generator must return a Deferred Object (" + dfd + ")";
            }
            this._promise = dfd.promise();
        }

        return this._promise;
    },

    // 
    prev: function prev() {
        return this._prev;
    },

    // 
    next: function next() {
        if (!this._next) {
            this._next = new LazyList(this.generator, this);
        }
        return this._next;
    },

    // 
    root: function root() {
        if (this._prev) {
            return this._prev.root();
        } else {
            return this;
        }
    }
};

module.exports = LazyList;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],292:[function(require,module,exports){
'use strict';

var decodeParam = require('js/Util/decodeParam');
var data = require('./globalData');

var host;
var _params;

var Location = {
    /**
     * setup
     * location
     * @param location {Object}
     */
    setup: function setup(location) {
        if (!location) {
            location = window.location;
        }
        var data = location.search.slice(1);
        _params = decodeParam(data);
        host = location.host;
    },

    param: function param(name) {
        return this.params()[name] ? this.params()[name][0] : null;
    },

    params: function params() {
        if (!_params) this.setup();
        return _params;
    },

    /**
     * 
     * Admin  Blogs
     * (b.hatena.ne.jp)Admin
     * admin-domain
     * 
     */
    domainType: function domainType() {
        if (!host) this.setup();

        var domain = '';
        var admin_domain = data('admin-domain');
        if (admin_domain) {
            var is_admin_domain = new RegExp('^(http|https)://' + host + '$').test(admin_domain);
            domain = is_admin_domain ? this.Admin : this.Blogs;
        } else {
            domain = /\.hatena\.ne\.jp(:\d+)?$/.test(host) ? this.Admin : this.Blogs;
        }
        return domain;
    },

    Admin: 'Admin',
    Blogs: 'Blogs'
};

module.exports = Location;

},{"./globalData":302,"js/Util/decodeParam":573}],293:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var URLGenerator = require('./URLGenerator');
var globalData = require('./globalData');
var Browser = require('./Browser');
var env = require('../env');

// localStorageisVerbose
var isVerbose;
try {
    isVerbose = JSON.parse(window.localStorage.getItem('Hatena.Diary.isVerbose'));
} catch (e) {/* noop */}

var Logger = {

    /**
     * console.log 
     * 
     */
    LOG: function LOG() {
        if (isVerbose || env.NODE_ENV !== 'production') {
            try {
                console.log.apply(console, arguments);
            } catch (e) {
                // just for IE9
                console.log(arguments);
            }
        }
    },

    /**
     * 
     * IE
     */
    BUG: function BUG(error, append) {
        if (Browser.isObsolete) {
            return;
        }

        $.ajax({
            type: 'get',
            url: URLGenerator.static_url('/js/vendor/stacktrace/stacktrace.js'),
            cache: true,
            dataType: 'script'
        }).done(function () {
            var trace;
            try {
                trace = window.printStackTrace({ e: error });
                trace.pop(); // printStackTrace
            } catch (e) {
                trace = null;
            }

            var msg = '[BUG] ' + (append || '') + ' ' + error;
            var domain = globalData('admin-domain') || '';
            var content = [location.href, msg, trace];

            var img = new Image();
            img.src = domain + '/api/bug?content=' + encodeURIComponent(JSON.stringify(content));

            Logger.LOG(msg);
            Logger.LOG(trace);
        });

        if (env.NODE_ENV !== 'production') {
            throw error;
        }
    },

    /**
     * BUG
     * Ajax  onerror 
     */
    REPORT_BUG: function REPORT_BUG(name) {
        return function (error) {
            return Logger.BUG(error, name);
        };
    }

};

module.exports = Logger;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../env":594,"./Browser":278,"./URLGenerator":298,"./globalData":302}],294:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// private
var loaded;
var MATHJAX_URL = "https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";

// Google Image Charts APIdeprecatedmathjax
// 
// TeXaltTeXalt
//  http://docs.mathjax.org/en/latest/typeset.html
var MathJaxLoader = {
    load: function load($root) {
        var $imgs = $root.find('img[src*="chart.apis.google.com/chart?cht=tx&chl="]');
        if (!$imgs.length) {
            return;
        }

        if (!loaded) {
            loaded = $.getScript(MATHJAX_URL);
        }

        loaded.done(function () {
            $imgs.each(function () {
                var $img = $(this);
                var source = $img.attr('alt');
                if (!source) {
                    return;
                }

                var $script = $('<script type="math/tex">');
                $img.replaceWith($script);
                MathJax.HTML.setScript($script[0], source);
            });
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, $root[0]]);
        });
    }
};

module.exports = MathJaxLoader;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],295:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Location = require('./Location');
var globalData = require('./globalData');
var Logger = require('./Logger');
var Messenger = require('js/Messenger');
var SpeedTrack = require('./SpeedTrack');

// resolvePromise
var resolver = null;

/**
 * 
 */
var Pages = {

    Controllers: null,

    Blogs: {},
    Admin: {},
    BlogsTouch: {},
    AdminTouch: {},

    /**
     * resolvedeferred
     * GlobalHeader.init
     * deferredreject
     * 
     */
    infoLoaded: new Promise(function (resolve) {
        return resolver = resolve;
    }),
    resolveInfo: function resolveInfo(info) {
        return resolver(info);
    },

    /**
     * Controllers
     * @param {Object} Controllers - loadController
     */
    setControllers: function setControllers(Controllers) {
        Pages.Controllers = Controllers;
    },

    /**
     * init.json
     * 
     * info, privateInfo resolveDeferred
     * XXX 
     *
     * @return {$.Promise}
     */
    loadInfo: function loadInfo() {
        var blogUri = decodeURIComponent(location.hash.substring(1));
        var circleId = Location.param('circle_id');

        var init;
        if (circleId) {
            init = $.ajax({
                url: '/api/init/circle',
                type: 'get',
                dataType: 'json',
                data: {
                    circle_id: circleId
                }
            });
        } else {
            init = $.ajax({
                url: '/api/init',
                type: "get",
                dataType: 'json',
                data: {
                    name: globalData('name'),
                    blog: blogUri
                }
            });
        }

        var loaded = $.Deferred();
        init.done(function (info) {
            var privateInfo = info['private'];

            // private
            delete info['private'];

            // 
            Messenger.send('init', info);

            // privateInfo
            loaded.resolve(info, privateInfo);
        });

        return loaded.promise();
    },

    /**
     * 
     * @return {string} 'pc' | 'touch'
     */
    device: function device() {
        var device = globalData('device');

        if (!device) {
            var message = "device is undefined, page: " + globalData('page') + ", location: " + location.href;
            Logger.BUG(message);
        }

        return device || 'pc';
    },

    /**
     * 
     * @public
     */
    loadPage: function loadPage() {
        var domain = Location.domainType();

        var deviceSuffix = Pages.device() === 'pc' ? '' : 'Touch';
        var namespace = domain + deviceSuffix;

        var page = globalData('page');

        SpeedTrack.setDomain(domain);
        SpeedTrack.setPage(page);

        var func;
        try {
            Pages.loadDomain(namespace);
            SpeedTrack.record('Pages["' + namespace + '"]["*"]');

            Pages.loadDomainPage(namespace, page);
            SpeedTrack.record('Pages["' + namespace + '"]["' + page + '"]');

            Pages.loadDomainController(namespace);
            SpeedTrack.record('Controllers["' + namespace + '"]');

            Pages.loadController(namespace, page);
            SpeedTrack.record('Controllers["' + namespace + '"]["' + page + '"]');
        } catch (e) {
            Logger.BUG(e, 'toplevel');
        }
    },

    /**
     * 
     * @deprecated
     * @param {string} namespace - /^(admin|blogs)(Touch)?/
     */
    loadDomain: function loadDomain(namespace) {
        Logger.LOG('Pages["' + namespace + '"]["*"]');
        var func = Pages[namespace]["*"];
        if (func) {
            func();
        }
        Logger.LOG('Pages["' + namespace + '"]["*"] done');
    },

    /**
     * 
     * @deprecated
     * @param {string} namespace - /^(admin|blogs)(Touch)?/
     * @param {string} page      - ID
     */
    loadDomainPage: function loadDomainPage(namespace, page) {
        Logger.LOG('Pages["' + namespace + '"]["' + page + '"]');
        var func = Pages[namespace][page];
        if (func) {
            func();
        }
        Logger.LOG('Pages["' + namespace + '"]["' + page + '"] done');
    },

    /**
     * 
     * @param {string} domain - /^(admin|blogs)(Touch)?/
     */
    loadDomainController: function loadDomainController(domain) {
        if (!Pages.Controllers) {
            throw new Error('Pages.Controllers not initialized');
        }

        Logger.LOG('Controllers["' + domain + '"]');
        var controller = Pages.Controllers[domain].__domain__;
        if (controller) {
            controller.init();
        }
        Logger.LOG('Controllers["' + domain + '"] done');
    },

    /**
     * 
     * @param {string} domain - /^(admin|blogs)(Touch)?/
     * @param {string} page   - ID
     */
    loadController: function loadController(domain, pageId) {
        if (!Pages.Controllers) {
            throw new Error('Pages.Controllers not initialized');
        }

        Logger.LOG('Controllers["' + domain + '"]["' + pageId + '"]');
        var controller = Pages.Controllers[domain][pageId];
        if (controller) {
            controller.init();
        }
        Logger.LOG('Controllers["' + domain + '"]["' + pageId + '"] done');
    }

};

module.exports = Pages;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Location":292,"./Logger":293,"./SpeedTrack":296,"./globalData":302,"js/Messenger":562}],296:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var globalData = require('./globalData');

var SpeedTrack = {
    init: function init() {
        if (this.initialized === true) return;

        // fluentd1001
        this.fluentdEnabled = Math.floor(Math.random() * 100) === 0;

        var now = new Date();
        this.startTime = now;
        this.data = {};
        this.checkpoints = [];
        this.elapsedTimes = [];

        this.initialized = true;
    },
    setDomain: function setDomain(domain) {
        this.domain = domain;
    },
    setPage: function setPage(page) {
        this.page = page;
    },
    record: function record(name) {
        var endTime = new Date();
        var elapsed = endTime.getTime() - this.startTime.getTime();
        this.checkpoints.push(name);
        this.elapsedTimes.push(elapsed);

        this.sendToFluentd();

        this.sendToUniversalAnalytics(name, elapsed);
    },
    sendToFluentd: function sendToFluentd() {
        if (this._sendToFluentd) return this._sendToFluentd();

        // 11
        this._sendToFluentd = _.throttle(function () {
            if (!this.fluentdEnabled) return;

            var img = new Image();
            img.src = (globalData('admin-domain') || '') + '/api/track/speed?' + $.param({
                track_domain: this.domain,
                track_page: this.page,
                track_speed_checkpoints: this.checkpoints,
                track_speed_elapsed_times: this.elapsedTimes,
                blog: globalData('blogs-uri-base') || 'http://' + globalData('blog')
            });

            this.checkpoints = [];
            this.elapsedTimes = [];
        }, 1000);

        this._sendToFluentd();
    },
    // UniversalAntlycscreate
    sendToUniversalAnalytics: function sendToUniversalAnalytics(name, elapsed) {
        if (!window.ga) {
            return;
        }

        window.ga('HatenaBlogTracker.send', {
            'hitType': 'timing',
            'timingCategory': 'SpeedTrack',
            'timingVar': name,
            'timingValue': elapsed
        });
    }
};
SpeedTrack.init();

module.exports = SpeedTrack;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./globalData":302,"underscore":213}],297:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');

var PAGE_LEAVE_EVENT = window.onbeforeunload !== undefined ? 'beforeunload' : 'unload';

/**
 * confirm
 */

var TransitionConfirmer = (function () {

    /**
     * 
     */

    function TransitionConfirmer() {
        var _this = this;

        _classCallCheck(this, TransitionConfirmer);

        this.isWatching = false;
        $(window).on(PAGE_LEAVE_EVENT, function () {
            return _this.confirm();
        });
    }

    /**
     * beforeunload
     * @return {string} confirm undefinedconfirm
     */

    _createClass(TransitionConfirmer, [{
        key: 'confirm',
        value: function confirm() {
            if (this.isWatching) {
                return Locale.text('form.confirm.changed');
            }
        }
    }, {
        key: 'enable',
        value: function enable() {
            this.isWatching = true;
        }
    }, {
        key: 'disable',
        value: function disable() {
            this.isWatching = false;
        }
    }]);

    return TransitionConfirmer;
})();

module.exports = TransitionConfirmer;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],298:[function(require,module,exports){
'use strict';

var globalData = require('./globalData');

// JSURL
var URLGenerator = {
    // pathURLAPIURL
    user_blog_url: function user_blog_url(path) {
        var blog_url_base = globalData('blogs-uri-base');
        return blog_url_base + path;
    },
    static_url: function static_url(path) {
        var static_base = globalData('static-domain');
        return static_base + path + this._versionParameter();
    },
    _versionParameter: function _versionParameter() {
        var version = globalData('version');

        if (version) {
            return '?version=' + version;
        } else {
            return '';
        }
    }
};

module.exports = URLGenerator;

},{"./globalData":302}],299:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var FixScroll = require('./FixScroll');

// 
var Window = {
    shown: [],

    init: function init() {
        var self = this;

        $(document.body).click(function (event) {
            var windowClicked = _.any(self.shown, function (win) {
                return win.win[0] === event.target || $.contains(win.win[0], event.target);
            });
            // window
            if (windowClicked) {
                return;
            }

            self.hideAll();
        });

        self.init = function () {};
    },

    /**
     * opts.closeExplicitlytrue
     * 
     * opts.keepOthers 
     */
    show: function show(win, opts) {
        var self = this;
        if (!opts) opts = {};
        self.init();
        if (opts.keepOthers) {
            // nop
        } else {
                self.hideAll();
            }
        if (opts.fixScroll) {
            FixScroll.enable();
        }
        if (opts.center) {
            Window._setCenter(win);
        }
        if (opts.showBackground) {
            Window._showBackground();
        }
        self.shown.push({
            closeExplicitly: !!opts.closeExplicitly,
            win: win,
            destroy: opts.destroy || function () {},
            fixScroll: !!opts.fixScroll,
            showBackground: !!opts.showBackground
        });
        win.fadeIn('fast');
    },

    hide: function hide(win) {
        var self = this;
        for (var i = 0, len = self.shown.length; i < len; i++) {
            var obj = self.shown[i];
            if (obj.win === win) {
                win.fadeOut('fast', obj.destroy);
                $('.modal-window-background').fadeOut('fast');
                if (obj.fixScroll) {
                    FixScroll.disable();
                }
                break;
            }
        }
    },

    hideAll: function hideAll() {
        var self = this,
            restWindows = [];
        for (var i = 0, len = self.shown.length; i < len; i++) {
            if (self.shown[i].closeExplicitly) {
                restWindows.push(self.shown[i]);
            } else {
                self.hide(self.shown[i].win);
            }
        }
        self.shown = restWindows;
    },

    toggle: function toggle(win, option) {
        if (win.is(':visible')) {
            this.hide(win);
            return false;
        } else {
            this.show(win, option);
            return true;
        }
    },

    _setCenter: function _setCenter(win) {
        var setSize = _.throttle(function () {
            if (!$(win).is(':visible')) {
                $(window).off('resize', setSize);
                return;
            }
            var margin_top = ($(window).height() - $(win).height()) / 2;
            var margin_left = ($(window).width() - $(win).width()) / 2;
            $(win).css({
                top: margin_top,
                left: margin_left
            });
        }, 100);

        $(window).on('resize', setSize);

        setSize();
    },

    _showBackground: function _showBackground() {
        var $screen = $('<div>').addClass('modal-window-background');
        $screen.appendTo(document.body);
    }
};

module.exports = Window;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./FixScroll":286,"underscore":213}],300:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var extractSyntax = require('./extractSyntax');

// fotolifefotolife:plainHTML
//  { image, syntax, html } Deferred
var extractFotolifeSyntax = function extractFotolifeSyntax(string) {
    var ret = $.Deferred();
    var match = string.match(/f:id:([^:]+):(\d+)([jpg]):image/);
    if (match) {
        var syntax = '[' + match[0].replace(':image', ':plain') + ']';
        var name = match[1];
        var id = match[2];
        var type = match[3];
        var path = [name.substring(0, 1), name, id.substring(0, 8), id].join('/');
        var image = 'http://cdn-ak.f.st-hatena.com/images/fotolife/' + path + '_120.jpg';

        extractSyntax(syntax).done(function (data) {
            ret.resolve({
                image: image,
                syntax: syntax,
                html: data.html
            });
        }).fail(function (error) {
            ret.reject(error);
        });
    } else {
        _.defer(function () {
            ret.reject('Invalid format? ' + string);
        });
    }
    return ret.promise();
};

module.exports = extractFotolifeSyntax;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./extractSyntax":301,"underscore":213}],301:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var globalData = require('./globalData');

// 
// hatena_syntax: String or [String]Array<p>
//  { html } Deferred
var extractSyntax = function extractSyntax(hatena_syntax) {
    var dfd = $.Deferred();
    if (_.isArray(hatena_syntax)) {
        hatena_syntax = hatena_syntax.join("\n\n");
    }

    $.ajax({
        url: "/api/support.expand",
        type: "POST",
        data: {
            syntax: hatena_syntax,
            rkm: globalData('rkm'),
            rkc: globalData('rkc')
        },
        dataType: 'json'
    }).done(function (data) {
        dfd.resolve({
            html: data.html
        });
    }).fail(function (error) {
        dfd.reject(error);
    });

    return dfd;
};

module.exports = extractSyntax;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./globalData":302,"underscore":213}],302:[function(require,module,exports){
'use strict';

// htmldata
// JS
var globalData = function globalData(name) {
    var html = document.documentElement;
    return html.getAttribute('data-' + name);
};

module.exports = globalData;

},{}],303:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var decodeParam = require('js/Util/decodeParam');

// locationvia
var inheritVia = function inheritVia(via) {
    if (!via) return;

    $('a[data-inherit-via]').each(function () {
        var $self = $(this);
        var href = $self.attr('href').split(/\?/);
        var query = href[1] || '';

        var params = decodeParam(query);
        params['via'] = via;

        $self.attr('href', href[0] + '?' + $.param(params));
    });
};

module.exports = inheritVia;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/decodeParam":573}],304:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * 
 * iframe 
 * iframe submit  submit 
 */
var preventClickJacking = function preventClickJacking() {
    if (window === window.parent) {
        return;
    }

    $('form').each(function () {
        var $this = $(this);

        // 
        // 
        if ($this.attr('data-pass-through-click-jacking-validation')) return;

        var $buttons = $this.find('input[type=submit][name!=delete][name!=draft]');
        var $delete_button = $this.find('input[type=submit][name=delete], input[type=submit][name=draft]');
        var disable = function disable() {
            $this.addClass('unedited');
            $buttons.attr('disabled', 'disabled');
        };
        var enable = function enable() {
            $this.removeClass('unedited');
            $buttons.removeAttr('disabled');
        };
        var serialize = function serialize($form) {
            return $({
                elements: $form.find(':input:not([data-ignore-click-jacking])')
            }).serialize();
        };

        disable();
        $delete_button.attr('disabled', 'disabled');
        var init = serialize($this);
        var timer = setInterval(function () {
            $delete_button.removeAttr('disabled');
            if (init != serialize($this)) {
                clearInterval(timer);
                enable();
            }
        }, 1500);
    });
};

module.exports = preventClickJacking;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],305:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var Window = require('./Window');

var setupProModal = function setupProModal() {
    var openProModal = function openProModal(modalURL) {
        var iframeContainer = $('<div class="hatena-iframe-container pro-modal-container">').appendTo(document.body);
        var iframe = $('<iframe frameborder="0"></iframe>').appendTo(iframeContainer);

        var messenger = Messenger.createForFrame(iframe[0], modalURL);
        messenger.addEventListener('close', function () {
            Window.hide(iframeContainer);
        });

        Window.show(iframeContainer, {
            destroy: function destroy() {
                iframe.remove();
                messenger.destroy();
            },
            fixScroll: true,
            center: true,
            showBackground: true
        });
    };

    $('.open-pro-modal').css('visibility', 'visible');
    $(document.body).on('click', '.open-pro-modal', function () {
        var $self = $(this);
        var modalURL = $self.attr('data-guide-pro-modal-ad-url');
        openProModal(modalURL);
        return false;
    });
};

module.exports = setupProModal;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Window":299,"js/Messenger":562}],306:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var globalData = require('./globalData');
var Devices = require('./Devices');

var setupTouchViewSuggest = function setupTouchViewSuggest() {
    var suggest_touch_view = !globalData('no-suggest-touch-view');
    var has_touch_view = globalData('has-touch-view');
    var is_touch_agent = Devices.userAgent() === 'touch';

    if (suggest_touch_view && has_touch_view && is_touch_agent) {
        $('#sp-suggest-link').on('click', function () {
            Devices.use('touch');
            return false;
        });
        $('#sp-suggest').show();
    }
};

module.exports = setupTouchViewSuggest;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Devices":280,"./globalData":302}],307:[function(require,module,exports){
'use strict';

var TwitterText = require('twitter-text');

var validateTweetLength = function validateTweetLength(tweet) {
    var length = TwitterText.getTweetLength(tweet || '');
    //  - httpsurl - httpsurl -  = 95
    // 95false, true
    // 
    // twitter
    // urlhttpsurl23
    return length < 140 - 23 - 23 - 1;
};

module.exports = validateTweetLength;

},{"twitter-text":212}],308:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var Messenger = require('js/Messenger');
var Browser = require('js/Base/Browser');
var Window = require('js/Base/Window');
var positionToString = require('js/Util/positionToString');

// 
var createMessenger = function createMessenger(url, name, $container) {
    return Browser.thirdPartyCookiesBlocked.pipe(function (blocked) {
        var messenger;

        if (blocked) {
            var size = { width: 300, height: 400 };
            size.left = Math.floor((screen.width - size.width) / 2);
            size.top = Math.floor((screen.height - size.height) / 2);

            var subwindow = window.open('', name, positionToString(size));
            messenger = Messenger.createForWindow(subwindow, url);

            messenger.addEventListener('close', function () {
                messenger.destroy();
                subwindow.close();
            });
        } else {
            var $iframe = $('<iframe frameborder=0>').appendTo($container);
            messenger = Messenger.createForFrame($iframe[0], url);

            messenger.addEventListener('close', function () {
                Window.hide($container);
            });

            messenger.addEventListener('resize', function (css) {
                if (css) $iframe.css(css);
            });

            Window.show($container, {
                destroy: function destroy() {
                    $iframe.remove();
                    messenger.destroy();
                }
            });
        }

        return messenger;
    });
};

var CircleSidebar = {

    init: function init() {
        $('.manage-membership-button').click(function () {
            createMessenger($('html').attr('data-admin-domain') + '/-/group/' + $('html').attr('data-circle-id') + '/membership', 'manage-membership', $(this).siblings('.manage-membership-popup'));

            return false;
        });
    }

};

module.exports = CircleSidebar;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Browser":278,"js/Base/Window":299,"js/Messenger":562,"js/Util/positionToString":584}],309:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var InPlaceEditor = require('./InPlaceEditor');
var updateDynamicPieces = require('js/Util/updateDynamicPieces');
var replaceYoutubeURL = require('js/Util/replaceYoutubeURL');
var waitForResource = require('js/Util/waitForResource');
var positionToString = require('js/Util/positionToString');
var Locale = require('js/Locale');
var Messenger = require('js/Messenger');
var SpeedTrack = require('js/Base/SpeedTrack');
var Logger = require('js/Base/Logger');
var Pages = require('js/Base/Pages');
var Browser = require('js/Base/Browser');
var Window = require('js/Base/Window');
var URLGenerator = require('js/Base/URLGenerator');
var globalData = require('js/Base/globalData');
var Cookie = require('js-cookie');

// XXX: 
var EntriesManager = {

    /**
     * /
     * @param {jQuery} $entry
     */
    editEntryInPlace: function editEntryInPlace($entry) {
        if (!$entry) return;

        InPlaceEditor.showEditInPlace($entry, {
            update: function update(data) {
                // data.entry
                var $newEntry = $(data.entry.trim());

                // , 
                if (!$newEntry.length) {
                    $entry.remove();
                    return;
                }
                $entry.replaceWith($newEntry);
                EntriesManager.initEntry($newEntry);
                updateDynamicPieces($newEntry.parent());
            }
        });
    },

    newEntry: function newEntry() {
        InPlaceEditor.showEditInPlace(null, {
            update: function update(data) {
                // data.entry
                var $newEntry = $(data.entry.replace(/^\s+/, '').replace(/\s+$/, ''));

                // 
                if (!$newEntry.length) {
                    return;
                }

                $newEntry.insertBefore('#main article.entry:first');
                EntriesManager.initEntry($newEntry);
                updateDynamicPieces($newEntry.parent());
                $('[data-remove-on-new-entry=1]').remove();
            }
        });
    },

    initEntry: function initEntry($entry) {
        replaceYoutubeURL($entry);

        var $container = $entry.find('.comment-box .comment');
        $container.on('click', '.comment-delete-button', function (e) {
            var $button = $(e.currentTarget);
            EntriesManager.deleteCommentHandler($entry, $button);
            return false;
        });

        var $readMoreLine = $entry.find('.read-more-comments');
        var $readMoreButton = $readMoreLine.find('a');

        // 3
        EntriesManager.showEntryInfo($entry, $container, 3);

        $readMoreButton.on('click', function () {
            // 
            EntriesManager.showEntryInfo($entry, $container, 0).done(function () {
                try {
                    (function () {
                        //  sessionStorage 
                        var map = {};
                        $('article[data-comments-expanded][data-uuid]').each(function (i, el) {
                            map[$(el).attr('data-uuid')] = true;
                        });
                        sessionStorage.setItem('entriesExpandedComments', JSON.stringify(map));
                    })();
                } catch (ignored) {}
            });
            return false;
        });

        Pages.infoLoaded.then(function (info) {
            $entry.find('.leave-comment-title').toggle(info.cookie_received ? info.commentable : true).on('click', function (e) {
                var $button = $(e.currentTarget);
                EntriesManager.leaveCommentHandler($entry, $button);
                return false;
            });
        });
    },

    showEntryInfo: function showEntryInfo($entry, $container, maxCommentsCount) {
        var entryInfoLoaded = function entryInfoLoaded(info) {
            if (!info.comments) {
                return;
            }

            var $readMoreLine = $entry.find('.read-more-comments');
            var $readMoreButton = $readMoreLine.find('a');

            // readMoreButton
            // maxCommentsCount0maxCommentsCount
            var commentsCount = info.comments.entries.length;
            var expandedInThisSession = false;

            try {
                var entriesExpandedComments = JSON.parse(sessionStorage.getItem('entriesExpandedComments')) || {};
                expandedInThisSession = entriesExpandedComments[$entry.attr('data-uuid')];
            } catch (ignored) {}

            if ($readMoreLine.length === 0 || maxCommentsCount === 0 || commentsCount <= maxCommentsCount || expandedInThisSession) {
                maxCommentsCount = commentsCount;

                // 
                // 
                // 
                $container.children().remove();
                $entry.attr('data-comments-expanded', true);
            } else {
                // 
                $readMoreLine.show();
            }

            // HTMLDOM
            var commentHTML = '';
            for (var i = 0, len = maxCommentsCount; i < len; i++) {
                commentHTML += info.comments.entries[i];
            }
            var $comments = $(commentHTML);

            $container.prepend($comments);

            // 
            $readMoreButton.text(Locale.text('read_more_comments') + ' (' + (info.comments.entries.length - maxCommentsCount) + ')');

            if (Hatena.Star) {
                waitForResource(function () {
                    return Hatena.Star && Hatena.Star.WindowObserver.loaded;
                }, function () {
                    Hatena.Star.EntryLoader.intoCommentScope(function () {
                        updateDynamicPieces($container);
                    });
                });
            } else {
                updateDynamicPieces($container);
            }
        };

        return EntriesManager.loadEntryInfo($entry).done(function (info) {
            entryInfoLoaded(info);
            SpeedTrack.record("Pages.Blogs['*'].init.showEntryInfo");
        }).fail(Logger.REPORT_BUG('loadEntryInfo'));
    },

    deleteCommentHandler: function deleteCommentHandler($entry, $button) {
        var commentId = $button.closest('li.entry-comment').attr('id');

        var adminDomain = globalData('admin-domain');
        var author = globalData('author');
        var blog = globalData('blog');
        var param = $.param({
            comment: commentId.slice(8)
        });

        var uri = adminDomain + '/' + author + '/' + blog + '/comment/delete?' + param;

        Browser.thirdPartyCookiesBlocked.done(function (blocked) {
            if (blocked) {
                EntriesManager.deleteCommentHandlerWindow($entry, $button, commentId, uri);
            } else {
                EntriesManager.deleteCommentHandlerIframe($entry, $button, commentId, uri);
            }
        });
    },

    deleteCommentHandlerIframe: function deleteCommentHandlerIframe($entry, $button, commentId, uri) {
        var $iframeContainer = $(('\n          <div class="hatena-iframe-container">\n            <div class="loading" style="display: none;">\n              <img src="' + URLGenerator.static_url('/images/loading.gif') + '" alt="loading"/>\n              ' + Locale.text('loading') + '\n            </div>\n            <iframe frameborder="0"></iframe>\n          </div>\n        ').trim()).appendTo($entry);
        $iframeContainer.css({
            width: 440,
            height: 120,
            position: 'absolute'
        }).offset($button.offset());

        var $iframe = $iframeContainer.find('iframe');
        var $loading = $iframeContainer.find('.loading');
        setTimeout(function () {
            return $loading.show();
        }, 250);
        $iframe.load(function () {
            return $loading.remove();
        });

        var messenger = Messenger.createForFrame($iframe[0], uri);
        messenger.addEventListener('delete', function () {
            $('#' + commentId).fadeOut();
        });
        messenger.addEventListener('close', function () {
            Window.hide($iframeContainer);
        });

        Window.show($iframeContainer, {
            destroy: function destroy() {
                $iframe.remove();
                messenger.destroy();
            }
        });
    },

    deleteCommentHandlerWindow: function deleteCommentHandlerWindow($entry, $button, commentId, uri) {
        var position = positionToString({
            width: 300,
            height: 150,
            left: Math.floor((screen.width - 300) / 2),
            tops: Math.floor((screen.height - 150) / 2)
        });

        var deleteCommentWindow = window.open('', 'delete_comment', position);

        var messenger = Messenger.createForWindow(deleteCommentWindow, uri);

        var close = function close() {
            messenger.destroy();
            deleteCommentWindow.close();
        };

        messenger.addEventListener('delete', function () {
            $('#' + commentId).fadeOut();
        });

        messenger.addEventListener('close', close);

        $(document.body).one('focus', close);
    },

    leaveCommentHandler: function leaveCommentHandler($entry, $button) {
        // viewable
        // bktoken
        var adminDomain = globalData('admin-domain');
        var author = globalData('author');
        var blog = globalData('blog');
        var param = $.param({
            entry: $entry.attr('data-uuid'),
            token: Cookie.get('bk')
        });

        var uri = adminDomain + '/' + author + '/' + blog + '/comment?' + param;

        Browser.thirdPartyCookiesBlocked.done(function (blocked) {
            if (blocked) {
                EntriesManager.leaveCommentHandlerWindow($entry, $button, uri);
            } else {
                EntriesManager.leaveCommentHandlerIframe($entry, $button, uri);
            }
        });
    },

    leaveCommentHandlerWindow: function leaveCommentHandlerWindow($entry, $button, uri) {
        var position = positionToString({
            width: 400,
            height: 240,
            left: Math.floor((screen.width - 400) / 2),
            top: Math.floor((screen.height - 120) / 2)
        });

        var commentWindow = window.open('', 'comment', position);

        var messenger = Messenger.createForWindow(commentWindow, uri);
        messenger.addEventListener('close', function () {
            messenger.destroy();
            commentWindow.close();
        });
        messenger.addEventListener('update', function (data) {
            EntriesManager.appendPostedComment($entry, data.comment);
        });
    },

    leaveCommentHandlerIframe: function leaveCommentHandlerIframe($entry, $button, uri) {
        var $container = $(('\n          <div class="hatena-iframe-container" style="display: none;">\n            <div class="loading" style="display: none;">\n              <img src="' + URLGenerator.static_url('/images/loading.gif') + '" alt="loading"/>\n              ' + Locale.text('loading') + '\n            </div>\n            <iframe frameborder="0"></iframe>\n          </div>\n        ').trim()).appendTo(document.body);

        var offset = $button.offset();
        var maxWidth = $(window).width();
        var winWidth = 440;
        var padding = 10;

        // framemaxWindow, 
        if (winWidth + 2 * padding > maxWidth) {
            winWidth = maxWidth - 2 * padding;
            offset.left = padding;
        }

        var height = 235;

        // 
        var topIsNew = globalData('blog-comments-top-is-new');
        if (topIsNew) {
            offset.top -= height;
            offset.top += $button.height();
        }

        $container.css({
            width: winWidth,
            height: height,
            position: 'absolute'
        }).offset(offset);

        var $iframe = $container.find('iframe');

        var $loading = $container.find('.loading');
        setTimeout(function () {
            return $loading.show();
        }, 250);
        $iframe.load(function () {
            return $loading.remove();
        });

        var editinplace = $iframe[0];

        var messenger = Messenger.createForFrame(editinplace, uri);
        messenger.addEventListener('update', function (data) {
            EntriesManager.appendPostedComment($entry, data.comment);
        });
        messenger.addEventListener('close', function () {
            Window.hide($container);
        });
        messenger.addEventListener('resize', function (data) {
            if (!data) {
                return;
            }

            if (topIsNew && data.height !== height) {
                data.top = $container.css('top') + height - data.height;
            }
            $container.css(data);
        });

        Window.show($container, {
            closeExplicitly: true,
            destroy: function destroy() {
                $iframe.remove();
                messenger.destroy();
            }
        });
    },

    appendPostedComment: function appendPostedComment($entry, commentHtml) {
        var $container = $entry.find('.comment-box .comment');
        var topIsNew = globalData('blog-comments-top-is-new');

        if (topIsNew) {
            $container.prepend(commentHtml);
        } else {
            $container.append(commentHtml);
        }

        if (Hatena.Star) {
            Hatena.Star.EntryLoader.intoCommentScope(function () {
                updateDynamicPieces($container);
            });
        } else {
            updateDynamicPieces($container);
        }
    },

    loadEntryInfo: function me(entry) {
        if (!me.data) me.data = {
            timer: setTimeout(function () {
                var data = me.data;
                me.data = null;
                $.ajax({
                    url: URLGenerator.user_blog_url('/api/entry/info'),
                    type: 'get',
                    dataType: 'json',
                    cache: false,
                    data: {
                        e: data.entries
                    }
                }).done(function (res) {
                    var entries = res.entries;
                    for (var key in entries) if (entries.hasOwnProperty(key)) {
                        data.deferred[key].resolve(entries[key]);
                    }
                    SpeedTrack.record("Pages.Blogs['*'].loadEntryInfo.ajax.success");
                });
            }, 0),
            entries: [],
            deferred: {}
        };

        var ret = $.Deferred();
        var uuid = entry.attr('data-uuid');

        me.data.entries.push(uuid);
        me.data.deferred[uuid] = ret;

        return ret;
    }

};

module.exports = EntriesManager;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./InPlaceEditor":312,"js-cookie":209,"js/Base/Browser":278,"js/Base/Logger":293,"js/Base/Pages":295,"js/Base/SpeedTrack":296,"js/Base/URLGenerator":298,"js/Base/Window":299,"js/Base/globalData":302,"js/Locale":561,"js/Messenger":562,"js/Util/positionToString":584,"js/Util/replaceYoutubeURL":586,"js/Util/updateDynamicPieces":591,"js/Util/waitForResource":592}],310:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Logger = require('js/Base/Logger');

var EntryModuleCarousel = function EntryModuleCarousel($container, opts) {
    this.init($container, opts);
};

EntryModuleCarousel.prototype = {
    init: function init($container, opts) {
        if (!opts) opts = {};

        var self = this;
        self.moveInProgress = false;
        self.$containerElem = $container;
        self.$goBackElem = $($.parseHTML('<a class="module-entries-carousel-button back"><span>Back</span<</a>'));
        self.$goForwardElem = $($.parseHTML('<a class="module-entries-carousel-button forward"><span>Forward</span></a>'));

        self.isAutoScroll = opts.isAutoScroll || false;
        self.autoScrollInterval = opts.autoScrollInterval || 5000;
        // 
        self.displayEntrySizeAtOnce = opts.displayEntrySizeAtOnce || 2;

        if (self.isAutoScroll) {
            self.autoScrollIntervalId = window.setInterval(function (self) {
                self.goForwardWithLoop();
            }, self.autoScrollInterval, self);
        }

        self.$containerElem.on('click', '.module-entries-carousel-button.back.active', function () {
            if (self.isAutoScroll) {
                window.clearInterval(self.autoScrollIntervalId);
            }
            self.goBack();
        });
        self.$containerElem.on('click', '.module-entries-carousel-button.forward.active', function () {
            if (self.isAutoScroll) {
                window.clearInterval(self.autoScrollIntervalId);
            }
            self.goForward();
        });
        self.currentPosition = 0;

        var $carouselBodyElem = self.getCarouselBodyElem();
        self.carouselList = $carouselBodyElem.find('.urllist-item');
        self.carouselElementsSize = self.carouselList.length;
        // 1, ` - ( - 1)`
        self.carouselSize = self.carouselElementsSize - (self.displayEntrySizeAtOnce - 1);

        self.$directNavigationListElem = $($.parseHTML('<ol class="module-entries-carousel-navigation">'));
        var counter = 0;
        while (counter < self.carouselSize) {
            self.$directNavigationListElem.append($($.parseHTML('<li><a data-carousel-index="' + counter + '"><span>' + counter + '</span></a></li>')));
            counter++;
        }
        self.$containerElem.on('click', '.module-entries-carousel-navigation a.active', function (event) {
            //  
            if (self.isAutoScroll) {
                window.clearInterval(self.autoScrollIntervalId);
            }
            self.goToIndex(Number($(this).attr('data-carousel-index')));
        });

        self.updateNavigationElementsClass();

        self.$containerElem.append(self.$goBackElem);
        self.$containerElem.append(self.$goForwardElem);
        self.$containerElem.append(self.$directNavigationListElem);
    },
    canGoBack: function canGoBack() {
        var self = this;
        if (self.currentPosition > 0) {
            return true;
        }
        return false;
    },
    // 6Carousel5
    canGoForward: function canGoForward() {
        var self = this;
        if (self.currentPosition < self.carouselSize - (self.displayEntrySizeAtOnce - 1)) {
            return true;
        }
        return false;
    },
    updateNavigationElementsClass: function updateNavigationElementsClass() {
        var self = this;
        self.$goBackElem.toggleClass('active', self.canGoBack());
        self.$goForwardElem.toggleClass('active', self.canGoForward());

        self.$directNavigationListElem.find('a').removeClass('current');
        self.$directNavigationListElem.find('a[data-carousel-index="' + self.currentPosition + '"]').addClass('current');

        self.$directNavigationListElem.find('a').addClass('active');
        self.$directNavigationListElem.find('a.current').removeClass('active');
    },
    // margin.width()offset
    getUnitWidth: function getUnitWidth() {
        var self = this;
        var $bodyElem = self.getCarouselBodyElem();
        var $unitElem = $bodyElem.find('.urllist-item');
        if ($unitElem.length === 0) {
            Logger.BUG("Can't get unit width");return 200;
        } else if ($unitElem.length === 1) {
            return $unitElem.width();
        }
        return $($unitElem[1]).offset().left - $($unitElem[0]).offset().left;
    },
    getCarouselBodyElem: function getCarouselBodyElem() {
        var self = this;
        return $(self.$containerElem).find('.urllist-with-thumbnails');
    },
    goToIndex: function goToIndex(index) {
        var self = this;
        if (index < 0 || index >= self.carouselSize) {
            return;
        }
        if (self.moveInProgress) {
            return;
        }
        self.moveInProgress = true;

        var $bodyElem = self.getCarouselBodyElem();
        var originalOffset = $bodyElem.offset();

        var moveSize = self.getUnitWidth() * (index - self.currentPosition);
        var relativeOffset = '-=' + moveSize + 'px';
        $bodyElem.animate({
            left: relativeOffset
        }, 300, function () {
            self.currentPosition = index;
            self.updateNavigationElementsClass();
            self.moveInProgress = false;
        });
    },
    goBack: function goBack() {
        this.goToIndex(this.currentPosition - 1);
    },
    goForward: function goForward() {
        this.goToIndex(this.currentPosition + 1);
    },
    goForwardWithLoop: function goForwardWithLoop() {
        if (this.canGoForward()) {
            this.goForward();
        } else {
            this.goToIndex(0);
        }
    }
};

module.exports = EntryModuleCarousel;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Logger":293}],311:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var globalData = require('js/Base/globalData');
var Pages = require('js/Base/Pages');
var Dropdown = require('js/Base/Dropdown');
var Feedback = require('js/Base/Feedback');
var Window = require('js/Base/Window');

var EntriesManager = require('./EntriesManager');
var MyMenuDropdown = require('./MyMenuDropdown');

var GlobalHeaderSubscriber = {

    navigateToEditNewEntry: function navigateToEditNewEntry() {
        Pages.infoLoaded.then(function (info) {
            if (info.can_open_editor) {
                EntriesManager.newEntry();
            } else {
                location.href = globalData('admin-domain') + '/my/?fragment=edit';
            }
        });
    },

    navigateToEditNewEntryWithQuote: function navigateToEditNewEntryWithQuote() {
        Pages.infoLoaded.then(function () {
            location.href = globalData('admin-domain') + '/my/edit?sidebar=quote#auto_fillin';
        });
    },

    navigateToEditNewEntryWithReQuote: function navigateToEditNewEntryWithReQuote() {
        Pages.infoLoaded.then(function () {
            location.href = globalData('admin-domain') + '/my/edit';
        });
    },

    init: function init() {
        if (window !== window.parent) {
            return null;
        }
        if (!Messenger.messenger) {
            return null;
        }

        Messenger.addEventListener('new-entry', function () {
            GlobalHeaderSubscriber.navigateToEditNewEntry();
        });

        Messenger.addEventListener('new-entry-with-quote', function () {
            GlobalHeaderSubscriber.navigateToEditNewEntryWithQuote();
        });
        Messenger.addEventListener('new-entry-with-requote', function () {
            GlobalHeaderSubscriber.navigateToEditNewEntryWithReQuote();
        });

        Messenger.addEventListener('units', function (data) {
            Dropdown.toggle(data.uri, data);
        });

        Messenger.addEventListener('feedback', function (data) {
            Feedback.toggle(data.uri);
        });

        Messenger.addEventListener('mymenu', function (data) {
            MyMenuDropdown.toggle(data);
        });

        Messenger.addEventListener('servicesmenu', function (data) {
            Dropdown.toggle('/-/menu/services', data);
        });

        Messenger.addEventListener('unread', function () {
            location.href = globalData('admin-domain') + '/-/antenna';
        });

        var $notifyOrigin = $('\n          <div id="notify-window" class="hatena-globalheader-window" style="display: none;">\n            <iframe style="border:none" frameBorder="0"\n              class="notify" width="250" height="300"\n              ></iframe>\n          </div>\n        '.trim());
        var $notifyWindow = undefined;
        Messenger.addEventListener('notify', function (data) {
            var BASE = data.BASE;

            // XXX: Window.hideremove
            //  is(':visible') remove
            if ($notifyWindow) {
                if ($notifyWindow.is(':visible')) {
                    Window.hide($notifyWindow);
                    return;
                }
                $notifyWindow.remove();
            }

            $notifyWindow = $notifyOrigin.clone();
            $notifyWindow.css({
                left: data.left - 250 + 32
            });

            var $iframe = $notifyWindow.find('iframe');
            $iframe.attr('src', 'https://www' + BASE + '/notify/notices.iframe?' + new Date().getTime());

            $notifyWindow.appendTo(document.body).fadeIn('fast');

            Window.show($notifyWindow, {
                fixScroll: true
            });
        });

        Messenger.addEventListener('blogmenu', function (data) {
            var params = {};

            if (globalData('blog')) {
                params['blog'] = location.href;

                //  or Not Found  
                // 
                if (globalData('page') === 'entry' && $('article.entry:not([class~="no-entry"])').length > 0) {
                    params['blog_permalink'] = 1;
                }
            }

            var uri = '/-/menu/blogmenu?' + $.param(params);
            Dropdown.toggle(uri, data, 'blogmenu', {
                callback: function callback(dropdown, messenger) {
                    messenger.addEventListener('request-report-abuse-info', function () {
                        var sourceOrigin = globalData('admin-domain');
                        var param = $.param({ blog: window.location.href });

                        var info = {
                            target_label: globalData('author'),
                            target_url: sourceOrigin + '/go?' + param,
                            location: sourceOrigin + '/go?' + param
                        };
                        messenger.send('response-report-abuse-info', info);
                    });
                    messenger.addEventListener('edit-this-entry', function () {
                        var $entry = $('article.entry').first();
                        EntriesManager.editEntryInPlace($entry);
                    });
                    messenger.addEventListener('new-entry', function () {
                        GlobalHeaderSubscriber.navigateToEditNewEntry();
                    });
                    // blogs
                    messenger.addEventListener('subscribe', function (subscribeData) {
                        $(document).trigger('subscribe', subscribeData);
                    });
                }
            });
        });

        Messenger.addEventListener('locale', function (data) {
            var uri = globalData('admin-domain') + '/-/locale';

            Dropdown.toggle(uri, data, 'locale');
        });
    }

};

module.exports = GlobalHeaderSubscriber;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./EntriesManager":309,"./MyMenuDropdown":318,"js/Base/Dropdown":282,"js/Base/Feedback":285,"js/Base/Pages":295,"js/Base/Window":299,"js/Base/globalData":302,"js/Messenger":562}],312:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var URLGenerator = require('js/Base/URLGenerator');
var globalData = require('js/Base/globalData');
var Window = require('js/Base/Window');
var Locale = require('js/Locale');
var Messenger = require('js/Messenger');

var InPlaceEditor = {

    id: 'hatena-diary-edit-in-place',

    // properties
    $entry: null,
    opts: null,
    isUpdated: false,
    $container: null,
    $iframe: null,
    $loading: null,
    messenger: null,

    /**
     * iframe
     * 
     * @param {jQuery} $entry - 
     * @param {Object} opts
     */
    showEditInPlace: function showEditInPlace($entry, opts) {
        var _this = this;

        var oldElement = document.getElementById(InPlaceEditor.id);
        if (oldElement) {
            oldElement.parentNode.removeChild(oldElement);
        }

        this.$entry = $entry;
        this.opts = opts;

        // DOM
        this.createElements();

        // iframe
        var iframe = this.$iframe[0];
        var uri = this.getEditorUrl();
        this.messenger = Messenger.createForFrame(iframe, uri);
        this.subscribeMessages();

        // 
        Window.show(this.$container, {
            closeExplicitly: true,
            fixScroll: true,
            destroy: function destroy() {
                _this.$iframe.remove();
                _this.messenger.destroy();
            }
        });
    },

    /**
     * iframe
     */
    createElements: function createElements() {
        var _this2 = this;

        this.$container = $(('\n          <div id="' + InPlaceEditor.id + '" class="hatena-iframe-container" style="display: none;">\n            <div class="loading" style="display: none;">\n              <img src="' + URLGenerator.static_url('/images/loading.gif') + '" alt=""/>\n              ' + Locale.text('loading') + '\n            </div>\n            <iframe frameborder="0"></iframe>\n          </div>\n        ').trim()).appendTo(document.body);

        this.$iframe = this.$container.find('iframe');
        this.$loading = this.$container.find('.loading');
        this.$loading.on('click', function () {
            return false;
        });

        setTimeout(function () {
            return _this2.$loading.show();
        }, 250);

        this.resizeContainer();
        $(window).on('resize', _.throttle(function () {
            return _this2.resizeContainer();
        }, 100));
    },

    /**
     * messenger
     */
    subscribeMessages: function subscribeMessages() {
        var _this3 = this;

        this.messenger.addEventListener('ready', function () {
            _this3.$loading.remove();
        });

        var onClose = function onClose() {
            return _this3.close();
        };
        this.messenger.addEventListener('close', onClose);
        this.messenger.addEventListener('update', function (data) {
            // submitconfirm
            _this3.messenger.removeEventListener('close', onClose);
            _this3.messenger.addEventListener('close', function () {
                return _this3.closeContainerWindow();
            });

            _this3.opts.update(data);
        });

        this.messenger.addEventListener('change', function (_isUpdated) {
            _this3.isUpdated = !!_isUpdated;
        });
    },

    /**
     * window
     */
    resizeContainer: function resizeContainer() {
        var CONTAINER_MARGIN = 27;

        this.$container.css({
            width: $(window).width() - CONTAINER_MARGIN * 2,
            height: $(window).height() - CONTAINER_MARGIN * 2,
            left: CONTAINER_MARGIN
        });
    },

    close: function close() {
        if (this.isUpdated && !confirm(Locale.text('form.confirm.changed.epic'))) {
            return false; // 
        } else {
                this.closeContainerWindow();
                this.messenger.send('close-preview-window'); // 
            }
    },

    closeContainerWindow: function closeContainerWindow() {
        // youtubeiframeIE11 #8762
        this.$container.find('iframe').remove();
        Window.hide(this.$container);
    },

    /**
     * iframeURL
     */
    getEditorUrl: function getEditorUrl() {
        var params = {
            editinplace: 1
        };

        if (this.$entry) {
            params.entry = this.$entry.attr('data-uuid');
        }
        if (this.opts.title) {
            params.title = this.opts.title;
        }
        if (this.opts.body) {
            params.body = this.opts.body;
        }

        var adminDomain = globalData('admin-domain');
        var author = globalData('author');
        var blog = globalData('blog');

        return adminDomain + '/' + author + '/' + blog + '/edit?' + $.param(params);
    }

};

module.exports = InPlaceEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/URLGenerator":298,"js/Base/Window":299,"js/Base/globalData":302,"js/Locale":561,"js/Messenger":562,"underscore":213}],313:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var SpeedTrack = require('js/Base/SpeedTrack');
var URLGenerator = require('js/Base/URLGenerator');
var globalData = require('js/Base/globalData');

var init = function init() {
    var $archives = $('.hatena-module-archive');
    if ($archives.length === 0) return;

    var detectDate = function detectDate() {
        // archive, 
        if (globalData('page') === 'archive') {
            var $entry = $('section.archive-entry:first');
            if ($entry.length > 0) {
                var year_month_day = $entry.find('div.date > a > time').attr('datetime');
                var year_str = year_month_day.split('-')[0];
                var month_str = year_month_day.split('-')[1];

                return { year: year_str, month: month_str };
            }

            return null;
        }

        // , 
        var $article = $('article.entry:first');
        if ($article.length > 0) {
            var date_year_str = $article.find('header time > span.date-year').text();
            var date_month_str = $article.find('header time > span.date-month').text();
            return { year: date_year_str, month: date_month_str };
        }

        return null;
    };

    // default
    var setupDefault = function setupDefault($archive) {
        var $open_year;
        var date = detectDate();
        if (date) {
            var year = date['year'];
            if (year) {
                var $year = $archive.find('li.archive-module-year[data-year="' + year + '"]');

                $open_year = $year.length > 0 ? $year : null;
            }
        }

        $open_year = $open_year || $('li.archive-module-year:first');
        $open_year.removeClass('archive-module-year-hidden');

        $archive.find('.archive-module-button').click(function (e) {
            e.preventDefault();

            var $year = $(this).parent('.archive-module-year');
            $year.toggleClass('archive-module-year-hidden');
        });
    };

    // calendar
    var setupCalendar = function setupCalendar($archive) {
        var $selector = $archive.find('.js-archive-module-calendar-selector');

        var updateCalendar = function updateCalendar() {
            var $date = $selector.find('option:selected');
            var year = $date.data('year');
            var month = $date.data('month');
            $.ajax({
                type: 'get',
                url: URLGenerator.user_blog_url('/archive_module_calendar'),
                data: { month: month, year: year }
            }).done(function (res) {
                // days object
                $archive.find('.js-archive-module-calendar-container').html(res);
            });
        };

        $selector.change(function () {
            updateCalendar();
        });

        // 
        var date = detectDate();
        if (date) {
            $selector.val(date['year'] + ' ' + date['month']);
        }
        updateCalendar();
    };

    // Archivetype( default, calendar )
    _.each($archives, function (archive) {
        var $archive = $(archive);
        var archiveType = $archive.data('archiveType');
        $.ajax({
            type: 'get',
            url: URLGenerator.user_blog_url('/archive_module'),
            data: { archive_type: archiveType },
            dataType: 'html'
        }).done(function (res) {
            $archive.find('.hatena-module-body').append(res);

            SpeedTrack.record("Pages.Blogs['*'].setupArchiveModule");

            if (archiveType == 'calendar') {
                setupCalendar($archive);
            } else {
                setupDefault($archive);
            }
        });
    });
};

module.exports = {
    init: init
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/SpeedTrack":296,"js/Base/URLGenerator":298,"js/Base/globalData":302,"underscore":213}],314:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var SpeedTrack = require('js/Base/SpeedTrack');
var URLGenerator = require('js/Base/URLGenerator');

var init = function init() {
    var $circles = $('.hatena-module-circles');
    if ($circles.length === 0) return;

    // JS
    var mtime = 0,
        circleIds = [],
        elems = {};
    $circles.find('[data-circle-id][data-circle-mtime]').each(function () {
        var $elem = $(this);
        var circleId = $elem.attr('data-circle-id');
        circleIds.push(circleId);
        elems[circleId] = $elem;
        var m = Number($elem.attr('data-circle-mtime'));
        if (m > mtime) mtime = m;
    });

    $.ajax({
        type: 'GET',
        url: URLGenerator.user_blog_url('/api/module/circles'),
        data: { mtime: mtime, circle_id: circleIds },
        traditional: true,
        dataType: 'json'
    }).done(function (data) {
        for (var circleId in data.circles) {
            elems[circleId].replaceWith($.parseHTML(data.circles[circleId].html || ' '));
        }

        SpeedTrack.record("Pages.Blogs['*'].setupCirclesModule");
    });
};

module.exports = {
    init: init
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/SpeedTrack":296,"js/Base/URLGenerator":298}],315:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var URLGenerator = require('js/Base/URLGenerator');

var init = function init() {
    var $entriesAccessRanking = $('.hatena-module-entries-access-ranking');
    if ($entriesAccessRanking.length === 0) return;

    $entriesAccessRanking.each(function () {
        var $self = $(this);
        var queryParams = {};
        // `data-`prefix
        _.each($self[0].attributes, function (attr) {
            if (!attr.name.match(/^data-/)) return;
            // `data-`prefixkey
            queryParams[attr.name.replace(/^data\-/, '')] = attr.value;
        });

        $.ajax({
            type: 'GET',
            url: URLGenerator.user_blog_url('/entries_access_ranking_module'),
            data: queryParams,
            dataType: 'html'
        }).done(function (res) {
            $self.find('.hatena-module-body').append(res);
        });
    });
};

module.exports = {
    init: init
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/URLGenerator":298,"underscore":213}],316:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var SpeedTrack = require('js/Base/SpeedTrack');
var URLGenerator = require('js/Base/URLGenerator');
var updateDynamicPieces = require('js/Util/updateDynamicPieces');

var init = function init() {
    var $recentComments = $('.hatena-module-recent-comments');
    if ($recentComments.length === 0) return;
    var template = _.template($('.recent-comments-template').html());

    var max_count = 0;
    // 
    $recentComments.each(function () {
        var $moduleBody = $(this).find('.hatena-module-body');
        var count = $moduleBody.attr('data-count');
        max_count = _.max([max_count, count]);
    });
    if (max_count === 0) return;

    $.ajax({
        url: URLGenerator.user_blog_url('/api/recent_comments'),
        dataType: 'json',
        data: {
            count: max_count
        }
    }).done(function (comments) {
        $recentComments.each(function () {
            var $container = $(this);
            var $moduleBody = $container.find('.hatena-module-body');
            var count = $moduleBody.attr('data-count');
            var comment_source = '';
            for (var i = 0; i < count; i++) {
                if (!comments[i]) break;
                comment_source += template({
                    comment: comments[i]
                });
            }
            $container.find('.recent-comments').html(comment_source);
            updateDynamicPieces($container);
        });

        SpeedTrack.record("Pages.Blogs['*'].setupRecentCommentsModule");
    });
};

module.exports = {
    init: init
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/SpeedTrack":296,"js/Base/URLGenerator":298,"js/Util/updateDynamicPieces":591,"underscore":213}],317:[function(require,module,exports){
'use strict';

var Archive = require('./Archive');
var Circles = require('./Circles');
var EntriesAccessRanking = require('./EntriesAccessRanking');
var RecentComments = require('./RecentComments');

var init = function init() {
    var modules = [Archive, Circles, EntriesAccessRanking, RecentComments];
    modules.forEach(function (module) {
        module.init();
    });
};

module.exports = {
    init: init
};

},{"./Archive":313,"./Circles":314,"./EntriesAccessRanking":315,"./RecentComments":316}],318:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Dropdown = require('js/Base/Dropdown');
var Feedback = require('js/Base/Feedback');

var MyMenuDropdown = {

    // Properties
    dropdown: null,
    $activeContainer: null,
    blogToDropdownContainer: {},

    toggle: function toggle(myMenuData) {
        var _this = this;

        var myMenuUrl = '/-/menu/mymenu?location=' + encodeURIComponent(location.href);

        Dropdown.toggle(myMenuUrl, myMenuData, 'mymenu', {

            callback: function callback(dropdown, messenger) {
                MyMenuDropdown.dropdown = dropdown;

                messenger.addEventListener('feedback', function (data) {
                    Feedback.toggle(data.uri);
                });

                messenger.addEventListener('myblogmenu.init', function (data) {
                    _this.initMyBlogMenu(data);
                });

                messenger.addEventListener('myblogmenu.open', function (data) {
                    var $dropdownContainer = _this.blogToDropdownContainer[data.blogUri];
                    $dropdownContainer.show();
                    _this.$activeContainer = $dropdownContainer;
                });

                messenger.addEventListener('myblogmenu.close', function (data) {
                    var $dropdownContainer = _this.blogToDropdownContainer[data.blogUri];
                    $dropdownContainer.hide();
                    _this.$activeContainer = null;
                });
            }
        });

        // , 
        if (this.$activeContainer && this.$activeContainer.is(':hidden')) {
            this.$activeContainer.fadeIn('fast');
        }
    },

    initMyBlogMenu: function initMyBlogMenu(data) {
        var _this2 = this;

        var init = {
            top: $(this.dropdown).offset().top + data.top,
            right: $(this.dropdown).offset().left - 2,
            height: 266
        };

        var myBlogMenuUrl = '/-/menu/myblogmenu?blog=' + encodeURIComponent(data.blogUri);
        Dropdown.toggle(myBlogMenuUrl, init, null, {
            callback: function callback(dropdown) {
                _this2.blogToDropdownContainer[data.blogUri] = $(dropdown).parent();

                // XXX: callbackshow
                // 
                _.delay(function () {
                    return $(dropdown).parent().hide();
                });
            },
            key: data.blogUri,
            parent: 'mymenu',
            className: 'hatena-diary-dropdown-myblogs'
        });
    }

};

module.exports = MyMenuDropdown;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Dropdown":282,"js/Base/Feedback":285,"underscore":213}],319:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');

var ReQuote = function ReQuote() {
    this.init();
};

ReQuote.prototype = {
    init: function init() {
        this.quote = {
            body: '',
            url: '',
            title: ''
        };

        this.$reQuoteButton = $($('#js-requote-button-template').html().trim());

        this.bindEvents();
    },

    // Ten.base.js getSelectedText
    getSelectedText: function getSelectedText() {
        if (window.getSelection) {
            return '' + (window.getSelection() || '');
        }
        if (document.getSelection) {
            return document.getSelection();
        }
        if (document.selection) {
            return document.selection.createRange().text;
        }
        return '';
    },

    selectedTextExists: function selectedTextExists() {
        return this.getSelectedText().length > 0;
    },

    bindEvents: function bindEvents() {
        var self = this;

        $(document).on('mouseenter', 'blockquote', function (e) {
            // 
            if (self.selectedTextExists() === false) {
                // hovere.targetap
                // blockquote
                var $blockquote = $(e.target).closest('blockquote');
                // blockquoteblockquote
                if ($blockquote.find('blockquote').length > 0) {
                    return;
                }

                self.focusOnBlockquote($blockquote);
                self.showButton();
            }
        });

        $(document).on('mouseleave', 'blockquote', function (e) {
            var $toElement = $(e.toElement);
            if ($toElement.hasClass('js-select_quote_panel') === false) {
                self.hideButton();
            }
        });

        // ReQuoteblockquote
        // ReQuote
        $(document).on('mouseup', 'blockquote', function () {
            if (self.selectedTextExists()) {
                self.hideButton();
            } else {
                self.showButton();
            }
        });

        // ReQuote
        self.$reQuoteButton.on('click', function () {
            // ReQuote -> admin
            Messenger.send('requote-edit-entry', { quote: self.quote });
            return false;
        });
    },

    focusOnBlockquote: function focusOnBlockquote($blockquote) {
        this.$blockquote = $blockquote;
        this.setButtonData($blockquote);
        this.$blockquote.append(this.$reQuoteButton);
    },

    setButtonData: function setButtonData($blockquote) {
        // blockquoteAPI
        // 
        //  test/Blogs/ReQuote.html 
        this.setQuoteBody($blockquote);
        this.setQuoteMeta($blockquote);

        // cite
        if (this.quote.body === '') {
            this.quote.body = this.quote.title;
            this.quote.title = this.quote.url;
        }
    },

    // blockquote
    setQuoteBody: function setQuoteBody($blockquote) {
        var $quoteBody = $blockquote.children(':not(cite, .js-requote-button)');

        if ($quoteBody.length <= 0) {
            this.quote.body = $blockquote.contents().get(0).nodeValue || '';
        } else {
            this.quote.body = $quoteBody.text();
        }
    },

    // blockquote
    setQuoteMeta: function setQuoteMeta($blockquote) {
        var $cite = $blockquote.find('cite');
        var $a = $cite.find('a');

        var url = $blockquote.attr('cite') || $a.attr('href');

        if (url === undefined) {
            var $article = $blockquote.closest('article');
            var $metadata = $article.find('.entry-title .entry-title-link');

            url = $metadata.attr('href');
        }

        var title = $a.text() || $cite.text() || url;

        this.quote.url = url;
        this.quote.title = title;
    },

    showButton: function showButton() {
        this.$reQuoteButton.addClass('is-visible');
    },

    hideButton: function hideButton() {
        this.$reQuoteButton.removeClass('is-visible');
    }
};

module.exports = ReQuote;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562}],320:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var globalData = require('js/Base/globalData');
var SubscribeButton = require('js/SubscribeButton');

// / 
// -  : 
// -  : ""
// -  : ""
// args:
//   isSubscribing : 
//   subscribers   : 
var init = function init(isSubscribing, subscribers) {
    // 
    var blogUrl = globalData('blog');
    var userData = {
        isSubscribing: isSubscribing,
        isGuest: globalData('rkm') && globalData('rkc') ? false : true
    };
    var blogData = {
        subscribersCount: subscribers,
        blogUrl: blogUrl,
        blogName: globalData('blog-name'),
        requestUrl: [globalData('admin-domain'), globalData('author'), blogUrl, 'subscribe'].join('/')
    };

    // Messenger
    var messenger = Messenger.createForCurrentWindow();

    // 
    var buttons = $('.hatena-follow-button-box').map(function () {
        return new SubscribeButton.Blogs($(this), userData, blogData, messenger);
    }).toArray();

    // /
    // iframeglobalHeader
    // admin -> blogs
    Messenger.addEventListener('subscription', function (data) {
        messenger.send('subscription', data);
    });
    // blogs -> admin
    messenger.addEventListener('subscription', function (data) {
        Messenger.send('subscription', data);
    });

    // globalHeadersubscribe
    var $hiddenButton = $('#hidden-subscribe-button > .hatena-follow-button-box');
    this.subscribeButtonForMessage = new SubscribeButton.Blogs($hiddenButton, userData, blogData, messenger);

    var self = this;
    Messenger.addEventListener('subscribe', function (data) {
        var offset = { left: data.left + 5 };
        self.subscribeButtonForMessage.openSubscribeWindow(offset, true);
    });

    // globalheader
    messenger.addEventListener('subscription', function (data) {
        if (data[blogUrl] === true) {
            Messenger.send('subscribed-current-blog');
        }
    });

    $(document).on('subscribe', function (e, data) {
        var offset = { left: data.left + 5 };
        self.subscribeButtonForMessage.openSubscribeWindow(offset, true);
    });
};

module.exports = {
    init: init
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/Messenger":562,"js/SubscribeButton":570}],321:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * Tumblr  http://www.tumblr.com/apps#bookmarklet_window 
 * URL 
 */
var TumblrShareButtons = {

    init: function init(elem) {
        var $elem = $(elem || document.body);

        $elem.on('click', 'a[data-hatenablog-tumblr-share-button]', function (e) {
            var $button = $(e.currentTarget);

            // 
            var selection = (window.getSelection ? window.getSelection() : document.getSelection ? document.getSelection() : document.selection ? document.selection.createRange().text : 0) + '';

            var url = 'http://www.tumblr.com/share?' + $.param({
                v: 3,
                u: $button.attr('data-share-url') || location.href,
                t: $button.attr('data-share-title') || document.title,
                s: selection
            });
            var go = function go() {
                if (!window.open(url, 't', 'toolbar=0,resizable=0,status=1,width=450,height=430')) {
                    location.href = url;
                }
            };

            if (/Firefox/.test(navigator.userAgent)) {
                setTimeout(go, 0);
            } else {
                go();
            }

            return false;
        });
    }

};

module.exports = TumblrShareButtons;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],322:[function(require,module,exports){
'use strict';

var globalData = require('js/Base/globalData');
var BUG = require('js/Base/Logger').BUG;

/**
 * Analytics
 * 10
**/
var trackBlogVisit = function trackBlogVisit() {
    setTimeout(function () {
        if (!window.ga) {
            BUG('window.ga is not defined');
            return;
        }

        var type = globalData('plus-available') ? 'pro' : 'free';

        window.ga('HatenaBlogTracker.send', {
            'hitType': 'event',
            'eventCategory': 'PageView',
            'eventAction': 'VisitBlog',
            'eventLabel': type
        });
    }, 10 * 1000);
};

module.exports = trackBlogVisit;

},{"js/Base/Logger":293,"js/Base/globalData":302}],323:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var globalData = require('js/Base/globalData');
var IframeBox = require('./IframeBox');

/**
 * 
 */

var Comment = (function () {

    /**
     * @param {jQuery} $element
     */

    function Comment($element) {
        _classCallCheck(this, Comment);

        this.$element = $element;

        this.uuid = $element.attr('id');

        this.initDeleteButton();
    }

    /**
     * iframe
     */

    _createClass(Comment, [{
        key: 'initDeleteButton',
        value: function initDeleteButton() {
            var _this = this;

            this.deleteBox = new IframeBox(this.$element, this.getDeleteUrl());

            this.deleteBox.on('delete', function () {
                return _this['delete']();
            });

            this.$element.on('click', '.js-comment-delete-button', function () {
                _this.deleteBox.show();
                return false;
            });
        }
    }, {
        key: 'getDeleteUrl',
        value: function getDeleteUrl() {
            var adminDomain = globalData('admin-domain');
            var author = globalData('author');
            var blog = globalData('blog');
            var uuid = encodeURIComponent(this.uuid.slice(8));

            return adminDomain + '/' + author + '/' + blog + '/comment/delete?comment=' + uuid;
        }

        /**
         * 
         * 
         */
    }, {
        key: 'delete',
        value: function _delete() {
            this.$element.fadeOut();
        }
    }, {
        key: 'getElement',
        value: function getElement() {
            return this.$element;
        }
    }]);

    return Comment;
})();

module.exports = Comment;

},{"./IframeBox":325,"js/Base/globalData":302}],324:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Cookie = require('js-cookie');

var Logger = require('js/Base/Logger');
var Pages = require('js/Base/Pages');
var URLGenerator = require('js/Base/URLGenerator');
var globalData = require('js/Base/globalData');
var replaceYoutubeURL = require('js/Util/replaceYoutubeURL');
var updateDynamicPieces = require('js/Util/updateDynamicPieces');

var Comment = require('./Comment');
var IframeBox = require('./IframeBox');

/**
 * 
 */

var Entry = (function () {

    /**
     * @param {jQuery} $element
     */

    function Entry($element) {
        _classCallCheck(this, Entry);

        replaceYoutubeURL($element);

        // 
        this.$element = $element;
        this.$commentBox = $element.find('.js-comment-box');
        this.$commentList = $element.find('.js-comment-box .js-comment');
        this.$showCommentInputButton = $element.find('.js-leave-comment-title');

        // 
        this.uuid = this.$element.attr('data-uuid');
        this.comments = [];

        this.initComments();
        this.initCommentInputBox();
        this.initEditButton();
    }

    /**
     * HTML
     * setTimeout
     * @param {string} entryId
     */

    /**
     * 
     */

    _createClass(Entry, [{
        key: 'initComments',
        value: function initComments() {
            var _this = this;

            // 
            return Entry.loadEntryInfo(this.uuid).done(function (info) {
                if (!info.comments) {
                    return;
                }

                _this.comments = info.comments.entries.map(function (comment) {
                    return new Comment($(comment));
                });

                _this.renderComments();
            });
        }

        /**
         * 
         */
    }, {
        key: 'initCommentInputBox',
        value: function initCommentInputBox() {
            var _this2 = this;

            var inputUri = this.getCommentInputUrl();

            this.inputBox = new IframeBox(this.$commentBox, inputUri);
            this.inputBox.on('update', function (data) {
                _this2.addComment(new Comment($(data.comment)));
                _this2.renderComments();
            });

            this.$showCommentInputButton.on('click', function () {
                _this2.inputBox.show();
                return false;
            });
        }

        /**
         * 
         */
    }, {
        key: 'initEditButton',
        value: function initEditButton() {
            var _this3 = this;

            var $buttonContainer = this.$element.find('.js-entry-edit-button-container');
            var $button = $buttonContainer.find('.js-entry-edit-button');

            Pages.infoLoaded.then(function (info) {
                if (!info.editable) {
                    return;
                }

                $buttonContainer.show();
                $button.attr('href', _this3.getEditorUrl());
            });
        }

        /**
         * iframeURL
         * @return {String}
         */
    }, {
        key: 'getCommentInputUrl',
        value: function getCommentInputUrl() {
            var adminDomain = globalData('admin-domain');
            var author = globalData('author');
            var blog = globalData('blog');

            var params = $.param({
                entry: this.uuid,
                token: Cookie.get('bk')
            });

            return adminDomain + '/touch/' + author + '/' + blog + '/comment?' + params;
        }

        /**
         * iframeURL
         * @return {String}
         */
    }, {
        key: 'getEditorUrl',
        value: function getEditorUrl() {
            var adminDomain = globalData('admin-domain');
            var author = globalData('author');
            var blog = globalData('blog');

            return adminDomain + '/' + author + '/' + blog + '/edit?entry=' + this.uuid;
        }

        /**
         * 
         * @param {Comment} comment
         */
    }, {
        key: 'addComment',
        value: function addComment(comment) {
            if (globalData('blog-comments-top-is-new')) {
                this.comments.unshift(comment);
            } else {
                this.comments.push(comment);
            }
        }

        /**
         * $commentList
         */
    }, {
        key: 'renderComments',
        value: function renderComments() {
            var _this4 = this;

            // DOM
            // 
            this.comments.forEach(function (comment) {
                _this4.$commentList.append(comment.getElement());
            });

            // 
            updateDynamicPieces(this.$commentList);
        }
    }]);

    return Entry;
})();

Entry.loadEntryInfo = (function () {

    var timer = undefined;
    var data = undefined;

    var clearData = function clearData() {
        data = {
            entries: [],
            deferred: {}
        };
    };

    return function (entryId) {
        if (!timer) {
            clearData();
            timer = setTimeout(function () {
                timer = null;

                var currentData = data;
                clearData();

                $.ajax({
                    url: URLGenerator.user_blog_url('/api/entry/info'),
                    type: 'get',
                    dataType: 'json',
                    cache: false,
                    data: {
                        e: currentData.entries
                    }
                }).then(function (res) {
                    var entries = res.entries;
                    for (var key in entries) {
                        if (entries.hasOwnProperty(key)) {
                            var val = entries[key];
                            currentData.deferred[key].resolve(val);
                        }
                    }
                });
            }, 0);
        }

        var ret = $.Deferred();

        data.entries.push(entryId);
        data.deferred[entryId] = ret;

        return ret.fail(Logger.REPORT_BUG('loadEntryInfo'));
    };
})();

module.exports = Entry;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Comment":323,"./IframeBox":325,"js-cookie":209,"js/Base/Logger":293,"js/Base/Pages":295,"js/Base/URLGenerator":298,"js/Base/globalData":302,"js/Util/replaceYoutubeURL":586,"js/Util/updateDynamicPieces":591}],325:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _ = require('underscore');

var Messenger = require('js/Messenger');
var URLGenerator = require('js/Base/URLGenerator');
var Locale = require('js/Locale');

/**
 * BlogsTouchiframe
 */

var IframeBox = (function () {

    /**
     * @param {jQuery} $parent - $container
     * @param {string} url     - iframeURL
     */

    function IframeBox($parent, url) {
        _classCallCheck(this, IframeBox);

        this.url = url;
        this.$container = $(IframeBox.TEMPLATE({
            image: URLGenerator.static_url('/images/loading.gif'),
            text: Locale.text('loading')
        })).css({
            position: 'relative',
            width: '100%',
            'margin-left': '-1px' }). // border
        appendTo($parent);

        this.$loading = this.$container.find('.js-loading');

        this.eventListeners = {};
    }

    /** @constant */

    _createClass(IframeBox, [{
        key: 'show',
        value: function show() {
            var _this = this;

            // resizeiframe
            this.$iframe = $('<iframe frameborder="0"></iframe>');
            this.$container.append(this.$iframe);

            // setTimeout(function () { $loading.show(); }, 250);
            // $iframe.on('load', function () { $loading.remove(); });

            this.messenger = Messenger.createForFrame(this.$iframe[0], this.url);

            this.messenger.addEventListener('close', function () {
                _this.$container.fadeOut();
                _this.$iframe.remove();
                _this.messenger.destroy();
            });
            this.messenger.addEventListener('resize', function (css) {
                if (css) {
                    _this.$container.css(css);
                }
            });

            Object.keys(this.eventListeners).forEach(function (eventName) {
                var listeners = _this.eventListeners[eventName];
                listeners.forEach(function (listener) {
                    _this.messenger.addEventListener(eventName, listener);
                });
            });

            this.$container.fadeIn();
        }
    }, {
        key: 'on',
        value: function on(eventName, callback) {
            this.eventListeners[eventName] = this.eventListeners[eventName] || [];
            this.eventListeners[eventName].push(callback);
        }
    }]);

    return IframeBox;
})();

IframeBox.TEMPLATE = _.template('<div class="hatena-iframe-container" style="display: none;">' + '  <div class="loading js-loading" style="display: none;">' + '    <img src="<%- image %>" alt="loading"/>' + '    <%- text %>' + '  </div>' + '</div>');

module.exports = IframeBox;

},{"js/Base/URLGenerator":298,"js/Locale":561,"js/Messenger":562,"underscore":213}],326:[function(require,module,exports){
'use strict';

module.exports = require('./Entry');

},{"./Entry":324}],327:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var preventDuplicateSubmit = require('js/Util/preventDuplicateSubmit');

/**
 * 
 */
var CreatePage = {
    init: function init() {
        var $form = $('form#create-circle-form');

        $form.on('submit', function () {
            preventDuplicateSubmit($form);
        });
    }
};

module.exports = CreatePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/preventDuplicateSubmit":585}],328:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var Circle = require('js/Base/Circle');

var MembershipDonePage = {
    init: function init() {
        Messenger.listenToParent();

        Messenger.send('resize', {
            // iframe+50..
            // *1Opera see also src/js/Util/sendresizerequest.js
            height: ($(document.body).height() + 50) * 1
        });

        Messenger.send('done');

        $('.close').on('click', function (e) {
            Messenger.send('close', { name: window.name });
            return false;
        });

        var $container = $('.options');
        var $select = $container.find('.membership-category-select');
        var current = $select.find('option:selected').val();
        var $indicator = $container.find('.indicator');

        $select.change(function (e) {
            Circle.updateMembershipCategory($select).done(function (data) {
                $indicator.find('.success').show();
                $indicator.find('.fail').hide();
            }).error(function (data) {
                $select.val(current);
                $indicator.find('.success').hide();
                $indicator.find('.fail').show();
            });
        });
    }
};

module.exports = MembershipDonePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Circle":279,"js/Messenger":562}],329:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var MembershipPage = {
    init: function init() {
        Messenger.listenToParent();

        $('.close').on('click', function (e) {
            Messenger.send('close', { name: window.name });
            return false;
        });

        $('form').submit(function (e) {
            var $form = $(this);
            if (!confirm($form.attr('data-confirm-message'))) {
                return false;
            }
        });

        sendResizeRequest();
    }
};

module.exports = MembershipPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562,"js/Util/sendResizeRequest":587}],330:[function(require,module,exports){
'use strict';

var AmazonSearch = require('js/Editor/Component/AmazonSearch');
var SidebarSimulator = require('js/Editor/Component/SidebarSimulator');

var AmazonPage = {

    init: function init() {
        new AmazonSearch({
            container: $('#editor-amazon-search'),
            sidebar: new SidebarSimulator()
        });
    }

};

module.exports = AmazonPage;

},{"js/Editor/Component/AmazonSearch":430,"js/Editor/Component/SidebarSimulator":542}],331:[function(require,module,exports){
'use strict';

var Flickr = require('js/Editor/Component/Flickr');
var SidebarSimulator = require('js/Editor/Component/SidebarSimulator');

var FlickrPage = {

    init: function init() {
        if ($('#editor-flickr.enabled').get(0)) {
            Flickr.init({
                container: document.querySelector('#editor-flickr'),
                sidebar: new SidebarSimulator()
            });
        }
    }

};

module.exports = FlickrPage;

},{"js/Editor/Component/Flickr":468,"js/Editor/Component/SidebarSimulator":542}],332:[function(require,module,exports){
'use strict';

var Gourmet = require('js/Editor/Component/Gourmet');
var SidebarSimulator = require('js/Editor/Component/SidebarSimulator');

var GourmetPage = {

    init: function init() {
        if ($('#editor-gourmet.enabled').get(0)) {
            new Gourmet({
                container: $('#editor-gourmet'),
                sidebar: new SidebarSimulator()
            });
        }
    }

};

module.exports = GourmetPage;

},{"js/Editor/Component/Gourmet":483,"js/Editor/Component/SidebarSimulator":542}],333:[function(require,module,exports){
'use strict';

var Instagram = require('js/Editor/Component/Instagram');
var SidebarSimulator = require('js/Editor/Component/SidebarSimulator');

var InstagramPage = {

    init: function init() {
        if ($('#editor-instagram.enabled').get(0)) {
            new Instagram({
                container: $('#editor-instagram'),
                sidebar: new SidebarSimulator()
            });
        }
    }

};

module.exports = InstagramPage;

},{"js/Editor/Component/Instagram":488,"js/Editor/Component/SidebarSimulator":542}],334:[function(require,module,exports){
'use strict';

var Itunes = require('js/Editor/Component/Itunes');
var SidebarSimulator = require('js/Editor/Component/SidebarSimulator');

var ItunesPage = {

    init: function init() {
        new Itunes({
            container: $('#editor-itunes'),
            sidebar: new SidebarSimulator()
        });
    }

};

module.exports = ItunesPage;

},{"js/Editor/Component/Itunes":489,"js/Editor/Component/SidebarSimulator":542}],335:[function(require,module,exports){
(function (global){
'use strict';

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactDOM = (typeof window !== "undefined" ? window['ReactDOM'] : typeof global !== "undefined" ? global['ReactDOM'] : null);
var Logger = require('js/Base/Logger');
var PromotionEntry = require('js/Editor/Component/Promotion/PromotionEntry');
var PromotionTouch = require('js/Editor/Component/Promotion/components/PromotionTouch');
var EntriesActions = require('js/Editor/Component/Promotion/actions/EntriesActions');
var OdaiActions = require('js/Editor/Component/Promotion/actions/OdaiActions');

var PromotionStore = require('js/Editor/Component/Promotion/stores/PromotionStore');
var EntriesStoreTouch = require('js/Editor/Component/Promotion/stores/EntriesStoreTouch');
var OdaiStoreTouch = require('js/Editor/Component/Promotion/stores/OdaiStoreTouch');

var PromotionPage = {

    init: function init() {
        // Store
        PromotionStore.init();
        EntriesStoreTouch.init();
        OdaiStoreTouch.init();

        var modalElement = document.querySelector('#promotion');

        // PRPR
        // 21
        ReactDOM.render(React.createElement(PromotionTouch, null), modalElement);

        // HTMLJSON
        var entriesJson = modalElement.getAttribute('data-entries-json');
        var entries = [];
        try {
            entries = JSON.parse(entriesJson).map(function (e) {
                return new PromotionEntry(e);
            });
        } catch (e) {
            Logger.BUG(e, 'Cannot parse embedded PromotionEntry JSON data');
        }

        // Store
        EntriesActions.loadEntries(entries);
        OdaiActions.loadOdais();

        EntriesActions.showEntryAt(0);
    }

};

module.exports = PromotionPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Logger":293,"js/Editor/Component/Promotion/PromotionEntry":505,"js/Editor/Component/Promotion/actions/EntriesActions":506,"js/Editor/Component/Promotion/actions/OdaiActions":507,"js/Editor/Component/Promotion/components/PromotionTouch":520,"js/Editor/Component/Promotion/stores/EntriesStoreTouch":525,"js/Editor/Component/Promotion/stores/OdaiStoreTouch":528,"js/Editor/Component/Promotion/stores/PromotionStore":529}],336:[function(require,module,exports){
'use strict';

var Twitter = require('js/Editor/Component/Twitter');
var SidebarSimulator = require('js/Editor/Component/SidebarSimulator');

var TwitterPage = {

    init: function init() {
        if ($('#editor-twitter.enabled').get(0)) {
            new Twitter({
                container: $('#editor-twitter'),
                sidebar: new SidebarSimulator()
            });
        }
    }

};

module.exports = TwitterPage;

},{"js/Editor/Component/SidebarSimulator":542,"js/Editor/Component/Twitter":546}],337:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var BlogMenuPage = {

    init: function init() {
        Messenger.listenToParent();
        sendResizeRequest();

        Messenger.send('init');
        Messenger.addEventListener('init', function (init) {
            $('.subscribe').click(function () {
                Messenger.send('subscribe', {
                    left: init.left ? init.left : 0
                });
                return false;
            });
            Messenger.send('request-report-abuse-info', {});
            Messenger.addEventListener('response-report-abuse-info', function (data) {
                var abuseLink = $('.js-report-abuse-link');
                var query = $.param(data);
                abuseLink.attr('href', abuseLink.attr('href') + '?' + query);
            });
        });
        $('.edit-this-entry').click(function () {
            Messenger.send('edit-this-entry');
            return false;
        });
        $('.new-entry').click(function () {
            Messenger.send('new-entry');
            return false;
        });
    }

};

module.exports = BlogMenuPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562,"js/Util/sendResizeRequest":587}],338:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');
var waitForResource = require('js/Util/waitForResource');

var MyBlogMenuPage = {

    init: function init() {
        Messenger.listenToParent();

        // myblogmenu
        // Firefox
        // resize

        waitForResource(function () {
            return $(document.body).is(':visible');
        }, function () {
            sendResizeRequest();
        }, 100);

        $(document.body).mouseenter(function () {
            Messenger.send('mouseenter');
        });
    }

};

module.exports = MyBlogMenuPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562,"js/Util/sendResizeRequest":587,"js/Util/waitForResource":592}],339:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var Browser = require('js/Base/Browser');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var MyMenuPage = {

    init: function init() {
        Messenger.listenToParent();
        sendResizeRequest();

        var $help = $('#help');
        $help.click(function () {
            Messenger.send('feedback', {
                uri: $help.attr('data-feedback-url')
            });
            return false;
        });

        // iPad
        if (Browser.isTablet) {
            var last_submenu_blog_uri;

            $('a.myblog').on('touchstart touchmove', function () {
                return false;
            });

            $('a.myblog').on('touchend', function () {
                var blog_uri = $(this).attr('href');

                if (last_submenu_blog_uri) {
                    Messenger.send('myblogmenu.close', { blogUri: last_submenu_blog_uri });
                }

                Messenger.send('myblogmenu.open', { blogUri: blog_uri });

                last_submenu_blog_uri = blog_uri;
                return false;
            });
        } else {
            $('.dropdown-mymenu').menuAim({
                activate: function activate(li) {
                    var has_submenu = $(li).hasClass('dropdown-mymenu-submenu');
                    if (!has_submenu) return;

                    var blog_uri = $(li).find('a').attr('href');

                    Messenger.send('myblogmenu.open', { blogUri: blog_uri });
                },
                deactivate: function deactivate(li) {
                    var has_submenu = $(li).hasClass('dropdown-mymenu-submenu');
                    if (!has_submenu) return;

                    var blog_uri = $(li).find('a').attr('href');

                    Messenger.send('myblogmenu.close', { blogUri: blog_uri });
                },
                submenuDirection: 'left'
            });
        }

        $('a.myblog').each(function () {
            var top = $(this).position().top;
            var blog_uri = $(this).attr('href');
            Messenger.send('myblogmenu.init', { top: top, blogUri: blog_uri });
        });
    }

};

module.exports = MyMenuPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Browser":278,"js/Messenger":562,"js/Util/sendResizeRequest":587}],340:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var Locale = require('js/Locale');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var ServicesPage = {

    init: function init() {
        Messenger.listenToParent();
        Messenger.addEventListener('init', function (data) {

            // data 
            var BASE = data.BASE;
            var servicesInUse = data.info.services;

            var usernameWindow = $('#username-window');

            $('<dt class="label"><span>Services in Use</span></dt>').find('span').text(Locale.text('services_in_use')).end().appendTo(usernameWindow);

            // global header
            var subdomainsForShow = [];
            for (var s in servicesInUse) {
                if (servicesInUse[s].is_beta) continue;
                if (!servicesInUse[s].portal_top_priority) continue;
                subdomainsForShow.push(s);
            }
            subdomainsForShow.sort(function (a, b) {
                return servicesInUse[b].portal_top_priority - servicesInUse[a].portal_top_priority;
            });

            for (var i = 0, length = subdomainsForShow.length; i < length; i++) {
                var subdomain = subdomainsForShow[i];
                var service = servicesInUse[subdomain];
                if (!service) continue;
                var url = 'http://www' + BASE + '/me/' + service.name + '/';
                var favicon = '//www.hatena.com/images/favicon/' + service.name + '.png';
                $('<dd><a href="" rel="noreferrer" target="_blank"><img alt="" width="16" height="16"/></a></dd>').find('a').find('img').attr('src', favicon).end().attr('href', url).append(document.createTextNode(service.text)).end().appendTo(usernameWindow);
            }

            $('<dt class="label"><span>Lang</span></td>').find('span').text(Locale.text('lang')).end().appendTo(usernameWindow);

            var langs = Locale.getAvailLangs();
            for (var i = 0; i < langs.length; i++) {
                var lang = langs[i];
                if (langs[i] == Locale.getTextLang()) {
                    $('<dd><span class="selected">lang</span></dd>').find('span').text(Locale.text('lang.' + lang + '.native')).end().appendTo(usernameWindow);
                } else {
                    $('<dd><a href="#">lang</a></dd>').find('a').attr('data-lang', lang).text(Locale.text('lang.' + lang + '.native')).end().appendTo(usernameWindow);
                }
            }
            usernameWindow.find('a[data-lang]').click(function () {
                var lang = $(this).attr('data-lang');
                Locale.setAcceptLang(lang);
                Messenger.send('reload');
                return false;
            });

            $('<dt class="label"><span>My Hatena</span></dt>').find('span').text(Locale.text('my_hatena')).end().appendTo(usernameWindow);

            $('<dd><a href="" rel="noreferrer" target="_blank"><img src="/images/favicon/my.png" width="16" height="16" alt=""></a></dd>').find('a').attr('href', 'http://www' + BASE + '/my/').append(Locale.text('profile')).end().appendTo(usernameWindow);

            $('<dd><a href="" rel="noreferrer" class="logout" target="_parent"><img width="16" height="16" src="/images/favicon/logout.gif"></a></dd>').find('a').attr('href', 'http://www' + BASE + '/logout?location=' + encodeURIComponent(data.location)).append(Locale.text('logout')).click(function () {
                return confirm(Locale.text('really_want_to_logout'));
            }).end().appendTo(usernameWindow);

            sendResizeRequest();
        });

        Messenger.send('init');
    }

};

module.exports = ServicesPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561,"js/Messenger":562,"js/Util/sendResizeRequest":587}],341:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var globalData = require('js/Base/globalData');

var OdaiEditPage = {

    init: function init() {
        var _this = this;

        this.$form = $('#odai');
        this.$submit = this.$form.find('input[type=submit]');
        this.$period = $('input[name=period]');
        this.$dateWrapper = $('.admin-odai-period-date-wrapper');
        this.$startDate = $('input[name=start_date]');
        this.$endDate = $('input[name=end_date]');
        this.$periodError = $('.admin-odai-period-error');

        $('.delete-odai').on('submit', function () {
            return _this.confirmDelete();
        });
        this.$period.on('change', function () {
            return _this.togglePeriod();
        });
        this.$form.on('change', function () {
            return _this.validatePeriod();
        });

        this.togglePeriod();
    },

    /**
     * confirm
     */
    confirmDelete: function confirmDelete() {
        var odaiTitle = this.$form.attr('data-odai-title');
        var odaiId = this.$form.attr('data-odai-id');
        var odaiUrl = globalData('admin-domain') + '/' + odaiId;
        return window.confirm(Locale.text('admin.odai.delete_odai.confirm', odaiTitle, odaiUrl));
    },

    /**
     * inputdisabled
     */
    togglePeriod: function togglePeriod() {
        this.$dateWrapper.toggle(this.$period.prop('checked'));
    },

    /**
     * validsubmit
     */
    validatePeriod: function validatePeriod() {
        var isPeriodInvalid = !this.isPeriodValid();
        this.$submit.attr('disabled', isPeriodInvalid);
        this.$periodError.toggle(isPeriodInvalid);
    },

    /**
     * inputvalid
     * @return {boolean}
     */
    isPeriodValid: function isPeriodValid() {
        if (!this.$period.prop('checked')) {
            return true;
        }
        var startDate = new Date(this.$startDate.val());
        var endDate = new Date(this.$endDate.val());
        return isNaN(startDate) || isNaN(endDate) || endDate - startDate >= 0;
    }

};

module.exports = OdaiEditPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/Locale":561}],342:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var PlusQuitPage = {

    init: function init() {
        $('form').submit(function () {
            $(this).find('input:submit').attr('disabled', 'disabled');
        });
    }

};

module.exports = PlusQuitPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],343:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var EventEmitter = require('events').EventEmitter;
var globalData = require('js/Base/globalData');
var URLGenerator = require('js/Base/URLGenerator');

var Series = (function (_EventEmitter) {
    _inherits(Series, _EventEmitter);

    function Series() {
        _classCallCheck(this, Series);

        _get(Object.getPrototypeOf(Series.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(Series, [{
        key: 'setState',
        value: function setState(state) {
            this.state = state;
            this.emit('change', this.state);
        }
    }, {
        key: 'saveTask',
        value: function saveTask(taskId, checked) {
            var _this = this;

            return $.ajax({
                url: '../task/' + taskId + '/save',
                method: 'POST',
                data: {
                    value: checked ? 1 : 0,
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                }
            }).done(function (state) {
                _this.setState(state);
            });
        }
    }]);

    return Series;
})(EventEmitter);

var SeriesController = function SeriesController(series, view) {
    var _this2 = this;

    _classCallCheck(this, SeriesController);

    this.series = series;

    $('input').on('change', function (event) {
        var $target = $(event.target);
        _this2.series.saveTask($target.attr('data-task-id'), $target.is(':checked'));
    });

    this.series.on('change', function (state) {
        view.render(state);
    });
};

var SeriesView = (function () {
    function SeriesView() {
        _classCallCheck(this, SeriesView);
    }

    _createClass(SeriesView, [{
        key: 'render',
        value: function render(state) {
            var $gauge = $('.challenge-indicator-gauge');
            var $count = $('.achieved-count');

            var userStatus = state.user_status;
            var percent = state.achieved_rate + '%';

            $gauge.css({
                width: percent
            });
            $count.text(percent);

            $('.js-user-title').text(userStatus.title);
            $('.js-user-level').text(userStatus.level);
            $('.js-user-point').text(userStatus.point);
            $('.js-user-achieved-count').text(userStatus.achieved_tasks_count);

            $('.js-challenge-status').removeClass('is-bronze').removeClass('is-silver').removeClass('is-gold');
            $('.js-rank-label').text('');

            if (userStatus.rank) {
                $('.js-challenge-status').addClass('is-' + userStatus.rank);
                $('.js-rank-label').text('(' + userStatus.rank + ')');
            }

            if (state.achieved_rate === 100) {
                $('.js-congratulations').show();
                document.body.style.backgroundImage = 'url(\'' + URLGenerator.static_url('/images/special/challenge/kira-bg.jpg') + '\')';
            } else {
                $('.js-congratulations').hide();
                document.body.style.backgroundImage = '';
            }

            this.setSocialURLs(state.links);
        }
    }, {
        key: 'setSocialURLs',
        value: function setSocialURLs(links) {
            $('.js-post-completed-to-blog').attr({
                href: links.post_completed_to_blog_link
            });
            $('.js-post-completed-to-twitter').attr({
                href: links.post_completed_to_twitter_link
            });
            $('.js-post-name-to-twitter').attr({
                href: links.post_name_to_twitter_link
            });
        }
    }]);

    return SeriesView;
})();

var SidebarController = function SidebarController(view) {
    _classCallCheck(this, SidebarController);

    var $window = $(window);
    var threshold = 1000;
    var wait = 100;

    $window.on('load scroll', _.throttle(function () {
        var state = {
            isFixed: $window.scrollTop() > threshold
        };
        view.render(state);
    }, wait));
};

var SidebarView = (function () {
    function SidebarView() {
        _classCallCheck(this, SidebarView);

        this.$challengeStatus = $('.l-challenge-status');
    }

    _createClass(SidebarView, [{
        key: 'render',
        value: function render(state) {
            if (state.isFixed) {
                this.$challengeStatus.addClass('is-fixed');
            } else {
                this.$challengeStatus.removeClass('is-fixed');
            }
        }
    }]);

    return SidebarView;
})();

var ChallengePage = {

    init: function init() {
        var series = new Series();
        var seriesView = new SeriesView();
        var seriesController = new SeriesController(series, seriesView);
        var initialState = JSON.parse($('.js-initial-state').attr('data-initial-state'));
        series.setState(initialState);

        var sidebarView = new SidebarView();
        var sidebarController = new SidebarController(sidebarView);
    }
};

module.exports = ChallengePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"events":207,"js/Base/URLGenerator":298,"js/Base/globalData":302,"underscore":213}],344:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var TopicShowPage = {

    init: function init() {
        $('#topic-entries-tabs').tabs({ active: 0 });
    }

};

module.exports = TopicShowPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],345:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');

var DeletedPage = {

    init: function init() {
        Messenger.listenToParent();
        Messenger.send('delete');
    }

};

module.exports = DeletedPage;

},{"js/Messenger":562}],346:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');

// 
var DeletePage = {

    init: function init() {
        Messenger.listenToParent();
    }

};

module.exports = DeletePage;

},{"js/Messenger":562}],347:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');

var DonePage = {

    init: function init() {
        Messenger.listenToParent();

        var comment = document.getElementById('posted').value;

        Messenger.send('update', { comment: comment });

        Messenger.send('close');
    }

};

module.exports = DonePage;

},{"js/Messenger":562}],348:[function(require,module,exports){
(function (global){
// TODO:  'use strict'; 

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var Locale = require('js/Locale');
var FormState = require('js/Base/FormState');
var TransitionConfirmer = require('js/Base/TransitionConfirmer');
var ModalWindow = require('js/Base/Window');
var globalData = require('js/Base/globalData');

var EditDesign = require('js/Admin/EditDesign');
var ListItemSelector = require('js/Admin/Design/ListItemSelector');
var Modules = require('js/Admin/Design/Modules');
var ModuleEditor = require('js/Admin/Design/ModuleEditor');
var CategoryEditor = require('js/Admin/Design/CategoryEditor');
var PreviewUpdater = require('js/Admin/Design/PreviewUpdater');
var TrimmingWindow = require('js/Admin/Design/TrimmingWindow');
var HeaderImage = require('js/Admin/Design/HeaderImage');
var HeaderImagePreview = require('js/Admin/Design/HeaderImagePreview');
var setupTextareaHider = require('js/Admin/Design/setupTextareaHider');
var FotoUploader = require('js/Admin/Design/FotoUploader');
var setupTouchHeaderImageComponent = require('js/Admin/Design/setupTouchHeaderImageComponent');

var DesignDetailPage = {

    init: function init() {
        var $css = $('#css');
        var $form = $('#form-design');
        var $preview = $('#preview');
        var $loading = $('#preview-loading');
        var $tabs = $('#tabs');
        var $foldButton = $('#form-design-fold-button');

        var formState = new FormState($form);

        var previewUpdater = new PreviewUpdater({
            $form: $form,
            $preview: $('#preview-iframe'),
            $loading: $loading,
            formState: formState
        });
        previewUpdater.requestPreview();

        $form.on('change', function () {
            previewUpdater.requestPreview();
        });

        ListItemSelector.init();
        DesignDetailPage.setupTabs({
            $tabs: $tabs,
            previewUpdater: previewUpdater
        });
        DesignDetailPage.setupFoldButton({
            $form: $form,
            $preview: $preview,
            $foldButton: $foldButton
        });
        DesignDetailPage.setupPreviewTypeButton(previewUpdater);

        _.each(['header-html', 'entry-header-html', 'entry-footer-html', 'footer-html', 'header-touch-html', 'entry-touch-header-html', 'entry-touch-footer-html', 'footer-touch-html', 'touch-under-pager-html'], function (name) {
            var selector = ':input[name = "' + name + '"]';
            var $target = $(selector);

            if (!$target.length) {
                return;
            }
            if ($target.prop('disabled')) {
                return;
            }

            DesignDetailPage.setupEditor({
                syntax: 'html',
                $textarea: $target
            });
        });

        DesignDetailPage.setupEditor({
            syntax: 'css',
            $textarea: $css
        });
        DesignDetailPage.setupBackgroundComponent({
            $css: $css
        });

        var trimmingWindow = new TrimmingWindow($('.js-header-modal-window'));
        DesignDetailPage.setupHeaderImageComponent({
            $container: $('.js-design-header .js-header-image-container'),
            previewUpdater: previewUpdater,
            trimmingWindow: trimmingWindow
        });

        setupTouchHeaderImageComponent({
            $container: $('.js-design-header-touch .js-header-image-container'),
            previewUpdater: previewUpdater
        });

        DesignDetailPage.setupEntryComponent();

        var moduleEditor = new ModuleEditor($('.js-module-edit-modal-window'));
        var categoryEditor = new CategoryEditor();

        // order_type
        $(moduleEditor).on('edit-new-module change-category-order-type', function () {
            categoryEditor.updateCategoryPreview();
        });

        _.each(['sidebar', 'top-page-main-column', 'top-page-header', 'top-page-sidebar', 'touch-top-page-header', 'touch-entry-header', 'touch-entry-footer-primary', 'touch-entry-footer-secondary', 'touch-footer'], function (type) {
            var $element = $('div[data-modules-type="' + type + '"].sidebar-box');
            if (!$element.length) {
                return;
            }

            var modules = new Modules($element, moduleEditor);

            // FormState(confirm)$formchange
            $(modules).on('updated', function () {
                return $form.trigger('change');
            });
        });
        DesignDetailPage.setupAccordion('.accordion-title');

        // form
        var profileUpdated = DesignDetailPage.updateProfileModule();
        var circlesUpdated = DesignDetailPage.updateCirclesModule();

        //  order_type
        categoryEditor.updateCategoryPreview();

        $.when(profileUpdated, circlesUpdated).always(function () {
            return formState.commit();
        });

        DesignDetailPage.setupThemesListSwitcher();

        // 
        setupTextareaHider();

        // 
        DesignDetailPage.setupSeeMoreBackgrounds();

        // 
        DesignDetailPage.setupTouchAccentColor({
            $form: $form
        });
    },

    setupAccordion: function setupAccordion(selector) {
        var $accordionTitle = $(selector);
        $accordionTitle.next().hide();

        $accordionTitle.click(function () {
            var $title = $(this);
            var $content = $title.next();

            if ($content.is(':visible')) {
                $content.hide();
                $title.removeClass('open');
            } else {
                $content.show();
                $title.addClass('open');
            }
        });
    },

    setupTabs: function setupTabs(args) {
        var $tabs = args.$tabs;
        var previewUpdater = args.previewUpdater;
        var $forcePcView = $('#force-pc-view');

        if (!$tabs[0]) {
            return;
        }

        // 
        // PCPC
        var updateDevice = function updateDevice(event, ui) {
            var panelID = (ui.newPanel || ui.panel).attr('id');
            if (panelID === 'tab-customize-touch' && !$forcePcView.is(':checked')) {
                previewUpdater.setDeviceAsTouch();
            } else {
                previewUpdater.setDeviceAsPC();
            }
        };

        $tabs.on('tabsactivate', updateDevice).on('tabscreate', updateDevice);

        // PC
        $forcePcView.on('change', function () {
            if ($forcePcView.is(':checked')) {
                previewUpdater.setDeviceAsPC();
            } else {
                previewUpdater.setDeviceAsTouch();
            }
        }).triggerHandler('change');

        $tabs.tabs();
    },

    // 
    setupFoldButton: function setupFoldButton(args) {
        var $form = args.$form;
        var $preview = args.$preview;
        var $foldButton = args.$foldButton;

        if (!$foldButton[0]) {
            return;
        }

        $foldButton.click(function () {
            if ($foldButton.hasClass('open')) {
                $foldButton.removeClass('open').addClass('close');
                $form.hide();
                $preview.addClass('fold-form');
            } else {
                $foldButton.removeClass('close').addClass('open');
                $form.show();
                $preview.removeClass('fold-form');
            }
        });
    },

    fadeInLoading: function fadeInLoading($loading) {
        $loading.fadeIn('fast');
    },

    fadeOutLoading: function fadeOutLoading($loading) {
        setTimeout(function () {
            $loading.fadeOut('fast');
        }, 1000);
    },

    setupPreviewTypeButton: function setupPreviewTypeButton(previewUpdater) {
        var $switchButton = $('.switch-button');

        $switchButton.click(function () {
            if (previewUpdater.getPageType() === 'index') {
                $switchButton.addClass('permalink').removeClass('index');
                $switchButton.text(Locale.text('admin.design.quit_preview_entry_page'));
                previewUpdater.setAsPermalinkPreview();
                previewUpdater.preview();
            } else {
                $switchButton.addClass('index').removeClass('permalink');
                $switchButton.text(Locale.text('admin.design.preview_entry_page'));
                previewUpdater.setAsIndexPreview();
                previewUpdater.preview();
            }
        });
    },

    setupBackgroundComponent: function setupBackgroundComponent(args) {
        var $css = args.$css;

        var $fileInput = $('input[type="file"].background-image');
        var $bgImage = $('#background-image');
        var $imageThumbnail = $('#background-image-thumbnail');
        var $deleteBgImage = $('a.delete-background-image');
        var $imageSrc = $('input[name="bg-image-src"]');
        var $imageId = $('input[name="bg-image-id"]');
        var $imageSelected = $('input[name="bg-image-selected"]');

        var styletemplate = _.template("body{ background-image: url('<%= image %>'); background-repeat: <%= repeat %>; background-color:<%= backgroundColor %>; background-attachment: <%= attachment %>; background-position: <%= position %> top;}");

        var $bgPosition = $('select[name="background-position"]');
        var $bgRepeat = $('select[name="background-repeat"]');
        var $bgAttachment = $('select[name="background-attachment"]');

        var showBackgroundImage = function showBackgroundImage() {
            $bgImage.show();
        };
        var hideBackgroundImage = function hideBackgroundImage() {
            $bgImage.hide();
        };

        $deleteBgImage.click(function () {
            if (confirm(Locale.text('admin.design.stop_header_image_confirm'))) {
                $imageId.val('');
                $imageSrc.val('');
                $imageSelected.val(0);
                setDesignCSS();

                hideBackgroundImage();
            }
            return false;
        });

        $imageThumbnail.click(function () {
            setDesignCSS();
            if (!$imageThumbnail.hasClass('ui-selected')) {
                // 
                var backgroundListItems = $('#backgrounds li');
                backgroundListItems.removeClass('ui-selected');
                $imageThumbnail.addClass('ui-selected');
                $imageSelected.val(1);
            }
        });

        $bgPosition.change(function () {
            setDesignCSS();
        });

        $bgAttachment.change(function () {
            setDesignCSS();
        });

        $bgRepeat.change(function () {
            setDesignCSS();
        });

        // 
        var setBackgroundImage = function setBackgroundImage(fid) {
            $imageId.val(fid);
            var match = fid.match(/f:id:([^:]+):(\d+)([jpg]):image/);
            if (!match) {
                return;
            }

            var name = match[1];
            var id = match[2];
            var type = match[3];

            var extension = {
                j: '.jpg',
                p: '.png',
                g: '.gif'
            };

            var path = [name.substring(0, 1), name, id.substring(0, 8), id].join('/');
            var image = 'http://cdn-ak.f.st-hatena.com/images/fotolife/' + path + extension[type];
            var thumbnail_src = 'http://cdn-ak.f.st-hatena.com/images/fotolife/' + path + '_120.jpg';

            $imageSrc.val(image);
            $imageThumbnail.attr('src', thumbnail_src);
            showBackgroundImage();
            $fileInput.prop('disabled', false);
            $imageThumbnail.trigger('click');

            // $fileInput.change$fileInput.valuechange
            var isSupportedFile = typeof FormData !== 'undefined';
            if (isSupportedFile) {
                var $newFileInput = $fileInput.clone(true);
                $fileInput.replaceWith($newFileInput);
                $fileInput = $newFileInput;
            }
        };

        var setDesignCSS = function setDesignCSS() {
            var image = $imageSrc.val();
            var design = new EditDesign($css.val());

            var id;
            var style;

            if (image) {
                var $backgroundColorItem = $('#background-colors li.ui-selected');
                var backgroundColor = 'transparent';

                // 
                if ($backgroundColorItem.length === 0) {
                    $('#background-colors li[data-css=""]').addClass('ui-selected');
                } else if ($backgroundColorItem.attr('data-id') !== undefined) {
                    backgroundColor = '#' + $backgroundColorItem.attr('data-id');
                }

                id = 'custom';

                var repeat = $bgRepeat.find('option:selected').val();
                var position = $bgPosition.find('option:selected').val();
                var attachment = $bgAttachment.find('option:selected').val();

                style = styletemplate({
                    image: image,
                    backgroundColor: backgroundColor,
                    repeat: repeat,
                    position: position,
                    attachment: attachment
                });
            } else {
                // 
                id = 'default';
                style = $('li[data-id="default"]').attr('data-css');
            }

            design.setData('background', id, style);
            $css.val(design.getCSS());
            $css.trigger('change');
        };

        var isSupportedFile = typeof FormData !== 'undefined';
        if (isSupportedFile) {
            $fileInput.on('change', function () {
                if (!this.files.length) {
                    return;
                }
                hideBackgroundImage();
                // XXX: FotoUploader
                FotoUploader.uploadImage({
                    file: this,
                    folder: 'Hatena Blog',
                    fotosize: 3000,
                    $input: $fileInput,
                    callback: setBackgroundImage
                });
            });
        } else {
            // XXX: FotoUploader
            FotoUploader.setIframeUploader({
                $fileinput: $fileInput,
                fotosize: 3000,
                callback: setBackgroundImage
            });
        }
    },

    // args: { $container, previewUpdater, trimmingWindow, imageSize: {width, height} }
    setupHeaderImageComponent: function setupHeaderImageComponent(args) {
        var $container = args.$container;
        var previewUpdater = args.previewUpdater;
        var trimmingWindow = args.trimmingWindow;

        var imageSize = {
            width: +$container.attr('data-max-width'),
            height: +$container.attr('data-max-height')
        };

        var image = new HeaderImage($container, imageSize);
        var thumbnail = new HeaderImagePreview($container.find('.js-header-image-item'));

        $(image).on('updated', function () {
            if (image.getImageSrc()) {
                thumbnail.render(image.getImageSrc(), image.getThumbnailSrc(), image.getDisplayArea());
            } else if (!image.getImageSrc()) {
                thumbnail.clear();
            }
            previewUpdater.requestPreview();
        });

        var uploaded = FotoUploader.init({
            $input: $container.find('.js-header-image-input'),
            size: imageSize.width
        });

        // 
        uploaded.progress(function (foto) {
            image.setImage(foto.url, foto.fid);
            trimmingWindow.trim(image.getImageSrc(), image.getTrimmingArea()).always(function (area) {
                image.setDisplayArea(area);
            });
        });

        $container.on('click', '.js-header-image-thumbnail, .jcrop-holder, .js-resizer', function () {
            // 
            trimmingWindow.trim(image.getImageSrc(), image.getTrimmingArea()).done(function (area) {
                image.setDisplayArea(area);
            });

            return false;
        }).on('click', '.js-delete-header-image', function () {
            // 
            if (!confirm(Locale.text('admin.design.stop_header_image_confirm'))) {
                return false;
            }

            image.clear();
            return false;
        });
    },

    setupEntryComponent: function setupEntryComponent() {
        // 
        $('.js-variable-toggle').click(function () {
            $(this).siblings('.js-variable-help').slideToggle();
            return false;
        });
    },

    // FacebookTwitter
    // resolveDeferred
    updateProfileModule: function updateProfileModule() {
        var updated = $.Deferred();

        $.ajax({
            type: 'GET',
            url: '/api/applications_data',
            dataType: 'json'
        }).done(function (res) {
            var data = res;
            var $profile_modules = $('.js-module-value-component-profile');

            $profile_modules.each(function () {
                var $profile_module = $(this);

                if (data.twitter) {
                    $profile_module.find('.cannot-twitter-button').remove();
                } else {
                    $profile_module.find('.can-twitter-button').remove();
                    $profile_module.find('.cannot-twitter-button').removeClass('cannot-twitter-button').addClass('cannot-twitter-button-display');
                }

                if (data.facebook) {
                    $profile_module.find('.cannot-facebook-follow').remove();
                    $profile_module.find('.cannot-facebook-subscribe').remove();
                } else {
                    $profile_module.find('.can-facebook-follow').remove();
                    $profile_module.find('.can-facebook-subscribe').remove();
                    $profile_module.find('.note').remove();
                    $profile_module.find('.cannot-facebook-follow').removeClass('.cannot-facebook-follow').addClass('.cannot-facebook-follow-display');
                    $profile_module.find('.cannot-facebook-subscribe').removeClass('cannot-facebook-subscribe').addClass('cannot-facebook-subscribe-display');
                }
            });

            updated.resolve();
        }).fail(function () {
            updated.reject();
        });

        return updated.promise();
    },

    // 
    // resolveDeferred
    updateCirclesModule: function updateCirclesModule() {
        var updated = $.Deferred();
        if ($('#module-value-component-circles').length === 0) {
            updated.resolve();
            return updated.promise();
        }

        $.ajax({
            type: 'GET',
            url: '/api/circles',
            data: { blog: globalData('blogs-uri-base') },
            dataType: 'json'
        }).done(function (res) {
            var mkSelectCircle = _.template($('.js-module-circles-select-circles-template').html().replace(/^\s+|\s+$/g, ''));
            _.each(res.circles, function (circle) {
                $('.js-select-circles-container').each(function () {
                    $(this).append($(mkSelectCircle({ circle: circle })));
                });
            });
            updated.resolve();
        }).fail(function () {
            updated.reject();
        });

        return updated.promise();
    },

    setupEditor: function setupEditor(args) {
        var syntax = args.syntax;
        var $textarea = args.$textarea;

        if (!$textarea[0]) {
            return;
        }

        var container = document.createElement('div');
        $(container).css({
            position: 'absolute',
            top: 'auto',
            left: 0,
            bottom: 50,
            padding: 0,
            margin: 0,
            borderTop: '1px solid #ccc',
            borderBottom: '1px solid #ccc',
            width: '500px',
            height: '400px',
            zIndex: 9999,
            background: '#fff'
        }).appendTo(document.body).hide();

        $textarea.css({
            'font-size': '11px',
            'white-space': 'nowrap',
            'overflow': 'hidden'
        });

        var editor = ace.edit(container);
        editor.commands.removeCommand('gotoline'); // fucking default keybinding of ace
        editor.commands.removeCommand('indent');
        editor.commands.removeCommand('outdent');

        // editor.renderer.setShowGutter(false);
        editor.renderer.setHScrollBarAlwaysVisible(false);
        editor.renderer.setPadding(5);
        editor.renderer.setShowPrintMargin(false);

        editor.setFontSize("10px");
        editor.setHighlightActiveLine(false);

        var Mode = ace.require('ace/mode/' + syntax).Mode;
        var mode = new Mode();

        var session = editor.getSession();
        session.setMode(mode);
        session.setUseWrapMode(true);

        var confirmer = new TransitionConfirmer();

        $textarea.focus(function () {
            $(container).show();
            editor.resize();
            editor.focus();
            confirmer.enable();
        });

        editor.on('blur', function () {
            $textarea.val(session.getValue());
            $textarea.trigger('change');
            $(container).hide();
            confirmer.disable();
        });

        $(container).mousedown(function () {
            return false;
        });

        session.setValue($textarea.val());

        $textarea.change(function () {
            session.setValue($textarea.val());
        });

        $('#tabs').on('tabsactivate', function () {
            setTimeout(function () {
                editor.resize();
            }, 0);
        });

        $(window).resize(function () {
            editor.resize();
        });
    },

    setupThemesListSwitcher: function setupThemesListSwitcher() {

        $('.switch-theme-list-types').on('blog:dropdown:selected', '[data-theme-list-type]', function () {
            var listType = $(this).attr('data-theme-list-type');

            $('#themes .themes-container').each(function () {
                $(this).toggle($(this).attr('data-theme-list-type') === listType);
            });
        });

        // 
        //  ['*'] 
        var $dropdown = $('.dropdown-container'),
            $dropdownList = $dropdown.find('.dropdown-list').hide();

        $dropdown.on('click', '.dropdown-button, .dropdown-selected', function () {
            var isShown = ModalWindow.toggle($dropdownList);
            $dropdownList.toggleClass('opened', isShown);
            return false;
        }).on('click', '.dropdown-list-item', function () {
            $dropdown.find('.dropdown-selected').text($(this).text());
            $(this).trigger('blog:dropdown:selected');
        }).find('.dropdown-list-item').eq(0).click();
    },

    // 
    setupSeeMoreBackgrounds: function setupSeeMoreBackgrounds() {
        var $button = $('.js-show-more-background-images');
        $button.one('click', function () {
            $button.remove();
            $('#backgrounds li:hidden').show();
        });
    },

    // UI
    setupTouchAccentColor: function setupTouchAccentColor(args) {
        var $form = args.$form;
        var $accent_color_input = $form.find(':input[name="touch-accent-color"]');

        var $colors = $('#touch-accent-colors');

        var select = function select($color) {
            $colors.find('.selected').removeClass('selected');
            $color.addClass('selected');

            var color = $color.attr('data-color');
            $accent_color_input.val(color);

            $form.trigger('change');
        };

        $colors.on('click', '[data-color]', function () {
            select($(this));
        });

        var first_value = $accent_color_input.val();
        select($colors.find('[data-color="' + first_value + '"]'));
    }

};

module.exports = DesignDetailPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/Design/CategoryEditor":232,"js/Admin/Design/FotoUploader":233,"js/Admin/Design/HeaderImage":234,"js/Admin/Design/HeaderImagePreview":235,"js/Admin/Design/ListItemSelector":236,"js/Admin/Design/ModuleEditor":238,"js/Admin/Design/Modules":239,"js/Admin/Design/PreviewUpdater":240,"js/Admin/Design/TrimmingWindow":241,"js/Admin/Design/setupTextareaHider":242,"js/Admin/Design/setupTouchHeaderImageComponent":243,"js/Admin/EditDesign":244,"js/Base/FormState":287,"js/Base/TransitionConfirmer":297,"js/Base/Window":299,"js/Base/globalData":302,"js/Locale":561,"underscore":213}],349:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var ConfigDetailPage = {

    init: function init() {
        $('.main-tab').find('.user-blog-config-detail').addClass('current-tab');

        $('#blog-config-custom-domain .check-validity').click(function (e) {
            var $this = $(this);
            $this.attr('disabled', 'disabled').addClass('disabled');
            $('#blog-config-custom-domain .validity-status').text('-');
            $.ajax({
                type: 'POST',
                url: '/api/custom_domain.check',
                data: $this.closest('form').serialize(),
                dataType: 'json',
                success: function success(data) {
                    $('#blog-config-custom-domain .validity-status').text(data.message);
                    $('#blog-config-custom-domain .validity-status.detail').text(data.detail || '');
                },
                complete: function complete() {
                    $this.removeAttr('disabled').removeClass('disabled');
                }
            });
            return false;
        });
    }

};

module.exports = ConfigDetailPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],350:[function(require,module,exports){
'use strict';

var Location = require('js/Base/Location');

var ConfigExternalPage = {

    init: function init() {
        var withParentWindow = Location.param('with_parent_window');
        var callback = Location.param('callback');

        // windowOAuthwindow
        if (withParentWindow && callback) {
            window.close();
        }
    }

};

module.exports = ConfigExternalPage;

},{"js/Base/Location":292}],351:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var BlogPermission = require('js/Admin/BlogPermission');

var ConfigPermissionPage = {

    init: function init() {
        new BlogPermission($('#blog-permission-container'));
    }

};

module.exports = ConfigPermissionPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/BlogPermission":220}],352:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var ThemePreviewPage = {

    init: function init() {
        var $previewForm = $('#theme-preview-form');
        var $saveForm = $('#theme-install-form');
        var noticeMessage = $saveForm.find('.notice').text();

        $saveForm.on('submit', function () {
            return confirm(noticeMessage);
        });

        $previewForm.submit();
    }

};

module.exports = ThemePreviewPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],353:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var Messenger = require('js/Messenger');
var SocializeBox = require('js/Admin/SocializeBox');
var setupProModal = require('js/Base/setupProModal');

var ExternalAuthModalHandler = require('js/Admin/EditDone/ExternalAuthModalHandler');
var ShareModal = require('js/Admin/EditDone/ShareModal');
var SelectText = require('js/Admin/EditDone/SelectText');
var OfficialShareWindow = require('js/Admin/EditDone/OfficialShareWindow');

var EditDonePage = {

    init: function init() {
        Messenger.listenToParent();

        var entry = document.getElementById('posted').value;
        Messenger.send('update', { entry: entry });

        $('.js-button-focus-this').focus();

        SocializeBox.setup($('.js-socialize-box').data('entry-id'));

        // deactivate click-jacking-escape in 1000msec
        setTimeout(function () {
            $('form').each(function (i, e) {
                var $form = $(e);
                var $buttons = $form.find('input[type=submit]');
                $form.removeClass('unedited');
                $buttons.removeAttr('disabled');
            });
        }, 1000);

        // pro
        setupProModal();

        var modal = new ExternalAuthModalHandler($('.js-socialize-modal'));

        $(document).on('click', '.js-share-button', function (e) {
            var serviceName = $(e.currentTarget).data('share-service');

            var $modal = $('.js-' + serviceName + '-modal');
            var $shareSuccessMessage = $('.js-share-success-message');
            var entryId = $('.js-socialize-box').data('entry-id');

            new ShareModal($modal, $shareSuccessMessage, entryId, serviceName);

            // 
            // twitter
            // ()
            var $message = $('.js-share-message');
            var posted = Locale.text('blog.posted');
            var isDefaultPostedText = $message.val().substr(0, posted.length) === posted;

            if ($message.get(0) && serviceName === 'twitter' && isDefaultPostedText) {
                new SelectText($message[0], 0, posted.length).select();
            }

            return false;
        });

        $(document).on('click', '.js-official-share-button', function (e) {
            var url = $(e.currentTarget).attr('href');
            new OfficialShareWindow(url, 550, 450, screen.width, screen.height);
            return false;
        });
    }

};

module.exports = EditDonePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/EditDone/ExternalAuthModalHandler":246,"js/Admin/EditDone/OfficialShareWindow":247,"js/Admin/EditDone/SelectText":248,"js/Admin/EditDone/ShareModal":249,"js/Admin/SocializeBox":266,"js/Base/setupProModal":305,"js/Locale":561,"js/Messenger":562}],354:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var ImportProgressBar = require('js/Admin/Import/ProgressBar');

var ImportHatenaDiaryStepsPage = {

    init: function init() {
        var $progress = $('#import-hatena_diary-progress');
        var $bar = $progress.find('.bar');
        if (!$progress[0] || !$bar[0]) {
            return;
        }

        var apiUrl = $progress.attr('data-progress-api');
        var onCompleteUrl = $progress.attr('data-diary-page');

        ImportProgressBar.init($bar, apiUrl, onCompleteUrl);
    }

};

module.exports = ImportHatenaDiaryStepsPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/Import/ProgressBar":263}],355:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var ImportProgressBar = require('js/Admin/Import/ProgressBar');

var ImportHatenaDiaryPage = {

    init: function init() {
        var $progress = $('#import-hatena_diary-progress');
        var $bar = $progress.find('.bar');
        if (!$progress[0] || !$bar[0]) {
            return;
        }

        var apiUrl = $progress.attr('data-progress-api');
        var onCompleteUrl = $progress.attr('data-diary-page');

        ImportProgressBar.init($bar, apiUrl, onCompleteUrl);
    }

};

module.exports = ImportHatenaDiaryPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/Import/ProgressBar":263}],356:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var SubscribeDonePage = {

    init: function init() {
        Messenger.listenToParent();
        sendResizeRequest();
        Messenger.send('done');
    }

};

module.exports = SubscribeDonePage;

},{"js/Messenger":562,"js/Util/sendResizeRequest":587}],357:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');
var SubscribeButton = require('js/SubscribeButton');

var SubscribeIframePage = {

    init: function init() {
        var $el = $('.js-hatena-follow-button-box');

        var userData = {
            isSubscribing: $el.data('is-subscribing'),
            isGuest: globalData('rkm') && globalData('rkc') ? false : true
        };
        var blogUrl = globalData('blog-host');
        var blogData = {
            subscribersCount: parseInt($el.data('subscribers-count'), 10),
            blogName: globalData('blog-name'),
            blogUrl: blogUrl,
            requestUrl: [globalData('admin-domain'), globalData('author'), blogUrl, 'subscribe'].join('/')
        };

        var view = new SubscribeButton.Admin($el, userData, blogData);
    }

};

module.exports = SubscribeIframePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/SubscribeButton":570}],358:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var AccessLogViewer = require('js/Admin/AccessLogViewer');

var AccessLogPage = {

    init: function init() {
        var table = $('#access-counts').remove();
        var counts = {};
        table.find('tr').each(function () {
            var $this = $(this);
            var time = +$this.find('td[data-time]').attr('data-time');
            var count = +$this.find('td[data-count]').attr('data-count');
            counts[time] = count;
        });

        AccessLogViewer.showGraph(counts, {
            parent: $('#access-counts-daily'),
            timeformat: '%m/%d',
            minTickSize: [1, 'day'],
            unit: 24 * 60 * 60 * 1000,
            number: 31
        });

        AccessLogViewer.showGraph(counts, {
            parent: $('#access-counts-hourly'),
            timeformat: '%d %H:%M',
            minTickSize: [1, 'hour'],
            unit: 60 * 60 * 1000,
            number: 48
        });

        $('#access-counts-tabs').tabs({ active: 0 });

        $('#summary-detail-tabs').tabs({ active: 0 });

        $('.summary-box .hosts').delegate('.host', 'click', function () {
            $('.summary-box .hosts .selected').removeClass('selected');
            $(this).addClass('selected');

            var host = $(this).attr('data-site-host');
            $('.summary-box .site.selected').removeClass('selected');
            $('.summary-box .sites').find('*[data-site-host="' + host + '"]').addClass('selected');
            return false;
        });
    }
};

module.exports = AccessLogPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/AccessLogViewer":214}],359:[function(require,module,exports){
'use strict';

var BreadcrumbEditor = require('js/Admin/BreadcrumbEditor');

/**
 * 
 */
var BreadcrumbPage = {
    init: function init() {
        var container = document.querySelector('.js-rules-container');

        BreadcrumbEditor.init(container);
    }
};

module.exports = BreadcrumbPage;

},{"js/Admin/BreadcrumbEditor":230}],360:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Window = require('js/Base/Window');

var CategoriesPage = {

    init: function init() {
        var openRenameModalWindow = function openRenameModalWindow(category_name) {
            var $modal = $('.js-rename-modal-window[data-category-name="' + category_name + '"]');
            if ($modal.is(':visible')) return;
            Window.show($modal, {});
            $modal.find(':text').val(category_name).focus()[0].select();
        };
        $(document).on('click', '.js-show-rename-modal-window', function (event) {
            var category_name = $(event.target).attr('data-category-name');
            openRenameModalWindow(category_name);
        });

        // WindowdocumentclickhideAll
        // .js-rename-modal-windowclick
        // clickdocument.on 
        // close
        // 
        $('.js-rename-modal-window .js-icon-close').on('click', function () {
            Window.hideAll();
        });
        $('.js-rename-modal-window').on('click', function (event) {
            event.stopPropagation();
        });
    }
};

module.exports = CategoriesPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Window":299}],361:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var CommentPage = {

    init: function init() {
        Messenger.listenToParent();
        CommentPage.focusTextArea();
        sendResizeRequest();
    },

    focusTextArea: function focusTextArea() {
        // IE9focus
        try {
            $('#body').focus();
        } catch (e) {
            setTimeout(CommentPage.focusTextArea, 100);
        }
    }

};

module.exports = CommentPage;

},{"js/Messenger":562,"js/Util/sendResizeRequest":587}],362:[function(require,module,exports){
'use strict';

var Comments = require('js/Admin/Comments');

var CommentsPage = {

    init: function init() {
        Comments.init();
    }

};

module.exports = CommentsPage;

},{"js/Admin/Comments":231}],363:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var keyString = require('js/keyString');
var Locale = require('js/Locale');
var Messenger = require('js/Messenger');
var EventTracker = require('js/Base/EventTracker');
var FormState = require('js/Base/FormState');
var preventDuplicateSubmit = require('js/Util/preventDuplicateSubmit');
var SocializeBox = require('js/Admin/SocializeBox');

var createEditor = require('js/Editor/createEditor');
var Promotion = require('js/Editor/Component/Promotion');
var EmbedBox = require('js/Editor/Component/EmbedBox');

var EditPage = {

    init: function init() {
        // 
        if (window.parent !== window) {
            Messenger.listenToParent();
            Messenger.send('ready');
        }

        var $title = $('#title');
        var $count = $('#character-count');
        var $form = $('#edit-form');

        var formState = new FormState($form);

        var editor = createEditor($form);

        $form.on('backup-restore', function () {
            return formState.commit();
        });
        editor.bind('initialize', function () {
            return formState.commit();
        });
        editor.trigger('initialize');

        editor.bind('change', function () {
            var c = editor.getCharacterCount();
            $count.text(Locale.textN('edit_form.character_count_unit', c, c));

            if (window.parent !== window) {
                Messenger.send('change', formState.isWatching);
            }
        });
        setTimeout(function () {
            return editor.focus();
        }, 100);

        $title.on('keydown', function (event) {
            if (keyString(event) !== 'RET') {
                return;
            }
            editor.focus();
            return false;
        });

        editor.$form.on('submit', function () {
            var submitButton = editor.$form.find(':submit');
            var disable = function disable() {
                editor.$form.addClass('unedited');
                submitButton.attr('disable', 'disable');
            };
            var enable = function enable() {
                editor.$form.removeClass('unedited');
                submitButton.removeAttr('disable');
            };

            var maxLength = 655360; // 2^16 * 10 
            if (editor.getByteCount() > maxLength) {
                disable();
                editor.bind('change', enable);
                window.alert(Locale.text('edit_form.body_length_exceeded_error'));
                return false;
            } else {
                // 
                preventDuplicateSubmit($(editor.$form));

                if (window.parent !== window) {
                    Messenger.send('change', false);
                }
            }
        });

        Promotion.init(document.querySelector('#promotion'), document.querySelector('.promotion-container'), editor);

        var embedBox = new EmbedBox({
            editor: editor,
            $container: $('.js-editor-embed-box')
        });

        // URLpaste
        // URL
        // URL
        // URL
        $(editor).on('paste-url', function (event, url) {
            if (!embedBox.isEnabledOnPasteURL()) {
                editor.insert(url);
                return;
            }

            embedBox.setURL(url);
            var session = embedBox.show();
            embedBox.requestPreview();
            session.fail(function () {
                return editor.insert(url);
            });

            EventTracker.trackEvent('EmbedBox.showFromPaste');
        });

        SocializeBox.setup();
    }

};

module.exports = EditPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/SocializeBox":266,"js/Base/EventTracker":284,"js/Base/FormState":287,"js/Editor/Component/EmbedBox":448,"js/Editor/Component/Promotion":522,"js/Editor/createEditor":560,"js/Locale":561,"js/Messenger":562,"js/Util/preventDuplicateSubmit":585,"js/keyString":599}],364:[function(require,module,exports){
var Entries = require('js/Admin/Entries/Entries');
var EntriesView = require('js/Admin/Entries/EntriesView');
var Categories = require('js/Admin/Entries/Categories');
var CategoriesView = require('js/Admin/Entries/CategoriesView');
var ShareDraftBox = require('js/Admin/Entries/ShareDraftBox');

var CategoriesDropdownView = require('js/Admin/Entries/CategoriesDropdownView.js');
var EntryTypeTabsView = require('js/Admin/Entries/EntryTypeTabsView');

var EntriesPage = {

    init: function init() {
        var entries = new Entries();
        var entriesView = new EntriesView(entries);
        var categories = new Categories();
        var categoriesView = new CategoriesView(categories, entries);
        var categoriesDropdownView = new CategoriesDropdownView();
        var entryTypeTabs = new EntryTypeTabsView(entries);
        var shareDraftBox = new ShareDraftBox(entriesView);

        entries.reset();
    }

};

module.exports = EntriesPage;

},{"js/Admin/Entries/Categories":250,"js/Admin/Entries/CategoriesDropdownView.js":251,"js/Admin/Entries/CategoriesView":252,"js/Admin/Entries/Entries":257,"js/Admin/Entries/EntriesView":258,"js/Admin/Entries/EntryTypeTabsView":260,"js/Admin/Entries/ShareDraftBox":262}],365:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

var Export = function Export(downloadURL, reserveURL) {
    this.downloadURL = downloadURL;
    this.reserveURL = reserveURL;
};

Export.prototype = {
    // 
    // not-created, running, completed 3
    getStatus: function getStatus() {
        return this.status;
    },
    // 
    // HTTPYYYY/MM/DDHTTP
    getDate: function getDate() {
        var date = this.date;

        if (!date) return null;

        var parsedDate;
        try {
            parsedDate = new Date(Date.parse(date));
            return [parsedDate.getFullYear(), parsedDate.getMonth() + 1, parsedDate.getDate()].join("/");
        } catch (ignore) {}
        return date;
    },
    // 
    // /download
    // - 200: 
    // - 404: 
    // - 503: 
    fetchStatus: function fetchStatus() {
        var self = this;
        $.ajax({
            url: self.downloadURL,
            method: 'HEAD',
            cache: false
        }).done(function (_ignore, __ignore, res) {
            self.date = res.getResponseHeader('Last-Modified');
            self.status = 'completed';
            self._updated();
        }).fail(function (res) {
            self.date = null;
            if (res.status === 503) {
                self.status = 'running';
                setTimeout(function () {
                    self.fetchStatus();
                }, 1000);
            } else {
                self.status = 'not-created';
            }
            self._updated();
        });
    },
    // 
    reserveExport: function reserveExport() {
        var self = this;
        $.ajax({
            url: self.reserveURL,
            method: 'POST',
            data: {
                rkm: globalData('rkm'),
                rkc: globalData('rkc')
            }
        }).always(function () {
            self.fetchStatus();
        });
        self.status = 'running';
        self._updated();
    },
    _updated: function _updated(data) {
        $(this).triggerHandler('updated');
    }
};

var ExportMovableTypePage = {

    init: function init() {
        var $container = $('.js-export-wrapper');
        var $panels = $container.find('.js-export-control-panel');
        var $reserveCompletedAt = $container.find('.js-reserve-completed-at');
        var $reserveButton = $container.find('.js-reserve-export-button');
        var $successMessage = $('.js-export-success-message');

        var statusToSelector = {
            'not-created': '.js-reserve-export-wrapper',
            'running': '.js-exporting-wrapper',
            'completed': '.js-export-completed-wrapper'
        };

        var exportModel = new Export($container.attr('data-download-url'), $container.attr('data-reserve-url'));

        $reserveButton.on('click', function () {
            exportModel.reserveExport();
        });

        $(exportModel).on('updated', function () {
            var status = exportModel.getStatus();
            $panels.hide();
            $container.find(statusToSelector[status]).show();
            $reserveCompletedAt.text(exportModel.getDate());
            if (status === 'completed') {
                $successMessage.show();
            } else {
                $successMessage.hide();
            }
        });

        exportModel.fetchStatus();
    }
};

module.exports = ExportMovableTypePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],366:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');

/**
 * One
 * 
 * blog.hatena.ne.jp/my/friend
 */
var FriendPage = {

    init: function init() {
        Messenger.listenToParent();
    }
};

module.exports = FriendPage;

},{"js/Messenger":562}],367:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');

function showCategories(superCategory) {
    if (superCategory) {
        var $categories = $('.categories-container').filter(function () {
            return $(this).attr('data-super-category') === superCategory;
        }).show();

        if ($categories.length > 0) {
            $('#super-categories-container').hide();
            $('.submit-form-controls').show();
            location.hash = '#' + superCategory;
        }
        $('.back-button').show();
    } else {
        $('#super-categories-container').show();
        $('.categories-container').hide();
        $('.submit-form-controls').hide();
        $('.back-button').hide();
        location.hash = '#';
    }
}

/**
 * 
 */
var GroupOfficialDialogPage = {

    init: function init() {
        $(window).hashchange(function () {
            var m = /^#((?:\w|-)+)$/.exec(location.hash);
            if (m) {
                showCategories(m[1]);
            } else {
                showCategories(false);
            }
        }).hashchange();

        $('#super-categories-container .select-super-category').click(function () {
            var superCategory = $(this).closest('[data-super-category]').attr('data-super-category');
            showCategories(superCategory);
            return false;
        });

        $('.back-button').click(function () {
            showCategories(false);
            return false;
        });

        Messenger.listenToParent();
        Messenger.send('resize', {
            height: 620,
            width: 620
        });

        $('.skip-button').click(function () {
            Messenger.send('close');
            return false;
        });

        $('form').submit(function () {
            var $form = $(this);

            $.ajax($form.attr('action'), {
                method: $form.attr('method'),
                data: $form.serialize()
            }).always(function () {
                Messenger.send('close');
            });

            Messenger.send('hide');

            return false;
        });
    }
};

module.exports = GroupOfficialDialogPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562}],368:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var ImportProgressBar = require('js/Admin/Import/ProgressBar');

var ImportPage = {

    init: function init() {
        $('.js-revert-import').on('submit', function () {
            return confirm(Locale.text('admin.import.undo.confirm'));
        });

        var $progress = $('.js-import-progress');
        if (!$progress[0]) {
            return;
        }

        var $bar = $progress.find('.js-import-bar');
        var apiUrl = $progress.attr('data-api-url');
        var onCompleteUrl = $progress.attr('data-on-complete-url');

        ImportProgressBar.init($bar, apiUrl, onCompleteUrl);
    }
};

module.exports = ImportPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/Import/ProgressBar":263,"js/Locale":561}],369:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var MembersPage = {

    init: function init() {
        $('.js-manage-members-table').on('click', '.js-edit-role', function () {
            var $row = $(this).parents('.js-member-row');
            $row.find('.js-form-member-update').show();
            $row.find('.js-member-role').hide();
        }).on('click', '.js-edit-cancel', function () {
            var $row = $(this).parents('.js-member-row');
            $row.find('.js-member-role').show();
            $row.find('.js-form-member-update').hide();
        });
    }
};

module.exports = MembersPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],370:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var preventDuplicateSubmit = require('js/Util/preventDuplicateSubmit');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var SubscribePage = {

    init: function init() {
        $('#subscribe-form').submit(function () {
            preventDuplicateSubmit($(this));
        });
        Messenger.listenToParent();
        sendResizeRequest();

        $('section input[type=checkbox]').focus();
    }
};

module.exports = SubscribePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562,"js/Util/preventDuplicateSubmit":585,"js/Util/sendResizeRequest":587}],371:[function(require,module,exports){
'use strict';

var loadNicknames = require('js/Util/loadNicknames');

var SubscribersPage = {

    init: function init() {
        var container = $('#subscribers-table-body');
        loadNicknames(container);
    }

};

module.exports = SubscribersPage;

},{"js/Util/loadNicknames":579}],372:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var GlobalHeaderSubscriber = require('js/Blogs/GlobalHeaderSubscriber');
var setupTouchViewSuggest = require('js/Base/setupTouchViewSuggest');
var globalData = require('js/Base/globalData');
var Pages = require('js/Base/Pages');
var Messenger = require('js/Messenger');
var Dropdown = require('js/Base/Dropdown');

var AdminDomain = {

    init: function init() {
        Locale.setupTimestampUpdater();
        GlobalHeaderSubscriber.init();
        setupTouchViewSuggest();

        AdminDomain.setupBlogList();
        AdminDomain.setupSubscribeBadge();
        AdminDomain.prepareForGlobalHeader();
    },

    /**
     * 
     */
    prepareForGlobalHeader: function prepareForGlobalHeader() {
        if (window != window.parent) {
            return null;
        }
        if (!Messenger.messenger) {
            return null;
        }

        // 
        var blogUri = globalData('blogs-uri-base');
        var blogName = globalData('blog-name');
        var blogIsPublic = globalData('blog-is-public');
        if (!(blogUri && blogName)) {
            return;
        }

        // admin
        if (globalData('page') === 'index') {
            return;
        }

        // 
        Pages.infoLoaded.then(function () {
            Messenger.send('showBlogInfo', {
                blogName: blogName,
                blogUri: blogUri,
                blogIsPublic: blogIsPublic
            });
        });

        // 
        Messenger.addEventListener('blogmenuAdmin', function (data) {
            var params = $.param({
                blog: data.blogUri,
                isEditing: globalData('page') === 'user-blog-edit' ? 1 : 0
            });
            Dropdown.toggle('/-/menu/blogmenu_admin?' + params, data, 'blogmenu');
        });
    },

    /**
     * 
     * 
     * 
     */
    setupBlogList: function setupBlogList() {
        var $blogList = $('.js-admin-menu-myblog-list');

        $('.js-admin-menu-myblog-btn').on('click', function () {
            if ($blogList.size() === 0) {
                return true;
            } else {
                $blogList.toggle();
                return false;
            }
        });

        $(document).on('click', function (e) {
            if (!$.contains($blogList, e.target)) {
                $blogList.hide();
            }
        });
    },

    setupSubscribeBadge: function setupSubscribeBadge() {
        if (window !== window.parent) {
            return null;
        } // globalheader

        var unreadUrl = globalData('admin-domain').replace(/https?\:/, '') + '/api/recent_subscribing';
        $.ajax({
            url: unreadUrl,
            type: 'get',
            cache: false,
            dataType: 'json'
        }).done(function (res) {
            if (!res || !res.count) {
                return;
            }

            var count = +res.count;
            if (count === 0) {
                return;
            }

            // 21
            var countStr = count > 20 ? '20+' : '' + res.count;

            $('.badge-subscribe').addClass('visible').text(countStr);
        });
    }

};

module.exports = AdminDomain;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Dropdown":282,"js/Base/Pages":295,"js/Base/globalData":302,"js/Base/setupTouchViewSuggest":306,"js/Blogs/GlobalHeaderSubscriber":311,"js/Locale":561,"js/Messenger":562}],373:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var SubscribeButton = require('js/SubscribeButton');
var globalData = require('js/Base/globalData');

var _require = require('js/Admin/SubscriptionConfig');

var attachSubscriptionConfig = _require.attachSubscriptionConfig;

var AntennaPage = {

    init: function init() {
        attachSubscriptionConfig(document, '.js-subscription');

        // 
        var setupEntryBox = function setupEntryBox($recentEntryBox) {
            var $recentEntries = $recentEntryBox.find('li.posts');
            var $moreButton = $recentEntryBox.find('li.more');
        };

        var $recentEntryBoxes = $('.entry-unit-older-post');
        $recentEntryBoxes.each(function () {
            setupEntryBox($(this));
        });

        $('.entry-unit').on('click', '.more', function (e) {
            var $button = $(this);
            var $recentEntries = $button.siblings('li.posts:hidden');
            $recentEntries.slideToggle('fast');
            $button.addClass('is-hidden');
        });

        var $closedBlogs = $('.closed-blog');
        $closedBlogs.each(function () {
            var $closedBlog = $(this);
            var antennaUrl = $closedBlog.data("antennaUrl");
            $.ajax({
                type: 'GET',
                url: antennaUrl,
                data: { device: 'pc' },
                dataType: 'html',
                crossDomain: true,
                xhrFields: {
                    withCredentials: true
                }
            }).done(function (res) {
                $closedBlog.empty();
                $closedBlog.append(res);
                setupEntryBox($closedBlog);
                var $blogContents = $closedBlog.find('.js-blog-content');
                Locale.updateTimestamps($blogContents[0]);
            });
        });

        // 
        var setUpRecommendedBlogs = function setUpRecommendedBlogs() {
            var $wrapper = $('.js-admin-subscribe-recommended-wrapper');
            var $recommendedBlogs = $wrapper.find('.recommend-blog');
            var $moreButton = $wrapper.find('.more');

            $recommendedBlogs.each(function (i) {
                var $li = $(this);
                var $el = $(this).find('.js-hatena-follow-button-box');

                var userData = {
                    isSubscribing: false,
                    isGuest: false
                };
                var blogUrl = $li.data('blogHost');
                var blogData = {
                    subscribersCount: parseInt($el.data('subscribers-count'), 10),
                    blogUrl: blogUrl,
                    requestUrl: [globalData('admin-domain'), $li.data('author'), blogUrl, 'subscribe'].join('/')
                };

                new SubscribeButton.Admin($el, userData, blogData);
            });

            var unit = 10; // 

            var head = $recommendedBlogs.filter(':visible').length; // 
            var tail = head + unit; // 

            var showMoreBlogs = function showMoreBlogs() {
                $recommendedBlogs.filter(function (i) {
                    return head <= i && i < tail;
                }).fadeIn('fast');

                head = tail;
                tail += unit;
            };

            $moreButton.on('click', function (e) {
                showMoreBlogs();
                if ($recommendedBlogs.length < head) {
                    $moreButton.addClass('is-hidden');
                }
            });
        };
        setUpRecommendedBlogs();
    }

};

module.exports = AntennaPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/SubscriptionConfig":267,"js/Base/globalData":302,"js/Locale":561,"js/SubscribeButton":570}],374:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Circle = require('js/Base/Circle');

var CirclePage = {

    init: function init() {
        $('.membership-category').each(function (i, container) {
            var $container = $(container);
            var $select = $container.find('.membership-category-select');
            var current = $select.find('option:selected').val();
            var $indicator = $container.find('.indicator');

            $select.change(function (e) {
                Circle.updateMembershipCategory($select).done(function (data) {
                    $indicator.find('.success').show();
                    $indicator.find('.fail').hide();
                }).error(function (data) {
                    $select.val(current);
                    $indicator.find('.success').hide();
                    $indicator.find('.fail').show();
                });
            });
        });
    }

};

module.exports = CirclePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Circle":279}],375:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var updateDynamicPieces = require('js/Util/updateDynamicPieces');

var ConfigPage = {

    init: function init() {
        updateDynamicPieces($('#user-config'));
    }

};

module.exports = ConfigPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/updateDynamicPieces":591}],376:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var Location = require('js/Base/Location');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var FeedbackIframePage = {

    init: function init() {
        Messenger.listenToParent();

        $('.close').on('click', function (e) {
            Messenger.send('close', { name: window.name });
            return false;
        });

        $('#button-feedback').on('click', function (e) {
            $('.js-show-on-send-feedback').show();
            $('#body').focus();
            $('.js-hide-on-send-feedback').hide();
            sendResizeRequest();
        });

        if (!!Location.param('thankyou')) {
            setTimeout(function () {
                $('#button-close').click();
            }, 3000);
        }
    }

};

module.exports = FeedbackIframePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Location":292,"js/Messenger":562,"js/Util/sendResizeRequest":587}],377:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');
var Browser = require('js/Base/Browser');
var needComrule2013 = require('js/Util/needComrule2013');
var Pages = require('js/Base/Pages');
var inheritVia = require('js/Base/inheritVia');
var LOG = require('js/Base/Logger').LOG;
var BUG = require('js/Base/Logger').BUG;
var SubscribeButton = require('js/SubscribeButton');

/**
 * 
 */
var GlobalHeaderPage = {

    init: function init() {
        Messenger.listenToParent();

        var BASE = location.hostname.match(/\.hatena\.[^:]+/)[0];

        var header = $('#header');
        var headerServices = $('#header-services');
        var headerNotify = $('#header-notify');
        var headerUnread = $('#header-unread');
        var headerLocale = $('#header-locale');

        var blogUri = decodeURIComponent(location.hash.substring(1));
        var loc = globalData('admin-domain') + '/go?blog=' + encodeURIComponent(blogUri);

        var publicUserInfo = $.ajax({
            type: 'get',
            dataType: 'jsonp',
            url: 'https://www' + BASE + '/notify/notices.count.json',
            data: {
                services: 1
            }
        });

        if (!Browser.isIE) {
            // IEcanvas
            var dropdownColor = document.body.getAttribute('data-color');
            GlobalHeaderPage.renderDropdown(dropdownColor);
        }

        header.delegate('.header-dropdown', {
            keypress: function keypress(event) {
                if (event.which !== 13) {
                    return;
                }

                $(event.currentTarget).click();
                event.preventDefault();
                event.stopPropagation();
            },
            mouseup: function mouseup(event) {
                event.currentTarget.blur();
            }
        });

        header.find('a.new-entry').on('click', function () {
            Messenger.send('new-entry', {});
            return false;
        });

        header.find('a.feedback').on('click', function (e) {
            var $feedback = $(e.currentTarget);
            Messenger.send('feedback', {
                left: $feedback.offset().left,
                uri: globalData('feedback')
            });
            return false;
        });

        header.find('.units a').on('click', function (e) {
            var $units = $(e.currentTarget);
            Messenger.send('units', {
                left: $units.offset().left,
                uri: '/-/units'
            });
            return false;
        });

        headerLocale.find('.header-dropdown').on('click', function () {
            Messenger.send('locale', {});
            return false;
        });

        headerServices.find('.header-dropdown').on('click', function (e) {
            var $dropdown = $(e.currentTarget);
            publicUserInfo.done(function (info) {
                Messenger.send('servicesmenu', {
                    BASE: BASE,
                    right: $dropdown.offset().left + $dropdown.width(),
                    info: info,
                    location: loc
                });
            });
            return false;
        });

        headerNotify.find('.header-dropdown').on('click', function (e) {
            var $dropdown = $(e.currentTarget);
            Messenger.send('notify', {
                BASE: BASE,
                left: $dropdown.offset().left
            });
            headerNotify.find('.notify-count').text('').hide();
            return false;
        });

        headerUnread.find('.header-button').on('click', function () {
            Messenger.send('unread');
            return false;
        });

        $('.locale .header-dropdown').on('click', function (e) {
            var $dropdown = $(e.currentTarget);
            Messenger.send('locale', {
                height: +$dropdown.attr('data-height-hint'),
                right: $dropdown.offset().left + $dropdown.width()
            });
            return false;
        });

        publicUserInfo.done(function (data) {
            if (data.count > 0) {
                headerNotify.find('.notify-count').text(data.count).show();
            } else {
                headerNotify.find('.notify-count').text('').hide();
            }
        });

        publicUserInfo.done(needComrule2013);

        // 
        var adminDomain = globalData('admin-domain').replace(/https?\:/, '');
        var unreadUrl = adminDomain + '/api/recent_subscribing';

        if (globalData('rkm') && globalData('rkc')) {
            $.ajax({
                url: unreadUrl,
                type: 'get',
                cache: false,
                dataType: 'json'
            }).done(function (res) {
                if (res && res.count) {
                    var count = +res.count;
                    if (count === 0) {
                        return;
                    }

                    var badge = headerUnread.find('.unread-count');
                    badge.show();

                    // 20
                    if (count > 20) {
                        badge.text('20');
                    } else {
                        badge.text(res.count);
                    }
                }
            });
        }

        Pages.loadInfo().done(function (info) {

            // 
            // adminblogs
            GlobalHeaderPage.initSubscribe(info);

            // 
            GlobalHeaderPage.initQuoteStock(info);

            // mymenu
            var $mymenu = $('#header-my');
            $mymenu.on('click', function () {
                Messenger.send('mymenu', {
                    BASE: BASE,
                    right: $mymenu.offset().left + $mymenu.width()
                });
                return false;
            });

            if (header.attr('data-page-category') === 'blogs') {
                // 
                // append
                if (!info.is_public) {
                    $('.js-blog-private-badge').show();
                }

                // 
                if (info.blog_name) {
                    $('#current-blog .current-blog-title').append(document.createTextNode(info.blog_name));
                }

                GlobalHeaderPage.initBlogDropdown(BASE);
            }
            if (header.attr('data-page-category') === 'admin') {
                GlobalHeaderPage.initAdminDropdown();
            }
        });

        $('.login').attr('href', 'https://www.hatena.ne.jp/login?location=' + encodeURIComponent(loc));

        // globalheaderjsvia
        Messenger.addEventListener('inheritVia', function (via) {
            LOG(['inheritVia', via]);
            inheritVia(via);
        });

        Messenger.addEventListener('newEntryGeometry', function () {
            var $newEntry = $('a.new-entry');
            var offset = $newEntry.offset();

            Messenger.send('newEntryGeometry', {
                top: offset.top,
                left: offset.left,
                height: $newEntry.height(),
                width: $newEntry.width()
            });
        });
    },

    coloringSvgHeader: function coloringSvgHeader(img, callbackWithJqueryObj) {
        // eventfire?
        img.onload = null;

        try {
            var color = document.body.getAttribute('data-color');
            $(img).find('path').attr('fill', color);
        } catch (e) {
            BUG(e, 'render logo');
        }

        callbackWithJqueryObj($(img));
    },

    renderDropdown: function renderDropdown(color) {
        var img = new Image();
        img.src = '/images/header/dropdown@2x.png?version=' + globalData('version');

        img.onload = function () {
            try {
                img.onload = null;

                var canvas = document.createElement('canvas');
                canvas.setAttribute('width', 24);
                canvas.setAttribute('height', 24);
                if (!canvas.getContext) {
                    return;
                }

                var ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);
                ctx.globalCompositeOperation = 'source-in';
                ctx.fillStyle = color;
                ctx.fillRect(0, 0, 24, 24);
                if (!canvas.toDataURL) {
                    return;
                }

                var data = canvas.toDataURL();

                var style = document.createElement('style');
                style.setAttribute('type', 'text/css');
                style.appendChild(document.createTextNode('\n                    #header span.header-dropdown,\n                    #header span.header-dropdown-custom {\n                        background: url(' + data + ') center right no-repeat; background-size: 12px 12px;\n                    }\n                '));
                document.body.appendChild(style);
            } catch (e) {
                BUG(e, 'render logo dropdown');
                img.src = '/images/header/dropdown.gif?version=' + globalData('version');
            }
        };
    },

    initAdminDropdown: function initAdminDropdown() {
        var $blogmenuButton = $('#current-blog');
        var $blogmenuTitle = $blogmenuButton.find('.current-blog-title');

        // 
        Messenger.addEventListener('showBlogInfo', function (data) {
            $blogmenuButton.show();
            $blogmenuTitle.text(data.blogName);
            if (!data.blogIsPublic) {
                $('.js-blog-private-badge').show();
            }

            // 
            $('.service-menu .edit').hide();
            $('.service-menu .admin-blog').show();

            // 
            $('#current-blog, #my-blogs').on('click', function (e) {
                var $blog = $(e.currentTarget);
                Messenger.send('blogmenuAdmin', {
                    left: $blog.offset().left,
                    blogUri: data.blogUri
                });
                return false;
            });
        });
    },

    initBlogDropdown: function initBlogDropdown(BASE) {

        var $blogmenuButton = $('#current-blog');
        $blogmenuButton.show();

        $('#current-blog, #my-blogs').on('click', function (e) {
            var $blog = $(e.currentTarget);
            Messenger.send('blogmenu', {
                BASE: BASE,
                left: $blog.offset().left
            });
            return false;
        });
    },

    initSubscribe: function initSubscribe(info) {
        // 
        // 
        // 
        if (!info.subscribe && !info.can_open_editor) {
            (function () {
                var $subscribe = $('.js-globalheader-subscribe');
                var $done = $('.js-globalheader-subscribed-message');

                $subscribe.show();

                $subscribe.on('click', function () {
                    Messenger.send('subscribe', {
                        left: $subscribe.offset().left
                    });
                    return false;
                });

                // 
                Messenger.addEventListener('subscribed-current-blog', function () {
                    $subscribe.hide();
                    $done.show().delay(3000).fadeOut('slow');
                });
            })();
        }

        // adminblogs
        // admin -> blogs
        window.addEventListener('storage', function (event) {
            if (event.key !== 'subscription') {
                return;
            }
            Messenger.send('subscription', JSON.parse(event.newValue));
        });
        // blogs -> admin
        Messenger.addEventListener('subscription', function (data) {
            for (var key in data) {
                SubscribeButton.Admin.setSubscription(key, data[key]);
            }
        });
    },

    initQuoteStock: function initQuoteStock() {

        Messenger.addEventListener('stockQuote', function (data) {
            if (!data.uri || !data.selected_text) {
                Messenger.send('failStockQuote', {});
            }

            $.ajax({
                url: '/api/quotes',
                data: {
                    uri: data.uri,
                    body: data.selected_text,
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                },
                cache: false,
                type: 'post',
                dataType: 'json'
            }).done(function (res) {
                Messenger.send('successStockQuote', {
                    res: res
                });
            }).fail(function (res) {
                Messenger.send('failStockQuote', {
                    res: res
                });
            });
        });

        // 
        // 
        // admin -> blogs
        Messenger.addEventListener('quote-edit-entry', function () {
            Messenger.send('new-entry-with-quote');
        });

        Messenger.addEventListener('requote-edit-entry', function (data) {
            try {
                localStorage.setItem('ReQuote', JSON.stringify(data.quote));
            } catch (e) {}

            Messenger.send('new-entry-with-requote');
        });
    }

};

module.exports = GlobalHeaderPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Browser":278,"js/Base/Logger":293,"js/Base/Pages":295,"js/Base/globalData":302,"js/Base/inheritVia":303,"js/SubscribeButton":570,"js/Util/needComrule2013":582}],378:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var globalData = require('js/Base/globalData');

var _require = require('js/Admin/SubscriptionConfig');

var attachSubscriptionConfig = _require.attachSubscriptionConfig;

var IndexPage = {

    init: function init() {
        attachSubscriptionConfig(document, '.js-subscription');

        $('.access-graph[itemscope]').each(function () {
            var $this = $(this);
            var i = 0;var data = $this.find('meta').map(function () {
                return [[i++, +this.getAttribute('content')]];
            });

            $.plot($this, [{
                data: data,
                bars: { show: true, lineWidth: 0.7 },
                points: { show: false },
                legend: { show: false },
                shadowSize: 0
            }], {
                xaxis: {
                    min: 0,
                    ticks: []
                },
                yaxis: {
                    min: 1,
                    autoscaleMargin: 0.1,
                    ticks: []
                },
                grid: {
                    show: false
                }
            });
        });
        $(document.body).click(function () {
            $('.config-dropdown-window').removeClass('open');
        });
        $('.dropdown-toggle').click(function () {
            var dropdown = $(this).closest('.myblog-box').find('.config-dropdown-window');
            if (dropdown.hasClass('open')) {
                dropdown.removeClass('open');
            } else {
                $('.config-dropdown-window').removeClass('open');
                dropdown.addClass('open');
            }
            return false;
        });

        // cookie
        var $closedBlogs = $('.closed-blog');
        $closedBlogs.each(function () {
            var $closedBlog = $(this);
            var antennaUrl = $closedBlog.data("antennaUrl");
            $.ajax({
                type: 'GET',
                url: antennaUrl,
                data: { lite: 1, device: 'pc' },
                dataType: 'html',
                crossDomain: true,
                xhrFields: {
                    withCredentials: true
                }
            }).done(function (res) {
                var $res = $($.parseHTML(res));
                $closedBlog = $closedBlog.replaceWith($res);
                var $blogContents = $res.find('.js-blog-content');
                Locale.updateTimestamps($blogContents[0]);
            });
        });

        this.getDashboardData();
    },

    getDashboardData: function getDashboardData() {
        $.ajax({
            type: 'GET',
            url: '/-/dashboard_data'
        }).done(function (data) {
            if ($('section.js-hot-entries-section').length) {
                $('section.js-hot-entries-section').append(data.hot_entries);
            }

            if ($('section.js-hot-blogs-section').length) {
                $('section.js-hot-blogs-section').append(data.hot_blogs);
            }

            if ($('section.js-recent-blogs-section').length) {
                $('section.js-recent-blogs-section').append(data.recent_blogs);
            }

            if ($('section.js-subscribing-blogs-section').length) {
                $('section.js-subscribing-blogs-section').append(data.subscribing_blogs);
            }

            Locale.updateTimestamps();
        });
    }

};

module.exports = IndexPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/SubscriptionConfig":267,"js/Base/globalData":302,"js/Locale":561}],379:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var LocalePage = {

    init: function init() {
        Messenger.listenToParent();

        $('#locale-window a').on('click', function () {
            var $this = $(this);
            var lang = $this.attr('data-lang');
            Locale.setAcceptLang(lang);
            Messenger.send('reload');
            return false;
        });

        sendResizeRequest();
    }

};

module.exports = LocalePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561,"js/Messenger":562,"js/Util/sendResizeRequest":587}],380:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var MenuBlogMenuAdminPage = {

    init: function init() {
        Messenger.listenToParent();
        sendResizeRequest();
        Messenger.send('init');
    }

};

module.exports = MenuBlogMenuAdminPage;

},{"js/Messenger":562,"js/Util/sendResizeRequest":587}],381:[function(require,module,exports){
'use strict';

var Refusal = require('js/Admin/Refusal');

var RefusalPage = {

    init: function init() {
        Refusal.init();
    }
};

module.exports = RefusalPage;

},{"js/Admin/Refusal":265}],382:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

var RegisterIframePage = {

    init: function init() {
        if (!globalData('name')) return; // guest

        var fillinDefault = function fillinDefault() {
            var user_name = globalData('name').toLowerCase().replace(/_/, '-');
            var idInput = $('input[name=id]');
            if (idInput.val() === '') {
                // iduser
                idInput.val(user_name);
            }
        };

        fillinDefault();
    }

};

module.exports = RegisterIframePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],383:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

var RegisterPage = {

    init: function init() {
        if (!globalData('name')) return; // guest

        var dispatcher = RegisterPage;
        dispatcher.submitButton = $('input[type=submit]');

        var $domain = $(':input[name="domain"]');
        var $blogIdInput = $('input[name="id"]');
        var requestThreshold = 1000;
        dispatcher.STATES = {
            progress: {
                className: 'progress',
                message: $('.domain-check-message.progress')
            },
            available: {
                className: 'check',
                message: $('.domain-check-message.check')
            },
            unavailable: {
                className: 'error',
                message: $('.domain-check-message.error')
            },
            invalid: {
                className: 'invalid',
                message: $('.domain-check-message.invalid')
            },
            invalidLength: {
                className: 'invalid-length',
                message: $('.domain-check-message.invalid-length')
            }
        };

        // StatesubmitButton
        dispatcher.inputValidStates = {
            "id": true,
            "import": true
        };

        var fetchBlogIdAvailability = function fetchBlogIdAvailability() {
            var blogID = $blogIdInput.val();
            var topdomain = $domain.val();

            if (!blogID) {
                return;
            } else if (blogID.length < 2 || blogID.length > 32) {
                RegisterPage.changeAvailabilityState({
                    nextState: 'invalidLength'
                });
                return;
            } else if (!/^[a-zA-Z0-9][a-zA-Z0-9\-]+$/.test(blogID)) {
                RegisterPage.changeAvailabilityState({
                    nextState: 'invalid'
                });
                return;
            }

            var brand_name = $('[data-brand-name]').attr('data-brand-name');
            $.ajax({
                url: '/api/blog/domain_registry',
                dataType: 'json',
                data: {
                    blog_ids: JSON.stringify([blogID]),
                    brand_name: brand_name
                }
            }).done(function (data) {
                var domain_statuses = data[blogID];

                if (domain_statuses !== undefined) {
                    dispatcher.checkBlogIdAvailability({
                        blogID: blogID,
                        topdomain: topdomain,
                        statuses: domain_statuses
                    });
                }
            });
        };

        fetchBlogIdAvailability();

        $domain.change(fetchBlogIdAvailability);
        $blogIdInput.keyup(_.debounce(fetchBlogIdAvailability, requestThreshold)).keyup(function () {
            dispatcher.changeAvailabilityState({
                nextState: 'progress'
            });
        });

        var fillinDefault = function fillinDefault() {
            var user_name = globalData('name').toLowerCase().replace(/_/, '-');
            var brand_name = $('[data-brand-name]').attr('data-brand-name');
            $.ajax({
                url: '/api/blog/domain_registry',
                dataType: 'json',
                data: {
                    blog_ids: JSON.stringify([user_name]),
                    brand_name: brand_name
                }
            }).done(function (data) {
                var domain_statuses = data[user_name];

                if (typeof domain_statuses === 'undefined' || typeof domain_statuses === null) {
                    domain_statuses = {};
                }

                var available_domains = RegisterPage.availableDomains(domain_statuses);

                if (_.any(available_domains)) {
                    var $domain = $(':input[name="domain"]');
                    var current_domain = $domain.val();
                    if (!_.include(available_domains, current_domain)) {
                        $domain.val(available_domains[0]);
                    }

                    var idInput = $('input[name=id]');
                    if (idInput.val() === '') {
                        // iduser
                        idInput.val(user_name);
                        RegisterPage.changeAvailabilityState({
                            nextState: 'available'
                        });
                    }
                }
            });
        };

        fillinDefault();

        if ($('input[name=import]').length) {
            $('input[name=permission],input[name=import]').change(function () {
                dispatcher.changeImportAvailabilityState();
            });
            $('.import-error').hide();
            dispatcher.changeImportAvailabilityState();
        }
    },

    changeAvailabilityState: function changeAvailabilityState(args) {
        var dispatcher = RegisterPage;
        var nextState = args.nextState;

        if (nextState == 'unavailable' || nextState == 'invalid' || nextState == 'invalidLength') {
            dispatcher.inputValidStates['id'] = false;
        } else {
            dispatcher.inputValidStates['id'] = true;
        }
        dispatcher.changeSubmitButtonState();

        _.each(RegisterPage.STATES, function (value, key) {
            if (key === nextState) {
                value.message.show();
            } else {
                value.message.hide();
            }
        });
    },

    checkBlogIdAvailability: function checkBlogIdAvailability(args) {
        var topdomain = args.topdomain;
        var blogID = args.blogID;
        var statuses = args.statuses;

        var inputState = statuses[topdomain];
        var availableDomains = RegisterPage.availableDomains(statuses);

        if (inputState === 'unavailable' && _.any(availableDomains)) {
            RegisterPage.suggestAlternativeDomainNames({
                blogID: blogID,
                availableDomains: availableDomains
            });
        }

        RegisterPage.changeAvailabilityState({
            nextState: inputState
        });
    },

    suggestAlternativeDomainNames: function suggestAlternativeDomainNames(args) {
        var blogID = args.blogID;
        var availableDomains = args.availableDomains;
        var $message = $('.domain-recommend');
        var $domain = $(':input[name="domain"]');

        $('.requested-blog-id').text(blogID);

        $message.find('ul').detach();
        var $alternatives = $('<ul/>');
        _.each(availableDomains, function (domain) {
            $('<li/>').text(blogID + '.' + domain).click(function () {
                $domain.val(domain).change();
            }).appendTo($alternatives);
        });
        $message.append($alternatives).show();
    },

    // domain_statuses = {
    //   $domain: 'available' || 'unavailable' || 'invalid'
    //   ...
    // }
    availableDomains: function availableDomains(domain_statuses) {
        var domains = _.keys(domain_statuses);
        var availableDomains = _.select(domains, function (domain) {
            return domain_statuses[domain] === 'available';
        });

        return availableDomains;
    },

    changeImportAvailabilityState: function changeImportAvailabilityState(args) {
        var dispatcher = RegisterPage;

        var $checkedPermission = $('input[name=permission]:checked');
        var $selectedImport = $('input[name=import]:checked');

        var blogPermission = $checkedPermission.val();
        var diaryPermission = $selectedImport.attr('data-permission');

        var $errorMessage = $('.import-error');
        if (diaryPermission == 'private' && blogPermission == 'public') {
            $errorMessage.show();
            dispatcher.inputValidStates['import'] = false;
            dispatcher.changeSubmitButtonState();
        } else {
            $errorMessage.hide();
            dispatcher.inputValidStates['import'] = true;
            dispatcher.changeSubmitButtonState();
        }
    },

    changeSubmitButtonState: function changeSubmitButtonState(args) {
        var dispatcher = RegisterPage;
        var submitButton = dispatcher.submitButton;

        var shouldEnabled = _.every(dispatcher.inputValidStates, function (valid) {
            return valid;
        });

        if (shouldEnabled) {
            submitButton.attr('disabled', false);
            submitButton.removeClass('disabled');
            submitButton.addClass('btn-blue');
        } else {
            submitButton.attr('disabled', true);
            submitButton.removeClass('btn-blue');
            submitButton.addClass('disabled');
        }
    }

};

module.exports = RegisterPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],384:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var StoreThemeNewPage = {

    init: function init() {
        var $availableLicenses = $('.available-licenses');
        var $showAvailableLicenses = $('.show-more').find('a');
        var expandAvailableLicenses = function expandAvailableLicenses() {
            $availableLicenses.show();
            $availableLicenses.attr('data-collapsed', 0);
            $showAvailableLicenses.text($showAvailableLicenses.attr('data-collapse-message'));
        };
        var collapseAvailableLicenses = function collapseAvailableLicenses() {
            $availableLicenses.hide();
            $availableLicenses.attr('data-collapsed', 1);
            $showAvailableLicenses.text($showAvailableLicenses.attr('data-expand-message'));
        };

        $availableLicenses.hide();

        $showAvailableLicenses.on('click', function (e) {
            if ($availableLicenses.attr('data-collapsed') === '1') {
                expandAvailableLicenses();
            } else {
                collapseAvailableLicenses();
            }
            e.preventDefault();
        });

        $('.deed').hide();
        $('.show-deed').on('click', function (e) {
            $($(this).attr('data-target-selector')).toggle();
            return false;
        });

        // 
        if ($('input[name=license]:checked').is(':visible') === false) {
            $showAvailableLicenses.click();
        }
    }

};

module.exports = StoreThemeNewPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],385:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Star = require('js/Star');

var StoreThemeThemeIdPage = {

    init: function init() {
        if (Star) {
            Star.SiteConfig = {
                entryNodes: {
                    '#container': {
                        uri: 'a.permalink',
                        title: 'h1.theme-name',
                        container: '.star-container'
                    }
                }
            };
        }

        var self = StoreThemeThemeIdPage;
        self.$themeContainer = $('#store-container');
        self.$installDialog = $('.blog-title-dropdown-window');
        self.$installButton = $('#sidebar').find('.install-theme-btn');

        self.$installDialog.hide();
        self.$installButton.click(function () {
            self.$installDialog.slideToggle();
        });

        $('#theme-detail-tabs').tabs({ active: 0 });
    }

};

module.exports = StoreThemeThemeIdPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Star":566}],386:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var TopicShowPage = {

    init: function init() {
        var $description = $('.description');
        var $topic_entries_tabs = $('#topic-entries-tabs');

        // 
        $description.find('.read-more').on('click', function (e) {
            e.preventDefault();
            var $read_more_text = $description.find('.read-more-text');
            $description.html($read_more_text.html());
        });

        // 
        $topic_entries_tabs.tabs({ active: 0 });
    }

};

module.exports = TopicShowPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],387:[function(require,module,exports){
'use strict';

var Messenger = require('js/Messenger');

var CommentDonePage = {

    init: function init() {
        Messenger.listenToParent();

        var comment = document.getElementById('posted').value;

        Messenger.send('update', { comment: comment });

        Messenger.send('close');
    }

};

module.exports = CommentDonePage;

},{"js/Messenger":562}],388:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var setupTextareaHider = require('js/Admin/Design/setupTextareaHider');
var setupTouchHeaderImageComponent = require('js/Admin/Design/setupTouchHeaderImageComponent');

var DesignDetailPage = {

    init: function init() {
        setupTextareaHider();
        setupTouchHeaderImageComponent({
            $container: $('.js-header-image-container'),
            previewUpdater: null
        });
    }

};

module.exports = DesignDetailPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/Design/setupTextareaHider":242,"js/Admin/Design/setupTouchHeaderImageComponent":243}],389:[function(require,module,exports){
'use strict';

var BlogPermission = require('js/Admin/BlogPermission');

var PermissionPage = {

    init: function init() {
        new BlogPermission($('#blog-permission-container'));
    }

};

module.exports = PermissionPage;

},{"js/Admin/BlogPermission":220}],390:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var validationTweetLength = require('js/Base/validateTweetLength');
var globalData = require('js/Base/globalData');
var Locale = require('js/Locale');
var TwitterValidator = require('js/AdminTouch/TwitterValidator');

var EditDonePage = {

    init: function init() {
        EditDonePage.initAppSuggestPanel();
        EditDonePage.postToSocialService();
        new TwitterValidator($('.js-touch-edit-socialize-box-li.twitter'));
    },

    initAppSuggestPanel: function initAppSuggestPanel() {
        var $appSuggestContainer = $('.editdoneform-app-suggest-container');
        var localStorageKey = 'Hatena.Diary.AdminTouch.User.Blog.Edit.Done.noticeId';
        var storagedId = localStorage.getItem(localStorageKey);
        var noticeId = $appSuggestContainer.attr('data-notice-id');

        // 
        // IDID&
        if (storagedId !== noticeId) {
            $appSuggestContainer.show();

            // 
            $('.editdoneform-app-suggest-close').on('click', function (event) {
                $appSuggestContainer.hide();

                // localStorage
                localStorage.setItem(localStorageKey, noticeId);
            });
        }
    },

    postToSocialService: function postToSocialService() {
        var entry_id = $('.js-touch-socialize-box').data('entry-id');

        var PostToSocialService = function PostToSocialService(entry_id) {
            this.init(entry_id);
        };
        PostToSocialService.prototype = {
            init: function init(entry_id) {
                this.entry_id = entry_id;
            },
            setServiceName: function setServiceName(service_name) {
                this.service_name = service_name;
            },
            setMessage: function setMessage(message) {
                this.message = message;
            },
            validateMessage: function validateMessage() {
                var self = this;
                // twitter
                // 
                if (self.service_name === 'twitter') {
                    if (validationTweetLength(self.message) === false) return false;
                }

                return true;
            },
            isAjaxRunning: false,
            post: function post() {
                var self = this;

                var dfd = $.Deferred();

                // 
                // reject
                if (self.isAjaxRunning === true) return dfd.reject();

                self.isAjaxRunning = true;

                $.ajax({
                    url: 'post_to_social_service',
                    type: 'POST',
                    data: {
                        rkm: globalData('rkm'),
                        rkc: globalData('rkc'),
                        service_name: self.service_name,
                        entry_id: self.entry_id,
                        message: self.message
                    }
                }).done(function () {
                    dfd.resolve();
                }).fail(function () {
                    dfd.reject();
                }).always(function () {
                    self.isAjaxRunning = false;
                });

                return dfd.promise();
            }
        };

        var post_to_social_service = new PostToSocialService(entry_id);
        $('.js-touch-share-button').on('click', function (event) {

            var $el = $(event.target);

            if ($el.attr('disabled')) return false;

            var $li = $el.closest('li');

            var confirm_message = Locale.text('blog.social.share.confirm', Locale.text('blog.social.service.name.' + $el.data('service-name')));
            if (!confirm(confirm_message)) return false;

            var $validation_error_message = $li.find('.js-validation-error');
            var $share_success_message = $li.find('.js-share-success-message');

            // 
            $validation_error_message.hide();
            $share_success_message.hide();

            post_to_social_service.setServiceName($el.data('service-name'));
            post_to_social_service.setMessage($li.find('.js-share-message').val());

            // validation
            if (post_to_social_service.validateMessage()) {
                post_to_social_service.post().done(function () {
                    $share_success_message.show();
                });
            } else {
                // validation
                $validation_error_message.show();
            }

            return false;
        });
    }

};

module.exports = EditDonePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/AdminTouch/TwitterValidator":275,"js/Base/globalData":302,"js/Base/validateTweetLength":307,"js/Locale":561}],391:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var AccessLogViewer = require('js/Admin/AccessLogViewer');

var AccessLogPage = {

    init: function init() {
        var table = $('#access-counts').remove();
        var counts = {};
        table.find('tr').each(function () {
            var $this = $(this);
            var time = +$this.find('td[data-time]').attr('data-time');
            var count = +$this.find('td[data-count]').attr('data-count');
            counts[time] = count;
        });

        AccessLogViewer.showGraph(counts, {
            parent: $('#access-counts-daily'),
            timeformat: '%m/%d',
            minTickSize: [1, 'day'],
            unit: 24 * 60 * 60 * 1000,
            number: 14,
            graphAreaMarginRight: 20,
            barWidth: 15
        });

        AccessLogViewer.showGraph(counts, {
            parent: $('#access-counts-hourly'),
            timeformat: '%d %H:%M',
            minTickSize: [1, 'hour'],
            unit: 60 * 60 * 1000,
            number: 24,
            graphAreaMarginRight: 20,
            barWidth: 10
        });

        $('#access-counts-tabs').tabs({ active: 0 });

        $('#summary-detail-tabs').tabs({ active: 0 });

        $('.summary-box .hosts').delegate('.host', 'click', function () {
            $('.summary-box .hosts .selected').removeClass('selected');
            $(this).addClass('selected');

            var host = $(this).attr('data-site-host');
            $('.summary-box .site.selected').removeClass('selected');
            $('.summary-box .sites').find('*[data-site-host="' + host + '"]').addClass('selected');
            return false;
        });
    }

};

module.exports = AccessLogPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/AccessLogViewer":214}],392:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');

var ActionPage = {

    init: function init() {
        Messenger.listenToParent();
        Messenger.send('resize', {
            height: $(document.body).height()
        });
    }

};

module.exports = ActionPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562}],393:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var sendResizeRequest = require('js/Util/sendResizeRequest');

var CommentPage = {

    init: function init() {
        Messenger.listenToParent();

        // CAPTCHA
        var $img = $('img');
        if ($img.length > 0) {
            $('img').on('load', sendResizeRequest);
        }

        sendResizeRequest();
    }

};

module.exports = CommentPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562,"js/Util/sendResizeRequest":587}],394:[function(require,module,exports){
'use strict';

var Comments = require('js/Admin/Comments');

var CommentsPage = {

    init: function init() {
        Comments.init();
    }

};

module.exports = CommentsPage;

},{"js/Admin/Comments":231}],395:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var Backup = require('js/Admin/Backup');
var EventTracker = require('js/Base/EventTracker');
var EditorConnector = require('js/Base/EditorConnector');
var extractFotolifeSyntax = require('js/Base/extractFotolifeSyntax');
var globalData = require('js/Base/globalData');

var ColorPicker = require('js/AdminTouch/Editor/ColorPicker');
var TwitterValidator = require('js/AdminTouch/TwitterValidator');
var Uploader = require('js/AdminTouch/Editor/Uploader');
var insertText = require('js/AdminTouch/Editor/insertText');
var setupDateTimeEditor = require('js/AdminTouch/Editor/setupDateTimeEditor');
var canUseWysiwyg = require('js/AdminTouch/Editor/canUseWysiwyg');

var EditPage = {

    init: function init() {
        this.$editEntry = $('#edit-entry');

        if (canUseWysiwyg()) {
            EditPage.setupWysiwygEditor();
        }

        Uploader.init(EditPage.uploadDone);

        EditPage.setupMyCuration();

        EditPage.setupScheduledEntry();

        if (EditPage.dateTimeEditorEnabled()) {
            setupDateTimeEditor();
        }

        EditPage.setupOptionsToggle();
        new TwitterValidator($('.js-touch-edit-socialize-box-li.twitter'));

        Backup.createMessage($('#edit-form'));
    },

    setupWysiwygEditor: function setupWysiwygEditor() {
        var textarea = this.$editEntry.find('textarea#entry-body');
        var iframe = $('<iframe src="about:blank" frameborder="0">').attr('id', 'entry-html-body').prependTo('div.edit-body');

        var wysiwygDocument = iframe.prop('contentDocument');
        var body = textarea.val();
        //  <p> 
        if (!body && !$('form#edit-form input[name="entry"]').val()) {
            body = '<p><br/></p>';
        }
        var link = wysiwygDocument.createElement('link');
        link.setAttribute('type', 'text/css');
        link.setAttribute('rel', 'stylesheet');
        link.setAttribute('href', globalData('admin-domain') + '/css/touch/blog-edit.css');

        wysiwygDocument.getElementsByTagName('head')[0].appendChild(link);
        wysiwygDocument.body.innerHTML = body;
        wysiwygDocument.body.contentEditable = true;
        wysiwygDocument.body.addEventListener('keyup', function () {
            textarea.val(wysiwygDocument.body.innerHTML);
        }, true);

        $('form#edit-form').append($('<input type="hidden" name="wysiwyg" value="1">')).submit(function () {
            $('textarea#entry-body').val(wysiwygDocument.body.innerHTML);
        }).bind('backup-restore', function () {
            wysiwygDocument.body.innerHTML = textarea.val();
        });

        //  Safari 
        $('input#entry-title').blur(function () {
            iframe.focus();
        });

        // click
        $(wysiwygDocument).on('click', "a", function () {
            return false;
        });

        textarea.hide();
    },

    setupOptionsToggle: function setupOptionsToggle() {
        var $options = $('.post-options');
        $('.js-toggle-options').on('click', function () {
            $options.toggle();
            $(document).scrollTop($options.position().top);
            return false;
        });
    },

    execCommand: function execCommand(command, value) {
        var editor = tinymce.get('entry-body');
        editor.execCommand(command, false, value);
        editor.save();
    },

    pickColor: function pickColor(callback) {
        var button = $('#edit-entry .toolbar button[data-action="color"]');
        ColorPicker.show(button.offset(), function (e, color) {
            callback(color);
        });
    },

    fontSize: function fontSize(delta) {
        var selection = tinymce.get('entry-body').selection;

        var span = selection.getNode();
        if (span.nodeName.toLowerCase() != 'span') {
            span = document.createElement('span');
            span.setAttribute('style', 'font-size: ' + (100 + delta) + '%');

            var range = selection.getRng();
            range.surroundContents(span);
            selection.setRng(range);
        } else {
            var remove = false;
            span.setAttribute('style', span.getAttribute('style').replace(/font-size:\s*(\d+)%|$/, function (_, size) {
                if (typeof size == 'undefined') size = 100;
                size = +size + delta;
                if (size == 100) remove = true;
                return 'font-size:' + size + '%';
            }));

            if (remove) {
                var frag = document.createDocumentFragment();
                while (span.firstChild) frag.appendChild(span.firstChild);
                span.parentNode.insertBefore(frag, span);
                span.parentNode.removeChild(span);
            }
        }
    },

    EDITOR_ACTIONS: {
        bold: function bold() {
            // http://www.tinymce.com/wiki.php/Command_identifiers
            this.execCommand('Bold');
        },

        italic: function italic() {
            this.execCommand('Italic');
        },

        strike: function strike() {
            this.execCommand('StrikeThrough');
        },

        underline: function underline() {
            this.execCommand('Underline');
        },

        removeFormat: function removeFormat() {
            this.execCommand("removeFormat");
            this.execCommand("unlink");
        },

        fontSizeIncl: function fontSizeIncl() {
            this.fontSize(+10);
        },

        fontSizeDecl: function fontSizeDecl() {
            this.fontSize(-10);
        },

        unorderedList: function unorderedList() {
            this.execCommand("InsertUnorderedList");
        },

        orderedList: function orderedList() {
            this.execCommand("InsertOrderedList");
        },

        color: function color() {
            var self = this;
            self.pickColor(function (color) {
                if (color) {
                    self.execCommand("ForeColor", color);
                } else {
                    self.execCommand("RemoveFormat");
                }
            });
        },

        link: function link() {
            var url = prompt('URL');
            if (url) {
                url = url.toLowerCase();
            }
            this.execCommand("CreateLink", url);
        }
    },

    uploadDone: function uploadDone(fotolife_syntax) {
        EditPage.trackPhotoUpload();

        if (canUseWysiwyg()) {
            // contentEditableHTML
            extractFotolifeSyntax(fotolife_syntax).done(function (res) {
                insertText(res.html);
            });
        } else {
            insertText('[' + fotolife_syntax.replace(/:image/, ':plain') + ']');
        }
    },

    trackPhotoUpload: function trackPhotoUpload() {
        // fluentd
        // XHRform
        var track_name = typeof FormData != 'undefined' ? 'photo-xhr-upload-touch' : 'photo-form-upload-touch';
        EventTracker.trackEvent(track_name);
    },

    setupMyCuration: function setupMyCuration() {
        $('[data-curation-action]').click(function () {
            var action = $(this).attr('data-curation-action');
            EditorConnector.loadServiceOnChildWindow("/-/curation/" + action);
            EventTracker.trackEvent('open-curation-' + action);
        });
    },

    // <input> type="date/time" 
    dateTimeEditorEnabled: function dateTimeEditorEnabled() {
        var enable_list = _.map(['date', 'time'], function (type) {
            // : http://stackoverflow.com/questions/10193294/how-can-i-tell-if-a-browser-supports-input-type-date
            var input = document.createElement('input');
            input.setAttribute('type', type);
            input.setAttribute('value', 'not-a-date');
            return input.type !== 'text' && input.value !== 'not-a-date';
        });

        return _.all(enable_list);
    },

    setupScheduledEntry: function setupScheduledEntry() {
        // 
        // UI

        var $datetime = $('input[name=datetime]');
        var $checkbox = $('.js-scheduled-entry-checkbox');
        var $normalParts = $('.js-show-on-normal-post');
        var $scheduledParts = $('.js-show-on-scheduled-post');
        var $socializeBox = $('.js-touch-scheduled-socialize-box');

        // datetimecheckbox
        var updateParts = function updateParts() {
            if ($datetime.val()) {
                $checkbox.prop('disabled', false);
            } else {
                $checkbox.prop('disabled', true);
            }

            if ($datetime.val() && $checkbox.prop('checked')) {
                $normalParts.hide();
                $scheduledParts.show();
                $socializeBox.show();
            } else {
                $normalParts.show();
                $scheduledParts.hide();
                $socializeBox.hide();
            }
        };

        $datetime.on('change', updateParts);
        $checkbox.on('change', updateParts);

        updateParts();
    }

};

module.exports = EditPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Admin/Backup":219,"js/AdminTouch/Editor/ColorPicker":269,"js/AdminTouch/Editor/Uploader":270,"js/AdminTouch/Editor/canUseWysiwyg":271,"js/AdminTouch/Editor/insertText":272,"js/AdminTouch/Editor/setupDateTimeEditor":273,"js/AdminTouch/TwitterValidator":275,"js/Base/EditorConnector":283,"js/Base/EventTracker":284,"js/Base/extractFotolifeSyntax":300,"js/Base/globalData":302,"underscore":213}],396:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var EntriesPage = {

    init: function init() {
        $('ul#entries li').click(function (e) {
            if ($(e.target).parents('a').length === 0) {
                location.href = $(this).find('a:first').attr('href');
            }
        });
    }

};

module.exports = EntriesPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],397:[function(require,module,exports){
'use strict';

var loadNicknames = require('js/Util/loadNicknames');

var SubscribersPage = {

    init: function init() {
        var container = $('#subscribers-table-body');
        loadNicknames(container);
    }

};

module.exports = SubscribersPage;

},{"js/Util/loadNicknames":579}],398:[function(require,module,exports){
'use strict';

var Locale = require('js/Locale');
var AndroidAppBanner = require('js/AdminTouch/AndroidAppBanner');

var AdminTouchDomain = {

    init: function init() {
        Locale.setupTimestampUpdater();

        // Mobile safari  onclick  label 
        $('label').on('click', function () {});

        AndroidAppBanner.init();
    }

};

module.exports = AdminTouchDomain;

},{"js/AdminTouch/AndroidAppBanner":268,"js/Locale":561}],399:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');

var AntennaPage = {

    init: function init() {
        var $closedBlogs = $('.closed-blog');
        $closedBlogs.each(function () {
            var $closedBlog = $(this);
            var antennaUrl = $closedBlog.data("antennaUrl");
            $.ajax({
                type: 'GET',
                url: antennaUrl,
                data: { device: 'touch' },
                dataType: 'html',
                crossDomain: true,
                xhrFields: {
                    withCredentials: true
                }
            }).done(function (res) {
                $closedBlog.empty();
                $closedBlog.append(res);
                var $blogContents = $closedBlog.find('.js-blog-content');
                Locale.updateTimestamps($blogContents[0]);
            });
        });
    }

};

module.exports = AntennaPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],400:[function(require,module,exports){
'use strict';

var updateDynamicPieces = require('js/Util/updateDynamicPieces');

var ConfigPage = {

    init: function init() {
        updateDynamicPieces($('#user-config'));
    }

};

module.exports = ConfigPage;

},{"js/Util/updateDynamicPieces":591}],401:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var globalData = require('js/Base/globalData');
var Pages = require('js/Base/Pages');

var GlobalHeaderPage = {

    init: function init() {
        Messenger.listenToParent();

        Pages.loadInfo().done(function (info, privateInfo) {
            GlobalHeaderPage.initSubscribe(info);
            GlobalHeaderPage.initQuoteStock(info);
        });
    },

    // 
    initSubscribe: function initSubscribe(info) {
        // 
        // 
        // 
        if (!info.blog) {
            return;
        }
        if (info.can_open_editor) {
            return;
        }
        if (info.subscribe) {
            return;
        }

        var $container = $('.js-subscribe-container');
        var $link = $container.find('.js-subscribe-link');

        // 
        $link.attr('href', info.subscribe_url);

        // 
        $container.show();
    },

    initQuoteStock: function initQuoteStock(info) {

        Messenger.addEventListener('stockQuote', function (data) {
            if (!data.uri || !data.selected_text) {
                Messenger.send('failStockQuote', {});
            }

            $.ajax({
                url: '/api/quotes',
                data: {
                    uri: data.uri,
                    body: data.selected_text,
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                },
                cache: false,
                type: 'post',
                dataType: 'json'
            }).done(function (res) {
                Messenger.send('successStockQuote', {
                    res: res
                });
            }).fail(function (res) {
                Messenger.send('failStockQuote', {
                    res: res
                });
            });
        });

        // 
        // 
        // admin -> blogs
        Messenger.addEventListener('quote-edit-entry', function (data) {
            if (data.quote !== undefined) {
                localStorage.setItem('reQuote', JSON.stringify(data.quote));
            }
            Messenger.send('new-entry-with-quote', {});
        });
    }

};

module.exports = GlobalHeaderPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Pages":295,"js/Base/globalData":302,"js/Messenger":562}],402:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var needComrule2013 = require('js/Util/needComrule2013');

var IndexPage = {

    init: function init() {
        var tabs = $('#admin-top-tab');
        var navs = $('#admin-top-tab .nav-cell');
        var panels = $('#config-container > .section');

        var loaded = false;
        $(window).load(function () {
            loaded = true;
        });

        navs.click(function () {
            var $this = $(this);
            navs.removeClass('selected');
            navs.find('a img').each(function () {
                if (/-selected/.test(this.src)) {
                    this.src = this.src.replace(/-selected/, '');
                }
            });
            panels.hide();

            var a = $this.find('a');
            $this.addClass('selected');
            a.find('img').each(function () {
                this.src = this.src.replace(/\.([^.\/]+)$/, '-selected.$1');
            });

            var panel = panels.filter(a.attr('href'));
            panel.show();

            tabs.trigger('tabsactivate', { panel: { id: panel.attr('id') } });

            if ('replaceState' in history && loaded) {
                var hash = a.attr('href').match(/(#.+)/)[0];
                if (hash) {
                    history.replaceState(null, document.title, hash);
                }
            }

            // antenna
            var $closedBlogs = $('.closed-blog');
            $closedBlogs.each(function () {
                var $closedBlog = $(this);
                var antennaUrl = $closedBlog.data("antennaUrl");
                $.ajax({
                    type: 'GET',
                    url: antennaUrl,
                    data: { device: 'touch' },
                    dataType: 'html',
                    crossDomain: true,
                    xhrFields: {
                        withCredentials: true
                    }
                }).done(function (res) {
                    $closedBlog.empty();
                    $closedBlog.append(res);
                    var $blogContents = $closedBlog.find('.js-blog-content');
                    Locale.updateTimestamps($blogContents[0]);
                });
            });
            return false;
        });

        var BASE = location.hostname.match(/\.hatena\.[^:]+/)[0];
        var notifyCount = $('#admin-top-tab .notify-count').hide();
        $.getJSON("https://www" + BASE + "/notify/notices.count.json?callback=?", function (res) {
            if (res.count) {
                notifyCount.text(res.count).show();
            }
            needComrule2013(res);
        });

        tabs.on('tabsactivate', function (e, ui) {
            if (ui.panel.id == 'notify') {
                notifyCount.hide();
                var notifyContainer = $('#notify').empty();
                var uri = 'https://www' + BASE + '/notify/notices.iframe?' + new Date().getTime();
                $('<iframe style="width: 100%; height: 340px; margin: 5px 0; padding: 0" frameborder="0"/>').attr('src', uri).appendTo(notifyContainer);
            }
        });

        var selected = navs.filter(function () {
            return $(this).find('a').filter(function () {
                return $(this).attr('href') == location.hash;
            }).length !== 0;
        });
        (selected.length ? selected : navs.eq(0)).click();

        IndexPage.getDashboardData();
    },

    getDashboardData: function getDashboardData() {
        $.ajax({
            type: 'GET',
            url: '/-/dashboard_data',
            data: { device: 'touch' }
        }).done(function (data) {
            $('section#subscribe').append(data.subscribing_blogs);
            $('section.js-hotentry-container').append(data.hot_entries);
        });
    }

};

module.exports = IndexPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561,"js/Util/needComrule2013":582}],403:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var Location = require('js/Base/Location');

var LocalePage = {

    init: function init() {
        $('a.js-set-language').on('click', function () {
            var $this = $(this);
            var lang = $this.attr('data-lang');
            Locale.setAcceptLang(lang);
            location.href = Location.param('location') || '/';
            return false;
        });
    }

};

module.exports = LocalePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Location":292,"js/Locale":561}],404:[function(require,module,exports){
(function (global){
'use strict';

Object.defineProperty(exports, '__esModule', {
    value: true
});
exports.init = init;
var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var _require = require('micro-location');

var Location = _require.Location;

function init() {
    var blogSlug = Location.parse(window.location.href).params('ref');
    $('#promotion-entry').click(function (e) {
        var keyword = e.target.getAttribute('data-keyword');
        if (!keyword) return;
        window.location.href = blogSlug + 'edit?body=' + encodeURIComponent(keyword);
    });
}

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"micro-location":210}],405:[function(require,module,exports){
'use strict';

var Refusal = require('js/Admin/Refusal');

var RefusalPage = {

    init: function init() {
        Refusal.init();
    }
};

module.exports = RefusalPage;

},{"js/Admin/Refusal":265}],406:[function(require,module,exports){
'use strict';

var CircleSidebar = require('js/Blogs/CircleSidebar');

var CircleBlogsPage = {

    init: function init() {
        CircleSidebar.init();
    }

};

module.exports = CircleBlogsPage;

},{"js/Blogs/CircleSidebar":308}],407:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var FastClick = require('fastclick').FastClick;
var Locale = require('js/Locale');
var Messenger = require('js/Messenger');
var Star = require('js/Star');
var QuotePC = require('js/Quote/PC');
var showFlashMessage = require('js/Util/showFlashMessage');
var updateDynamicPieces = require('js/Util/updateDynamicPieces');
var AccessLogger = require('js/Base/AccessLogger');
var Browser = require('js/Base/Browser');
var Location = require('js/Base/Location');
var Pages = require('js/Base/Pages');
var SpeedTrack = require('js/Base/SpeedTrack');
var Window = require('js/Base/Window');
var globalData = require('js/Base/globalData');
var setupProModal = require('js/Base/setupProModal');
var setupTouchViewSuggest = require('js/Base/setupTouchViewSuggest');
var EntriesManager = require('js/Blogs/EntriesManager');
var EntryModuleCarousel = require('js/Blogs/EntryModuleCarousel');
var GlobalHeaderSubscriber = require('js/Blogs/GlobalHeaderSubscriber');
var BlogsModule = require('js/Blogs/Module');
var ReQuote = require('js/Blogs/ReQuote');
var SubscribeButtonSynchronizer = require('js/Blogs/SubscribeButtonSynchronizer');
var TumblrShareButtons = require('js/Blogs/TumblrShareButtons');
var trackBlogVisit = require('js/Blogs/trackBlogVisit');

var BlogsDomain = {

    hasInfoLoaded: false,

    init: function init() {
        // iframeapi
        if (window.parent === window) {
            AccessLogger.ping();
            trackBlogVisit();
        }

        Pages.infoLoaded.then(function (info) {
            BlogsDomain.infoLoaded(info);

            if (info.quote) {
                // 
                QuotePC.init(info.quote);
                QuotePC.Stock.init(info.quote);
            }
        });

        updateDynamicPieces([document]);

        $(document).on('click', 'img.hatena-fotolife, img.magnifiable, img.http-image', function (e) {
            var img = e.currentTarget;
            var $img = $(img);

            if ($img.data('colorbox')) {
                // colorbox is already set up
                return;
            }

            // asrc
            var closestA = $img.closest('a').get(0);
            if (closestA && closestA.href !== img.src) {
                return;
            }

            $img.colorbox({
                maxWidth: '95%',
                maxHeight: '95%',
                transition: 'none',
                photo: true,
                href: $img.attr('src'),
                title: ' ',
                open: true
            });

            $('#cboxContent').on('click', function () {
                $.colorbox.close();
            });

            return false;
        });

        BlogsModule.init();

        GlobalHeaderSubscriber.init();

        BlogsDomain.setupOndemandCommentDeleteButton();

        BlogsDomain.highlightKeyword();

        // archive
        if (!_.contains(['archive', 'hatena-bookmark-comment'], globalData('page'))) {
            Star.initBigStar();
            Star.initStarNavigation();
            Star.initDeleteStar();

            QuotePC.Star.init();
        }

        setupTouchViewSuggest();

        TumblrShareButtons.init();

        BlogsDomain.setupFastClick();
    },

    // 
    highlightKeyword: function highlightKeyword() {
        var params = Location.params();
        if (!params || !params.q) {
            return;
        }

        var keywords = $('.search-result').data('searchQueries');
        if (!keywords) {
            return;
        }

        $('.entry-title').highlight(keywords, { caseSensitive: false });
        $('.entry-description').highlight(keywords, { caseSensitive: false });
    },

    infoLoaded: function infoLoaded(info) {
        if (BlogsDomain.hasInfoLoaded) {
            return;
        }
        BlogsDomain.hasInfoLoaded = true;

        // globalhaedervia
        var via = Location.param('via');
        if (via) {
            Messenger.send('inheritVia', via);
        }

        if (info.message) {
            showFlashMessage(info.message);
        }

        if (info.show_modal) {
            var $modalContainer;
            var $iframe;
            var messenger;

            (function () {
                $modalContainer = $('<div class="hatena-iframe-container"></div>').appendTo(document.body);
                $iframe = $('<iframe frameborder="0"></iframe>').appendTo($modalContainer);
                messenger = Messenger.createForFrame($iframe[0], info.show_modal.url);

                messenger.addEventListener('resize', function (data) {
                    if (data) {
                        $modalContainer.css(data);
                        $(window).trigger('resize'); // reset position
                    }
                });

                var destroyed = $.Deferred();

                // hide close 
                // iframe 
                messenger.addEventListener('hide', function () {
                    Window.hide($modalContainer);
                });

                messenger.addEventListener('close', function () {
                    destroyed.done(function () {
                        $iframe.remove();
                        messenger.destroy();
                    });
                    Window.hide($modalContainer);
                });

                Window.show($modalContainer, {
                    destroy: function destroy() {
                        return destroyed.resolve();
                    },
                    fixScroll: true,
                    center: true,
                    showBackground: true
                });
            })();
        }

        Browser.thirdPartyCookiesBlocked.resolve(!info.cookie_received);

        $('article.entry').each(function (i, e) {
            EntriesManager.initEntry($(e));
        });

        if (info.editable) {
            var createEditButton;

            (function () {
                var $entry = undefined,
                    timer = undefined;
                var $menu = $('<div>').addClass('entry-header-menu');

                // 

                createEditButton = function createEditButton($targetEntry) {
                    return $('<a href="javascript:void">' + Locale.text('edit') + '</a>').on('click', function (e) {
                        e.preventDefault();
                        EntriesManager.editEntryInPlace($targetEntry);
                    });
                };

                $(document).on('mouseenter', 'article.entry', function (e) {
                    var $hovered = $(e.currentTarget);
                    if ($hovered.is($entry)) {
                        clearTimeout(timer);
                        return;
                    }

                    $entry = $hovered;
                    if (!$entry.attr('data-uuid')) {
                        return;
                    }

                    $menu.empty().append(createEditButton($entry)).appendTo($entry.find('.entry-header')).show();
                });

                $(document).on('mouseleave', 'article.entry', function () {
                    clearTimeout(timer);
                    timer = setTimeout(function () {
                        $entry = null;
                        $menu.fadeOut('fast');
                    }, 2000);
                });

                // 
                if (globalData('page') === 'index' && !Location.param('preview') && $('#globalheader').is(':visible')) {
                    BlogsDomain.setupFirstEntry();
                }

                setupProModal();
            })();
        }

        BlogsDomain.renderGooglePlusOneButtons();
        // 
        BlogsDomain.setupHatenaBookmarkComment($('#container'));

        // 
        BlogsDomain.setupEntryModuleCarousel();

        // 
        SubscribeButtonSynchronizer.init(info.subscribe, info.subscribes);

        // Re-
        if (info.is_public) {
            new ReQuote();
        }

        Browser.thirdPartyCookiesBlocked.done(function (blocked) {
            if (blocked) {
                Star.initStarForThirdPartyCookiesDisabled(info);
            }
        });

        SpeedTrack.record("Pages.Blogs['*'].init");
    },

    setupFirstEntry: function setupFirstEntry() {
        $('.entry-content').show();

        // 1
        var $tooltip = $('.welcome-tooltip-newentry');
        $tooltip.on('click', function () {
            return EntriesManager.newEntry();
        });

        Messenger.send('newEntryGeometry');
        Messenger.addEventListener('newEntryGeometry', function (geometry) {
            $tooltip.offset({
                left: geometry.left + geometry.width / 2 - $tooltip.outerWidth() / 2
            });
            $tooltip.show();
        });
    },

    // 
    elementDidAppear: function elementDidAppear(element) {
        var deferred = $.Deferred();
        var $window = $(window);

        if ($window.scrollTop() > $(element).offset().top - $window.height()) {
            deferred.resolve();
        } else {
            $window.on('scroll', _.throttle(function () {
                if ($window.scrollTop() > $(element).offset().top - $window.height()) {
                    deferred.resolve();
                }
            }, 200));
        }
        return deferred.promise();
    },

    // Google+ plusone.js()
    // YouTubesubscribeplusone.js
    // https://developers.google.com/+/web/+1button/?hl=ja
    renderGooglePlusOneButtons: function renderGooglePlusOneButtons() {
        if (!window.gapi) {
            return;
        }

        try {
            window.gapi.plusone.go('container');
            window.gapi.ytsubscribe.go('container');
        } catch (ignore) {
            // Google+IE8IE7
        }
    },

    setupHatenaBookmarkComment: function setupHatenaBookmarkComment($superNode) {
        // 
        // 
        var $bookmarkComment = $superNode.find('.hatena-bookmark-comment-iframe');
        if ($bookmarkComment.size() === 0) {
            return;
        }

        _.each($bookmarkComment, function (item) {
            var $item = $(item);
            var messenger = Messenger.createForFrame(item, $item.attr('data-src'));
            messenger.addEventListener('resize', function (height) {
                $item.css('height', height);
            });
        });
    },

    setupOndemandCommentDeleteButton: function setupOndemandCommentDeleteButton() {
        $(document).on('mouseenter', '.entry-comment', function (e) {
            var $comment = $(e.currentTarget);
            if ($comment.find('.comment-delete-button img').size() > 0) {
                return;
            }

            var adminDomain = globalData('admin-domain');
            var param = $.param({
                comment: $comment.attr('data-comment-uuid'),
                blog: $comment.attr('data-blog-uuid')
            });
            var url = adminDomain + '/api/comment.delete.image?' + param;

            var $img = $('<img src="' + url + '" />');
            $img.on('load error', function () {
                return $img.attr('alt', 'delete');
            });
            $comment.find('.comment-delete-button').append($img);
        });
    },

    setupEntryModuleCarousel: function setupEntryModuleCarousel() {
        var $carouselScripts = $(document).find('script[type="text/x-hatenablog-carousel"]');

        _.each($carouselScripts, function (item) {
            var $item = $(item);
            var displayEntrySize = $item.attr('data-carousel-display-entry-size-at-once');
            var opts = {
                isAutoScroll: !!$item.attr('data-carousel-autoscroll'),
                displayEntrySizeAtOnce: +displayEntrySize || undefined
            };

            if (opts.isAutoScroll) {
                var interval = $item.attr('data-carousel-autoscroll-interval');
                opts.autoScrollInterval = +interval || undefined;
            }

            new EntryModuleCarousel($(document).find($item.html()), opts);
        });
    },

    // TouchBlogsTouchBlogs
    // tap delay
    setupFastClick: function setupFastClick() {
        FastClick.attach(document.body);
    }

};

module.exports = BlogsDomain;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"fastclick":208,"js/Base/AccessLogger":277,"js/Base/Browser":278,"js/Base/Location":292,"js/Base/Pages":295,"js/Base/SpeedTrack":296,"js/Base/Window":299,"js/Base/globalData":302,"js/Base/setupProModal":305,"js/Base/setupTouchViewSuggest":306,"js/Blogs/EntriesManager":309,"js/Blogs/EntryModuleCarousel":310,"js/Blogs/GlobalHeaderSubscriber":311,"js/Blogs/Module":317,"js/Blogs/ReQuote":319,"js/Blogs/SubscribeButtonSynchronizer":320,"js/Blogs/TumblrShareButtons":321,"js/Blogs/trackBlogVisit":322,"js/Locale":561,"js/Messenger":562,"js/Quote/PC":563,"js/Star":566,"js/Util/showFlashMessage":590,"js/Util/updateDynamicPieces":591,"underscore":213}],408:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Pages = require('js/Base/Pages');

var BlogCountLimitExceededPage = {

    init: function init() {
        Pages.infoLoaded.then(function (info) {
            var selector = info.editable ? '.js-message-author' : '.js-message-guest';
            $('#container').append($(selector).html());
        });
    }

};

module.exports = BlogCountLimitExceededPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Pages":295}],409:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Pages = require('js/Base/Pages');
var CircleSidebar = require('js/Blogs/CircleSidebar');

var initScrollFollowedElement = require('../../Util/initScrollFollowedElement');

var CirclePage = {

    init: function init() {
        CirclePage.setupControls();
        CircleSidebar.init();
        CirclePage.setupSpace();

        Pages.infoLoaded.then(function (info) {
            if (info.flash && info.flash.has_just_created_circle) {
                var closeFlash = function closeFlash() {
                    $('#flash-created-circle').fadeOut('fast');
                };
                $('#flash-created-circle').find('.close').click(function () {
                    closeFlash();
                }).end().show();
                $(document.body).on('click', function (e) {
                    if ($(e.target).closest('#flash-created-circle').length === 0) {
                        closeFlash();
                        $(document.body).off('click', arguments.callee);
                        return false;
                    }
                });
            }
        });

        initScrollFollowedElement($('.js-followed-ad-container'), false);
    },

    setupControls: function setupControls() {
        Pages.infoLoaded.then(function (info) {
            if (info.is_admin) {
                $('.admin-control').addClass('admin-control-available');
            } else {
                $('.admin-control').addClass('admin-control-unavailable');
            }

            if (info.is_member) {
                $('.circle-member-control').addClass('circle-member-control-available');
            } else {
                $('.circle-member-control').addClass('circle-member-control-unavailable');
            }

            if (info.has_blogs) {
                $('.blog-user-control').addClass('blog-user-control-available');
            } else {
                $('.blog-user-control').addClass('blog-user-control-unavailable');
            }

            if (info.cookie_received === false) {
                // 
                $('[data-user-unknown-overrides]').removeClass('admin-control-unavailable circle-member-control-unavailable blog-user-control-unavailable').addClass('admin-control-available circle-member-control-available blog-user-control-available');
            }
        });
    },

    setupSpace: function setupSpace() {
        if (!$('.hatena-module.circle-space')[0]) return;
        $.getScript('http://space.hatena.ne.jp/js/interest.widget.js');
    }

};

module.exports = CirclePage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../Util/initScrollFollowedElement":577,"js/Base/Pages":295,"js/Blogs/CircleSidebar":308}],410:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var FamousBlogsTopPage = {

    init: function init() {
        $(document).on('click', '.js-read-old-entries', function () {
            var $button = $(this);
            $button.closest('.js-category-container').find('.js-old-entry').show();
            $button.remove();
        });
    }

};

module.exports = FamousBlogsTopPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],411:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var inheritVia = require('js/Base/inheritVia');
var Location = require('js/Base/Location');

var GlobalTopPage = {

    init: function init() {
        $('img[data-alternate-src]').one('error', function () {
            var $img = $(this);
            $img.attr('src', $img.attr('data-alternate-src'));
        });

        $('.js-category-wrapper').tabs({
            selected: 0
        });

        // UInav-bar
        $('.js-category-wrapper .ui-tabs-nav').removeClass('ui-tabs-nav');

        // globaljsvia
        var via = Location.param('via');
        if (via) {
            inheritVia(via);
        }
    }

};

module.exports = GlobalTopPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Location":292,"js/Base/inheritVia":303}],412:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var initScrollFollowedElement = require('js/Util/initScrollFollowedElement');

var GroupCategoryPage = {

    init: function init() {
        initScrollFollowedElement($('.js-followed-ad-container'), true);
    }

};

module.exports = GroupCategoryPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/initScrollFollowedElement":577}],413:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');

var GuideProModalAdPage = {

    init: function init() {
        Messenger.listenToParent();

        $('.close-window').on('click', function (e) {
            Messenger.send('close', { name: window.name });
            return false;
        });
    }

};

module.exports = GuideProModalAdPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562}],414:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');

var HatenaBookmarkCommentPage = {

    init: function init() {
        var messenger = Messenger.createForParent(),
            OFFSET = 30,
            // iframebody, 
        current_height = 0;

        var sendResize = function sendResize() {
            var next_height = $('body').height() + OFFSET;
            if (next_height !== current_height) {
                messenger.send('resize', next_height);
                current_height = next_height;
            }
        };

        // 
        $(document).on('click', '.hatena-bookmark-span-button', function () {
            sendResize();
        });

        setInterval(function () {
            sendResize();
        }, 1000);
    }

};

module.exports = HatenaBookmarkCommentPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562}],415:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Location = require('js/Base/Location');
var Pages = require('js/Base/Pages');
var BUG = require('js/Base/Logger').BUG;

var EntriesManager = require('../../Blogs/EntriesManager');

var IndexPage = {

    init: function init() {
        Location.setup();

        // URL #edit 
        $(window).hashchange(function () {
            if (location.hash !== '#edit') {
                return;
            }

            Pages.infoLoaded.then(function (info) {
                if (info.editable) {
                    EntriesManager.newEntry();
                }
            })['catch'](function (e) {
                return BUG(e);
            });
        }).hashchange();
    }

};

module.exports = IndexPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../Blogs/EntriesManager":309,"js/Base/Location":292,"js/Base/Logger":293,"js/Base/Pages":295}],416:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var PreviewDraftPage = {

    init: function init() {
        $(function () {
            // 
            var $box = $('.js-preview-draft-modal');
            var $closeButton = $box.find('.js-preview-draft-modal-btn');

            $closeButton.focus().on('click', function () {
                $box.addClass('is-hidden');
            });
        });
    }

};

module.exports = PreviewDraftPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],417:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var PreviewPage = {

    init: function init() {
        try {
            if (!window.sessionStorage) return;
            var editor_id = $('#content').attr('data-editor-id');
            if (!editor_id) return;
            var $document = $(document);

            var pos = sessionStorage.previewed_scroll_position ? JSON.parse(sessionStorage.previewed_scroll_position) : null;
            if (pos && pos.editor_id == editor_id) {
                $document.scrollTop(pos.top);
                $document.scrollLeft(pos.left);
            }

            $document.scroll(_.throttle(function () {
                sessionStorage.previewed_scroll_position = JSON.stringify({
                    editor_id: editor_id,
                    top: $document.scrollTop(),
                    left: $document.scrollLeft()
                });
            }, 100));
        } catch (_ignored) {}
    }

};

module.exports = PreviewPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],418:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');

var PreviewUrlEmbedPage = {

    init: function init() {
        var messenger = Messenger.createForParent();

        // 1sendnull
        // IE0
        // 0iframe
        var current_height = null;

        var sendResize = function sendResize() {
            var next_height = $('html').height();
            if (next_height !== current_height) {
                messenger.send('resize', next_height);
                current_height = next_height;
            }
        };

        // iframe
        var embed_success = !!$('.js-embed-preview')[0];

        if (embed_success) {
            sendResize();
            setInterval(function () {
                sendResize();
            }, 1000);
        } else {
            // 
            messenger.send('close');
        }
    }

};

module.exports = PreviewUrlEmbedPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562}],419:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var RealtimePreviewPage = {

    init: function init() {
        try {
            if (!window.sessionStorage) {
                return;
            }

            var editor_id = $('#realtime-preview-content').attr('data-editor-id');
            if (!editor_id) {
                return;
            }

            var $wrapper = $('#realtime-preview-wrapper');

            var pos = sessionStorage.realtime_previewed_scroll_position ? JSON.parse(sessionStorage.realtime_previewed_scroll_position) : null;
            if (pos && pos.editor_id == editor_id) {
                $wrapper.scrollTop(pos.top);
                $wrapper.scrollLeft(pos.left);
            }

            $wrapper.scroll(_.throttle(function () {
                sessionStorage.realtime_previewed_scroll_position = JSON.stringify({
                    editor_id: editor_id,
                    top: $wrapper.scrollTop(),
                    left: $wrapper.scrollLeft()
                });
            }, 100));
        } catch (_ignored) {}
    }

};

module.exports = RealtimePreviewPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],420:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var initScrollFollowedElement = require('js/Util/initScrollFollowedElement');

var RecentGroupsPage = {

    init: function init() {
        initScrollFollowedElement($('.js-followed-ad-container'), true);
    }

};

module.exports = RecentGroupsPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Util/initScrollFollowedElement":577}],421:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');
var Star = require('js/Star');
var AccessLogger = require('js/Base/AccessLogger');
var Browser = require('js/Base/Browser');
var Location = require('js/Base/Location');
var Pages = require('js/Base/Pages');
var globalData = require('js/Base/globalData');
var updateDynamicPieces = require('js/Util/updateDynamicPieces');
var BlogsModule = require('js/Blogs/Module');
var SubscribeButtonSynchronizer = require('js/Blogs/SubscribeButtonSynchronizer');
var trackBlogVisit = require('js/Blogs/trackBlogVisit');
var QuoteTouch = require('js/Quote/Touch');

/**
 * TouchBlogs
 */
var BlogsTouchDomain = {

    init: function init() {
        // iframeapi
        if (window.parent === window) {
            AccessLogger.ping();
            trackBlogVisit();
        }

        Pages.infoLoaded.then(function (info) {
            BlogsTouchDomain.loadInfo(info);

            // entry
            if (globalData('page') === 'entry' && info.quote) {
                QuoteTouch.init(info.quote);
            }
        });

        updateDynamicPieces([document]);

        BlogsTouchDomain.initFooterAction();
        BlogsTouchDomain.setupOndemandCommentDeleteButton();
        Star.initBigStar();

        BlogsModule.init();
    },

    // 
    loadInfo: function loadInfo(info) {
        Browser.thirdPartyCookiesBlocked.resolve(!info.cookie_received);

        // globalhaedervia
        var via = Location.param('via');
        if (via) {
            Messenger.send('inheritVia', via);
        }

        // 
        SubscribeButtonSynchronizer.init(info.subscribe, info.subscribes);
    },

    setupOndemandCommentDeleteButton: function setupOndemandCommentDeleteButton() {
        $(document).on('mouseenter', '.js-entry-comment', function (e) {
            var $comment = $(e.currentTarget);

            if ($comment.find('.js-comment-delete-button .js-comment-delete-image').size() > 0) {
                return;
            }

            var adminDomain = globalData('admin-domain');
            var param = $.param({
                comment: $comment.attr('data-comment-uuid'),
                blog: $comment.attr('data-blog-uuid')
            });
            var url = adminDomain + '/api/comment.delete.image?' + param;

            var $img = $('<img>');
            $img.addClass('js-comment-delete-image');
            $img.attr('src', url);

            var handler = function handler() {
                return $img.attr('alt', 'delete');
            };
            $img.load(handler);
            $img.error(handler);

            $comment.find('.js-comment-delete-button').append($img);
        });
    },

    initFooterAction: function initFooterAction() {
        var footerAction = $('iframe.js-footer-action');

        if (footerAction.length) {
            try {
                var messenger = Messenger.createForFrame(footerAction.get(0), footerAction.attr('data-src'));
                messenger.addEventListener('resize', function (css) {
                    if (css) {
                        footerAction.css(css);
                    }
                });
            } catch (ignore) {
                // AndroidMessengerSecurityError
                // 
            }
        }
    }

};

module.exports = BlogsTouchDomain;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/AccessLogger":277,"js/Base/Browser":278,"js/Base/Location":292,"js/Base/Pages":295,"js/Base/globalData":302,"js/Blogs/Module":317,"js/Blogs/SubscribeButtonSynchronizer":320,"js/Blogs/trackBlogVisit":322,"js/Messenger":562,"js/Quote/Touch":564,"js/Star":566,"js/Util/updateDynamicPieces":591}],422:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Entry = require('js/BlogsTouch/Entry');

var EntryPage = {

    init: function init() {
        var entries = $('.js-entry-article').toArray().map(function (entry) {
            return new Entry($(entry));
        });
    }

};

module.exports = EntryPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/BlogsTouch/Entry":326}],423:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Location = require('js/Base/Location');
var decodeParam = require('js/Util/decodeParam');

var GlobalTopPage = {

    init: function init() {
        // viaiframe
        var via = Location.param('via');
        var $dashboardLinks = $('iframe.js-dashboard-link');
        $dashboardLinks.each(function (index, element) {
            var $iframe = $(element);
            var src = $iframe.data('src').split(/\?/);
            var query = src[1] || '';

            var params = decodeParam(query);
            params['via'] = via;

            element.contentWindow.location.replace(src[0] + '?' + $.param(params, true));
        });

        $('img[data-alternate-src]').one('error', function () {
            var $img = $(this);
            $img.attr('src', $img.attr('data-alternate-src'));
        });

        $('.js-category-wrapper').tabs({
            selected: 0
        });

        // UInav-bar
        $('.js-category-wrapper .ui-tabs-nav').removeClass('ui-tabs-nav');
    }

};

module.exports = GlobalTopPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Location":292,"js/Util/decodeParam":573}],424:[function(require,module,exports){
'use strict';

var Admin = {
    '__domain__': require('./Admin/__domain__'),

    'globalheader': require('./Admin/globalheader'),

    'circle': require('./Admin/circle'),
    'circle-create': require('./Admin/Circle/create'),
    'circle-membership': require('./Admin/Circle/membership'),
    'circle-membership-done': require('./Admin/Circle/membership-done'),

    'odai-new': require('./Admin/Odai/edit'),
    'odai-odai_id-edit': require('./Admin/Odai/edit'),

    'plus-quit': require('./Admin/Plus/quit'),
    'topic-show': require('./Admin/Topic/show'),
    'antenna': require('./Admin/antenna'),
    'config': require('./Admin/config'),
    'index': require('./Admin/index'),
    'locale': require('./Admin/locale'),
    'refusal': require('./Admin/refusal'),

    'feedback-iframe': require('./Admin/feedback-iframe'),

    'register': require('./Admin/register'),
    'register-iframe': require('./Admin/register-iframe'),

    'store-theme-new': require('./Admin/store-theme-new'),
    'store-theme-theme_id': require('./Admin/store-theme-theme_id'),

    'menu-mymenu': require('./Admin/Menu/mymenu'),
    'menu-myblogmenu': require('./Admin/Menu/myblogmenu'),
    'menu-blogmenu': require('./Admin/Menu/blogmenu'),
    'menu-services': require('./Admin/Menu/services'),
    'menu-blogmenu_admin': require('./Admin/menu-blogmenu_admin.js'),

    'curation-amazon': require('./Admin/Curation/amazon'),
    'curation-flickr': require('./Admin/Curation/flickr'),
    'curation-gourmet': require('./Admin/Curation/gourmet'),
    'curation-instagram': require('./Admin/Curation/instagram'),
    'curation-itunes': require('./Admin/Curation/itunes'),
    'curation-promotion': require('./Admin/Curation/promotion'),
    'curation-twitter': require('./Admin/Curation/twitter'),

    'user-blog-breadcrumb': require('./Admin/User/Blog/breadcrumb'),

    // TODO: 
    //       entries
    'user-blog-entries': require('./Admin/User/Blog/entries'),
    'user-blog-drafts': require('./Admin/User/Blog/entries'),

    'user-blog-comment': require('./Admin/User/Blog/comment'),
    'user-blog-comments': require('./Admin/User/Blog/comments'),
    'user-blog-comment-done': require('./Admin/User/Blog/Comment/done'),
    'user-blog-comment-delete': require('./Admin/User/Blog/Comment/delete'),
    'user-blog-comment-delete-deleted': require('./Admin/User/Blog/Comment/delete-deleted'),

    'user-blog-config-theme-theme_id-preview': require('./Admin/User/Blog/Config/theme-theme_id-preview'),
    'user-blog-config-detail': require('./Admin/User/Blog/Config/detail'),
    'user-blog-config-external': require('./Admin/User/Blog/Config/external'),
    'user-blog-config-permission': require('./Admin/User/Blog/Config/permission'),
    'user-blog-config-design-detail': require('./Admin/User/Blog/Config/design-detail'),

    'special-challenge-series-series_name': require('./Admin/Special/Challenge/'),

    'user-blog-accesslog': require('./Admin/User/Blog/accesslog'),
    'user-blog-categories': require('./Admin/User/Blog/categories'),
    'user-blog-export-movable_type': require('./Admin/User/Blog/export-movable_type'),
    'user-blog-friend': require('./Admin/User/Blog/friend'),
    'user-blog-group-official-dialog': require('./Admin/User/Blog/group-official-dialog'),
    'user-blog-members': require('./Admin/User/Blog/members'),

    'user-blog-subscribe': require('./Admin/User/Blog/subscribe'),
    'user-blog-subscribe-done': require('./Admin/User/Blog/Subscribe/done'),
    'user-blog-subscribe-iframe': require('./Admin/User/Blog/Subscribe/iframe'),

    'user-blog-subscribers': require('./Admin/User/Blog/subscribers'),

    'user-blog-import': require('./Admin/User/Blog/import'),
    'user-blog-import-hatena_diary': require('./Admin/User/Blog/Import/hatena_diary'),
    'user-blog-import-hatena_diary-diary-diary_name': require('./Admin/User/Blog/Import/hatena_diary-diary-diary_name'),

    'user-blog-edit': require('./Admin/User/Blog/edit'),
    'user-blog-edit-done': require('./Admin/User/Blog/Edit/done')
};

var Blogs = {
    '__domain__': require('./Blogs/__domain__'),

    'blog-count-limit-exceeded': require('./Blogs/blog-count-limit-exceeded'),
    'famous-blogs-top': require('./Blogs/famous-blogs-top'),
    'global-top': require('./Blogs/global-top'),
    'guide-pro-modal-ad': require('./Blogs/guide-pro-modal-ad'),
    'index': require('./Blogs/index'),
    'realtime_preview': require('./Blogs/realtime-preview'),

    'circle': require('./Blogs/circle'),
    'circle-blogs': require('./Blogs/Circle/blogs'),

    'group-category': require('./Blogs/group-category'),
    'recent-groups': require('./Blogs/recent-groups'),

    'preview': require('./Blogs/preview'),
    'preview-draft': require('./Blogs/preview-draft'),
    'hatena-bookmark-comment': require('./Blogs/hatena-bookmark-comment'),
    'preview_url_embed': require('./Blogs/preview_url_embed')
};

var AdminTouch = {
    '__domain__': require('./AdminTouch/__domain__'),

    'antenna': require('./AdminTouch/antenna'),
    'config': require('./AdminTouch/config'),
    'globalheader': require('./AdminTouch/globalheader'),
    'index': require('./AdminTouch/index'),
    'locale': require('./AdminTouch/locale'),
    'refusal': require('./AdminTouch/refusal'),
    'topic-show': require('./AdminTouch/Topic/show'),

    'promotion-promotion_id': require('./AdminTouch/promotion'),

    'user-blog-accesslog': require('./AdminTouch/User/Blog/accesslog'),
    'user-blog-action': require('./AdminTouch/User/Blog/action'),
    'user-blog-comment': require('./AdminTouch/User/Blog/comment'),
    'user-blog-comment-done': require('./AdminTouch/User/Blog/Comment/done'),
    'user-blog-comments': require('./AdminTouch/User/Blog/comments'),
    'user-blog-entries': require('./AdminTouch/User/Blog/entries'),
    'user-blog-subscribers': require('./AdminTouch/User/Blog/subscribers'),

    'user-blog-config-permission': require('./AdminTouch/User/Blog/Config/permission'),
    'user-blog-config-design-detail': require('./AdminTouch/User/Blog/Config/design-detail'),

    'user-blog-edit': require('./AdminTouch/User/Blog/edit'),
    'user-blog-edit-done': require('./AdminTouch/User/Blog/Edit/done')
};

var BlogsTouch = {
    '__domain__': require('./BlogsTouch/__domain__'),

    'global-top': require('./BlogsTouch/global-top'),
    'entry': require('./BlogsTouch/entry')
};

module.exports = {
    Admin: Admin,
    Blogs: Blogs,
    AdminTouch: AdminTouch,
    BlogsTouch: BlogsTouch
};

},{"./Admin/Circle/create":327,"./Admin/Circle/membership":329,"./Admin/Circle/membership-done":328,"./Admin/Curation/amazon":330,"./Admin/Curation/flickr":331,"./Admin/Curation/gourmet":332,"./Admin/Curation/instagram":333,"./Admin/Curation/itunes":334,"./Admin/Curation/promotion":335,"./Admin/Curation/twitter":336,"./Admin/Menu/blogmenu":337,"./Admin/Menu/myblogmenu":338,"./Admin/Menu/mymenu":339,"./Admin/Menu/services":340,"./Admin/Odai/edit":341,"./Admin/Plus/quit":342,"./Admin/Special/Challenge/":343,"./Admin/Topic/show":344,"./Admin/User/Blog/Comment/delete":346,"./Admin/User/Blog/Comment/delete-deleted":345,"./Admin/User/Blog/Comment/done":347,"./Admin/User/Blog/Config/design-detail":348,"./Admin/User/Blog/Config/detail":349,"./Admin/User/Blog/Config/external":350,"./Admin/User/Blog/Config/permission":351,"./Admin/User/Blog/Config/theme-theme_id-preview":352,"./Admin/User/Blog/Edit/done":353,"./Admin/User/Blog/Import/hatena_diary":355,"./Admin/User/Blog/Import/hatena_diary-diary-diary_name":354,"./Admin/User/Blog/Subscribe/done":356,"./Admin/User/Blog/Subscribe/iframe":357,"./Admin/User/Blog/accesslog":358,"./Admin/User/Blog/breadcrumb":359,"./Admin/User/Blog/categories":360,"./Admin/User/Blog/comment":361,"./Admin/User/Blog/comments":362,"./Admin/User/Blog/edit":363,"./Admin/User/Blog/entries":364,"./Admin/User/Blog/export-movable_type":365,"./Admin/User/Blog/friend":366,"./Admin/User/Blog/group-official-dialog":367,"./Admin/User/Blog/import":368,"./Admin/User/Blog/members":369,"./Admin/User/Blog/subscribe":370,"./Admin/User/Blog/subscribers":371,"./Admin/__domain__":372,"./Admin/antenna":373,"./Admin/circle":374,"./Admin/config":375,"./Admin/feedback-iframe":376,"./Admin/globalheader":377,"./Admin/index":378,"./Admin/locale":379,"./Admin/menu-blogmenu_admin.js":380,"./Admin/refusal":381,"./Admin/register":383,"./Admin/register-iframe":382,"./Admin/store-theme-new":384,"./Admin/store-theme-theme_id":385,"./AdminTouch/Topic/show":386,"./AdminTouch/User/Blog/Comment/done":387,"./AdminTouch/User/Blog/Config/design-detail":388,"./AdminTouch/User/Blog/Config/permission":389,"./AdminTouch/User/Blog/Edit/done":390,"./AdminTouch/User/Blog/accesslog":391,"./AdminTouch/User/Blog/action":392,"./AdminTouch/User/Blog/comment":393,"./AdminTouch/User/Blog/comments":394,"./AdminTouch/User/Blog/edit":395,"./AdminTouch/User/Blog/entries":396,"./AdminTouch/User/Blog/subscribers":397,"./AdminTouch/__domain__":398,"./AdminTouch/antenna":399,"./AdminTouch/config":400,"./AdminTouch/globalheader":401,"./AdminTouch/index":402,"./AdminTouch/locale":403,"./AdminTouch/promotion":404,"./AdminTouch/refusal":405,"./Blogs/Circle/blogs":406,"./Blogs/__domain__":407,"./Blogs/blog-count-limit-exceeded":408,"./Blogs/circle":409,"./Blogs/famous-blogs-top":410,"./Blogs/global-top":411,"./Blogs/group-category":412,"./Blogs/guide-pro-modal-ad":413,"./Blogs/hatena-bookmark-comment":414,"./Blogs/index":415,"./Blogs/preview":417,"./Blogs/preview-draft":416,"./Blogs/preview_url_embed":418,"./Blogs/realtime-preview":419,"./Blogs/recent-groups":420,"./BlogsTouch/__domain__":421,"./BlogsTouch/entry":422,"./BlogsTouch/global-top":423}],425:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var Browser = require('js/Base/Browser');

module.exports = {

    defaultParagraph: function defaultParagraph() {
        this.formatBlock('p');
    },

    largeHeading: function largeHeading() {
        this.formatBlock('h3');
    },

    middleHeading: function middleHeading() {
        this.formatBlock('h4');
    },

    smallHeading: function smallHeading() {
        this.formatBlock('h5');
    },

    bold: function bold() {
        // http://www.tinymce.com/wiki.php/Command_identifiers
        this.execCommand('Bold');
    },

    italic: function italic() {
        this.execCommand('Italic');
    },

    strike: function strike() {
        this.execCommand('StrikeThrough');
    },

    underline: function underline() {
        this.execCommand('Underline');
    },

    removeFormat: function removeFormat() {
        this.execCommand("removeFormat");
        this.execCommand("unlink");
    },

    veryLargeFontSize: function veryLargeFontSize() {
        this.execCommand('FontSize', '200%');
    },

    largeFontSize: function largeFontSize() {
        this.execCommand('FontSize', '150%');
    },

    defaultFontSize: function defaultFontSize() {
        this.execCommand("RemoveFormat", 'FontSize');
    },

    smallFontSize: function smallFontSize() {
        this.execCommand('FontSize', '80%');
    },

    unorderedList: function unorderedList() {
        this.execCommand("InsertUnorderedList");
    },

    orderedList: function orderedList() {
        this.execCommand("InsertOrderedList");
    },

    color: function color() {}, // noop

    pickColor: function pickColor(color) {
        var self = this;

        var rng = this.tinymce.selection.getRng();
        var mark;
        if (Browser.isIE) {
            this.tinymce.focus();
            mark = this.tinymce.selection.getBookmark(1);
            self.tinymce.selection.setRng(rng);
        }

        if (color) {
            self.execCommand("ForeColor", color);
        } else {
            // tinyMCE
            try {
                self.execCommand("RemoveFormat");
            } catch (e) {}
        }

        if (mark) {
            self.tinymce.selection.moveToBookmark(mark);
        }
    },

    link: function link() {
        $(document).trigger('show-embed-box');
    },

    insertSeeMore: function insertSeeMore() {
        this.insertLines(["<!-- more -->", ""]);
    },

    blockquote: function blockquote() {
        if (Browser.isIE) {
            this.tinymce.focus();
        }

        var current_node = this.tinymce.selection.getNode();
        var $current_node = $(current_node);
        var selection_is_in_blockquote = $current_node.closest('blockquote').length !== 0;
        var current_node_is_last_node = $current_node.next().length === 0;
        var current_node_is_empty = $current_node.text().length === 0;

        // [IE] body, blockquote
        // , formatBlock
        if (Browser.isIE && current_node.tagName.toLowerCase() === 'body') {
            if (this.tinymce.selection.isCollapsed()) {
                this.insertBlockQuoteWithNewLine();
            } else {
                this.formatBlockQuote();
            }
            return;
        }

        if (!current_node_is_last_node || selection_is_in_blockquote) {
            this.formatBlockQuote();
            return;
        }

        // formatBlock, blockquoteblockquote
        if (!this.tinymce.selection.isCollapsed() || current_node_is_empty) {
            this.insertBlockQuoteWithNewLine();
        } else {
            this.moveCaretToNodeEnd(current_node);

            this.insert('<p>&nbsp;</p>');

            var prev_node = $(this.tinymce.selection.getNode()).prev()[0];
            this.tinymce.selection.select(prev_node);

            this.formatBlockQuote();
        }
    },

    footnote: function footnote() {
        var selection_text = this.tinymce.selection.getContent();
        if (selection_text.length) {
            this.replace('((' + selection_text + '))');
        } else {
            this.insert('((');
            var mark = this.tinymce.selection.getBookmark();
            this.insert('))');
            this.tinymce.selection.moveToBookmark(mark);

            this.insertAndSelectText(Locale.text('edit_form.footnote_message'));
        }
    }

};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Browser":278,"js/Locale":561}],426:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');

module.exports = {

    defaultParagraph: function defaultParagraph() {
        this.headingAction('');
    },

    largeHeading: function largeHeading() {
        this.headingAction('* ');
    },

    middleHeading: function middleHeading() {
        this.headingAction('** ');
    },

    smallHeading: function smallHeading() {
        this.headingAction('*** ');
    },

    italic: function italic() {
        this.wrapString('<i>', '</i>');
    },

    bold: function bold() {
        this.wrapString('<b>', '</b>');
    },

    underline: function underline() {
        this.wrapString('<u>', '</u>');
    },

    strike: function strike() {
        this.wrapString('<s>', '</s>');
    },

    veryLargeFontSize: function veryLargeFontSize() {
        this.toggleFontSize(200);
    },

    largeFontSize: function largeFontSize() {
        this.toggleFontSize(150);
    },

    defaultFontSize: function defaultFontSize() {
        this.removeFontSize();
    },

    smallFontSize: function smallFontSize() {
        this.toggleFontSize(80);
    },

    unorderedList: function unorderedList() {
        var text = this.getSelectionText();
        var range = this.replace("\n- " + text);
        range.start = range.end;
        this.setSelectionRange(range);
    },

    orderedList: function orderedList() {
        var text = this.getSelectionText();
        var range = this.replace("\n+ " + text);
        range.start = range.end;
        this.setSelectionRange(range);
    },

    color: function color() {}, // noop

    /**
     * 
     * @param {string} color - '#xxxxxx' 
     */
    pickColor: function pickColor(color) {
        var self = this;
        var range = self.getSelectionRange();
        var text = self.getSelectionText(range);

        if (/(<span style="color: [^;]+?">)/.test(text)) {
            if (color) {
                text = text.replace(RegExp.$1, '<span style="color: ' + color + '">');
            } else {
                text = text.replace(RegExp.$1, '').replace(/<\/span>/, '');
            }
            range = self.replace(text, range);
        } else {
            if (color) {
                range = self.replace('<span style="color: ' + color + '">' + text + '</span>', range);
            }
        }
        self.setSelectionRange(range);
    },

    link: function link() {
        $(document).trigger('show-embed-box');
    },

    insertSeeMore: function insertSeeMore() {
        this.insertLines(['====', '']);
    },

    blockquote: function blockquote() {
        this.wrapStringAround('>>\n', '\n<<');
    },

    footnote: function footnote() {
        this.wrapStringAroundLabel('((', Locale.text('edit_form.footnote_message'), '))');
    }

};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],427:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var HatenaEditorActions = require('./HatenaEditor');

// 
module.exports = Object.assign({}, HatenaEditorActions, {

    largeHeading: function largeHeading() {
        this.headingAction('### ');
    },

    middleHeading: function middleHeading() {
        this.headingAction('#### ');
    },

    smallHeading: function smallHeading() {
        this.headingAction('##### ');
    },

    unorderedList: function unorderedList() {
        var text = this.getSelectionText();
        var range = this.replace("\n* " + text);
        range.start = range.end;
        this.setSelectionRange(range);
    },

    orderedList: function orderedList() {
        var text = this.getSelectionText();
        var range = this.replace("\n1. " + text);
        range.start = range.end;
        this.setSelectionRange(range);
    },

    color: function color() {}, // noop

    /**
     * 
     * @param {string} color - '#xxxxxx' 
     */
    pickColor: function pickColor(color) {
        var self = this;

        var range = self.getSelectionRange();
        var text = self.getSelectionText(range);

        if (/(<span style="color: [^;]+?">)/.test(text)) {
            if (color) {
                text = text.replace(RegExp.$1, '<span style="color: ' + color + '">');
            } else {
                text = text.replace(RegExp.$1, '').replace(/<\/span>/, '');
            }
            range = self.replace(text, range);
        } else {
            if (color) {
                range = self.replace('<span style="color: ' + color + '">' + text + '</span>', range);
            }
        }
        self.setSelectionRange(range);
    },

    link: function link() {
        $(document).trigger('show-embed-box');
    },

    insertSeeMore: function insertSeeMore() {
        this.insertLines(['<!-- more -->', '']);
    },

    blockquote: function blockquote() {
        var selection_text = this.getSelectionText();

        if (selection_text.length === 0) {
            this.insert('\n> ');
            return;
        }

        var range;

        // , 
        if (/^(> .*\r?\n)+(> .*)?$/.test(selection_text)) {
            var unquoted_text = selection_text.replace(/^> (.*)/mg, "$1");
            range = this.replace(unquoted_text);
        } else {
            // , "> " 
            var quoted_text = selection_text.replace(/\r?\n$/g, '').replace(/^(.*)/mg, "> $1");
            range = this.replace(quoted_text);
        }

        this.setSelectionRange(range);
    }

});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./HatenaEditor":426}],428:[function(require,module,exports){
module.exports = {
    html: require('./HTMLEditor'),
    hatena: require('./HatenaEditor'),
    markdown: require('./MarkdownEditor')
};

},{"./HTMLEditor":425,"./HatenaEditor":426,"./MarkdownEditor":427}],429:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var EventEmitter = require('events').EventEmitter;

var ColorPicker = (function (_EventEmitter) {
    _inherits(ColorPicker, _EventEmitter);

    /**
     * @param {jQuery} $container
     */

    function ColorPicker($container) {
        var _this = this;

        _classCallCheck(this, ColorPicker);

        _get(Object.getPrototypeOf(ColorPicker.prototype), 'constructor', this).call(this);

        this.$container = $container;

        this.$container.on('click', '.js-color-chip', function (e) {
            var color = $(e.currentTarget).attr('data-color');
            _this.emit('colorpick', color);
        });

        this.$container.on('click', '.js-color-picker-cancel', function () {
            _this.emit('colorpick');
        });

        this.$container.appendTo(document.body);
    }

    /**
     * 
     * @param {Object} position
     */

    _createClass(ColorPicker, [{
        key: 'setPosition',
        value: function setPosition(position) {
            this.$container.css(position);
        }
    }]);

    return ColorPicker;
})(EventEmitter);

module.exports = ColorPicker;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"events":207}],430:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var keyString = require('js/keyString');
var trackEvent = require('js/Base/EventTracker').trackEvent;
var backupTab = require('js/Util/backupTab');
var extractSyntax = require('js/Base/extractSyntax');
var EditorConnector = require('js/Base/EditorConnector');
var Logger = require('js/Base/Logger');

/**
 * : Amazon
 */
var AmazonSearch = function AmazonSearch() {
    this.init.apply(this, arguments);
};
AmazonSearch.prototype = {
    init: function init(args) {
        var self = this;
        this.type = 'editor-amazon-search';

        self.$container = args.container;
        if (!self.$container.get(0)) return;
        self.$categorySelect = self.$container.find('.amazon-search-category');
        self.$keywordInput = self.$container.find('.amazon-search-keyword');
        self.$keywordSubmit = self.$container.find('.amazon-search-keyword-submit');
        self.$itemsContainer = self.$container.find('.amazon-search-items');
        self.itemTemplate = _.template($('.amazon-search-item-template').html());
        self.$indicator = self.$container.find('.indicator');
        self.$pasteButton = self.$container.find('.amazon-search-paste-button');
        self.$layoutType = self.$container.find('.amazon-search-layout-type');
        self.$layoutTypeContainer = self.$container.find('.amazon-search-layout-type-container');
        self.$resultIsEmpty = self.$container.find('.amazon-search-result-is-empty');
        self.$formats = self.$container.find('.amazon-search-formats input[name="amazon-search-format"]');
        self.$formatsContainer = self.$container.find('.amazon-search-formats');
        self.$welcomeMessage = self.$container.find('.amazon-search-welcome');

        self.$header = self.$container.find('.amazon-search-header');
        self.$footer = self.$container.find('.amazon-search-footer');

        this.sidebar = args.sidebar;

        self.bindEvents();
        self.resize();

        // 
        if (self.$keywordInput.val()) {
            self.$keywordSubmit.click();
        }
    },
    bindEvents: function bindEvents() {
        var _this = this;

        var self = this;

        self.$keywordSubmit.click(function (event) {
            self.searchByInput();
            return false;
        });

        self.$categorySelect.change(function (event) {
            self.searchByInput();
            return false;
        });

        self.$keywordInput.keydown(function (event) {
            if (keyString(event) == 'RET') {
                self.searchByInput();
                return false;
            }
        });

        self.$keywordInput.focus(function () {
            // 
            // 
            // 1
            setTimeout(function () {
                self.resize();
            }, 0);
        });

        self.$itemsContainer.delegate('.amazon-search-item', 'click', function (event) {
            if ($(event.target).is('a')) return;
            $(this).toggleClass('selected');

            self.selectedItemsChanged();
        });

        self.$container.delegate('.amazon-search-item', 'dblclick', function (event) {
            if ($(event.target).is('a')) return;
            self.insertAsins([$(this).attr('data-asin')]);
            $(this).removeClass('selected');
            self.selectedItemsChanged();
            trackEvent(self.$pasteButton.attr('data-track-name'));
            return false;
        });

        self.$pasteButton.click(function (event) {
            var asins = [];
            self.$itemsContainer.find('.selected').each(function () {
                asins.push($(this).attr('data-asin'));
                $(this).removeClass('selected');
            });
            self.insertAsins(asins);
            self.selectedItemsChanged();
        });

        backupTab({
            $container: self.$formatsContainer,
            key: 'amazon-formats',
            onchange: function onchange($input) {
                self.$formatsContainer.find('label.selected').removeClass('selected');
                $input.closest('label').addClass('selected');
            }
        });

        backupTab({
            $container: self.$layoutTypeContainer,
            key: 'amazon-layout',
            onchange: function onchange($input) {
                self.$itemsContainer.removeClass('layout-thumbnail');
                self.$itemsContainer.removeClass('layout-list');

                var layout = $input.val();
                self.$itemsContainer.addClass('layout-' + layout);

                // label class
                self.$layoutTypeContainer.find('label.selected').removeClass('selected');
                $input.closest('label').addClass('selected');

                // tipsy
                self.setTipsyEnabled(layout == 'thumbnail');
            }
        });

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);
    },
    setTipsyEnabled: function setTipsyEnabled(enable) {
        var self = this;

        // tipsy-southwest

        var $items = self.$itemsContainer.find('.amazon-search-item');
        var className = 'tipsy-southeast';

        if (enable) {
            $items.addClass(className);
        } else {
            $items.removeClass(className);
        }
    },
    resize: function resize() {
        var mainHeight = $(window).height();

        var padding = 0;
        padding += parseInt(this.$itemsContainer.css('padding-top'), 10) || 0;
        padding += parseInt(this.$itemsContainer.css('padding-bottom'), 10) || 0;
        this.$itemsContainer.height(mainHeight - this.$container.offset().top - this.$header.outerHeight(true) - this.$footer.outerHeight(true) - padding);
    },
    selectedItemsChanged: function selectedItemsChanged() {
        var self = this;

        if (self.$itemsContainer.find('.selected').length > 0) {
            self.$pasteButton.removeClass('disabled').addClass('enabled').prop('disabled', false);
        } else {
            self.$pasteButton.removeClass('enabled').addClass('disabled').prop('disabled', true);
        }
    },
    searchByInput: function searchByInput() {
        var self = this;

        self.search(self.$keywordInput.val(), self.$categorySelect.find('option:selected').val());
    },
    search: function search(keyword, category) {
        var self = this;

        if (typeof keyword != 'string') return false;

        keyword = keyword.replace(/^\s*/, '');
        keyword = keyword.replace(/\s*$/, '');

        if (keyword.length === 0) return false;

        if (self._searchingKeyword == keyword && self._searchingCategory == category) return false;

        // 

        self.$welcomeMessage.addClass('disable');

        if (self._searchDeferred) {
            self._searchDeferred.reject();
        }

        self.ajaxStarted();

        self._searchingKeyword = keyword;
        self._searchingCategory = category;

        var currentAjax;
        var dfd = $.Deferred().done(function () {}).fail(function () {
            if (currentAjax) {
                // ajax
                currentAjax.abort();
            }
        }).always(function () {
            self.ajaxFinished();
        });

        self.$itemsContainer.find('.amazon-search-item').remove();

        var searchPage = function searchPage(page) {
            self.ajaxStarted();

            currentAjax = $.ajax({
                url: '/api/amazon',
                data: {
                    keyword: keyword,
                    category: category,
                    page: page
                }
            }).done(function (res) {
                self.showItems(res.items);

                if (res.page === 1 && res.items.length === 0) {
                    self.$resultIsEmpty.show();
                } else {
                    self.$resultIsEmpty.hide();
                }

                if (!res.has_next) {
                    dfd.resolve();
                    return;
                }

                if (res.page >= 5) {
                    dfd.resolve();
                    return;
                } else {
                    searchPage(res.page + 1);
                }
            }).fail(function (res) {
                dfd.reject(res);
            });
        };
        searchPage(1);

        self._searchDeferred = dfd;
    },
    showItems: function showItems(items) {
        var self = this;

        var source = '';
        _.each(items, function (item) {
            source += self.itemTemplate({
                item: item
            });
        });
        self.$indicator.before(source);

        self.setTipsyEnabled(self.$itemsContainer.hasClass('layout-thumbnail'));
    },
    insertAsins: function insertAsins(asins) {
        var self = this;

        var suffix = self.$container.find('[name="amazon-search-format"]:checked').val();

        var hatena_syntaxes = _.map(asins, function (asin) {
            return '[asin:' + asin + (suffix.length > 0 ? ':' + suffix : '') + ']';
        });

        var lines = {
            html: hatena_syntaxes,
            hatena: hatena_syntaxes,
            markdown: hatena_syntaxes
        };

        extractSyntax(hatena_syntaxes).done(function (data) {
            if (suffix === 'detail') {
                lines.html = ['', '<div class="freezed">' + data.html + '</div>', ''];
            } else {
                lines.html = [data.html];
            }
            EditorConnector.insertLines(lines);
        }).fail(function (error) {
            Logger.BUG(error);
            EditorConnector.insertLines(lines);
        });
    },
    ajaxStarted: function ajaxStarted() {
        var self = this;

        self.isAjaxing = true;

        self.$keywordSubmit.prop('disabled', true);
        self.$indicator.show();
        self.$resultIsEmpty.hide();
    },
    ajaxFinished: function ajaxFinished() {
        var self = this;

        self.isAjaxing = false;

        self.$keywordSubmit.prop('disabled', false);
        self.$indicator.hide();
    }
};

module.exports = AmazonSearch;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EditorConnector":283,"js/Base/EventTracker":284,"js/Base/Logger":293,"js/Base/extractSyntax":301,"js/Util/backupTab":571,"js/keyString":599,"underscore":213}],431:[function(require,module,exports){
'use strict';

var actions = {
    LOAD: 'ARCHIVES:LOAD',
    LOAD_MORE: 'ARCHIVES:LOAD_MORE',
    TOGGLE_SELECTION: 'ARCHIVES:TOGGLE_SELECTION',
    INSERT_SELECTED: 'ARCHIVES:INSERT_SELECTED',
    INSERT_DOUBLE_CLICKED: 'ARCHIVES:INSERT_DOUBLE_CLICKED',

    UPDATE_TERM: 'ARCHIVES:UPDATE_TERM',
    START_LOADING: 'ARCHIVES:START_LOADING',
    FINISH_LOADING: 'ARCHIVES:FINISH_LOADING'
};

module.exports = {
    actions: actions
};

},{}],432:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var actions = require('../Constants').actions;
var Dispatcher = require('js/Base/Dispatcher');
var FetchEntries = require('../external_apis/FetchEntries');

var ArchiveActions = (function (_Dispatcher$Actions) {
    _inherits(ArchiveActions, _Dispatcher$Actions);

    function ArchiveActions() {
        _classCallCheck(this, ArchiveActions);

        _get(Object.getPrototypeOf(ArchiveActions.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(ArchiveActions, [{
        key: 'load',
        value: function load(archive) {
            var _this = this;

            if (archive.isLoading) {
                return;
            }
            var term = archive.term;

            this.emit(actions.UPDATE_TERM, term);
            this.emit(actions.START_LOADING);

            FetchEntries(term).then(function (res) {
                _this.emit(actions.LOAD, res);
                _this.emit(actions.FINISH_LOADING, res);
            })['catch'](function () {
                var res = {
                    entries: [],
                    has_more: false
                };
                _this.emit(actions.LOAD, res);
                _this.emit(actions.FINISH_LOADING, res);
            });
        }
    }, {
        key: 'loadMore',
        value: function loadMore(archive) {
            var _this2 = this;

            if (archive.isLoading || !archive.hasMore) {
                return;
            }
            this.emit(actions.START_LOADING);

            FetchEntries(archive.term, archive.until).then(function (res) {
                _this2.emit(actions.LOAD_MORE, res);
                _this2.emit(actions.FINISH_LOADING, res);
            })['catch'](function () {
                var res = {
                    entries: [],
                    has_more: false
                };
                _this2.emit(actions.LOAD_MORE, res);
                _this2.emit(actions.FINISH_LOADING, res);
            });
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection(entryId) {
            this.emit(actions.TOGGLE_SELECTION, entryId);
        }
    }, {
        key: 'insertSelected',
        value: function insertSelected() {
            this.emit(actions.INSERT_SELECTED);
        }
    }, {
        key: 'insertDoubleClicked',
        value: function insertDoubleClicked(entryId) {
            this.emit(actions.INSERT_DOUBLE_CLICKED, entryId);
        }
    }]);

    return ArchiveActions;
})(Dispatcher.Actions);

module.exports = new ArchiveActions();

},{"../Constants":431,"../external_apis/FetchEntries":441,"js/Base/Dispatcher":281}],433:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');
var shallowCompare = React.addons.shallowCompare;

var ArchiveActions = require('../actions/ArchiveActions');
var Thumbnail = require('./Thumbnail');

var Entry = (function (_React$Component) {
  _inherits(Entry, _React$Component);

  function Entry() {
    _classCallCheck(this, Entry);

    _get(Object.getPrototypeOf(Entry.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(Entry, [{
    key: 'shouldComponentUpdate',
    value: function shouldComponentUpdate(nextProps, nextState) {
      return shallowCompare(this, nextProps, nextState);
    }
  }, {
    key: 'render',
    value: function render() {
      var _this = this;

      var entry = this.props.entry;

      var trim = function trim(text, chars) {
        if (text.length <= chars) {
          return text;
        }
        return text.substr(0, chars - 1) + ' ...';
      };

      var datetimeEpoch = +entry.datetime;
      var relativeDatetime = Locale.deltaDatetime(entry.datetime);

      return React.createElement(
        'div',
        { className: 'item ' + (entry.isSelected ? 'selected' : ''),
          'data-permalink': entry.url,
          onClick: function () {
            return _this.onClick();
          },
          onDoubleClick: function () {
            return _this.onDoubleClick();
          } },
        React.createElement(
          'div',
          { className: 'item-inner' },
          React.createElement(
            'table',
            null,
            React.createElement(
              'tbody',
              null,
              React.createElement(
                'tr',
                null,
                React.createElement(
                  'td',
                  { className: 'text' },
                  React.createElement(
                    'span',
                    { className: 'entry-title' },
                    entry.title
                  ),
                  React.createElement(Thumbnail, { thumbnails: entry.thumbnails }),
                  React.createElement(
                    'span',
                    { className: 'entry-body' },
                    trim(entry.summary, 34)
                  ),
                  React.createElement(
                    'time',
                    { className: 'meta', 'data-epoch': datetimeEpoch },
                    relativeDatetime
                  )
                ),
                React.createElement(
                  'td',
                  { className: 'detail' },
                  React.createElement(
                    'a',
                    { href: entry.url, target: '_blank', onClick: function (e) {
                        return _this.onLinkClick(e);
                      } },
                    React.createElement('i', { className: 'blogicon-external' })
                  )
                )
              )
            )
          )
        )
      );
    }
  }, {
    key: 'onClick',
    value: function onClick() {
      ArchiveActions.toggleSelection(this.props.entryId);
    }
  }, {
    key: 'onLinkClick',
    value: function onLinkClick(e) {
      // 
      e.stopPropagation();
    }
  }, {
    key: 'onDoubleClick',
    value: function onDoubleClick() {
      ArchiveActions.insertDoubleClicked(this.props.entryId);
    }
  }]);

  return Entry;
})(React.Component);

Entry.propTypes = {
  entry: React.PropTypes.object.isRequired,
  entryId: React.PropTypes.string.isRequired,
  isSelected: React.PropTypes.bool.isRequired
};

module.exports = Entry;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../actions/ArchiveActions":432,"./Thumbnail":440,"js/Locale":561}],434:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var Entry = require('./Entry');
var ErrorMessage = require('./ErrorMessage');
var LoadingIndicator = require('./LoadingIndicator');

var EntryList = (function (_React$Component) {
    _inherits(EntryList, _React$Component);

    function EntryList() {
        _classCallCheck(this, EntryList);

        _get(Object.getPrototypeOf(EntryList.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntryList, [{
        key: 'render',
        value: function render() {
            var listItems = this.props.entries.map(function (entry) {
                return React.createElement(Entry, {
                    key: entry.id,
                    entry: entry,
                    entryId: entry.id,
                    isSelected: !!entry.isSelected });
            });

            var isLoading = this.props.isLoading;
            var isNoEntries = listItems.length === 0 && !isLoading;

            return React.createElement(
                'div',
                { className: 'items vertical-items' },
                listItems,
                isLoading ? React.createElement(LoadingIndicator, { ref: 'loadingIndicator' }) : null,
                isNoEntries ? React.createElement(ErrorMessage, { ref: 'errorMessage' }) : null
            );
        }
    }]);

    return EntryList;
})(React.Component);

EntryList.propTypes = {
    entries: React.PropTypes.array.isRequired,
    isLoading: React.PropTypes.bool.isRequired
};

module.exports = EntryList;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Entry":433,"./ErrorMessage":435,"./LoadingIndicator":437}],435:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var ErrorMessage = (function (_React$Component) {
  _inherits(ErrorMessage, _React$Component);

  function ErrorMessage() {
    _classCallCheck(this, ErrorMessage);

    _get(Object.getPrototypeOf(ErrorMessage.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(ErrorMessage, [{
    key: 'render',
    value: function render() {
      return React.createElement(
        'div',
        { className: 'error-message active' },
        Locale.text('edit_form.archive.not_found')
      );
    }
  }]);

  return ErrorMessage;
})(React.Component);

module.exports = ErrorMessage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],436:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ArchiveActions = require('../actions/ArchiveActions');
var SidebarInsertButton = require('../../SidebarInsertButton');

var Footer = (function (_React$Component) {
    _inherits(Footer, _React$Component);

    function Footer() {
        _classCallCheck(this, Footer);

        _get(Object.getPrototypeOf(Footer.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(Footer, [{
        key: 'onClick',
        value: function onClick() {
            ArchiveActions.insertSelected();
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            // disable
            var disabled = !this.props.hasSelectedItems;

            return React.createElement(
                'div',
                { className: 'insert-button-wrapper' },
                React.createElement(SidebarInsertButton, { disabled: disabled,
                    trackingId: 'curation-archive-paste-button',
                    onClick: function () {
                        return _this.onClick();
                    } })
            );
        }
    }]);

    return Footer;
})(React.Component);

Footer.propTypes = {
    hasSelectedItems: React.PropTypes.bool.isRequired
};

module.exports = Footer;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../SidebarInsertButton":540,"../actions/ArchiveActions":432}],437:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var LoadingIndicator = (function (_React$Component) {
  _inherits(LoadingIndicator, _React$Component);

  function LoadingIndicator() {
    _classCallCheck(this, LoadingIndicator);

    _get(Object.getPrototypeOf(LoadingIndicator.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(LoadingIndicator, [{
    key: 'render',
    value: function render() {
      return React.createElement(
        'div',
        { className: 'indicator active' },
        React.createElement('img', { src: '/images/loading.gif' }),
        Locale.text('edit_form.archive.searching')
      );
    }
  }]);

  return LoadingIndicator;
})(React.Component);

module.exports = LoadingIndicator;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],438:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var EntriesStore = require('../stores/EntriesStore');
var ArchiveStore = require('../stores/ArchiveStore');
var ArchiveActions = require('../actions/ArchiveActions');

var SearchForm = require('./SearchForm');
var EntryList = require('./EntryList');
var Footer = require('./Footer');

var InfiniteScroll = require('../../InfiniteScroll');

/**
 * 
 *
 */

var MainPanel = (function (_React$Component) {
    _inherits(MainPanel, _React$Component);

    function MainPanel() {
        _classCallCheck(this, MainPanel);

        _get(Object.getPrototypeOf(MainPanel.prototype), 'constructor', this).call(this);

        this.state = {
            entries: EntriesStore.getState(),
            archive: ArchiveStore.getState()
        };

        this.updateState = this._updateState.bind(this);
    }

    _createClass(MainPanel, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            EntriesStore.on('change', this.updateState);
            ArchiveStore.on('change', this.updateState);
        }
    }, {
        key: '_updateState',
        value: function _updateState() {
            this.setState({
                entries: EntriesStore.getState(),
                archive: ArchiveStore.getState()
            });
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            var entries = this.state.entries.entries;
            var hasSelectedItems = this.state.entries.hasSelectedItems;
            var isLoading = this.state.archive.isLoading;
            var archive = this.state.archive;

            return React.createElement(
                'div',
                { className: 'editor-archive-content' },
                React.createElement(
                    'div',
                    { className: 'editor-archive-header' },
                    React.createElement(
                        'div',
                        { className: 'header curation-header curation-tab-content-inner' },
                        React.createElement(
                            'h2',
                            null,
                            Locale.text('edit_form.archive')
                        ),
                        React.createElement(SearchForm, { archive: archive })
                    )
                ),
                React.createElement(
                    'div',
                    { className: 'editor-archive-main' },
                    React.createElement(
                        InfiniteScroll,
                        { onScroll: function () {
                                return _this.onScroll();
                            } },
                        React.createElement(
                            'div',
                            { className: 'result' },
                            React.createElement(EntryList, { entries: entries, isLoading: isLoading })
                        )
                    )
                ),
                React.createElement(Footer, { hasSelectedItems: hasSelectedItems })
            );
        }
    }, {
        key: 'onScroll',
        value: function onScroll() {
            ArchiveActions.loadMore(this.state.archive);
        }
    }]);

    return MainPanel;
})(React.Component);

module.exports = MainPanel;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../InfiniteScroll":487,"../actions/ArchiveActions":432,"../stores/ArchiveStore":443,"../stores/EntriesStore":444,"./EntryList":434,"./Footer":436,"./SearchForm":439,"js/Locale":561}],439:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactDOM = (typeof window !== "undefined" ? window['ReactDOM'] : typeof global !== "undefined" ? global['ReactDOM'] : null);
var Locale = require('js/Locale');
var keyString = require('js/keyString');

var ArchiveActions = require('../actions/ArchiveActions');

var SearchForm = (function (_React$Component) {
    _inherits(SearchForm, _React$Component);

    function SearchForm() {
        _classCallCheck(this, SearchForm);

        _get(Object.getPrototypeOf(SearchForm.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(SearchForm, [{
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'div',
                { className: 'search-keyword-wrapper' },
                React.createElement('input', { type: 'text',
                    placeholder: Locale.text('edit_form.archive.placeholder'),
                    className: 'search-keyword archive-keyword',
                    'data-ignore-click-jacking': '1',
                    size: '30',
                    onKeyPress: function (e) {
                        return _this.handleKeyPress(e);
                    },
                    ref: 'keyword' }),
                React.createElement(
                    'button',
                    { type: 'button',
                        className: 'search-keyword-submit archive-keyword-submit',
                        onClick: function (e) {
                            return _this.search(e);
                        },
                        ref: 'searchButton' },
                    React.createElement('i', { className: 'blogicon-search' })
                )
            );
        }

        /**
         * Input
         */
    }, {
        key: 'handleKeyPress',
        value: function handleKeyPress(e) {
            // Enter
            if (keyString(e) === 'RET') {
                e.preventDefault();
                this.search();
            }
        }

        /**
         * keywordload
         */
    }, {
        key: 'search',
        value: function search() {
            var term = ReactDOM.findDOMNode(this.refs.keyword).value.trim();
            var archive = this.props.archive;

            archive.term = term;
            ArchiveActions.load(archive);
        }
    }]);

    return SearchForm;
})(React.Component);

SearchForm.propTypes = {
    archive: React.PropTypes.object.isRequired
};

module.exports = SearchForm;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../actions/ArchiveActions":432,"js/Locale":561,"js/keyString":599}],440:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var Thumbnail = (function (_React$Component) {
    _inherits(Thumbnail, _React$Component);

    function Thumbnail() {
        _classCallCheck(this, Thumbnail);

        _get(Object.getPrototypeOf(Thumbnail.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(Thumbnail, [{
        key: 'render',
        value: function render() {
            if (this.props.thumbnails && this.props.thumbnails['60']) {
                var style = {
                    backgroundImage: 'url(' + this.props.thumbnails['60'] + ')'
                };

                return React.createElement('div', { className: 'thumb', style: style });
            }
            return null;
        }
    }]);

    return Thumbnail;
})(React.Component);

Thumbnail.propTypes = {
    thumbnails: React.PropTypes.object
};

module.exports = Thumbnail;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],441:[function(require,module,exports){
(function (global){
'use strict';

var get = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null).get;

var FetchEntries = function FetchEntries() {
    var term = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];
    var untilEpoch = arguments.length <= 1 || arguments[1] === undefined ? null : arguments[1];

    var data = {
        permission: 'public',
        q: term
    };

    if (untilEpoch) {
        data.until = untilEpoch;
    }

    return new Promise(function (resolve, reject) {
        get('entries.json', data).then(function (res) {
            if (res.entries.length > 0) {
                resolve(res);
            } else {
                reject();
            }
        }).fail(function () {
            reject();
        });
    });
};

module.exports = FetchEntries;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],442:[function(require,module,exports){
(function (global){
'use strict';

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactDOM = (typeof window !== "undefined" ? window['ReactDOM'] : typeof global !== "undefined" ? global['ReactDOM'] : null);

var MainPanel = require('./components/MainPanel');
var ArchiveActions = require('./actions/ArchiveActions');

var EntriesStore = require('./stores/EntriesStore');
var ArchiveStore = require('./stores/ArchiveStore');

/**
 * Archive
 *
 * @param {Element} baseElement - MainPanel
 */
var initArchive = function initArchive(baseElement) {
    // Store
    EntriesStore.init();
    ArchiveStore.init();

    // MainPanel
    ReactDOM.render(React.createElement(MainPanel, null), baseElement);

    // EntriesStore
    ArchiveActions.load(ArchiveStore.getState());
};

module.exports = {
    init: initArchive
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./actions/ArchiveActions":432,"./components/MainPanel":438,"./stores/ArchiveStore":443,"./stores/EntriesStore":444}],443:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Dispatcher = require('js/Base/Dispatcher');

var actions = require('../Constants').actions;

var ArchiveStore = (function (_Dispatcher$Store) {
    _inherits(ArchiveStore, _Dispatcher$Store);

    function ArchiveStore() {
        _classCallCheck(this, ArchiveStore);

        _get(Object.getPrototypeOf(ArchiveStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(ArchiveStore, [{
        key: 'init',
        value: function init() {
            var _this = this;

            // init state
            this.initState();

            Dispatcher.on(actions.UPDATE_TERM, function (term) {
                _this.updateTerm(term);
                _this.emit('change');
            });
            Dispatcher.on(actions.START_LOADING, function () {
                _this.startLoading();
                _this.emit('change');
            });
            Dispatcher.on(actions.FINISH_LOADING, function (params) {
                _this.finishLoading(params);
                _this.emit('change');
            });
        }

        // public
        // ArchiveStore
        // public
    }, {
        key: 'initState',
        value: function initState() {
            this.state = {
                term: '',
                hasMore: false,
                until: null,
                isLoading: false
            };
        }
    }, {
        key: 'updateTerm',
        value: function updateTerm(term) {
            this.state.term = term;
            this.state.hasMore = false;
            this.state.until = null;
        }
    }, {
        key: 'startLoading',
        value: function startLoading() {
            this.state.isLoading = true;
        }
    }, {
        key: 'finishLoading',
        value: function finishLoading(params) {
            this.state.hasMore = params.has_more;

            if (params.entries.length) {
                this.state.until = Date.parse(params.entries[params.entries.length - 1].created) / 1000;
            } else {
                this.state.until = null;
            }

            this.state.isLoading = false;
        }
    }]);

    return ArchiveStore;
})(Dispatcher.Store);

module.exports = new ArchiveStore();

},{"../Constants":431,"js/Base/Dispatcher":281}],444:[function(require,module,exports){
'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Dispatcher = require('js/Base/Dispatcher');
var extractSyntax = require('js/Base/extractSyntax');
var EditorConnector = require('js/Base/EditorConnector');
var BUG = require('js/Base/Logger').BUG;

var actions = require('../Constants').actions;

var EntriesStore = (function (_Dispatcher$Store) {
    _inherits(EntriesStore, _Dispatcher$Store);

    function EntriesStore() {
        _classCallCheck(this, EntriesStore);

        _get(Object.getPrototypeOf(EntriesStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntriesStore, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this._initState();

            Dispatcher.on(actions.LOAD, function (params) {
                _this.load(params);
                _this.emit('change');
            });
            Dispatcher.on(actions.LOAD_MORE, function (params) {
                _this.loadMore(params);
                _this.emit('change');
            });
            Dispatcher.on(actions.TOGGLE_SELECTION, function (entryId) {
                _this.toggleSelection(entryId);
                _this.emit('change');
            });
            Dispatcher.on(actions.INSERT_SELECTED, function () {
                _this.insertSelected();
                _this.emit('change');
            });
            Dispatcher.on(actions.INSERT_DOUBLE_CLICKED, function (entryId) {
                _this.insertDoubleClicked(entryId);
                _this.emit('change');
            });
        }

        /* @override
         * entries          - 
         * hasSelectedItems - 1
         */
    }, {
        key: 'getState',
        value: function getState() {
            return _extends({}, this.state, {
                hasSelectedItems: this.state.entries.some(function (entry) {
                    return entry.isSelected;
                })
            });
        }

        // public
        // EntriesStore
        // public
    }, {
        key: 'load',
        value: function load(res) {
            this._initState();
            this._add(res);
        }
    }, {
        key: 'loadMore',
        value: function loadMore(res) {
            this._add(res);
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection(entryId) {
            var entry = this.state.entries.find(function (entry) {
                return entry.id === entryId;
            });
            entry.isSelected = !entry.isSelected;
        }
    }, {
        key: 'insertSelected',
        value: function insertSelected() {
            var entries = this.state.entries.filter(function (entry) {
                return entry.isSelected;
            });
            // ->
            this._insert(entries.reverse());

            // clear selection
            entries.forEach(function (entry) {
                entry.isSelected = false;
            });
        }
    }, {
        key: 'insertDoubleClicked',
        value: function insertDoubleClicked(entryId) {
            var entry = this.state.entries.find(function (entry) {
                return entry.id === entryId;
            });
            this._insert([entry]);
        }

        // private
    }, {
        key: '_initState',
        value: function _initState() {
            /*
             * entries          - 
             */
            this.state = {
                entries: []
            };
        }
    }, {
        key: '_add',
        value: function _add(params) {
            var _this2 = this;

            params.entries.forEach(function (rawEntry) {
                _this2.state.entries.push({
                    id: rawEntry.uuid,
                    title: rawEntry.title,
                    summary: rawEntry.summary,
                    datetime: new Date(rawEntry.datetime),
                    url: rawEntry.url,
                    thumbnails: rawEntry.thumbnails,
                    isSelected: false
                });
            });
        }
    }, {
        key: '_insert',
        value: function _insert(entries) {
            var lines = {
                hatena: [],
                markdown: []
            };

            entries.forEach(function (entry) {
                lines.hatena.push('[' + entry.url + ':embed:cite]');
                lines.markdown.push('[' + entry.url + ':embed:cite]');
            });

            // Deferredreturn
            return extractSyntax(lines.hatena).done(function (data) {
                lines.html = ['', data.html, ''];
            }).fail(function (error) {
                lines.html = lines.hatena;
                BUG(error);
            }).always(function () {
                if (EditorConnector.isiOS() || EditorConnector.isAndroid()) {
                    lines.html = lines.hatena;
                }

                EditorConnector.insertLines(lines);
            });
        }
    }]);

    return EntriesStore;
})(Dispatcher.Store);

module.exports = new EntriesStore();

},{"../Constants":431,"js/Base/Dispatcher":281,"js/Base/EditorConnector":283,"js/Base/Logger":293,"js/Base/extractSyntax":301}],445:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var keyString = require('js/keyString');

/**
 * CategoryEditor
 *
 * 
 * DOM
 */
var CategoryEditor = function CategoryEditor() {
    this.init.apply(this, arguments);
};
CategoryEditor.prototype = {
    init: function init($form, sidebar) {
        this.type = 'editor-category';

        this.$form = $form;
        this.$container = $('#entry-categories-container');
        this.$categoryEditor = $('#entry-categories');
        this.$input = this.$categoryEditor.find('input[type="text"]');

        this.$selectedCategories = $('#selected-categories');
        this.$existingCategories = $('#existing-categories');

        this.sidebar = sidebar;

        // 
        this.selectedCategoryTemplate = _.template(this.$container.find('.js-selected-category-template').html());

        // 
        this.existingCategoryTemplate = _.template(this.$container.find('.js-existing-category-template').html());

        // 
        this.newCategoryPrompt = this.$categoryEditor.attr('data-new-category-prompt');
        this.newCategoryLabel = this.$categoryEditor.attr('data-new-category-label');

        this.initEvents();
    },
    initEvents: function initEvents() {
        var _this = this;

        var self = this;

        this.$form.on('backup-restore-params', function (e, params) {
            if (!params.category) {
                return;
            }
            params.category.forEach(function (category) {
                self.append('' + category);
            });
        });

        this.$selectedCategories.on('click', '.remove-category', function (e) {
            $(this).closest('[data-category-name]').remove();
            self.updateExistingCategories();
        });

        this.$categoryEditor.on('click', function (e) {
            if ($(e.target).is(self.$categoryEditor)) {
                self.$input.focus();
            }
        });

        this.$existingCategories.on('click', '[data-category-name]', function () {
            if ($(this).hasClass('selected')) {
                self.remove($(this).attr('data-category-name'));
            } else {
                self.append($(this).attr('data-category-name'));
            }
        });

        $('#new-category').on('click', function () {
            var category = prompt(self.newCategoryPrompt);
            self.append(category);
        });

        this.$input.autocomplete({
            source: function source(request, response) {
                var term = request.term;

                // term
                var categories = self.$existingCategories.find('[data-category-name]').map(function () {
                    return $(this).attr('data-category-name');
                }).filter(function () {
                    return this.indexOf(term) === 0;
                });

                var newCategory = {
                    value: null,
                    label: self.newCategoryLabel
                };

                response(categories.toArray().concat(term.length > 0 ? [] : [newCategory]));
            },
            select: function select(e, ui) {
                var category;

                if (ui.item.value) {
                    category = ui.item.value;
                } else if (ui.item.value === null) {
                    category = prompt(self.newCategoryPrompt);
                }

                if (category) {
                    self.append(category);
                    $(e.target).val('');
                    e.stopPropagation();
                    e.preventDefault();
                }
            },
            minLength: 1,
            appendTo: this.$categoryEditor.parent()
        });

        this.$input.on('keydown', function (e) {
            var $input = $(this);
            if (keyString(e) == 'RET') {
                if ($input.val().length) {
                    self.$input.autocomplete('close');
                    self.append($input.val());
                    $input.val('');
                }
                return false;
            } else if (keyString(e) == 'BS' && $input.val().length === 0) {
                self.remove();
            }
        });

        this.$form.on('submit', function (e) {
            if (self.$input.val()) {
                self.append(self.$input.val());
                self.$input.val('');
            }
        });

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);

        self.resize();
    },

    // 
    append: function append(name) {
        if (!name) return;

        // 
        var existing = this.$selectedCategories.find('[data-category-name="' + name + '"]');
        if (existing.length) {
            this.$selectedCategories.append(existing);
        } else {
            var html = this.selectedCategoryTemplate({
                categoryName: name
            });
            this.$selectedCategories.append($(html.trim()));
        }
        this.appendToExistingCategories(name);
        this.updateExistingCategories();
    },

    // 
    remove: function remove(categoryName) {
        var targetToDelete = typeof categoryName === 'undefined' ? this.$selectedCategories.find('[data-category-name]:last') : this.$selectedCategories.find('[data-category-name="' + categoryName + '"]');

        targetToDelete.remove();
        this.updateExistingCategories();
    },

    // 
    appendToExistingCategories: function appendToExistingCategories(name) {
        var isDuplicated = this.$existingCategories.find('[data-category-name]').filter(function () {
            return $(this).attr('data-category-name') == name;
        }).length;
        if (!isDuplicated) {
            var html = this.existingCategoryTemplate({ categoryName: name });
            this.$existingCategories.append($(html.trim()));
        }
    },

    // selected
    updateExistingCategories: function updateExistingCategories() {
        var isSelected = {};
        this.$selectedCategories.find('[data-category-name]').each(function () {
            isSelected[$(this).attr('data-category-name')] = true;
        });
        this.$existingCategories.find('[data-category-name]').each(function () {
            $(this).toggleClass('selected', !!isSelected[$(this).attr('data-category-name')]);
        });
    },

    // 
    resize: function resize() {
        this.$existingCategories.height($('#editor-category').outerHeight(true) - $('.entry-categories-top').outerHeight(true) - (16 + 1) // padding * 2 + border-top
        );
    }

};

module.exports = CategoryEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/keyString":599,"underscore":213}],446:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * DateTimeEditor
 *
 * 
 * 
 */
var DateTimeEditor = function DateTimeEditor() {
    this.init.apply(this, arguments);
};
DateTimeEditor.prototype = {
    init: function init(form) {
        this.form = $(form);
        this.element = $('#datetime-input');
        this.element.hide();
        this.datetimepicker = $('<div class="datetime-input">' + '<input type="text" id="datetime-input-date" > ' + '<input type="text" id="datetime-input-time" ></div>');
        this.datepicker = this.datetimepicker.find('#datetime-input-date').attr('placeholder', this.todayString());
        this.timepicker = this.datetimepicker.find('#datetime-input-time').attr('placeholder', '00:00');

        this.element.after(this.datetimepicker);

        // 
        this.$isScheduled = $('.js-scheduled-entry-checkbox');

        this.bind();
        this.load();
    },

    bind: function bind() {
        var self = this;

        this.form.bind('backup-restore-params', function (e, params) {
            self.load();
        });

        var lang = document.documentElement.getAttribute('lang');
        $.datepicker.setDefaults($.datepicker.regional[lang == 'en' ? '' : lang]);
        this.datepicker.datepicker({
            dateFormat: $.datepicker.W3C,
            onSelect: function onSelect() {
                self.datepicker.change();
            }
        });

        var timeOptions = [];
        for (var i = 0; i < 24; ++i) {
            timeOptions.push(('0' + i.toString()).slice(-2) + ':00');
            timeOptions.push(('0' + i.toString()).slice(-2) + ':30');
        }
        this.timepicker.autocomplete({
            source: function source(request, response) {
                if (!request.term.match(/^\d{1,2}:\d{1,2}:(\d{1,2})?$/)) {
                    response(timeOptions);
                }
            },
            select: function select(e, ui) {
                if (ui.item.value) {
                    self.timepicker.val(ui.item.value).change();
                }
            },
            minLength: 0,
            appendTo: this.element.parent()
        });
        this.timepicker.focus(function () {
            $(this).autocomplete('search', '');
        });

        this.datepicker.change(function () {
            self.date = $(this).val();
            self.updateValue();

            if (self.timepicker.val() === '') {
                self.timepicker.val('00:00').focus().change();
            }
        });

        this.timepicker.change(function () {
            var time = $(this).val();

            if (self.checkTime(time)) {
                var m = time.match(/^(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?$/);
                self.time = $([1, 2, 3]).map(function () {
                    return ('0' + (m[this] || '00')).slice(-2);
                }).toArray().join(':');
            } else {
                self.time = null;
            }

            self.updateValue();

            if (self.datepicker.val() === '') {
                self.datepicker.val(self.todayString()).change();
            }
        });

        this.form.submit(function (e) {
            self.updateValue();
        });

        this.$isScheduled.on('change', function () {
            self.updateValue();
        });
    },

    /**
     * 
     * ( or )
     */
    load: function load() {
        var self = this;
        var m = this.element.val().match(/^(\d{4}-\d{2}-\d{2})T(\d{2}:\d{2}:\d{2})\+(\d{2}:\d{2})$/);
        if (m) {
            this.datepicker.val(this.date = m[1]);
            this.time = m[2];
            var time = this.time.replace(/:00$/, '');
            this.timepicker.val(time);
            this.timezone = m[3];
        }
    },

    /**
     * 
     */
    todayString: function todayString() {
        var now = new Date();
        var date = [];
        date.push((1900 + now.getYear()).toString());
        date.push(('0' + (1 + now.getMonth()).toString()).slice(-2));
        date.push(('0' + now.getDate().toString()).slice(-2));
        return date.join('-');
    },

    /**
     * 
     * @param {string} time - 
     * @return {Boolean}
     */
    checkTime: function checkTime(time) {
        var match = time.match(/^(\d{1,2}):(\d{1,2})(?::(\d{1,2}))?$/);
        if (match) {
            var h = parseInt(match[1], 10);
            var m = parseInt(match[2], 10);
            var s = parseInt(match[3] || '0', 10);
            return 0 <= h && h < 24 && 0 <= m && m < 60 && 0 <= s && s < 60;
        }
        return false;
    },

    /**
     * 
     */
    updateValue: function updateValue() {
        var isValidDate;

        // 
        // 
        if (this.date) {
            //  00:00 
            if (!this.time) this.time = '00:00';

            // timezone 
            var timezone = '';
            if (this.timezone) timezone = '+' + this.timezone;

            this.element.val(this.date + 'T' + this.time + timezone);
            isValidDate = true;
        } else {
            this.element.val('');
            isValidDate = false;
        }

        // 
        this.$isScheduled.prop('disabled', !isValidDate);

        var isScheduled = isValidDate && this.$isScheduled.prop('checked');

        $(this).trigger('updated', isScheduled);
    }
};

module.exports = DateTimeEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],447:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var configStorage = require('../configStorage');

var EventEmitter = require('events').EventEmitter;
var SidebarButtons = require('./SidebarButtons');

/**
 * EditorSidebar
 *
 * config
 * public
 */

var EditorSidebar = (function () {

    /**
     * @param {Editor} editor
     */

    function EditorSidebar(editor) {
        _classCallCheck(this, EditorSidebar);

        this.editor = editor;

        this.eventEmitter = new EventEmitter();
        this.eventEmitter.setMaxListeners(100); // 

        this.$editor = $('#editor');
        this.$container = $('#editor-support-container');
        this.$services = this.$container.find('.services');
        this.$header = this.$container.find('.header');
        this.$footer = this.$container.find('.footer');

        this.type = 'editor-home';
        this.isOpen = true;

        this.sidebarButtons = new SidebarButtons(this.$container.find('.curation-bar-itemlist'), this);

        this.bindEvents();
        this.restoreLastStatus();
    }

    _createClass(EditorSidebar, [{
        key: 'bindEvents',
        value: function bindEvents() {
            var _this = this;

            this.on('toggle', function () {
                return _this.toggle();
            });
            this.on('openByType', function (type) {
                return _this.openByType(type);
            });

            this.editor.on('resize', function () {
                return _this.emit('resize', _this.type);
            });
        }
    }, {
        key: 'restoreLastStatus',
        value: function restoreLastStatus() {
            // config
            var sidebar = configStorage.load('sidebar-status');
            if (sidebar) {
                this.type = sidebar.type;
                this.isOpen = sidebar.is_open;
            }

            // 
            if (this.$editor.attr('data-sidebar-type')) {
                this.type = this.$editor.attr('data-sidebar-type');
                this.isOpen = true;
            }

            if (this.isOpen) {
                this.openByType(this.type);
            }
        }
    }, {
        key: 'isOpening',
        value: function isOpening() {
            return $(document.body).hasClass('support-shown');
        }

        /** @public */
    }, {
        key: 'toggle',
        value: function toggle() {
            if (this.isOpening()) {
                this.close();
            } else {
                this.openByType(this.type);
            }
        }

        /** @public */
    }, {
        key: 'openByType',
        value: function openByType(type) {
            if (!type) {
                this.close();
                return;
            }
            var $content = this.$container.find('#' + type);
            if (!$content.get(0)) {
                this.openByType('editor-home');
                return;
            }

            this.type = type;

            this.$container.find('.curation-tab-content').hide();

            // 
            $(document.body).addClass('support-shown');

            $content.show();
            $content.triggerHandler('show');

            this.isOpen = true;
            this.save();

            this.emit('tabChange', type);
        }

        /** @public */
    }, {
        key: 'close',
        value: function close() {
            $(document.body).removeClass('support-shown');

            var $previous_button = this.$container.find('.curation-itemlist.active');
            $previous_button.removeClass('active');
            $previous_button.removeClass($previous_button.attr('data-icon-class-when-active'));
            $previous_button.addClass($previous_button.attr('data-icon-class'));

            this.isOpen = false;
            this.save();

            this.emit('tabChange', 'none'); // 
        }
    }, {
        key: 'save',
        value: function save() {
            configStorage.save('sidebar-status', {
                is_open: this.isOpen,
                type: this.type
            });
        }
    }, {
        key: 'on',
        value: function on() {
            this.eventEmitter.on.apply(this.eventEmitter, arguments);
        }
    }, {
        key: 'emit',
        value: function emit() {
            this.eventEmitter.emit.apply(this.eventEmitter, arguments);
        }
    }]);

    return EditorSidebar;
})();

module.exports = EditorSidebar;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../configStorage":559,"./SidebarButtons":539,"events":207,"underscore":213}],448:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Messenger = require('js/Messenger');
var keyString = require('js/keyString');
var Browser = require('js/Base/Browser');
var Window = require('js/Base/Window');
var globalData = require('js/Base/globalData');
var trackEvent = require('js/Base/EventTracker').trackEvent;
var URLGenerator = require('js/Base/URLGenerator');
var Editor = require('../Editor');
var EmbedBoxCandidate = require('./EmbedBoxCandidate');

// 
var EmbedBox = function EmbedBox() {
    this.init.apply(this, arguments);
};
EmbedBox.prototype = {
    init: function init(args) {
        var self = this;
        self.editor = args.editor;
        self.$container = args.$container;
        self.$urlInput = self.$container.find('.js-embed-url');
        self.$previewButton = self.$container.find('.js-preview-button');
        self.$embedTypes = self.$container.find('.js-embed-types');
        self.$pasteButton = self.$container.find('.js-paste-button');
        self.$showEmbedCheckbox = self.$container.find('.js-show-embed-box-on-paste-url');
        self.candidates = [];

        // showresolve, reject
        self.session = $.Deferred();
        self.session.reject();

        self.$container.on('click', '.js-close', function () {
            self.hide();
        });

        self.$previewButton.on('click', function () {
            self.requestPreview();
        });

        self.$urlInput.on('keydown', function (event) {
            if (keyString(event) === 'RET') {
                self.requestPreview();
                return false;
            }
        });

        self.$pasteButton.on('click', function () {
            self.requestPaste();
        });

        self.$container.on('keydown', ':input', function (event) {
            // ESC
            // CompositionURL
            if (keyString(event) === 'ESC') {
                self.hide();
                return false;
            }
        });

        if (Browser.isIE) {
            var editor = self.editor;
            // IE
            setInterval(function () {
                try {
                    self.selectionRangeInTimer = editor.getSelectionRange();
                    self.selectionContentInTimer = editor.isCollapsed() ? null : editor.getSelectionText();
                } catch (ignore) {
                    // 
                }
            }, 1000);
        }

        // URL
        // 
        // localStorageinputinput
        var key = 'EmbedBox.show-embed-box-on-paste-url';
        var pasteEnabled = true;
        try {
            pasteEnabled = localStorage.getItem(key) !== 'false';
        } catch (ignore) {}
        if (pasteEnabled) {
            self.$showEmbedCheckbox.prop('checked', true);
        }

        self.$showEmbedCheckbox.on('change', function () {
            var enabled = self.isEnabledOnPasteURL();
            localStorage.setItem(key, enabled);
            trackEvent('EmbedBox.showFromPaste.setEnable.' + enabled);
        });

        $(document).on('show-embed-box', function () {
            self.show();
        });

        self.$embedTypes.on('change', ':input', function () {
            var $input = $(this);
            self.$embedTypes.find('.js-embed-type.selected').removeClass('selected');
            $input.parents('.js-embed-type').toggleClass('selected');
        });

        self.$embedTypes.on('dblclick', '.js-embed-type', function () {
            self.requestPaste();
        });
    },
    // 
    isEnabledOnPasteURL: function isEnabledOnPasteURL() {
        return this.$showEmbedCheckbox.prop('checked');
    },
    // 
    show: function show() {
        var self = this;
        if (self.isShown()) return;

        self.$container.css('left', ($(window).width() - self.$container.width()) / 2);

        self.$embedTypes.find('.js-embed-type.selected').removeClass('selected');

        Window.show(self.$container, {
            showBackground: true,
            destroy: function destroy() {
                self.onHide();
            }
        });

        _.defer(function () {
            self.$urlInput.focus()[0].select();
        });

        self.checkSelection();

        trackEvent('EmbedBox.show');

        self.session = $.Deferred();
        return self.session.promise();
    },
    setURL: function setURL(url) {
        this.$urlInput.val(url);
    },
    isShown: function isShown() {
        return this.$container.is(':visible');
    },
    // 
    hide: function hide() {
        var self = this;
        Window.hide(self.$container);
    },
    // callback
    onHide: function onHide() {
        var self = this;
        self.session.reject();
        self.reset();
    },
    // 
    checkSelection: function checkSelection() {
        var self = this;
        if (!Browser.isIE) {
            var editor = self.editor;
            self.selectionRange = editor.getSelectionRange();
            self.selectionContent = editor.isCollapsed() ? null : editor.getSelectionText();
        } else {
            // IE
            self.selectionRange = self.selectionRangeInTimer;
            self.selectionContent = self.selectionContentInTimer;
        }
    },
    // URL
    requestPreview: function requestPreview() {
        var self = this;

        var url = self.$urlInput.val();
        if (!url) return;

        // 
        if (!url.match(/^https?:\/\//)) {
            url = 'http://' + url;
        }

        self.reset();

        // showfocus
        _.defer(function () {
            self.$pasteButton.attr('disabled', false).removeClass('disabled').focus();
        });

        if (self.selectionRange && self.selectionContent) {
            self.candidates.push(self.createQuoteCandidate(url, self.selectionContent));
        }
        self.candidates.push(self.createImageCandidate(url));
        self.candidates.push(self.createEmbedCandidate(url));
        self.candidates.push(self.createTitleCandidate(url));
        self.candidates.push(self.createURLCandidate(url));
    },
    // disabledURL
    reset: function reset() {
        var self = this;
        _.each(self.candidates, function (candidate) {
            candidate.kill();
        });
        self.candidates = [];
        self.$pasteButton.attr('disabled', true).addClass('disabled');
    },
    // 
    requestPaste: function requestPaste() {
        var self = this;

        if (self.$pasteButton.is(':disabled')) return;

        // 
        var candidate = _.find(self.candidates, function (candidate) {
            return candidate.isChecked();
        }) || _.find(self.candidates, function (candidate) {
            return candidate.isEnabled();
        });

        trackEvent('EmbedBox.paste');
        trackEvent('EmbedBox.paste.' + candidate.type);

        self.session.resolve(candidate);

        candidate.paste();
        self.hide();
    },
    createEmbedCandidate: function createEmbedCandidate(url) {
        var self = this;

        var $iframe = $('<iframe width="100%" scrolling="no">');
        var src = URLGenerator.user_blog_url('/preview_url_embed') + '?' + $.param({ url: url });

        var embedSucceed = $.Deferred();

        // iframeDOMMessenger(postMessage.js)
        _.defer(function () {
            var messenger = Messenger.createForFrame($iframe[0], src);
            messenger.addEventListener('resize', function (height) {
                $iframe.css('height', height);
                embedSucceed.resolve();
            });
            messenger.addEventListener('close', function () {
                $iframe.remove();
                embedSucceed.reject();
            });
        });

        // youtubeiframescript
        // :embed + :cite
        // twitterstatusiTunesFlickedivscript:embed1:cite
        var syntax;
        var anchor = document.createElement('a');
        anchor.href = url;
        if (anchor.host === 'itunes.apple.com' || anchor.host == 'twitter.com' && anchor.pathname.match(/\/status\//) || anchor.host.match(/flickr\.com/) && anchor.pathname.match(/\/photos\//)) {
            syntax = "[" + url + ":embed]";

            // iTunes(tinyMCE)
            // tinymce
            if ($('#syntax').val() === 'html') {
                syntax += "\n\n ";
            }
        } else {
            syntax = "[" + url + ":embed:cite]";
        }

        return new EmbedBoxCandidate({
            $root_container: self.$container,
            type: 'embed',
            syntax: syntax,
            loader: embedSucceed.promise(),
            $preview: $iframe,
            editor: self.editor
        });
    },

    createImageCandidate: function createImageCandidate(url) {
        var self = this;

        var imageLoaded = $.Deferred();
        var $img = $('<img>').on('load', function () {
            imageLoaded.resolve();
        }).on('error', function () {
            imageLoaded.reject();
        }).attr('src', url);

        return new EmbedBoxCandidate({
            $root_container: self.$container,
            type: 'image',
            selectionRange: self.selectionRange,
            // :image:image=imgsrc
            syntax: '[' + url + ':image=' + url + ']',
            loader: imageLoaded.promise(),
            $preview: $img,
            editor: self.editor
        });
    },
    createTitleCandidate: function createTitleCandidate(url) {
        var self = this;

        var $preview = $('<div>');

        var loadInfo = $.Deferred();

        $.ajax({
            type: 'POST',
            dataType: 'json',
            url: '/api/extract_title',
            data: {
                url: url,
                rkm: globalData('rkm'),
                rkc: globalData('rkc')
            }
        }).done(function (info) {
            if (info.title) {
                $preview.text(info.title);
                loadInfo.resolve();
            } else {
                loadInfo.reject();
            }
        }).fail(function () {
            loadInfo.reject();
        });

        return new EmbedBoxCandidate({
            $root_container: self.$container,
            type: 'title',
            selectionRange: self.selectionRange,
            syntax: '[' + url + ':title]',
            loader: loadInfo.promise(),
            $preview: $preview,
            editor: self.editor
        });
    },
    createURLCandidate: function createURLCandidate(url) {
        var self = this;

        var $preview = $('<div>').text(url);

        return new EmbedBoxCandidate({
            $root_container: self.$container,
            type: 'url',
            selectionRange: self.selectionRange,
            syntax: '[' + url + ']',
            loader: $.Deferred().resolve().promise(),
            $preview: $preview,
            editor: self.editor
        });
    },
    createQuoteCandidate: function createQuoteCandidate(url, quote) {
        var self = this;
        var $preview = $('<pre>').text(quote);

        return new EmbedBoxCandidate({
            $root_container: self.$container,
            type: 'quote',
            selectionRange: self.selectionRange,
            syntax: '[' + url + ':title=' + quote + ']',
            loader: $.Deferred().resolve().promise(),
            $preview: $preview,
            paste: function paste() {
                var editor = self.editor;
                editor.setSelectionRange(self.selectionRange);
                editor.createLink(url);
            },
            editor: self.editor
        });
    }
};

module.exports = EmbedBox;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Editor":549,"./EmbedBoxCandidate":449,"js/Base/Browser":278,"js/Base/EventTracker":284,"js/Base/URLGenerator":298,"js/Base/Window":299,"js/Base/globalData":302,"js/Messenger":562,"js/keyString":599,"underscore":213}],449:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var extractSyntax = require('js/Base/extractSyntax');
var EditorConnector = require('js/Base/EditorConnector');

// URLviewsyntax
var EmbedBoxCandidate = function EmbedBoxCandidate() {
    this.init.apply(this, arguments);
};
EmbedBoxCandidate.prototype = {
    // args: { $root_container, type, syntax|paste, load, $preview }
    init: function init(args) {
        var self = this;
        self.type = args.type;
        self.selectionRange = args.selectionRange;
        self.editor = args.editor;

        // syntax(1)
        if (args.syntax) {
            self.syntax = args.syntax;
        }

        // pastepaste
        if (args.paste) {
            self.paste = args.paste;
        }

        self.$container = args.$root_container.find('[data-embed-type="' + self.type + '"]');
        self.$container.hide();
        self.$radio = self.$container.find('.js-type-select');
        self.$radio.attr('checked', false);

        // previewContainreappendpreviewContainer
        self.$previewContainer = self.$container.find('.js-preview-container');
        self.$previewContainer.hide();
        self.$previewContainer.append(args.$preview);

        // resolve
        self.loader = args.loader;

        self.loader.done(function () {
            self.enable();
        }).fail(function () {
            self.disable();
        });
    },
    // (:image)
    isEnabled: function isEnabled() {
        var self = this;
        return self.loader.state() === "resolved";
    },
    // 
    enable: function enable() {
        var self = this;
        self.$container.show();
        self.$previewContainer.show();
    },
    // 
    disable: function disable() {
        var self = this;
        self.$container.hide();
        self.$previewContainer.empty();
    },
    // 
    kill: function kill() {
        var self = this;
        self.disable();
    },
    // radio
    isChecked: function isChecked() {
        var self = this;

        return self.$radio.prop('checked');
    },
    // 
    paste: function paste() {
        var self = this;
        self.getSyntaxLines().done(function (lines) {
            if (self.selectionRange) {
                self.editor.setSelectionRange(self.selectionRange);
            }

            EditorConnector.insertLines(lines);
        });
    },
    // resolveDeferred
    getSyntaxLines: function getSyntaxLines() {
        var self = this;
        var gotSyntax = $.Deferred();

        var lines_data = self.syntax.split('\n');
        var lines = {
            html: lines_data,
            hatena: lines_data,
            markdown: lines_data
        };

        extractSyntax(self.syntax).done(function (data) {
            lines.html = [data.html];
        }).always(function () {
            gotSyntax.resolve(lines);
        });

        return gotSyntax.promise();
    }
};

module.exports = EmbedBoxCandidate;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EditorConnector":283,"js/Base/extractSyntax":301}],450:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var TwitterMessage = require('./TwitterMessage');
var DateTimeEditor = require('./DateTimeEditor');
var OgImageEditor = require('./OgImageEditor');
var OgDescriptionInput = require('./OgDescriptionInput');

/**
 *  
 * 
 */

var EntryOption = (function () {

    /**
     * @param {jQuery} $form
     * @param {Editor} editor
     */

    function EntryOption($form, editor, sidebar) {
        var _this = this;

        _classCallCheck(this, EntryOption);

        this.type = 'editor-option';

        this.editor = editor;
        this.$socializeBox = $('.js-socialize-box');

        // 
        this.twitterMessage = new TwitterMessage();
        this.datetimeEditor = new DateTimeEditor($form);

        this.ogImageEditor = new OgImageEditor($form, editor);
        this.ogDescriptionInput = new OgDescriptionInput(editor);

        sidebar.on('resize', function (type) {
            if (type !== _this.type) {
                return;
            }
            _this.ogImageEditor.reloadItems();
        });
        sidebar.on('tabChange', function (type) {
            if (type !== _this.type) {
                return;
            }
            _this.ogImageEditor.reloadItems();
            _this.ogDescriptionInput.update();
        });

        this.observeForScheduledEntry();
    }

    _createClass(EntryOption, [{
        key: 'observeForScheduledEntry',
        value: function observeForScheduledEntry() {
            var _this2 = this;

            $(this.datetimeEditor).on('updated', function (e, isScheduled) {
                _this2.editor.emit('toggleScheduledEntry', !!isScheduled);
                _this2.$socializeBox.toggle(isScheduled);
            });

            this.datetimeEditor.updateValue();
        }
    }]);

    return EntryOption;
})();

module.exports = EntryOption;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./DateTimeEditor":446,"./OgDescriptionInput":497,"./OgImageEditor":498,"./TwitterMessage":547}],451:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var keyString = require('js/keyString');
var waitForResource = require('js/Util/waitForResource');
var globalData = require('js/Base/globalData');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');

var Evernote = function Evernote() {
    this.init.apply(this, arguments);
};
Evernote.prototype = {
    parent: MyCuration,
    init: function init(args) {
        this.type = 'editor-evernote';

        this.editor = args.editor;
        this.sidebar = args.sidebar;

        this.$keywordInput = args.container.find('.evernote-search-keyword');
        this.$keywordSubmit = args.container.find('.evernote-search-keyword-submit');

        // $.extend  this.constructor 
        this.parent.prototype.init.call(this, args);
    },
    bindEvents: function bindEvents() {
        var _this = this;

        var self = this;

        // $.extend  this.constructor 
        self.parent.prototype.bindEvents.call(self);

        // AmazonSearch 

        self.$keywordSubmit.click(function (event) {
            self.searchByInput();
            return false;
        });

        self.$keywordInput.keydown(function (event) {
            if (keyString(event) === 'RET') {
                self.searchByInput();
                return false;
            }
        });

        self.$keywordInput.focus(function () {
            // 
            // 
            // 1
            setTimeout(function () {
                self.resize();
            }, 0);
        });

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);

        self.$itemsContainer.on('show_items', function (event, args) {
            _.each(args.notes, function (note) {
                var $item = self.$itemsContainer.find('.item[data-item-guid=' + note.guid + ']');

                $.ajax({
                    url: '/api/evernote/note',
                    data: {
                        content: 1,
                        guid: $item.attr('data-item-guid')
                    },
                    type: 'GET',
                    dataType: 'json'
                }).done(function (response) {
                    if (response && response.content) {
                        var content_type = $('#syntax').val() === 'html' ? 'html' : 'plain';

                        // API<
                        $item.find('.evernote-search-item-body').text(_.unescape(response.content.extended[content_type]));
                        $item.find('.evernote-search-item-body-preview').text(_.unescape(response.content.extended.excerpt));

                        $item.attr('data-loaded-body', true);

                        if (response.extended.has_resource) {
                            self.appendResources({ item: $item, resources: response.resources });
                            self.previewResources({ item: $item, resources: response.resources });
                        }
                    }
                });
            });
        });

        self.$container.on('insert_items', function (event, args) {
            var notes = args.items;
            var resources = _.chain(notes).map(function (note) {
                return $(note).find('.evernote-item-resource').get();
            }).flatten().value();

            self.requestInsertResources(resources);

            var note_title = _.chain(notes).map(function ($item) {
                return $item.find('.evernote-search-item-title').text();
            }).find(function (note_title) {
                return note_title;
            }).value();
            var entry_title = self.editor.getTitle();

            if (note_title && !entry_title) {
                self.editor.setTitle(note_title);
            }
        });
    },
    serviceName: 'Evernote',
    syntax: function syntax() {
        return $('#syntax').val();
    },
    loadItems: function loadItems() {
        var self = this;
        var data = {
            filter_order: 'created'
        };

        return $.ajax({
            url: '/api/evernote/notes_metadata',
            data: data,
            type: 'GET',
            dataType: 'json'
        }).pipe(function (response) {
            if (!response) return response;

            if (!response.is_error) {
                response.entries = response.notes;
            } else if (response.is_error && response.error_details.type === 'auth_expired') {
                self.$container.html(self.$container.find('.auth-expired-template').html()).removeClass('enabled').addClass('disabled');
                return response;
            }

            self.itemsReachedEnd = !response.extended.has_next;

            return response;
        }).fail(function (response) {
            if (!response) return response;

            // API
            var responseText = null;
            try {
                responseText = $.parseJSON(response.responseText);
            } catch (e) {}
            if (responseText && responseText.is_rate_limit_reached) {
                self.$container.html(self.$container.find('.rate-limit-reached-template').html()).removeClass('enabled').addClass('disabled');
                return response;
            }
        });
    },
    previewResources: function previewResources(args) {
        var self = this;
        var $note_item = args.item;
        var resources = args.resources;

        if (resources.length <= 0) return;

        var resource = resources[0];

        var $img = $('<img/>');
        $img.attr('src', '/api/evernote/thumbnail?guid=' + resource.guid);
        $img.addClass('resource-image');

        waitForResource(function () {
            return $note_item.attr('data-loaded-body');
        }, function () {
            $note_item.find('.evernote-image-preview').append($img);
        });
    },
    appendResources: function appendResources(args) {
        var self = this;

        var $item = args.item;
        var resources = args.resources;

        $item.attr('data-has-resource', true);
        $item.addClass('has-resource');
        var $resources = _.map(resources, function (resource) {
            var $resource_node = $('<li/>');
            var attrs = {
                'data-guid': resource.guid
            };
            $resource_node.attr(attrs);
            $resource_node.addClass('evernote-item-resource');

            return $resource_node.get(0);
        });
        $item.find('.evernote-item-resources').append($resources);
    },
    requestInsertResources: function requestInsertResources(resources) {
        var self = this;
        var resource = resources.shift();

        if (!resource) return;

        var $resource = $(resource);
        if ($resource.attr('data-uploaded')) {
            self.insertFotolifeImage({
                annotation: $resource.attr('data-fotolife-annotation'),
                html: $resource.attr('data-fotolife-html'),
                hex_body_hash: $resource.attr('data-hex-body-hash')
            });
            self.requestInsertResources(resources);
        } else {
            var dfd = self.requestUploadResource($resource);
            dfd.done(function () {
                self.requestInsertResources(resources);
            });
        }
    },
    requestUploadResource: function requestUploadResource(resource) {
        var self = this;

        return $.ajax({
            url: '/api/upload/evernote/resource',
            data: {
                rkm: globalData('rkm'),
                rkc: globalData('rkc'),
                guid: resource.attr('data-guid')
            },
            dataType: 'json',
            type: 'POST'
        }).done(_.bind(self.onCompleteUploadingResource, self, resource));
    },
    onCompleteUploadingResource: function onCompleteUploadingResource($resource, response) {
        var self = this;

        $resource.attr({
            'data-uploaded': 1,
            'data-fotolife-annotation': response.annotation,
            'data-fotolife-html': response.html,
            'data-hex-body-hash': response.hex_body_hash
        });

        self.insertFotolifeImageByResource($resource);
    },
    insertFotolifeImageByResource: function insertFotolifeImageByResource($resource) {
        var self = this;

        if (!$resource.attr('data-uploaded')) return;

        self.insertFotolifeImage({
            annotation: $resource.attr('data-fotolife-annotation'),
            html: $resource.attr('data-fotolife-html'),
            hex_body_hash: $resource.attr('data-hex-body-hash')
        });
    },
    insertFotolifeImage: function insertFotolifeImage(args) {
        var self = this;

        var annotation = args.annotation;
        var hex_body_hash = args.hex_body_hash;
        var html = args.html;

        var uploadingMessage = Locale.text('uploading');
        var editor = self.editor;
        var current_body = editor.getBody();
        var placeholder = '[evernote:' + hex_body_hash + ' ' + uploadingMessage + ']';
        var image_source = self.syntax() === 'html' ? html : '[' + annotation + ']';
        var replaced = current_body.replace(placeholder, image_source);

        editor.setValue(replaced);
    },
    resourcesAreUploaded: function resourcesAreUploaded($item) {
        return _.all($item.find('.evernote-resource').get(), function ($resource) {
            return $resource.attr('data-uploaded');
        });
    },
    readyToInserted: function readyToInserted($items) {
        var self = this;
        return _.all($items, function ($item) {
            var loaded_body = $item.attr('data-loaded-body');
            var has_resource = $item.attr('data-has-resource');
            var upload_completed = has_resource ? self.resourcesAreUploaded($item) : true;
            return loaded_body && upload_completed;
        });
    },
    insertItems: function insertItems(items) {
        var self = this;

        waitForResource(function () {
            return self.readyToInserted(items);
        }, function () {
            var uploadingMessage = Locale.text('uploading');
            var lines = _.map(items, function ($item) {
                return $item.find('.evernote-search-item-body').text().replace(/\[evernote:([^\]]*)\]/gm, '[evernote:$1 ' + uploadingMessage + ']');
            });

            self.editor.insertLines(lines);

            self.$container.trigger('insert_items', { items: items, lines: lines });
        });
    },
    showItems: function showItems(items) {
        var self = this;
        self.parent.prototype.showItems.call(self, items);

        self.$itemsContainer.trigger('show_items', { notes: items });
    },
    searchByInput: function searchByInput() {
        var self = this;

        self.search(self.$keywordInput.val());
    },
    search: function search(keyword) {
        var self = this;

        if (typeof keyword != 'string') return false;

        keyword = keyword.replace(/^\s*/, '');
        keyword = keyword.replace(/\s*$/, '');

        // 
        if (keyword.length === 0) {
            self.requestReload();
            return false;
        }

        // AmazonSearch 

        // if (self._searchingKeyword == keyword && self._searchingCategory == category) return false;

        if (self._searchDeferred) {
            self._searchDeferred.reject();
        }

        self.ajaxStarted();

        self._searchingKeyword = keyword;

        var currentAjax;
        var dfd = $.Deferred().done(function () {}).fail(function () {
            if (currentAjax) {
                // ajax
                currentAjax.abort();
            }
        }).always(function () {
            self.ajaxFinished();
        });

        self.$itemsContainer.find('.evernote-search-item').remove();

        var searchWithOffset = function searchWithOffset(offset) {
            self.ajaxStarted();

            currentAjax = $.ajax({
                url: '/api/evernote/notes_metadata',
                data: {
                    offset: offset,
                    filter_order: 'created',
                    filter_words: keyword
                }
            }).done(function (response) {
                self.showItems(response.notes);

                if (response.extended.has_next && response.extended.next_offset) {
                    searchWithOffset(response.extended.next_offset);
                } else {
                    dfd.resolve();
                    return;
                }
            }).fail(function (response) {
                dfd.reject(response);
            });
        };
        searchWithOffset(0);

        self._searchDeferred = dfd;
    },
    ajaxStarted: function ajaxStarted() {
        var self = this;

        self.isAjaxing = true;

        self.$keywordSubmit.prop('disabled', true);
        self.$indicator.show();
        self.$errorMessage.hide();
    },
    ajaxFinished: function ajaxFinished() {
        var self = this;

        self.isAjaxing = false;

        self.$keywordSubmit.prop('disabled', false);
        self.$errorMessage.hide();
        self.$indicator.hide();
    }
};

extend(Evernote.prototype, MyCuration.prototype);

module.exports = Evernote;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MyCuration":494,"js/Base/globalData":302,"js/Locale":561,"js/Util/extend":574,"js/Util/waitForResource":592,"js/keyString":599,"underscore":213}],452:[function(require,module,exports){
'use strict';

var actions = {
    SEARCH: {
        LOAD: 'FLICKR:SEARCH:LOAD',
        START_LOADING: 'FLICKR:SEARCH:START_LOADING',
        FINISH_LOADING: 'FLICKR:SEARCH:FINISH_LOADING',
        INIT_WITH_WORD: 'FLICKR:SEARCH:INIT_WITH_WORD',
        TOGGLE_SELECTION: 'FLICKR:SEARCH:TOGGLE_SELECTION',
        INSERT_SELECTED: 'FLICKR:SEARCH:INSERT_SELECTED',
        INSERT_DOUBLE_CLICKED: 'FLICKR:SEARCH:INSERT_DOUBLE_CLICKED'
    },
    PHOTOSTREAM: {
        LOAD: 'FLICKR:PHOTOSTREAM:LOAD',
        REGISTER_USER: 'FLICKR:PHOTOSTREAM:REGISTER_USER',
        UNREGISTER_USER: 'FLICKR:PHOTOSTREAM:UNREGISTER_USER',
        HIDE_WELCOME_MESSAGE: 'FLICKR:PHOTOSTREAM:HIDE_WELCOME_MESSAGE',
        START_LOADING: 'FLICKR:PHOTOSTREAM:START_LOADING',
        FINISH_LOADING: 'FLICKR:PHOTOSTREAM:FINISH_LOADING',
        TOGGLE_SELECTION: 'FLICKR:PHOTOSTREAM:TOGGLE_SELECTION',
        INSERT_SELECTED: 'FLICKR:PHOTOSTREAM:INSERT_SELECTED',
        INSERT_DOUBLE_CLICKED: 'FLICKR:PHOTOSTREAM:INSERT_DOUBLE_CLICKED'
    }
};

module.exports = {
    actions: actions
};

},{}],453:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var actions = require('../Constants').actions;
var Dispatcher = require('js/Base/Dispatcher');
var fetchUserInfo = require('../external_apis/fetchUserInfo');
var fetchUserPhotostream = require('../external_apis/fetchUserPhotostream');

var PhotostreamActions = (function (_Dispatcher$Actions) {
    _inherits(PhotostreamActions, _Dispatcher$Actions);

    function PhotostreamActions() {
        _classCallCheck(this, PhotostreamActions);

        _get(Object.getPrototypeOf(PhotostreamActions.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PhotostreamActions, [{
        key: 'registerUser',
        value: function registerUser(name) {
            var _this = this;

            if (/^\s*$/.test(name)) {
                return;
            }

            fetchUserInfo(name).then(function (res) {
                _this.emit(actions.PHOTOSTREAM.REGISTER_USER, res);
                _this._load(res.data.nsid, 1);
            })['catch'](function () {
                _this.emit(actions.PHOTOSTREAM.HIDE_WELCOME_MESSAGE);
            });
        }
    }, {
        key: 'unregisterUser',
        value: function unregisterUser() {
            this.emit(actions.PHOTOSTREAM.UNREGISTER_USER);
        }
    }, {
        key: 'loadMore',
        value: function loadMore(photostream) {
            if (photostream.isLoading || !photostream.hasMore) {
                return;
            }

            var userId = photostream.user.id;
            var page = photostream.page;

            this._load(userId, page);
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection(photoKey) {
            this.emit(actions.PHOTOSTREAM.TOGGLE_SELECTION, photoKey);
        }
    }, {
        key: 'insertSelected',
        value: function insertSelected() {
            this.emit(actions.PHOTOSTREAM.INSERT_SELECTED);
        }
    }, {
        key: 'insertDoubleClicked',
        value: function insertDoubleClicked(photoKey) {
            this.emit(actions.PHOTOSTREAM.INSERT_DOUBLE_CLICKED, photoKey);
        }
    }, {
        key: 'load',
        value: function load(userId, page) {
            // index.jsload
            // actionactionFlux_loadload
            // 
            this._load(userId, page);
        }
    }, {
        key: '_load',
        value: function _load(userId, page) {
            var _this2 = this;

            this.emit(actions.PHOTOSTREAM.START_LOADING);
            fetchUserPhotostream(userId, page).then(function (res) {
                _this2.emit(actions.PHOTOSTREAM.LOAD, res.data);
                _this2.emit(actions.PHOTOSTREAM.FINISH_LOADING, res);
            });
        }
    }]);

    return PhotostreamActions;
})(Dispatcher.Actions);

module.exports = new PhotostreamActions();

},{"../Constants":452,"../external_apis/fetchUserInfo":465,"../external_apis/fetchUserPhotostream":466,"js/Base/Dispatcher":281}],454:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var actions = require('../Constants').actions;
var Dispatcher = require('js/Base/Dispatcher');
var searchPhotos = require('../external_apis/searchPhotos');

var SearchActions = (function (_Dispatcher$Actions) {
    _inherits(SearchActions, _Dispatcher$Actions);

    function SearchActions() {
        _classCallCheck(this, SearchActions);

        _get(Object.getPrototypeOf(SearchActions.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(SearchActions, [{
        key: 'load',
        value: function load(search, word) {
            var _this = this;

            if (search.isLoading || /^\s*$/.test(word)) {
                return;
            }

            this.emit(actions.SEARCH.INIT_WITH_WORD, word);
            this.emit(actions.SEARCH.START_LOADING);

            searchPhotos(word).then(function (res) {
                _this.emit(actions.SEARCH.LOAD, res.data);
                _this.emit(actions.SEARCH.FINISH_LOADING, res);
            });
        }
    }, {
        key: 'loadMore',
        value: function loadMore(search) {
            var _this2 = this;

            if (search.isLoading || !search.hasMore) {
                return;
            }

            this.emit(actions.SEARCH.START_LOADING);

            searchPhotos(search.word, search.page).then(function (res) {
                _this2.emit(actions.SEARCH.LOAD, res.data);
                _this2.emit(actions.SEARCH.FINISH_LOADING, res);
            });
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection(photoKey) {
            this.emit(actions.SEARCH.TOGGLE_SELECTION, photoKey);
        }
    }, {
        key: 'insertSelected',
        value: function insertSelected() {
            this.emit(actions.SEARCH.INSERT_SELECTED);
        }
    }, {
        key: 'insertDoubleClicked',
        value: function insertDoubleClicked(photoKey) {
            this.emit(actions.SEARCH.INSERT_DOUBLE_CLICKED, photoKey);
        }
    }]);

    return SearchActions;
})(Dispatcher.Actions);

module.exports = new SearchActions();

},{"../Constants":452,"../external_apis/searchPhotos":467,"js/Base/Dispatcher":281}],455:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var SidebarInsertButton = require('../../SidebarInsertButton');

var Footer = (function (_React$Component) {
    _inherits(Footer, _React$Component);

    function Footer() {
        _classCallCheck(this, Footer);

        _get(Object.getPrototypeOf(Footer.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(Footer, [{
        key: 'render',
        value: function render() {
            var _this = this;

            // disable
            var disabled = !this.props.hasSelectedItems;

            return React.createElement(
                'div',
                { className: 'insert-button-wrapper' },
                React.createElement(SidebarInsertButton, {
                    disabled: disabled,
                    trackingId: this.props.trackingId,
                    onClick: function () {
                        return _this.props.onClickInsertButton();
                    } })
            );
        }
    }]);

    return Footer;
})(React.Component);

Footer.propTypes = {
    hasSelectedItems: React.PropTypes.bool.isRequired,
    onClickInsertButton: React.PropTypes.func.isRequired,
    trackingId: React.PropTypes.string.isRequired
};

module.exports = Footer;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../SidebarInsertButton":540}],456:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var LoadingIndicator = (function (_React$Component) {
  _inherits(LoadingIndicator, _React$Component);

  function LoadingIndicator() {
    _classCallCheck(this, LoadingIndicator);

    _get(Object.getPrototypeOf(LoadingIndicator.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(LoadingIndicator, [{
    key: 'render',
    value: function render() {
      return React.createElement(
        'div',
        { className: 'loading-indicator' },
        React.createElement('img', { src: '/images/loading.gif' }),
        Locale.text('edit_form.loading')
      );
    }
  }]);

  return LoadingIndicator;
})(React.Component);

module.exports = LoadingIndicator;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],457:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var Photostream = require('./Photostream');
var Search = require('./Search');

var Tabs = require('js/React/Tabs');

/**
 * Flickr
 */

var MainPanel = (function (_React$Component) {
  _inherits(MainPanel, _React$Component);

  function MainPanel() {
    _classCallCheck(this, MainPanel);

    _get(Object.getPrototypeOf(MainPanel.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(MainPanel, [{
    key: 'render',
    value: function render() {
      var tabs = [{
        key: 'photostream',
        name: Locale.text('edit_form.flickr.photostream'),
        component: Photostream
      }, {
        key: 'search',
        name: Locale.text('edit_form.flickr.search'),
        component: Search
      }];

      // flexboxcontainer > main-panel
      // editor-sidebar-body > editor-sidebar-tabs-container 
      // CSSheight:100%
      return React.createElement(
        'div',
        { className: 'editor-sidebar-main-panel-container' },
        React.createElement(
          'div',
          { className: 'editor-sidebar-main-panel' },
          React.createElement(
            'div',
            { className: 'editor-sidebar-header' },
            React.createElement(
              'h2',
              null,
              Locale.text('edit_form.flickr')
            )
          ),
          React.createElement(
            'div',
            { className: 'editor-sidebar-body' },
            React.createElement(
              'div',
              { className: 'editor-sidebar-tabs-container' },
              React.createElement(Tabs, {
                tabs: tabs,
                className: 'editor-sidebar-tabs',
                localStoragePrefix: 'sidebar-flickr-tab' })
            )
          )
        )
      );
    }
  }]);

  return MainPanel;
})(React.Component);

module.exports = MainPanel;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Photostream":461,"./Search":462,"js/Locale":561,"js/React/Tabs":565}],458:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var shallowCompare = React.addons.shallowCompare;

var Photo = (function (_React$Component) {
    _inherits(Photo, _React$Component);

    function Photo() {
        _classCallCheck(this, Photo);

        _get(Object.getPrototypeOf(Photo.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(Photo, [{
        key: 'shouldComponentUpdate',
        value: function shouldComponentUpdate(nextProps, nextState) {
            return shallowCompare(this, nextProps, nextState);
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            var photo = this.props.photo;
            var style = {
                backgroundImage: 'url(' + photo.src_thumbnail + ')'
            };

            return React.createElement('div', { className: 'photo-list-item' + (photo.isSelected ? ' selected' : ''),
                style: style,
                onClick: function () {
                    return _this.onClick();
                },
                onDoubleClick: function () {
                    return _this.onDoubleClick();
                } });
        }
    }, {
        key: 'onClick',
        value: function onClick() {
            this.props.onClickPhoto(this.props.photo.key);
        }
    }, {
        key: 'onDoubleClick',
        value: function onDoubleClick() {
            this.props.onDoubleClickPhoto(this.props.photo.key);
        }
    }]);

    return Photo;
})(React.Component);

Photo.propTypes = {
    photo: React.PropTypes.object.isRequired,
    onClickPhoto: React.PropTypes.func.isRequired,
    onDoubleClickPhoto: React.PropTypes.func.isRequired
};

module.exports = Photo;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],459:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var Photo = require('./Photo');
var PhotoListMessage = require('./PhotoListMessage');
var LoadingIndicator = require('./LoadingIndicator');

var PhotoList = (function (_React$Component) {
    _inherits(PhotoList, _React$Component);

    function PhotoList() {
        _classCallCheck(this, PhotoList);

        _get(Object.getPrototypeOf(PhotoList.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PhotoList, [{
        key: 'render',
        value: function render() {
            // showWelcomeMessage
            if (this.props.showWelcomeMessage) {
                return React.createElement(
                    'div',
                    { className: 'photo-list' },
                    React.createElement(PhotoListMessage, {
                        text: this.props.welcomeMessage,
                        ref: 'welcomeMessage' })
                );
            }

            // 
            //  && 0
            var isLoading = this.props.isLoading;
            var isError = this.props.photos.length === 0 && !isLoading;
            return React.createElement(
                'div',
                { className: 'photo-list' },
                this.renderPhotos(),
                isLoading ? React.createElement(LoadingIndicator, { ref: 'loadingIndicator' }) : null,
                isError ? React.createElement(PhotoListMessage, { text: Locale.text('edit_form.empty_items'), ref: 'errorMessage' }) : null
            );
        }
    }, {
        key: 'renderPhotos',
        value: function renderPhotos() {
            var _this = this;

            return this.props.photos.map(function (photo) {
                return React.createElement(Photo, {
                    key: photo.key,
                    photo: photo,
                    onClickPhoto: function (key) {
                        return _this.props.onClickPhoto(key);
                    },
                    onDoubleClickPhoto: function (key) {
                        return _this.props.onDoubleClickPhoto(key);
                    } });
            });
        }
    }]);

    return PhotoList;
})(React.Component);

PhotoList.propTypes = {
    photos: React.PropTypes.array.isRequired,
    showWelcomeMessage: React.PropTypes.bool.isRequired,
    isLoading: React.PropTypes.bool.isRequired,
    welcomeMessage: React.PropTypes.string.isRequired,
    onClickPhoto: React.PropTypes.func.isRequired,
    onDoubleClickPhoto: React.PropTypes.func.isRequired
};

module.exports = PhotoList;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./LoadingIndicator":456,"./Photo":458,"./PhotoListMessage":460,"js/Locale":561}],460:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var PhotoListMessage = (function (_React$Component) {
    _inherits(PhotoListMessage, _React$Component);

    function PhotoListMessage() {
        _classCallCheck(this, PhotoListMessage);

        _get(Object.getPrototypeOf(PhotoListMessage.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PhotoListMessage, [{
        key: 'render',
        value: function render() {
            return React.createElement(
                'div',
                { className: 'message' },
                this.props.text
            );
        }
    }]);

    return PhotoListMessage;
})(React.Component);

PhotoListMessage.propTypes = {
    text: React.PropTypes.string.isRequired
};

module.exports = PhotoListMessage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],461:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var PhotostreamActions = require('../actions/PhotostreamActions');
var PhotostreamStore = require('../stores/PhotostreamStore');

var InfiniteScroll = require('../../InfiniteScroll');
var UserAssociation = require('./UserAssociation');
var PhotoList = require('./PhotoList');
var Footer = require('./Footer');

var Photostream = (function (_React$Component) {
    _inherits(Photostream, _React$Component);

    function Photostream() {
        _classCallCheck(this, Photostream);

        _get(Object.getPrototypeOf(Photostream.prototype), 'constructor', this).call(this);

        this.state = PhotostreamStore.getState();

        this.updateState = this._updateState.bind(this);
    }

    _createClass(Photostream, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            PhotostreamStore.on('change', this.updateState);
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            PhotostreamStore.removeListener('change', this.updateState);
        }
    }, {
        key: '_updateState',
        value: function _updateState() {
            this.setState(PhotostreamStore.getState());
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'div',
                { className: 'photostream' },
                React.createElement(UserAssociation, { user: this.state.user }),
                React.createElement(
                    'div',
                    { className: 'result' },
                    React.createElement(
                        InfiniteScroll,
                        { onScroll: function () {
                                return _this.loadMore();
                            } },
                        React.createElement(PhotoList, {
                            photos: this.state.photos,
                            showWelcomeMessage: this.state.showWelcomeMessage,
                            isLoading: this.state.isLoading,
                            welcomeMessage: Locale.text('edit_form.flickr.photostream.description'),
                            onClickPhoto: function (key) {
                                return _this.toggleSelection(key);
                            },
                            onDoubleClickPhoto: function (key) {
                                return _this.insertDoubleClicked(key);
                            } })
                    )
                ),
                React.createElement(Footer, {
                    onClickInsertButton: function () {
                        return _this.insertSelected();
                    },
                    hasSelectedItems: this.state.hasSelectedItems,
                    trackingId: 'curation-flickr-photostream-paste-button' })
            );
        }
    }, {
        key: 'loadMore',
        value: function loadMore() {
            PhotostreamActions.loadMore(this.state);
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection(key) {
            PhotostreamActions.toggleSelection(key);
        }
    }, {
        key: 'insertDoubleClicked',
        value: function insertDoubleClicked(key) {
            PhotostreamActions.insertDoubleClicked(key);
        }
    }, {
        key: 'insertSelected',
        value: function insertSelected() {
            PhotostreamActions.insertSelected();
        }
    }]);

    return Photostream;
})(React.Component);

module.exports = Photostream;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../InfiniteScroll":487,"../actions/PhotostreamActions":453,"../stores/PhotostreamStore":471,"./Footer":455,"./PhotoList":459,"./UserAssociation":464,"js/Locale":561}],462:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var SearchActions = require('../actions/SearchActions');
var SearchStore = require('../stores/SearchStore');

var InfiniteScroll = require('../../InfiniteScroll');
var SearchForm = require('./SearchForm');
var PhotoList = require('./PhotoList');
var Footer = require('./Footer');

var Search = (function (_React$Component) {
    _inherits(Search, _React$Component);

    function Search() {
        _classCallCheck(this, Search);

        _get(Object.getPrototypeOf(Search.prototype), 'constructor', this).call(this);

        this.state = SearchStore.getState();

        this.updateState = this._updateState.bind(this);
    }

    _createClass(Search, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            SearchStore.on('change', this.updateState);
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            SearchStore.removeListener('change', this.updateState);
        }
    }, {
        key: '_updateState',
        value: function _updateState() {
            this.setState(SearchStore.getState());
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'div',
                { className: 'search' },
                React.createElement(SearchForm, { onSubmit: function (keyword) {
                        return _this.load(keyword);
                    } }),
                React.createElement(
                    'div',
                    { className: 'result' },
                    React.createElement(
                        InfiniteScroll,
                        { onScroll: function () {
                                return _this.loadMore();
                            } },
                        React.createElement(PhotoList, {
                            photos: this.state.photos,
                            showWelcomeMessage: this.state.showWelcomeMessage,
                            isLoading: this.state.isLoading,
                            welcomeMessage: Locale.text('edit_form.flickr.search.description'),
                            onClickPhoto: function (key) {
                                return _this.toggleSelection(key);
                            },
                            onDoubleClickPhoto: function (key) {
                                return _this.insertDoubleClicked(key);
                            } })
                    )
                ),
                React.createElement(Footer, {
                    onClickInsertButton: function () {
                        return _this.insertSelected();
                    },
                    hasSelectedItems: this.state.hasSelectedItems,
                    trackingId: 'curation-flickr-search-paste-button' })
            );
        }
    }, {
        key: 'load',
        value: function load(keyword) {
            SearchActions.load(this.state, keyword);
        }
    }, {
        key: 'loadMore',
        value: function loadMore() {
            SearchActions.loadMore(this.state);
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection(key) {
            SearchActions.toggleSelection(key);
        }
    }, {
        key: 'insertDoubleClicked',
        value: function insertDoubleClicked(key) {
            SearchActions.insertDoubleClicked(key);
        }
    }, {
        key: 'insertSelected',
        value: function insertSelected() {
            SearchActions.insertSelected();
        }
    }]);

    return Search;
})(React.Component);

module.exports = Search;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../InfiniteScroll":487,"../actions/SearchActions":454,"../stores/SearchStore":472,"./Footer":455,"./PhotoList":459,"./SearchForm":463,"js/Locale":561}],463:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var SidebarSearchForm = require('../../SidebarSearchForm');

var SearchForm = (function (_React$Component) {
    _inherits(SearchForm, _React$Component);

    function SearchForm() {
        _classCallCheck(this, SearchForm);

        _get(Object.getPrototypeOf(SearchForm.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(SearchForm, [{
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'div',
                { className: 'search-form-wrapper' },
                React.createElement(SidebarSearchForm, {
                    placeholder: Locale.text('edit_form.flickr.placeholder'),
                    onSubmit: function (keyword) {
                        return _this.props.onSubmit(keyword);
                    } })
            );
        }
    }]);

    return SearchForm;
})(React.Component);

SearchForm.propTypes = {
    onSubmit: React.PropTypes.func.isRequired
};

module.exports = SearchForm;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../SidebarSearchForm":541,"js/Locale":561}],464:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');

var PhotostreamActions = require('../actions/PhotostreamActions');

var SidebarUserAssociation = require('../../SidebarUserAssociation');

var UserAssociation = (function (_React$Component) {
    _inherits(UserAssociation, _React$Component);

    function UserAssociation() {
        _classCallCheck(this, UserAssociation);

        _get(Object.getPrototypeOf(UserAssociation.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(UserAssociation, [{
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(SidebarUserAssociation, {
                user: this.props.user,
                onRegister: function (name) {
                    return _this.register(name);
                },
                onUnregister: function () {
                    return _this.unregister();
                },
                placeholder: Locale.text('edit_form.flickr.screen_name') });
        }
    }, {
        key: 'register',
        value: function register(name) {
            PhotostreamActions.registerUser(name);
        }
    }, {
        key: 'unregister',
        value: function unregister() {
            PhotostreamActions.unregisterUser();
        }
    }]);

    return UserAssociation;
})(React.Component);

UserAssociation.propTypes = {
    user: React.PropTypes.object
};

module.exports = UserAssociation;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../SidebarUserAssociation":543,"../actions/PhotostreamActions":453,"js/Locale":561}],465:[function(require,module,exports){
(function (global){
'use strict';

var get = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null).get;

var fetchUserInfo = function fetchUserInfo(user_id) {
    return new Promise(function (resolve, reject) {
        get('/api/flickr/user', { user_id: user_id }).then(function (res) {
            // res.data
            if (res.data) {
                resolve(res);
            } else {
                reject();
            }
        }).fail(function () {
            reject();
        });
    });
};

module.exports = fetchUserInfo;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],466:[function(require,module,exports){
(function (global){
'use strict';

var get = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null).get;

var fetchPhotostream = function fetchPhotostream(user_id) {
    var page = arguments.length <= 1 || arguments[1] === undefined ? 1 : arguments[1];

    return new Promise(function (resolve) {
        get('/api/flickr/user_photostream', { user_id: user_id, page: page }).then(function (res) {
            // datares
            if (!res.data) {
                res = { data: [] };
            }

            resolve(res);
        }).fail(function () {
            // 
            // resolve
            resolve({ data: [] });
        });
    });
};

module.exports = fetchPhotostream;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],467:[function(require,module,exports){
(function (global){
'use strict';

var get = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null).get;

var searchPhotos = function searchPhotos() {
    var word = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];
    var page = arguments.length <= 1 || arguments[1] === undefined ? 1 : arguments[1];

    return new Promise(function (resolve) {
        get('/api/flickr/search', { word: word, page: page }).then(function (res) {
            // datares
            if (!res.data) {
                res = { data: [] };
            }

            resolve(res);
        }).fail(function () {
            // 
            // resolve
            resolve({ data: [] });
        });
    });
};

module.exports = searchPhotos;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],468:[function(require,module,exports){
(function (global){
'use strict';

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactDOM = (typeof window !== "undefined" ? window['ReactDOM'] : typeof global !== "undefined" ? global['ReactDOM'] : null);

var MainPanel = require('./components/MainPanel');
var SearchStore = require('./stores/SearchStore');
var PhotostreamStore = require('./stores/PhotostreamStore');
var PhotostreamActions = require('./actions/PhotostreamActions');

/**
 * Flickr
 */
var initFlickr = function initFlickr(_ref) {
    var container = _ref.container;
    var sidebar = _ref.sidebar;

    // Store
    SearchStore.init();
    PhotostreamStore.init();

    // MainPanel
    ReactDOM.render(React.createElement(MainPanel, null), container);

    // 
    var initialized = false;
    var loadPhotostream = function loadPhotostream() {
        var user = PhotostreamStore.getState().user;
        if (user && user.id) {
            PhotostreamActions.load(user.id, 1);
        }
        initialized = true;
    };

    // 
    var type = 'editor-flickr';
    if (sidebar.type === type) {
        loadPhotostream();
    }
    sidebar.on('tabChange', function (currentType) {
        if (initialized === false && currentType === type) {
            loadPhotostream();
        }
    });
};

module.exports = {
    init: initFlickr
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./actions/PhotostreamActions":453,"./components/MainPanel":457,"./stores/PhotostreamStore":471,"./stores/SearchStore":472}],469:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var _fetchUserInfo = require('../external_apis/fetchUserInfo');

/**
 * Model
 */

var Photo = (function () {
    function Photo(args) {
        _classCallCheck(this, Photo);

        this.key = args.farm + '-' + args.server + '-' + args.id;
        this.id = args.id;
        this.farm = args.farm;
        this.server = args.server;
        this.permalink = args.permalink;
        this.title = args.title;
        this.user_id = args.user_id;
        this.username = null;
        this.src = args.src;
        this.src_thumbnail = args.src_thumbnail;
        this.isSelected = false;
    }

    _createClass(Photo, [{
        key: 'fetchUserInfo',
        value: function fetchUserInfo() {
            var _this = this;

            // usernamefetchresolve
            if (this.username) {
                return Promise.resolve();
            }

            // usernamefetchPromise
            return new Promise(function (resolve, reject) {
                _fetchUserInfo(_this.user_id).then(function (res) {
                    _this.username = res.data.username._content;
                    resolve();
                })['catch'](function () {
                    reject();
                });
            });
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection() {
            this.isSelected = !this.isSelected;
        }
    }]);

    return Photo;
})();

module.exports = Photo;

},{"../external_apis/fetchUserInfo":465}],470:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Dispatcher = require('js/Base/Dispatcher');
var extractSyntax = require('js/Base/extractSyntax');
var EditorConnector = require('js/Base/EditorConnector');
var BUG = require('js/Base/Logger').BUG;

var Photo = require('../models/Photo');

var AbstractPhotoStore = (function (_Dispatcher$Store) {
    _inherits(AbstractPhotoStore, _Dispatcher$Store);

    function AbstractPhotoStore() {
        _classCallCheck(this, AbstractPhotoStore);

        _get(Object.getPrototypeOf(AbstractPhotoStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(AbstractPhotoStore, [{
        key: 'initState',
        value: function initState() {
            // AbstractPhotoStore
            // state
            this.state = {
                photos: [],
                isLoading: false,
                hasMore: false,
                page: 1,
                hasSelectedItems: false
            };

            this._photoKeys = {};
        }
    }, {
        key: 'getState',
        value: function getState() {
            this.state.hasSelectedItems = this.state.photos.some(function (photo) {
                return photo.isSelected;
            });
            return this.state;
        }
    }, {
        key: 'load',
        value: function load(photos) {
            this._add(photos);
        }
    }, {
        key: 'toggleSelection',
        value: function toggleSelection(photoKey) {
            var photo = this.state.photos.find(function (photo) {
                return photo.key === photoKey;
            });
            photo.toggleSelection();
        }
    }, {
        key: 'insertSelected',
        value: function insertSelected() {
            var photos = this.state.photos.filter(function (photo) {
                return photo.isSelected;
            });
            this._insert(photos);

            // clear selection
            photos.forEach(function (photo) {
                photo.isSelected = false;
            });
        }
    }, {
        key: 'insertDoubleClicked',
        value: function insertDoubleClicked(photoKey) {
            var photo = this.state.photos.find(function (photo) {
                return photo.key === photoKey;
            });
            this._insert([photo]);
        }

        // manage loading state
    }, {
        key: 'startLoading',
        value: function startLoading() {
            this.state.isLoading = true;
        }
    }, {
        key: 'finishLoading',
        value: function finishLoading(params) {
            if (params.data.length) {
                this.state.page++;
                this.state.hasMore = true;
            } else {
                this.state.hasMore = false;
            }

            this.state.isLoading = false;
        }

        // private
    }, {
        key: '_add',
        value: function _add(photos) {
            var _this = this;

            photos.forEach(function (rawPhoto) {
                var photo = new Photo(rawPhoto);

                // Flickr API
                // 
                // TODO: photostream
                if (_this._photoKeys[photo.key]) {
                    return;
                }
                _this._photoKeys[photo.key] = true;

                _this.state.photos.push(photo);
            });
        }
    }, {
        key: '_insert',
        value: function _insert(photos) {
            var lines = {
                hatena: [],
                markdown: [],
                html: []
            };

            // 
            photos.forEach(function (photo) {
                lines.hatena.push('[' + photo.permalink + ':embed]');
                lines.markdown.push('[' + photo.permalink + ':embed]');
            });

            // 
            // Promise
            return new Promise(function (resolve, reject) {
                extractSyntax(lines.hatena).done(function (data) {
                    lines.html = [data.html];
                    resolve();
                }).fail(function (error) {
                    lines.html = lines.hatena;
                    BUG(error);
                    reject();
                });
            }).then(function () {
                // Editor
                if (EditorConnector.isiOS() || EditorConnector.isAndroid()) {
                    lines.html = lines.hatena;
                }

                EditorConnector.insertLines(lines);
            });
        }
    }]);

    return AbstractPhotoStore;
})(Dispatcher.Store);

module.exports = AbstractPhotoStore;

},{"../models/Photo":469,"js/Base/Dispatcher":281,"js/Base/EditorConnector":283,"js/Base/Logger":293,"js/Base/extractSyntax":301}],471:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var actions = require('../Constants').actions;

var Dispatcher = require('js/Base/Dispatcher');
var configStorage = require('js/Editor/configStorage');

var configStorageKey = {
    tab: 'sidebar-flickr-tab',
    user: 'sidebar-flickr-user'
};

var AbstractPhotoStore = require('./AbstractPhotoStore');

var PhotostreamStore = (function (_AbstractPhotoStore) {
    _inherits(PhotostreamStore, _AbstractPhotoStore);

    function PhotostreamStore() {
        _classCallCheck(this, PhotostreamStore);

        _get(Object.getPrototypeOf(PhotostreamStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PhotostreamStore, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this.initState();
            this.restoreUser();

            Dispatcher.on(actions.PHOTOSTREAM.LOAD, function (photos) {
                _this.load(photos);
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.REGISTER_USER, function (params) {
                _this.registerUser(params);
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.UNREGISTER_USER, function () {
                _this.unregisterUser();
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.HIDE_WELCOME_MESSAGE, function () {
                _this.state.showWelcomeMessage = false;
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.START_LOADING, function () {
                _this.startLoading();
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.FINISH_LOADING, function (params) {
                _this.finishLoading(params);
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.TOGGLE_SELECTION, function (photoKey) {
                _this.toggleSelection(photoKey);
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.INSERT_SELECTED, function () {
                _this.insertSelected();
                _this.emit('change');
            });
            Dispatcher.on(actions.PHOTOSTREAM.INSERT_DOUBLE_CLICKED, function (photoKey) {
                _this.insertDoubleClicked(photoKey);
                _this.emit('change');
            });
        }

        // public
        // PhotostreamStore
        // public

        /**
         * localStorage
         * @public
         * @param {Object} params - user
         */
    }, {
        key: 'registerUser',
        value: function registerUser(params) {
            var user = params.data;

            this.state.user = {
                id: user.nsid,
                name: user.username._content,
                uri: user.photosurl._content,
                icon: this._iconUrl(user)
            };
            this.state.showWelcomeMessage = false;
            configStorage.save(configStorageKey.user, this.state.user);
        }

        /**
         * localStorage
         * @public
         */
    }, {
        key: 'unregisterUser',
        value: function unregisterUser() {
            this.initState();
            configStorage.save(configStorageKey.user, null);
        }

        /**
         * state
         * @public
         */
    }, {
        key: 'initState',
        value: function initState() {
            _get(Object.getPrototypeOf(PhotostreamStore.prototype), 'initState', this).call(this);

            this.state.user = null;
            this.state.showWelcomeMessage = true;
        }

        /**
         * localStorage
         * @public
         */
    }, {
        key: 'restoreUser',
        value: function restoreUser() {
            var user = configStorage.load(configStorageKey.user);
            if (user && user.id) {
                this.state.showWelcomeMessage = false;
                this.state.user = configStorage.load(configStorageKey.user);
            }
        }

        /**
         * localStorage
         * @private
         * @param {string} iconFarm - APIiconfarm
         * @param {string} iconServer - APIiconserver
         * @param {string} nsid -
         */
    }, {
        key: '_iconUrl',
        value: function _iconUrl(_ref) {
            var iconfarm = _ref.iconfarm;
            var iconserver = _ref.iconserver;
            var nsid = _ref.nsid;

            // iconserver0
            // https://www.flickr.com/services/api/misc.buddyicons.html
            return iconserver > 0 ? 'https://farm' + iconfarm + '.staticflickr.com/' + iconserver + '/buddyicons/' + nsid + '.jpg' : 'https://www.flickr.com/images/buddyicon.gif';
        }
    }]);

    return PhotostreamStore;
})(AbstractPhotoStore);

module.exports = new PhotostreamStore();

},{"../Constants":452,"./AbstractPhotoStore":470,"js/Base/Dispatcher":281,"js/Editor/configStorage":559}],472:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x2, _x3, _x4) { var _again = true; _function: while (_again) { var object = _x2, property = _x3, receiver = _x4; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x2 = parent; _x3 = property; _x4 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var actions = require('../Constants').actions;

var Dispatcher = require('js/Base/Dispatcher');

var AbstractPhotoStore = require('./AbstractPhotoStore');

var SearchStore = (function (_AbstractPhotoStore) {
    _inherits(SearchStore, _AbstractPhotoStore);

    function SearchStore() {
        _classCallCheck(this, SearchStore);

        _get(Object.getPrototypeOf(SearchStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(SearchStore, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this.initState();
            this.state.showWelcomeMessage = true;

            Dispatcher.on(actions.SEARCH.INIT_WITH_WORD, function (word) {
                _this.initState(word);
                _this.emit('change');
            });
            Dispatcher.on(actions.SEARCH.LOAD, function (photos) {
                _this.load(photos);
                _this.emit('change');
            });
            Dispatcher.on(actions.SEARCH.START_LOADING, function () {
                _this.startLoading();
                _this.emit('change');
            });
            Dispatcher.on(actions.SEARCH.FINISH_LOADING, function (params) {
                _this.finishLoading(params);
                _this.emit('change');
            });
            Dispatcher.on(actions.SEARCH.TOGGLE_SELECTION, function (photoKey) {
                _this.toggleSelection(photoKey);
                _this.emit('change');
            });
            Dispatcher.on(actions.SEARCH.INSERT_SELECTED, function () {
                _this.insertSelected();
                _this.emit('change');
            });
            Dispatcher.on(actions.SEARCH.INSERT_DOUBLE_CLICKED, function (photoKey) {
                _this.insertDoubleClicked(photoKey);
                _this.emit('change');
            });
        }

        /**
         * state
         * @public
         * @param {string} word - 
         */
    }, {
        key: 'initState',
        value: function initState() {
            var word = arguments.length <= 0 || arguments[0] === undefined ? '' : arguments[0];

            _get(Object.getPrototypeOf(SearchStore.prototype), 'initState', this).call(this);

            this.state.word = word;
            this.state.showWelcomeMessage = false;
        }
    }]);

    return SearchStore;
})(AbstractPhotoStore);

module.exports = new SearchStore();

},{"../Constants":452,"./AbstractPhotoStore":470,"js/Base/Dispatcher":281}],473:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Dropdown = require('../Dropdown');

/**
 * Dropdown
 */

var DropdownAbove = (function (_Dropdown) {
    _inherits(DropdownAbove, _Dropdown);

    function DropdownAbove() {
        _classCallCheck(this, DropdownAbove);

        _get(Object.getPrototypeOf(DropdownAbove.prototype), 'constructor', this).apply(this, arguments);
    }

    /**
     * 
     * 
     */

    _createClass(DropdownAbove, [{
        key: 'setPosition',
        value: function setPosition() {
            var rect = this.$element[0].getBoundingClientRect();
            var offset = this.$window.height();
            this.$window.css({
                top: rect.top - offset,
                left: rect.left
            });
        }
    }]);

    return DropdownAbove;
})(Dropdown);

var Footer = (function () {
    function Footer(editor) {
        var _this = this;

        _classCallCheck(this, Footer);

        this.editor = editor;

        this.$element = $('.l-editor-footer');
        this.$selector = this.$element.find('.editor-save-buttons-selector a');
        this.$dropdown = this.$element.find('.editor-save-buttons-dropdown');
        this.$dropdownButtons = this.$dropdown.find('a');
        this.$saveButtons = this.$element.find('.editor-save-buttons');
        this.$scheduledButton = this.$element.find('.editor-save-buttons-scheduled');

        this.saveMode = this.$element.data('saveMode');
        this.isScheduled = false;
        this.isOpen = false;

        this.dropdown = new DropdownAbove(this.$selector, this.$dropdown);
        this.$dropdown.on('click', 'a', function (e) {
            _this.saveMode = $(e.currentTarget).data('saveMode');
            _this.isOpen = false;
            _this.render();
            _this.focusOnSelector();
        });
        this.$selector.on('click', function () {
            _this.isOpen = !_this.isOpen;
            _this.render();
            _this.focusOnSelector();
        });
        this.editor.on('toggleScheduledEntry', function (isScheduled) {
            _this.isScheduled = isScheduled;
            _this.isOpen = false;
            _this.render();
        });

        this.render();
    }

    _createClass(Footer, [{
        key: 'render',
        value: function render() {
            // 
            this.$saveButtons.find('input').addClass('is-hidden');
            this.$saveButtons.find('.editor-save-button-' + this.saveMode).removeClass('is-hidden');

            // 
            this.$selector.toggle(!this.isScheduled);
            this.$saveButtons.toggle(!this.isScheduled);
            this.$scheduledButton.toggle(this.isScheduled);
        }
    }, {
        key: 'focusOnSelector',
        value: function focusOnSelector() {
            // 
            var $focusedButton = this.$dropdownButtons.filter('[data-save-mode=' + this.saveMode + ']');
            this.$dropdownButtons.removeClass('is-selected');
            $focusedButton.addClass('is-selected');

            // focus
            if (this.isOpen) {
                $focusedButton.focus();
            } else {
                this.$selector.focus();
            }
        }
    }]);

    return Footer;
})();

module.exports = Footer;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Dropdown":548}],474:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var LOG = require('js/Base/Logger').LOG;
var trackEvent = require('js/Base/EventTracker').trackEvent;

var EventEmitter = require('events').EventEmitter;

var UploadForm = require('./UploadForm');
var Item = require('./Item');

/** Fotolife
 * - 
 * - 
 *
 * 
 * - formcontrollerFotolife/UploadForm.js
 * - modelUploader.js
 */
var Fotolife = function Fotolife() {
    this.init.apply(this, arguments);

    // 
    // Fotolife
    // TODO: documentEditor
    var self = this;
    $(document).on('uploadDroppedFiles', function (e, files) {
        return self.uploadForm.uploadFiles(files);
    });
};

Fotolife.prototype = {

    defaultFolder: 'Hatena Blog',

    type: 'editor-fotolife',

    init: function init(args) {
        this.$element = args.container;
        this.eventEmitter = new EventEmitter();

        this.editor = args.editor;
        this.syntax = $('#syntax').val();
        this.sidebar = args.sidebar;

        this._setupElements();
        this._setupEvents();

        this._setupUploadForm();

        this.resize();
        this.load(this.defaultFolder, 1);
    },

    _setupUploadForm: function _setupUploadForm() {
        this.uploadForm = new UploadForm(this.$uploadForm, this);
    },

    _setupElements: function _setupElements() {
        this.$items = this.$element.find('#items');
        this.$pasteButton = this.$element.find('.paste-button');
        this.$footerButtons = this.$element.find('#footer-buttons');
        this.$uploadForm = this.$element.find('#uploader');
        this.$uploadFormWrapper = this.$element.find('#uploader-wrapper');
    },

    _setupEvents: function _setupEvents() {
        var _this = this;

        var self = this;

        // 
        self.$items.on('click', '.item', function (e) {
            $(this).toggleClass('selected');

            if (self.$items.find('.selected').length) {
                self.$pasteButton.removeClass('disabled').addClass('enable');
            } else {
                self.$pasteButton.removeClass('enable').addClass('disabled');
            }
        });
        self.$items.on('dblclick', '.item', function (e) {
            $(this).removeClass('selected');

            var attr = self.syntax == 'html' ? 'data-html' : 'data-syntax';
            var syntax = $(this).attr(attr);

            trackEvent(self.$pasteButton.attr('data-track-name'));

            self.editor.insert(syntax);
        });

        // 
        self.$pasteButton.addClass('disabled').on('click', function () {
            var syntax = self.$items.find('.item.selected').map(function () {
                if (self.syntax == 'html') {
                    return $(this).removeClass('selected').attr('data-html');
                } else {
                    return $(this).removeClass('selected').attr('data-syntax');
                }
            }).get().reverse().join("");

            self.editor.insert(syntax);
        });

        // item
        self.on('success', function (data) {
            self.editor.insert(self.syntax === 'html' ? data.html : data.syntax);
        });

        // UploadForm
        this.on('upload', this.addUploadingItem.bind(this));
        this.on('changeFolder', function (folderName) {
            self.load(folderName, 1);
        });

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);

        this.on('resize', function () {
            return _this.resize();
        });
    },

    /**
     * UploaderItem
     * @param {Uploader} uploader
     */
    addUploadingItem: function addUploadingItem(uploader) {
        var item = new Item({
            parent: this,
            syntax: '',
            html: '',
            image: '/images/loading.gif'
        });
        item.listenTo(uploader);

        uploader.setParams({
            'fotosize': this.uploadForm.fotoSize(),
            'delete-gps': 1
        });

        this.$items.prepend(item.$element);
    },

    /**
     * fotolife
     *
     * @param {string} folder - 
     * @param {number} page   -  1
     */
    load: function load(folder, page) {
        var self = this;

        LOG(['load', folder, page]);

        $.ajax({
            url: '/api/support/fotolife',
            type: "get",
            cache: false,
            dataType: 'json',
            data: {
                folder: folder,
                page: page
            }
        }).done(function (res) {
            LOG(res);
            if (res.error) {
                return;
            }

            // Item
            var container = self.$items;
            if (page === 1) {
                container.empty();
            }

            for (var i = 0, it; it = res.items[i]; i++) {
                var item = new Item(it);
                container.append(item.$element);
            }

            // 
            if (res.last) {
                return;
            }
            $('<div class="item pager-next"/>').on('click', function () {
                $(this).remove();
                self.load(folder, page + 1);
                return false;
            }).appendTo(container);
        });
    },

    /**
     * 
     */
    resize: function resize() {
        var mainHeight = $(window).height() - $('#editor-main').offset().top;
        this.$items.height(mainHeight - this.$uploadFormWrapper.outerHeight(true) - this.$footerButtons.outerHeight(true) - (this.$items.outerHeight(true) - this.$items.height()) * 2);
    },

    on: function on() {
        this.eventEmitter.on.apply(this.eventEmitter, arguments);
    },

    emit: function emit() {
        this.eventEmitter.emit.apply(this.eventEmitter, arguments);
    }

};

module.exports = Fotolife;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Item":475,"./UploadForm":476,"events":207,"js/Base/EventTracker":284,"js/Base/Logger":293}],475:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');

/**
 * 
 * isUploading2
 * - 
 * - 
 */
var Item = function Item() {
    this.init.apply(this, arguments);
};
Item.prototype = {
    uploadingTemplate: _.template('<div class="progress">' + '  <div class="percent"><%- percent %></div>' + '  <div class="bar" style="width: <%- width %>"></div>' + '</div>'),

    init: function init(opts) {
        this.parent = opts.parent;

        this.syntax = opts.syntax.replace(/:image/, ':plain');
        this.html = opts.html;
        this.image = opts.image;

        this.isUploading = false;
        this.progress = 0;
        this.barWidth = 0;

        // public
        this.$element = $('<div class="item"/>');
        this.render();
    },

    render: function render() {
        this.$element.attr({
            'data-syntax': this.syntax,
            'data-html': this.html,
            'style': 'background-image: url(\'' + this.image + '\');'
        });
        this.$element.children().remove();

        if (this.isUploading) {
            var $uploading = $(this.uploadingTemplate({
                percent: this.percent,
                width: this.barWidth
            }));
            this.$element.append($uploading);
            this.$element.addClass('is-uploading');
        } else {
            this.$element.removeClass('is-uploading');
        }
    },

    /**
     * uploader
     * uploader11
     * - progress   { percent: 0100 }
     * - disk_full 
     * - success    { html, syntax }
     * - error     
     */
    listenTo: function listenTo(uploader) {
        var self = this;
        self.isUploading = true;

        var lastProgressTimer,
            lastProgress = 0;

        var updateProgress = function updateProgress(progress) {
            if (progress > 100) {
                progress = 100;
            }
            self.barWidth = progress + '%';
            self.percent = Locale.text('uploading');
            self.render();
        };

        uploader.on('error', function (e) {
            console.log('upload error');
            clearInterval(lastProgressTimer);
            self.$element.remove();
            self.parent.emit('error', e);
        });

        uploader.on('disk_full', function (e) {
            clearInterval(lastProgressTimer);
            self.$element.remove();
            self.parent.emit('disk_full', e);
        });

        uploader.on('progress', function (e) {
            // success  100% 
            var progress = e.percent * 0.9;
            if (e.percent === 100) {
                clearInterval(lastProgressTimer);
                lastProgressTimer = setInterval(function () {
                    lastProgress += 0.1;
                    updateProgress(progress + lastProgress);
                }, 100);
            } else {
                updateProgress(progress);
            }
        });

        uploader.on('success', function (data) {
            clearInterval(lastProgressTimer);

            self.isUploading = false;
            if (data.image) {
                self.image = data.image;
            }
            if (data.html) {
                self.html = data.html;
            }
            if (data.syntax) {
                self.syntax = data.syntax;
            }
            self.render();

            self.parent.emit('success', data);
        });
    }

};

module.exports = Item;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561,"underscore":213}],476:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Messenger = require('js/Messenger');
var Locale = require('js/Locale');
var globalData = require('js/Base/globalData');
var Logger = require('js/Base/Logger');
var Browser = require('js/Base/Browser');
var trackEvent = require('js/Base/EventTracker').trackEvent;

var extractFotolifeSyntax = require('js/Base/extractFotolifeSyntax');

var Uploader = require('../../Uploader');

var isFileSupported = function isFileSupported() {
    // IE10  input type="file" 
    // 
    // #3336
    if (Browser.isIE) {
        return false;
    }
    return !!$('<input type="file" />')[0].files && typeof FormData != 'undefined';
};

/**
 * Fotolifecontroller
 * IEiframe
 * fotolife
 */
var FotolifeUploadForm = function FotolifeUploadForm() {
    this.init.apply(this, arguments);
};
FotolifeUploadForm.prototype = {
    /**
     * @param {jQuery}   $element - form
     * @param {Fotolife} parent   - Fotolife
     */
    init: function init($element, parent) {
        this.$element = $element;
        this.parent = parent;

        this.messenger = Messenger.createForCurrentWindow();

        if (isFileSupported()) {
            this.initUploader();
        } else {
            this.initIframeUploader();
        }

        this.initEvents();
    },

    initEvents: function initEvents() {
        // 
        this.parent.on('success', this.loadInfo.bind(this));

        this.parent.on('error', this.showUploadErrorAlert.bind(this));
        this.parent.on('disk_full', this.showDiskFullAlert.bind(this));
    },

    initUploader: function initUploader() {
        var self = this;

        var $uploadForm = self.$element.find(".fotolife-upload-form");
        $uploadForm.show();

        var $input = self.$element.find('input.file');
        $input.on('change', function () {
            self.uploadFiles([].slice.call(this.files));
        });

        $('#items').on('drop', function (e) {
            var files = [].slice.call(e.originalEvent.dataTransfer.files);
            self.uploadFiles(files);
            return false;
        }).on("dragenter dragover", function () {
            return false;
        });

        this.loadInfo();
    },

    /**
     * File APIiframe
     * iframeload
     */
    initIframeUploader: function initIframeUploader() {
        var self = this;

        var $iframe = $('<iframe frameborder="0" style="border: none;"/>').prependTo(self.$element);
        var src = "/api/upload/fotolife/" + self.messenger.key;

        $iframe.attr('src', src);
        $iframe.css({
            width: 250,
            height: 90
        });
        $iframe.on('load', function () {
            var iframeDocument;
            if ($iframe[0].contentDocument) {
                iframeDocument = $iframe[0].contentDocument;
            } else if ($iframe[0].contentWindow) {
                iframeDocument = $iframe[0].contentWindow.document;
            } else {
                return;
            }

            self.document = iframeDocument;

            if (iframeDocument.body.innerHTML.match(/^\s*(f:id:\S+)/)) {
                self.emitIframe('success', RegExp.$1);
                $iframe[0].contentWindow.location.replace(src);
            } else if (iframeDocument.body.innerHTML.match(/disk full/)) {
                self.emitIframe('disk_full', null);
                self.emitIframe('error', null);
                $iframe[0].contentWindow.location.replace(src);
            } else {
                self.loadInfo();
            }
        });

        // iframeuploader
        var dummyUploader;
        this.onIframe('progress', function () {
            if (!dummyUploader) {
                dummyUploader = new Uploader();
                self.parent.emit('upload', dummyUploader);
            }
            dummyUploader.emit('progress', { percent: 100 });
        });
        this.onIframe('success', function (result) {
            extractFotolifeSyntax(result).done(function (data) {
                dummyUploader.emit('success', data);
            }).fail(function (e) {
                Logger.BUG(e);
            }).always(function () {
                dummyUploader = null;
            });
        });
        this.onIframe('disk_full', function (result) {
            dummyUploader.emit('disk_full', result);
        });
        this.onIframe('error', function (result) {
            dummyUploader.emit('error', result);
        });
    },

    /**
     * Iframeform
     */
    onIframe: function onIframe(eventName, handler) {
        this.messenger.addEventListener('EditorUploadIframe', function (data) {
            if (data.eventName !== eventName) {
                return;
            }
            Logger.LOG(['onUploadIframe', data.eventName, data.result]);
            handler(data.result);
        });
    },
    emitIframe: function emitIframe(eventName, result) {
        this.messenger.send('EditorUploadIframe', {
            eventName: eventName,
            result: result
        });
    },

    /**
     * Uploader
     * @param {File} file - File
     * @return {$.Promise}
     */
    uploadFile: function uploadFile(file) {
        var self = this;

        var folder = $('.js-folder-selector', self.document).val();

        var uploader = new Uploader();
        self.parent.emit('upload', uploader);
        return uploader.upload(file, folder);
    },

    /**
     * 
     * @param {Array<File>} files
     * @return {$.Promise}
     */
    uploadFiles: function uploadFiles(files) {
        var self = this;

        var promise = files.reduce(function (f1, f2) {
            return f1.then(function () {
                return self.uploadFile(f2);
            });
        }, $.Deferred().resolve(true));

        return promise.fail(function () {}); // Item
    },

    /**
     * Fotolife
     *  
     */
    loadInfo: function loadInfo() {
        var self = this;

        $.ajax({
            url: "/f/" + globalData('name') + "/api/info?mode=detail",
            type: "get",
            cache: false,
            dataType: 'json'
        }).done(function (res) {
            if (res.error) {
                return;
            }

            self.info = res;

            self.updateFolderList(res.folder_list, res.is_private);
            self.setFotoSizeForIframeUploader();
            self.renderDiskSizeGraph(+res.disksize, +res.maxdisksize);
            self.parent.emit('resize');
        });
    },

    /**
      * iframe
      * - uploader.documentiframe
      * - iframeDOM
      * - loadInfo
      */
    setFotoSizeForIframeUploader: function setFotoSizeForIframeUploader() {
        var self = this;

        if (!self.document) {
            return;
        }
        if (!self.info) {
            return;
        }

        var $sizeInput = $('.js-fotosize', self.document);
        $sizeInput.val(self.fotoSize());
    },

    /**
      * 
      * 1024px
      * 1024
      *
      * @returns {Number}
      */
    fotoSize: function fotoSize() {
        var minSize = Uploader.DEFAULT_SIZE;
        if (this.info && this.info.fotosize > minSize) {
            return this.info.fotosize;
        } else {
            return minSize;
        }
    },

    /**
     * select
     */
    updateFolderList: function updateFolderList(folder_list, is_private) {
        var self = this;

        folder_list.push({ status: 'private', folder: 'Hatena Blog' });
        folder_list.push({ status: is_private ? 'private' : 'public', folder: '' });

        var folderMap = {};
        var folderList = [];
        for (var i = 0, it; it = folder_list[i]; i++) {
            folderMap[it.folder] = it;
            folderList.push(it.folder);
        }

        folderList.sort();

        var select = $('.js-folder-selector', self.document).empty();

        for (var i = 0; i < folderList.length; i++) {
            if (folderList[i] === folderList[i - 1]) continue;
            var it = folderMap[folderList[i]];

            // 
            var folderLabel = it.folder || Locale.text('fotolife.folder.top');
            if (is_private || it.status == 'private') {
                folderLabel += '(private)';
            }

            // option
            var option = $('<option/>').attr('value', it.folder).text(folderLabel).appendTo(select);

            if (it.folder == 'Hatena Blog') {
                option.prop('selected', true);
            }
        }

        select.off('change');
        select.on('change', function () {
            self.parent.emit('changeFolder', $(this).val());
        });

        select.parent().show();
    },

    /**
     * Fotolife
     * @param {number} size    - 
     * @param {number} maxsize - 
     */
    renderDiskSizeGraph: function renderDiskSizeGraph(size, maxsize) {
        var self = this;
        var $container = self.$element.find('.js-disksize-container');
        var $box = $container.find('.js-box');
        var $bar = $container.find('.js-bar');
        var $rate = $container.find('.js-rate');

        var rate = size / maxsize;
        var rate_string = Math.floor(rate * 100) + '%';

        $rate.text(rate_string);

        $bar.css('width', rate_string);

        var label = $box.attr('data-label') + rate_string;
        $box.attr('original-title', label);

        $container.show();
    },

    /**
     * Fotolifealert
     */
    showDiskFullAlert: function showDiskFullAlert() {
        var $container = this.$element.find('.js-disksize-container');
        $container.find('.js-disk-full-alert').show();
        this.parent.emit('resize');
        trackEvent('fotolife.full_alert.show');
    },

    /**
     * alert
     */
    showUploadErrorAlert: function showUploadErrorAlert(e) {
        var $container = this.$element.find('.js-disksize-container');
        if (e.name === 'TypeError') {
            $container.find('.js-upload-type-alert').show();
        } else {
            $container.find('.js-upload-type-alert').show();
        }
        this.parent.emit('resize');
        trackEvent('fotolife.upload_error.show');
    }

};

module.exports = FotolifeUploadForm;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../Uploader":558,"js/Base/Browser":278,"js/Base/EventTracker":284,"js/Base/Logger":293,"js/Base/extractFotolifeSyntax":300,"js/Base/globalData":302,"js/Locale":561,"js/Messenger":562,"underscore":213}],477:[function(require,module,exports){
module.exports = require('./Fotolife');

},{"./Fotolife":474}],478:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');
var GistUserManager = require('./GistUserManager');

// Gist
var Gist = function Gist() {
    this.init.apply(this, arguments);
};
Gist.prototype = {
    parent: MyCuration,
    serviceName: 'Gist',
    enableAutoPager: true,
    pasteReverseOrder: true,
    init: function init(args) {
        var _this = this;

        this.type = 'editor-gist';

        this.editor = args.editor;
        this.parent.prototype.init.call(this, args);

        this.userManager = new GistUserManager({
            container: this.$container
        });

        $(this.userManager).on('registered', function () {
            _this.resetUser();
            _this.requestLoadItems();
        });

        $(this.userManager).on('unregistered', function () {
            _this.resetUser();
        });
    },
    loadItems: function loadItems(more) {
        var self = this;

        var dfd = $.Deferred();

        if (!(self.userManager && self.userManager.getUser())) {
            dfd.reject();
            return dfd;
        }

        var user = self.userManager.getUser();

        if (more) {
            user.forward();
        }

        user.load().done(function (gists) {
            dfd.resolve({
                entries: gists
            });
        }).fail(function (msg) {
            dfd.reject(msg);
            self.itemsReachedEnd = true;
        });

        return dfd;
    },
    showItems: function showItems(items) {
        var self = this;
        var source = '';

        _.each(items, function (item) {

            var description_short;
            if (item.description) {
                description_short = item.description.length > 50 ? item.description.substr(0, 50) + " ..." : item.description;
            } else {
                description_short = '';
            }

            var language = _.values(item.files)[0].language;

            source += self.template({
                item: item,
                description: description_short ? description_short : "gist" + item.id,
                language: language ? language : "Unknown"
            });
        });
        self.$indicator.before(source);
        Locale.updateTimestamps(self.$container[0]);
        $(self).triggerHandler('items-appended');
    },
    insertItems: function insertItems(items) {
        var self = this;
        var lines = [];
        var mode = self.editor.mode;

        _.each(items, function ($item) {
            var description = $item.data('description');
            // embedMarkdown, embed
            // [http://gist/:embed#foo `bar`] -> [http://gist/:embed#foo \`bar\`]
            if (mode === 'markdown') {
                description = self.escape_markdown_chars(description);
            }

            var escaped_description = self.escape_text_for_description(description);
            var html_url = $item.data('html-url');

            lines.push('[' + html_url + ':embed#' + escaped_description + ']');

            if (mode === 'html') {
                lines.push('<a href="' + html_url + '">' + escaped_description + '</a>');
            } else if (mode == 'hatena') {
                lines.push('[' + html_url + ':title=' + escaped_description + ']');
            } else {
                lines.push('[' + escaped_description + '](' + html_url + ')');
            }
        });

        self.editor.insertLines(lines);
    },
    escape_text_for_description: function escape_text_for_description(text) {
        text = text.replace(/[\n\[\]]/g, "");
        return _.escape(text);
    },
    escape_markdown_chars: function escape_markdown_chars(text) {
        return text.replace(/[\\_\*`]/g, "\\$&");
    },
    resetUser: function resetUser() {
        var self = this;

        self.itemsReachedEnd = false;
        self.removeItems();

        if (self.userManager && self.userManager.getUser()) {
            self.userManager.getUser().rewind();
        }
    }
};

extend(Gist.prototype, MyCuration.prototype);

module.exports = Gist;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./GistUserManager":481,"./MyCuration":494,"js/Locale":561,"js/Util/extend":574,"underscore":213}],479:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// gist
var GistUser = function GistUser() {
    this.init.apply(this, arguments);
};
GistUser.prototype = {
    init: function init(name) {
        this.name = name;
        this.page = 1;
        this._exists = false;
    },
    getName: function getName() {
        return this.name;
    },
    getImage: function getImage() {
        return this.info.avatar_url;
    },
    load: function load() {

        var self = this;
        var dfd = $.Deferred();

        var data = {
            page: self.page,
            per_page: 20
        };

        $.ajax({
            url: 'https://api.github.com/users/' + self.name + '/gists',
            data: data,
            type: 'GET',
            dataType: 'jsonp',
            jsonp: 'callback'
        }).done(function (res) {
            // API
            if (res && res.data.message && res.data.message !== 'Not Found') {
                dfd.reject('api');
            } else if (res && res.data.length > 0) {
                // ()
                self.info = res.data[0].owner;
                self._exists = true;
                dfd.resolve(res.data);
            } else {
                // 
                // (Gist.loadItems())
                dfd.reject('not found');
            }
        }).fail(function (res) {
            dfd.reject('ajax');
        });

        return dfd;
    },
    forward: function forward() {
        this.page++;
    },
    rewind: function rewind() {
        this.page = 1;
    },
    exists: function exists() {
        return this._exists;
    }
};

module.exports = GistUser;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],480:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var GistUser = require('./GistUser');

// User
var GistUserLoader = function GistUserLoader() {
    this.init.apply(this, arguments);
};
GistUserLoader.prototype = {
    init: function init(args) {
        var self = this;

        self.users = {};
    },
    loadUser: function loadUser(name) {
        var self = this;

        var dfd = $.Deferred();

        if (!self.users[name]) {
            self.users[name] = new GistUser(name);
        }

        self.users[name].load().done(function () {
            dfd.resolve(self.users[name]);
        }).fail(function (msg) {
            dfd.reject(msg);
        });

        return dfd;
    }
};

module.exports = GistUserLoader;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./GistUser":479}],481:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var keyString = require('js/keyString');
var configStorage = require('../configStorage');
var GistUserLoader = require('./GistUserLoader');

// UserLoaderUserUI
var GistUserManager = function GistUserManager() {
    this.init.apply(this, arguments);
};
GistUserManager.prototype = {
    init: function init(args) {
        var self = this;

        self.$container = args.container;

        self.$input = self.$container.find('.gist-user-name');
        self.$registerButton = self.$container.find('.register-button');
        self.$unregisterButton = self.$container.find('.unregister-button');

        self.$userImage = self.$container.find('.user-image');
        self.$name = self.$container.find('.user-name');
        self.$nameLink = self.$container.find('.user-name-link');
        self.$userNotFound = self.$container.find('.user-not-found-error');
        self.$apiLimit = self.$container.find('.api-limit-error');
        self.$ajaxError = self.$container.find('.ajax-error');

        self.userLoader = new GistUserLoader();

        self.bindEvents();

        // 
        self.$input.val(self.loadUserName());
        self.tryRegisterFromInput();
    },
    bindEvents: function bindEvents() {
        var self = this;

        self.$registerButton.on('click', function () {
            self.tryRegisterFromInput();
            return false;
        });

        self.$input.on('keydown', function (event) {
            if (keyString(event) === 'RET') {
                self.tryRegisterFromInput();
                return false;
            }
        });

        self.$unregisterButton.on('click', function () {
            self.unregister();
            return false;
        });
    },
    // input
    tryRegisterFromInput: function tryRegisterFromInput() {
        var self = this;

        var user_name = self.$input.val();
        if (!user_name) return;
        self.tryRegister(user_name);
    },
    // validUser
    getUser: function getUser() {
        var self = this;

        return self.currentUser;
    },
    // 
    tryRegister: function tryRegister(user_name) {
        var self = this;

        // loadUseruser.exists
        self.userLoader.loadUser(user_name).done(function (user) {
            self.onUserFound(user);
        }).fail(function (msg) {
            self.unregister();
            if (msg === 'api') {
                self.$apiLimit.show();
            } else if (msg === 'ajax') {
                self.$ajaxError.show();
            } else {
                self.$userNotFound.show();
            }
        });
    },
    // registerview
    onUserFound: function onUserFound(user) {
        var self = this;

        self.currentUser = user;
        self.setUserImage(user.getImage());
        self.$name.text(user.getName());
        self.$nameLink.attr('href', 'http://gist.github.com/' + user.getName());
        self.$userNotFound.hide();
        self.$apiLimit.hide();
        self.$ajaxError.hide();
        self.$container.addClass('registered');
        self.saveUserName(user.getName());
        $(self).trigger('registered');
        $(window).resize(); // header
    },
    // 
    // view
    unregister: function unregister() {
        var self = this;

        $(self).trigger('unregistered');

        self.currentUser = null;
        self.$input.focus();

        self.setUserImage(self.DEFAULT_UESR_IMAGE);
        self.$userNotFound.hide();
        self.$apiLimit.hide();
        self.$ajaxError.hide();
        self.saveUserName('');
        self.$container.removeClass('registered');
        $(window).resize(); // header
    },
    setUserImage: function setUserImage(url) {
        var self = this;

        self.$userImage.attr('src', url);
    },
    saveUserName: function saveUserName(name) {
        configStorage.save('gist-user-name', name);
    },
    loadUserName: function loadUserName() {
        return configStorage.load('gist-user-name') || '';
    }
};

module.exports = GistUserManager;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../configStorage":559,"./GistUserLoader":480,"js/keyString":599}],482:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var LOG = require('js/Base/Logger').LOG;
var globalData = require('js/Base/globalData');
var Location = require('js/Base/Location');

// window.gapi JS
// google  loadApi 
var gapi = (typeof window !== "undefined" ? window['gapi'] : typeof global !== "undefined" ? global['gapi'] : null);

// Costants
var DEVELOPER_KEY = 'AIzaSyBT5jC9eFqTXg7df8nRpVEd-oRuOm5nfHA';
var CLIENT_ID = '900568370540-qrvm1v1gtndg5krpn3mgjvfm28rontj0.apps.googleusercontent.com';
var SCOPE = ['https://www.googleapis.com/auth/photos'];

/**
 * GooglePicker
 *
 * GooglePickerEditor
 * GoogleYoutubeGooglePicker
 * picker
 */
var GooglePicker = {
    editor: undefined,

    google: undefined, // loadApiundefined
    oauthToken: undefined,

    // picker
    types: {
        GOOGLE: 'GOOGLE',
        YOUTUBE: 'YOUTUBE'
    },

    /**
     * GoogleYoutube
     * View
     * @public
     * @param {Editor} editor
     */
    setup: function setup(editor) {
        GooglePicker.editor = editor;

        // google picker api
        $('#editor-google-picker').on('show', function () {
            return GooglePicker.initApi();
        });
        $('#editor-youtube').on('show', function () {
            return GooglePicker.initApi();
        });

        // Picker
        // initApiAPI
        $('#launch-google-picker button').on('click', function () {
            GooglePicker.initApi().then(function () {
                GooglePicker.showPicker(GooglePicker.types.GOOGLE);
            });
        });

        // Youtube
        $('#launch-youtube button').on('click', function () {
            GooglePicker.initApi().then(function () {
                GooglePicker.showPicker(GooglePicker.types.YOUTUBE);
            });
        });
    },

    /**
     * loadApi, authApiPromise
     * Promise
     */
    _initApi: null,
    initApi: function initApi() {
        if (!GooglePicker._initApi) {
            GooglePicker._initApi = GooglePicker.loadApi().then(function () {
                return GooglePicker.authApi();
            }); // auth
        }
        return GooglePicker._initApi;
    },

    // googlePickerApigooglePickerApi
    // oauthpicker
    loadApi: function loadApi() {
        var d = new $.Deferred();

        // 
        if (GooglePicker.google) {
            d.resolve();
        } else {
            gapi.load('picker', { 'callback': function callback() {
                    GooglePicker.google = window.google;
                    d.resolve();
                } });
        }

        return d.promise();
    },

    // googlePickeroAuth
    authApi: function authApi() {
        var d = new $.Deferred();

        // 
        if (GooglePicker.oauthToken) {
            d.resolve();
        } else {
            gapi.load('auth', { 'callback': d.resolve });
        }

        return d.promise();
    },

    // 
    authUser: function authUser() {
        var d = new $.Deferred();

        // 
        if (GooglePicker.oauthToken) {
            d.resolve(GooglePicker.oauthToken, DEVELOPER_KEY);
        } else {
            gapi.auth.authorize({
                'client_id': CLIENT_ID,
                'scope': SCOPE,
                'immediate': false
            }, function (authResult) {
                if (authResult && !authResult.error) {
                    GooglePicker.oauthToken = authResult.access_token;
                    d.resolve(GooglePicker.oauthToken, DEVELOPER_KEY);
                }
            });
        }

        return d.promise();
    },

    createGoogleBuilder: function createGoogleBuilder() {
        var google = GooglePicker.google;
        return new google.picker.PickerBuilder().enableFeature(google.picker.Feature.MULTISELECT_ENABLED).addView(google.picker.ViewId.PHOTOS).addView(new google.picker.PhotosView().setType('camerasync')).addView(google.picker.ViewId.PHOTO_UPLOAD).setLocale('ja').setOAuthToken(GooglePicker.oauthToken).setDeveloperKey(DEVELOPER_KEY);
    },

    createYoutubeBuilder: function createYoutubeBuilder() {
        var google = GooglePicker.google;

        // Youtube
        var youtubeView = new google.picker.VideoSearchView();
        youtubeView.setSite(google.picker.VideoSearchView.YOUTUBE);

        return new google.picker.PickerBuilder().enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setLocale('ja').addView(youtubeView);
    },

    // builderpromise
    createBuilder: function createBuilder(type) {
        if (type === GooglePicker.types.GOOGLE) {
            return GooglePicker.authUser().then(function () {
                return GooglePicker.createGoogleBuilder();
            });
        }
        if (type === GooglePicker.types.YOUTUBE) {
            return GooglePicker.loadApi().then(function () {
                return GooglePicker.createYoutubeBuilder();
            });
        }
    },

    // pickerpickercallback
    showPicker: function showPicker(type) {
        GooglePicker.createBuilder(type).then(function (builder) {
            builder.setCallback(function (res) {
                GooglePicker.insertToEditor(res);
            });
            builder.setOrigin(Location.param('editinplace') ? globalData('blogs-uri-base') : globalData('admin-domain'));

            var picker = builder.build();
            picker.setVisible(true);
        });
    },

    // actiongoogle
    isActionPicked: function isActionPicked(action) {
        return action === GooglePicker.google.picker.Action.PICKED;
    },

    // PickerEditor
    insertToEditor: function insertToEditor(res) {
        LOG(['insertToEditor', res]);
        if (!GooglePicker.isActionPicked(res.action)) {
            return;
        }

        var editor = GooglePicker.editor;

        var lines = [];
        for (var i = 0, len = res.docs.length; i < len; i++) {
            var doc = res.docs[i];
            lines.push(GooglePicker.docToString(doc));
        }
        // IE9Google Picker
        // internet explore
        //  (tinymce.focus()doc.selection.createRange())
        // bodyfocus
        if (navigator.userAgent.indexOf('MSIE') >= 0 && $('#syntax').val() === 'html') {
            $('body').trigger('focus');
        }
        editor.insertLines(lines);
    },

    // PickerHTML
    docToString: function docToString(doc) {
        var $div = $('<div/>');
        if (doc.type === 'video') {
            // embedURL
            // doc.url  : https://www.youtube.com/watch?v=***
            // embedUrl : https://www.youtube.com/embed/***
            var videoId = doc.url.match(/v=(.*)$/)[1];
            var embedUrl = '//www.youtube.com/embed/' + videoId;

            $div.append($('<iframe width="420" height="315" frameborder="0" allowfullscreen></iframe>').attr('src', embedUrl), $('<br/>'), $('<a/>').attr('href', doc.url).text(doc.name));
        } else if (doc.type === 'photo') {
            var url = doc.thumbnails[doc.thumbnails.length - 1].url;

            var img = $('<img/>').addClass('magnifiable').attr({ src: this.magnifyImage(url), itemprop: 'image' });
            var span = $('<span/>').attr({ itemtype: 'http://schema.org/Photograph', itemscope: 'itemscope' });
            $div.append(span.append(img));
        } else if (doc.embedUrl) {
            $div.append($('<iframe width="425" height="350" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>').attr('src', doc.embedUrl), $('<br/>'), $('<a/>').attr('href', doc.url).text(doc.name));
        } else {
            var $thumbnail, $icon, $link;

            var thumbnailUrl = doc.thumbnails && doc.thumbnails[doc.thumbnails.length - 1].url;
            if (thumbnailUrl) {
                if (doc.url) {
                    $thumbnail = $('<a/>').attr('href', doc.url).append($thumbnail);
                } else {
                    $thumbnail = $('<img/>').attr({ src: thumbnailUrl, alt: doc.name || '' });
                }
            } else if (doc.iconUrl) {
                $icon = $('<img/>').attr({ src: doc.iconUrl, alt: '' });
            }

            if (doc.name && doc.url) {
                $link = $('<a/>').attr('href', doc.url).text(doc.name);
            }

            if ($thumbnail) {
                $div.append($thumbnail);
            }
            if ($thumbnail && $link) {
                $div.append($('<br/>'));
            }
            if ($icon) {
                $div.append($icon);
            }
            if ($link) {
                $div.append($link);
            }
        }
        return $div.html();
    },

    /**
     * 
     * /s1024/ 1024px
     */
    magnifyImage: function magnifyImage(uri) {

        if (uri.match(/\/s\d+(\-.)?\/[^\/+]+$/)) {
            // URIs+
            // /s400/  /s1024/
            // /s400-d/  /s1024/
            // /s400-c/  /s1024/
            uri = uri.replace(/\/s\d+(\-.)?\//, '/s1024/');
        } else {
            // /s1024/aaa.jpg
            var fragments = uri.split(/\//);
            fragments.splice(fragments.length - 1, 0, 's1024');
            uri = fragments.join('/');
        }

        return uri;
    }
};

// export
module.exports = GooglePicker;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Location":292,"js/Base/Logger":293,"js/Base/globalData":302}],483:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var keyString = require('js/keyString');
var EditorConnector = require('js/Base/EditorConnector');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');
var GourmetSearcher = require('./GourmetSearcher');

// 
var Gourmet = function Gourmet() {
    this.init.apply(this, arguments);
};
Gourmet.prototype = {
    parent: MyCuration,
    serviceName: 'Gourmet',
    enableAutoPager: true,
    init: function init(args) {
        var _this = this;

        this.type = 'editor-gourmet';
        this.$container = args.container;
        var $searchInput = args.container.find('.gourmet-keyword');
        var $searchPref = args.container.find('.gourmet-pref');
        var $searchSubmit = args.container.find('.gourmet-keyword-submit');

        // localStoragerestore
        this.prefLocalStorageKey = 'MyCuration.Gourmet.Pref';
        try {
            if (localStorage[this.prefLocalStorageKey]) {
                var selector = 'option[value=' + localStorage[this.prefLocalStorageKey] + ']';
                $searchPref.find(selector).first().prop('selected', true);
            }
        } catch (ignore) {}

        // localStorage
        $searchPref.on('change', function () {
            try {
                localStorage[_this.prefLocalStorageKey] = $searchPref.val();
            } catch (ignore) {}
        });

        this.gourmetSearcher = new GourmetSearcher({
            searchInput: $searchInput,
            searchPref: $searchPref,
            type: 'gnavi' // 
        });
        this.updateProvidorStatus();

        $searchSubmit.on('click', function () {
            _this.requestReload();
        });
        $searchInput.on('keydown', function (e) {
            if (keyString(e) === 'RET') {
                _this.requestReload();
                return false;
            }
            return true;
        });

        $searchInput.focus(function () {
            _this.$container.find('.gourmet-description').hide();
        });

        this.setupFormatSwitcher(); // 
        this.setupProvidorSwitcher(); // /

        this.parent.prototype.init.call(this, args);
    },
    loadItems: function loadItems(is_more) {
        var self = this;

        var dfd = $.Deferred();

        if (is_more) {
            self.gourmetSearcher.forward();
        } else {
            self.gourmetSearcher.reset();
            self.itemsReachedEnd = false;
        }

        self.gourmetSearcher.load().done(function (data) {
            dfd.resolve(data);
        }).fail(function () {
            dfd.reject();
        }).always(function () {
            self.itemsReachedEnd = !self.gourmetSearcher.has_next;
        });

        return dfd;
    },
    insertItems: function insertItems(items) {
        var self = this;

        var lines = [];
        var suffix = self.$container.find('[name="gourmet-format"]:checked').val();
        _.each(items, function ($item) {
            var syntax = $item.attr('data-syntax');
            syntax = syntax.replace(/\]$/, ":" + suffix + "]");
            // tabeloggnaviprovidor
            var providor = self.$container.find('[name="gourmet-providor"]:checked').val();
            syntax = syntax.replace(/^\[.+?:/, "[" + providor + ":");
            lines.push(syntax);
        });

        EditorConnector.insertLines({
            hatena: lines,
            markdown: lines,
            html: lines
        });
    },
    setupFormatSwitcher: function setupFormatSwitcher() {
        var self = this;
        var $formatsContainer = self.$container.find('.gourmet-formats');
        $formatsContainer.on('change', function (e) {
            var $input = $(e.target);
            $formatsContainer.find('label.selected').removeClass('selected');
            $input.closest('label').addClass('selected');
        });
    },
    setupProvidorSwitcher: function setupProvidorSwitcher() {
        var self = this;
        var $providorsContainer = self.$container.find('.gourmet-providors');
        $providorsContainer.on('change', function (e) {
            var $input = $(e.target);
            $providorsContainer.find('label.selected').removeClass('selected');
            $input.closest('label').addClass('selected');

            // providorreload
            self.updateProvidorStatus();
        });
    },
    updateProvidorStatus: function updateProvidorStatus() {
        var self = this;
        var providor = self.$container.find('[name="gourmet-providor"]:checked').val();

        if (providor !== self.gourmetSearcher.type) {
            self.gourmetSearcher.type = providor;
            self.requestReload();
        }
    },
    loadItemsFinishedHandler: function loadItemsFinishedHandler() {
        var self = this;
        // 
        if (self.gourmetSearcher.$searchInput.val() && self.getItemsOnPage().length === 0) {
            self.$container.find('.no-result').show();
        }
    },
    requestReload: function requestReload() {
        var self = this;
        self.$container.find('.no-result').hide();
        self.parent.prototype.requestReload.call(self);
    }
};

extend(Gourmet.prototype, MyCuration.prototype);

module.exports = Gourmet;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./GourmetSearcher":484,"./MyCuration":494,"js/Base/EditorConnector":283,"js/Util/extend":574,"js/keyString":599,"underscore":213}],484:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

// Gourmet
// load()  forward()  load() 
// resetword
var GourmetSearcher = function GourmetSearcher() {
    this.init.apply(this, arguments);
};
GourmetSearcher.prototype = {
    init: function init(args) {
        var self = this;
        self.$searchInput = args.searchInput;
        self.$searchPref = args.searchPref;
        self.type = args.type || 'gnavi';
        self.reset();
    },

    load: function load() {
        var self = this;
        var dfd = $.Deferred();

        var searchKeyword = self.searchKeyword;

        if (!searchKeyword) {
            dfd.reject();
            return dfd;
        }

        // API
        $.ajax({
            url: "/api/gourmet/search",
            type: "GET",
            data: {
                word: searchKeyword,
                pref: self.searchPref,
                page: self.page,
                type: self.type
            },
            dataType: "json"
        }).done(function (data) {
            if (data.entries.length === 0) {
                // 
                self.has_next = false;
            }
            dfd.resolve(data);
        }).fail(function () {
            // 
            self.has_next = false;
            dfd.reject();
        });

        return dfd;
    },
    forward: function forward() {
        var self = this;
        self.page++;
    },
    reset: function reset() {
        var self = this;
        self.page = 1;
        self.has_next = true; // false
        self.resetSearchParameters();
    },
    resetSearchParameters: function resetSearchParameters() {
        var self = this;
        self.searchKeyword = self.$searchInput.val();
        self.searchPref = self.$searchPref.val();
    }
};

module.exports = GourmetSearcher;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],485:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var trackEvent = require('js/Base/EventTracker').trackEvent;
var Locale = require('js/Locale');
var EditorConnector = require('js/Base/EditorConnector');
var extractSyntax = require('js/Base/extractSyntax');

/**
 * : 
 */
var HatenaBookmark = function HatenaBookmark() {
    this.init.apply(this, arguments);
};
HatenaBookmark.prototype = {
    // args: { container }
    init: function init(args) {
        this.type = 'editor-hatena-bookmark';

        this.$container = args.container;
        if (!this.$container.get(0)) {
            return;
        }
        this.$header = this.$container.find('.header');
        this.$itemsContainer = this.$container.find('.items');
        this.$indicator = this.$container.find('.indicator');
        this.template = _.template(this.$container.find('.template').html());
        this.$errorMessage = this.$container.find('.error-message');
        this.$disabledMessage = this.$container.find('.disabled-message');
        this.$footer = this.$container.find('.footer');
        this.$pasteButton = this.$container.find('.paste-button');

        this.sidebar = args.sidebar;

        this.loadedPage = 0;

        this.bindEvents();
        this.resize();

        this.loadItems(1);
    },
    bindEvents: function bindEvents() {
        var _this = this;

        var self = this;

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
            _this.loadItems(1);
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);

        self.$itemsContainer.on('click', '.item', function (event) {
            if ($(event.target).is('a')) return;
            if ($(event.target).parents('a').length > 0) return;
            $(this).toggleClass('selected');

            self.selectedItemsChanged();
            return false;
        });

        self.$container.on('dblclick', '.item', function (event) {
            if ($(event.target).is('a')) return;
            if ($(event.target).parents('a').length > 0) return;
            self.insertItems([$(this)]);
            $(this).removeClass('selected');
            self.selectedItemsChanged();
            trackEvent(self.$pasteButton.attr('data-track-name'));
            return false;
        });

        self.$pasteButton.click(function (event) {
            var items = [];
            self.selectedItems().each(function () {
                items.push($(this));
                $(this).removeClass('selected');
            });
            self.insertItems(items.reverse());
            self.selectedItemsChanged();
        });

        // 
        // twitter
        self.$itemsContainer.scroll(_.throttle(function () {
            var rate = (self.$itemsContainer.scrollTop() + self.$itemsContainer.height()) / self.$itemsContainer[0].scrollHeight;
            if (rate > 0.7) {
                // 
                self.loadItems(self.loadedPage + 1);
            }
        }, 100));
    },

    resize: function resize() {
        var self = this;

        var mainHeight = $(window).height() - $('#editor-main').offset().top;
        self.$itemsContainer.height(mainHeight - self.$header.outerHeight(true) - self.$footer.outerHeight(true));
    },

    selectedItemsChanged: function selectedItemsChanged() {
        var self = this;

        if (self.selectedItems().length > 0) {
            self.$pasteButton.removeClass('disabled').addClass('enabled').prop('disabled', false);
        } else {
            self.$pasteButton.removeClass('enabled').addClass('disabled').prop('disabled', true);
        }
    },

    selectedItems: function selectedItems() {
        var self = this;

        return self.$itemsContainer.find('.selected');
    },

    loadItems: function loadItems(page) {
        var self = this;

        if (self.isLoading) return;
        if (!self.$container.is(':visible')) return;

        if (page > 10) return; // 
        if (self.failed) return; // 

        if (self.loadedPage > page) return;

        self.isLoading = true;
        self.$indicator.show();
        self.$errorMessage.hide();

        $.ajax({
            url: '/api/hatena_bookmark/bookmarks?page=' + page,
            type: 'GET',
            dataType: 'json'
        }).done(function (items) {
            self.$errorMessage.hide();
            if (page === 1 && items.length === 0) {
                self.showDisabledMessage();
                return;
            }

            self.showItems(items);
        }).fail(function (res) {
            self.$errorMessage.show();
            self.failed = true;
        }).always(function () {
            self.$indicator.hide();
            self.isLoading = false;
        });

        self.loadedPage = page;
    },

    showDisabledMessage: function showDisabledMessage() {
        // 
        var self = this;
        self.$disabledMessage.show();
        self.$itemsContainer.hide();
        self.$footer.hide();
        self.failed = true;
    },

    showItems: function showItems(items) {
        var self = this;

        var source = '';
        _.each(items, function (item) {
            source += self.template({
                item: item
            });
        });
        self.$indicator.before(source);
        Locale.updateTimestamps(self.$container[0]);
    },

    insertItems: function insertItems(items) {
        var lines = [];
        _.each(items, function ($item) {
            var url = $item.attr('data-comment-url');
            var permalink = $item.attr('data-permalink');
            var description = $item.attr('data-description');

            // blockquotescript
            // API
            // :embed:cite
            if (description && description.length > 0) {
                lines.push('[' + url + ':embed]');
            } else {
                lines.push('[' + permalink + ':embed:cite]');
            }
        });

        var syntaxes = {
            html: lines,
            hatena: lines,
            markdown: lines
        };

        // 
        if ($('#syntax').val() === 'html') {
            extractSyntax(lines.join("\n")).done(function (data) {
                // 
                syntaxes.html = ['', data.html, ''];
            }).always(function () {
                EditorConnector.insertLines(syntaxes);
            });
        } else {
            EditorConnector.insertLines(syntaxes);
        }
    }
};

module.exports = HatenaBookmark;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EditorConnector":283,"js/Base/EventTracker":284,"js/Base/extractSyntax":301,"js/Locale":561,"underscore":213}],486:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

/**
 * 
 * /
 */
var Home = function Home() {
    this.init.apply(this, arguments);
};
Home.prototype = {

    init: function init(args) {
        this.type = 'editor-home';

        this.$element = args.container;
        this.sidebar = args.sidebar;

        this.$header = this.$element.find('.header');
        this.$services = this.$element.find('.services');

        this.setupButtons();
        this.setupButtonActive();

        this.bindEvents();
    },

    bindEvents: function bindEvents() {
        var _this = this;

        var self = this;
        this.$element.on('click', '.select-service', function () {
            self.sidebar.emit('openByType', $(this).attr('data-support-type'));
            return false; // 
        });

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);
    },

    resize: function resize() {
        this.$services.height(this.$element.height() - this.$header.outerHeight(true));
    },

    // 
    setupButtons: function setupButtons() {
        var self = this;
        this.$element.on('change', 'input', function (event) {
            var $input = $(this);
            var $service = $input.closest('.service');
            var service_id = $service.attr('data-service-id');

            var show = $input.prop('checked') ? 1 : 0;

            $.ajax({
                url: 'edit_sidebar_button',
                type: 'POST',
                data: {
                    service_id: service_id,
                    show: show,
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                }
            }).done(function (res) {
                self.sidebar.emit('reloadSidebarButtons', res);
            });
        });
    },

    // 
    setupButtonActive: function setupButtonActive() {
        this.$element.on('mouseenter', '.about', function () {
            $(this).find('.curation-itemlist').addClass('is-active');
        }).on('mouseleave', '.about', function () {
            $(this).find('.curation-itemlist').removeClass('is-active');
        });
    }
};

module.exports = Home;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],487:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _ = require('underscore');
var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var PADDING = 100;
var INTERVAL = 300;

var STYLE = {
    outer: {
        position: 'absolute',
        top: 0,
        left: 0,
        width: '100%',
        height: '100%',
        margin: 0,
        padding: 0,
        overflowY: 'auto'
    },
    inner: {
        width: '100%'
    }
};

/**
 * 
 * 
 *  position: relative 
 */

var InfiniteScroll = (function (_React$Component) {
    _inherits(InfiniteScroll, _React$Component);

    function InfiniteScroll() {
        _classCallCheck(this, InfiniteScroll);

        _get(Object.getPrototypeOf(InfiniteScroll.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(InfiniteScroll, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            var _this = this;

            this._interval = Number.isFinite(this.props.interval) ? +this.props.interval : INTERVAL;
            this._padding = Number.isFinite(this.props.padding) ? +this.props.padding : PADDING;
            this._pos = 0;

            this._onScroll = _.throttle(function (e) {
                return _this.onScroll(e);
            }, this._interval);
            this.refs.outer.addEventListener('scroll', this._onScroll);
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            this.refs.outer.removeEventListener('scroll', this._onScroll);
            this._onScroll = null; // 
            this._pos = 0;
        }
    }, {
        key: 'onScroll',
        value: function onScroll(e) {
            if (this.props.disabled) {
                return;
            }

            var target = e.target;

            // 
            var lastPos = this._pos;
            this._pos = target.scrollTop;
            if (this._pos - lastPos <= 0) {
                return;
            }

            // padding
            var remaining = target.scrollHeight - (target.clientHeight + target.scrollTop);
            if (this._padding <= remaining) {
                return;
            }

            this.props.onScroll();
        }
    }, {
        key: 'render',
        value: function render() {
            return React.createElement(
                'div',
                { className: 'InfiniteScroll', ref: 'outer',
                    style: STYLE.outer,
                    onScroll: this._onScroll },
                React.createElement(
                    'div',
                    { className: 'InfiniteScroll__Inner', style: STYLE.inner },
                    this.props.children
                )
            );
        }
    }]);

    return InfiniteScroll;
})(React.Component);

InfiniteScroll.propTypes = {
    children: React.PropTypes.node,
    disabled: React.PropTypes.bool,
    padding: React.PropTypes.number,
    interval: React.PropTypes.number,
    onScroll: React.PropTypes.func.isRequired
};

module.exports = InfiniteScroll;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],488:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var extractSyntax = require('js/Base/extractSyntax');
var BUG = require('js/Base/Logger').BUG;
var EditorConnector = require('js/Base/EditorConnector');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');

var Instagram = function Instagram() {
    this.init.apply(this, arguments);
};
Instagram.prototype = {
    parent: MyCuration,
    init: function init(args) {
        var _this = this;

        this.type = 'editor-instagram';

        this.parent.prototype.init.call(this, args);

        $(this).on('items-appended', function () {
            _this.setPaddingLeft();
        });

        this.resize();
    },
    serviceName: 'Instagram',
    enableAutoPager: true,
    pasteReverseOrder: true,
    loadItems: function loadItems(more) {
        var self = this;

        var data = {};

        if (more) {
            var $lastItem = self.$itemsContainer.find('.item:last');
            data.max_id = $lastItem.attr('data-next-max-id');
        }

        return $.ajax({
            url: '/api/instagram/recent',
            data: data,
            type: 'GET',
            dataType: 'json'
        }).fail(function () {
            self.pleaseReAuthorize();
        }).done(function (res) {
            if (res && res.data) {
                res.entries = res.data;
                // data-max-id
                _.each(res.entries, function (entry) {
                    entry.next_max_id = res.next_max_id;
                });
            }

            // next_max_id(autopager)
            if (!res.next_max_id) {
                self.itemsReachedEnd = true;
            }

            return res;
        });
    },
    pleaseReAuthorize: function pleaseReAuthorize() {
        var self = this;
        self.$container.find('.disabled-box').show();
    },
    insertItems: function insertItems(items) {
        var self = this;

        var lines = {
            hatena: [],
            markdown: []
        };
        _.each(items, function ($item) {
            var item = {
                permalink: $item.attr('data-permalink'),
                caption: $item.attr('data-caption'),
                type: $item.attr('data-type')
            };

            var media_url = item.permalink + 'media/?size=l';

            // iframe(:embediframe)a>img
            if (item.type === 'video') {
                lines.hatena.push('[' + item.permalink + ':embed]');
                lines.markdown.push('[' + item.permalink + ':embed]');
            } else {
                lines.hatena.push('[' + item.permalink + ':image=' + media_url + ']');
                lines.markdown.push('[![](' + media_url + ')](' + item.permalink + ')');
            }

            // captioncaption
            // captionmarkdown
            if (item.caption) {
                var caption = item.caption.replace(/\r?\n/g, '');
                lines.hatena.push('[' + item.permalink + ':title=' + caption + ']');
                lines.markdown.push('[' + caption + '](' + item.permalink + ')');
            } else {
                lines.hatena.push('[' + item.permalink + ':title]');
                lines.markdown.push('[' + item.permalink + ':title]');
            }
        });

        extractSyntax(lines.hatena).done(function (data) {
            lines.html = [data.html];
        }).fail(function (error) {
            lines.html = lines.hatena;
            BUG(error);
        }).always(function () {
            EditorConnector.insertLines(lines);
        });
    },
    setPaddingLeft: function setPaddingLeft() {
        var self = this;

        // items
        // itemspaddingLeft
        //
        // |----|               |----|  padding
        // |-------------------------|  .itemsContainer
        //      |---| |---| |---|       .item
        //      ^itemsLeft
        //                      ^itemsRight
        //
        // padding = itemsContainer - (itemsRight - itemsLeft) / 2

        var $itemsContainer = self.$container.find('.items');
        var $items = $itemsContainer.find('.item');
        var $firstItem = $($items[0]);
        var firstItemTop = $firstItem.position().top;
        var itemsLeft = $firstItem.position().left;
        var itemsRight = itemsLeft + $firstItem.outerWidth();
        $items.each(function () {
            var $this = $(this);
            if ($this.position().top !== firstItemTop) return false;
            itemsRight = $this.position().left + $this.outerWidth();
        });

        var itemsWidthTotal = itemsRight - itemsLeft;
        var padding = ($itemsContainer.width() - itemsWidthTotal) / 2;

        $itemsContainer.css({
            'padding-left': padding + 'px'
        });
    }
};

extend(Instagram.prototype, MyCuration.prototype);

module.exports = Instagram;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MyCuration":494,"js/Base/EditorConnector":283,"js/Base/Logger":293,"js/Base/extractSyntax":301,"js/Util/extend":574,"underscore":213}],489:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var keyString = require('js/keyString');
var BUG = require('js/Base/Logger').BUG;
var extractSyntax = require('js/Base/extractSyntax');
var EditorConnector = require('js/Base/EditorConnector');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');

/**
 * Itunes
 */
var Itunes = function Itunes() {
    this.init.apply(this, arguments);
};
Itunes.prototype = {
    parent: MyCuration,

    init: function init(args) {
        this.type = 'editor-itunes';

        this.parent.prototype.init.call(this, args);
        this._templatesByType = {
            'default': _.template(this.$container.find('.template').html()),
            'artist': _.template(this.$container.find('.template-artist').html()),
            'collection': _.template(this.$container.find('.template-collection').html()),
            'audiobook': _.template(this.$container.find('.template-collection').html())
        };
    },
    bindEvents: function bindEvents() {
        var self = this;

        self.parent.prototype.bindEvents.call(self);

        self.$submit = self.$container.find('.itunes-keyword-submit');
        self.$media = self.$container.find('.itunes-media');
        self.$keyword = self.$container.find('.itunes-keyword');
        self.$welcomeMessage = self.$container.find('.items-welcome');

        self.$submit.click(function (event) {
            self.requestReload();
            return false;
        });

        self.$media.change(function (event) {
            self.requestReload();
            return false;
        });

        self.$keyword.keydown(function (event) {
            if (keyString(event) == 'RET') {
                self.requestReload();
                return false;
            }
        });
    },
    serviceName: 'Itunes',
    enableAutoPager: false,
    pasteReverseOrder: false,
    willRequestLoadItems: function willRequestLoadItems(more) {
        var self = this;
        return self.$keyword.val() !== '';
    },
    loadItems: function loadItems(more) {
        var self = this;

        self.$welcomeMessage.addClass('disable');

        var term = self.$keyword.val();
        var queries = self.$media.val().split(':');
        var media = queries[0];
        var entity = queries[1];

        var data = {
            term: term,
            media: media,
            entity: entity
        };

        return $.ajax({
            url: '/api/itunes/search',
            data: data,
            type: 'GET',
            dataType: 'json'
        });
    },
    renderItem: function renderItem(item) {
        var self = this;

        var type = item.wrapperType || 'default';
        var template = self._templateByType(type);

        // 
        item._formattedPrice = '';
        if (item.formattedPrice !== undefined) {
            item._formattedPrice = item.formattedPrice;
        } else if (item.trackPrice !== undefined || item.collectionPrice !== undefined) {
            var amount = item.trackPrice || item.collectionPrice;
            var currency = item.currency;
            if (amount < 0) {
                //  -1 
            } else if (currency === 'JPY') {
                    item._formattedPrice = '' + amount;
                } else {
                    item._formattedPrice = currency + ' ' + amount;
                }
        }

        // 
        item._genre = '';
        if (item.genres !== undefined && _.isArray(item.genres) && item.genres.length > 0) {
            item._genre = item.genres[0];
        } else if (item.primaryGenreName !== undefined) {
            item._genre = item.primaryGenreName;
        }

        return template({
            item: item
        });
    },
    _templateByType: function _templateByType(type) {
        var self = this;
        return self._templatesByType[type] || self._templatesByType['default'];
    },
    insertItems: function insertItems(items) {
        var self = this;

        var lines = {
            hatena: [],
            markdown: []
        };
        _.each(items, function ($item) {
            var item = {
                permalink: $item.attr('data-permalink')
            };

            lines.hatena.push('[' + item.permalink + ':embed]');
            lines.markdown.push('[' + item.permalink + ':embed]');
        });

        extractSyntax(lines.hatena).done(function (data) {
            lines.html = ['', data.html, ''];
        }).fail(function (error) {
            lines.html = lines.hatena;
            BUG(error);
        }).always(function () {
            if (EditorConnector.isiOS() || EditorConnector.isAndroid()) {
                // 
                lines.html = lines.hatena;
            }
            EditorConnector.insertLines(lines);
        });
    }
};

extend(Itunes.prototype, MyCuration.prototype);

module.exports = Itunes;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MyCuration":494,"js/Base/EditorConnector":283,"js/Base/Logger":293,"js/Base/extractSyntax":301,"js/Util/extend":574,"js/keyString":599,"underscore":213}],490:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');
var MiilUserManager = require('./MiilUserManager');

var Miil = function Miil() {
    this.init.apply(this, arguments);
};
Miil.prototype = {
    parent: MyCuration,
    serviceName: 'Miil',
    enableAutoPager: true,
    pasteReverseOrder: true,
    init: function init(args) {
        var _this = this;

        this.type = 'editor-miil';

        this.editor = args.editor;
        this.parent.prototype.init.call(this, args);

        this.userManager = new MiilUserManager({
            container: this.$container
        });

        $(this.userManager).on('registered', function () {
            _this.resetUser();
            _this.requestLoadItems();
        });

        $(this.userManager).on('unregistered', function () {
            _this.resetUser();
        });
    },
    loadItems: function loadItems(is_more) {
        var self = this;

        var dfd = $.Deferred();

        if (!(self.userManager && self.userManager.getUser())) {
            dfd.reject();
            return dfd;
        }

        var user = self.userManager.getUser();

        if (is_more) {
            user.forward();
        }
        user.load().done(function (data) {
            var photos = data.photos;
            _.each(photos, function (photo) {
                photo.thumbnail_url = photo.url + '=s72';
            });

            dfd.resolve({
                entries: photos
            });
        }).fail(function () {
            dfd.reject();
            self.itemsReachedEnd = true;
        });

        return dfd;
    },
    insertItems: function insertItems(items) {
        var self = this;

        var lines = [];

        _.each(items, function ($item) {
            if ($('#syntax').val() === 'html') {
                lines.push(self.editorTemplate({
                    item: {
                        permalink_url: $item.attr('data-permalink'),
                        image_url: $item.attr('data-image-url'),
                        title: $item.attr('data-title')
                    }
                }));
            } else {
                lines.push('[' + $item.attr('data-permalink') + ':image=' + $item.attr('data-image-url') + ']');
                if ($item.attr('data-title')) {
                    lines.push($item.attr('data-title'));
                }
            }
        });
        self.editor.insertLines(lines);
    },
    resetUser: function resetUser() {
        var self = this;

        self.itemsReachedEnd = false;
        self.removeItems();

        if (self.userManager && self.userManager.getUser()) {
            self.userManager.getUser().rewind();
        }
    }
};

extend(Miil.prototype, MyCuration.prototype);

module.exports = Miil;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MiilUserManager":493,"./MyCuration":494,"js/Util/extend":574,"underscore":213}],491:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var LazyList = require('js/Base/LazyList');

// miil
// photos
// Hatena.Diary.LazyList
// load()  forward()  load() 
// rewind()  forward() 
// rewindPhotosCursor()
var User = function User() {
    this.init.apply(this, arguments);
};
User.prototype = {
    init: function init(name) {
        var self = this;

        self.name = name;

        // photos_loader
        self.photos_loader_root = new LazyList(_.bind(self._photosLoaderBody, self));

        // 
        self.photos_loader = self.photos_loader_root;
    },
    getName: function getName() {
        var self = this;

        return self.name;
    },
    // URL
    getImage: function getImage() {
        var self = this;

        return self.basicData.photos[0].user.user_icon_url;
    },

    // 
    load: function load() {
        var self = this;

        return self.photos_loader.promise();
    },
    // loader load
    forward: function forward() {
        var self = this;
        self.photos_loader = self.photos_loader.next();
    },
    // loader
    rewind: function rewind() {
        var self = this;
        self.photos_loader = self.photos_loader_root;
    },
    // miil
    exists: function exists() {
        var self = this;

        return self.photos_loader_root.promise().state() === "resolved";
    },
    _photosURL: function _photosURL(data) {
        var self = this;

        return 'http://api.miil.me/api/users/' + self.name + '/photos/public.json?' + $.param(data);
    },
    _getNextPageFromReceivedData: function _getNextPageFromReceivedData(data) {
        if (!data) return;
        if (!data.next_url) return;

        var match = data.next_url.match(/page=(\d+)/);
        if (!match) return;
        return match[1];
    },
    // APIURL
    _photosLoaderBody: function _photosLoaderBody(prev) {
        var self = this;

        // resolve
        var photos_loaded = $.Deferred();

        // GETURLresolve
        var page_determined = $.Deferred();

        // 
        if (prev) {
            prev.promise().done(function (data) {
                var next_page = self._getNextPageFromReceivedData(data);
                if (!next_page) {
                    page_determined.reject();
                }
                page_determined.resolve(next_page);
            }).fail(function () {
                page_determined.reject();
            });
        } else {
            // next_page
            page_determined.resolve();
        }

        page_determined.done(function (next_page) {
            var data = {};

            if (next_page) {
                data.page = next_page;
            }

            $.ajax({
                url: '/api/external/json',
                data: {
                    url: self._photosURL(data)
                },
                type: 'GET',
                dataType: 'json'
            }).done(function (data) {
                if (data && data.photos && data.photos.length > 0) {
                    if (!self.basicData) {
                        // 
                        self.basicData = data;
                    }
                    photos_loaded.resolve(data);
                } else {
                    // 
                    photos_loaded.reject();
                }
            }).fail(function (res) {
                photos_loaded.reject();
            });
        }).fail(function () {
            photos_loaded.reject();
        });

        return photos_loaded;
    }
};

module.exports = User;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/LazyList":291,"underscore":213}],492:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var MiilUser = require('./MiilUser');

// User
var MiilUserLoader = function MiilUserLoader() {
    this.init.apply(this, arguments);
};
MiilUserLoader.prototype = {
    init: function init(args) {
        var self = this;

        self.users = {};
    },
    loadUser: function loadUser(name) {
        var self = this;

        var dfd = $.Deferred();

        if (!self.users[name]) {
            self.users[name] = new MiilUser(name);
        }

        self.users[name].load().always(function () {
            dfd.resolve(self.users[name]);
        });

        return dfd;
    }
};

module.exports = MiilUserLoader;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MiilUser":491}],493:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var keyString = require('js/keyString');
var configStorage = require('../configStorage');
var MiilUserLoader = require('./MiilUserLoader');

// UserLoaderUserUI
var MiilUserManager = function MiilUserManager() {
    this.init.apply(this, arguments);
};
MiilUserManager.prototype = {
    init: function init(args) {
        var self = this;

        self.$container = args.container;

        self.$input = self.$container.find('.miil-user-name');
        self.$registerButton = self.$container.find('.register-button');
        self.$unregisterButton = self.$container.find('.unregister-button');

        self.$userImage = self.$container.find('.user-image');
        self.$name = self.$container.find('.user-name');
        self.$nameLink = self.$container.find('.user-name-link');
        self.$userNotFound = self.$container.find('.user-not-found-error');

        self.userLoader = new MiilUserLoader();

        self.bindEvents();

        // 
        self.$input.val(self.loadUserName());
        self.tryRegisterFromInput();
    },
    bindEvents: function bindEvents() {
        var self = this;

        self.$registerButton.on('click', function () {
            self.tryRegisterFromInput();
            return false;
        });

        self.$input.on('keydown', function (event) {
            if (keyString(event) === 'RET') {
                self.tryRegisterFromInput();
                return false;
            }
        });

        self.$unregisterButton.on('click', function () {
            self.unregister();
            return false;
        });
    },
    // input
    tryRegisterFromInput: function tryRegisterFromInput() {
        var self = this;

        var user_name = self.$input.val();
        if (!user_name) return;
        self.tryRegister(user_name);
    },
    // validUser
    getUser: function getUser() {
        var self = this;

        return self.currentUser;
    },
    // 
    tryRegister: function tryRegister(user_name) {
        var self = this;

        self.userLoader.loadUser(user_name).done(function (user) {
            if (user.exists()) {
                self.onUserFound(user);
            } else {
                self.unregister();
                self.$userNotFound.show();
            }
        });
    },
    // registerview
    onUserFound: function onUserFound(user) {
        var self = this;

        self.currentUser = user;
        self.setUserImage(user.getImage() || self.DEFAULT_UESR_IMAGE);
        self.$name.text(user.getName());
        self.$nameLink.attr('href', 'http://miil.me/u/' + user.getName());
        self.$userNotFound.hide();
        self.$container.addClass('registered');
        self.saveUserName(user.getName());
        $(self).trigger('registered');
        $(window).resize(); // header
    },
    // 
    // view
    unregister: function unregister() {
        var self = this;

        $(self).trigger('unregistered');

        self.currentUser = null;
        self.$input.focus();

        self.setUserImage(self.DEFAULT_UESR_IMAGE);
        self.$userNotFound.hide();
        self.saveUserName('');
        self.$container.removeClass('registered');
        $(window).resize(); // header
    },
    setUserImage: function setUserImage(url) {
        var self = this;

        self.$userImage.attr('src', url);
    },
    saveUserName: function saveUserName(name) {
        configStorage.save('miil-user-name', name);
    },
    loadUserName: function loadUserName() {
        return configStorage.load('miil-user-name') || '';
    },
    DEFAULT_UESR_IMAGE: 'http://assets.miil.me/images/pc/user.jpg'
};

module.exports = MiilUserManager;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../configStorage":559,"./MiilUserLoader":492,"js/keyString":599}],494:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var trackEvent = require('js/Base/EventTracker').trackEvent;
var MyCurationTab = require('./MyCurationTab');

// 
// extend
var MyCuration = function MyCuration() {
    this.init.apply(this, arguments);
};
MyCuration.prototype = Object.defineProperties({

    // args: { container }
    init: function init(args) {
        var self = this;

        self.editor = args.editor;
        self.sidebar = args.sidebar;

        self.$container = args.container;
        if (!self.$container.get(0)) return;
        self.$header = self.$container.find('.header');
        self.$itemsContainer = self.$container.find('.items');
        self.$tabsContainer = self.$container.find('.tab-container');
        self.$indicator = self.$container.find('.indicator');
        self.$errorMessage = self.$container.find('.error-message');
        self.$disabledMessage = self.$container.find('.disabled-message');
        self.$footer = self.$container.find('.footer');
        self.$pasteButton = self.$container.find('.paste-button');

        var $templateNode = self.$container.find('.template');
        if ($templateNode.get(0)) {
            self.template = _.template($templateNode.html());
        }

        var $editorTemplateNode = self.$container.find('.editor-template');
        if ($editorTemplateNode.get(0)) {
            self.editorTemplate = _.template($editorTemplateNode.html());
        }

        self.loadedPage = 0;

        self.bindEvents();

        self.requestLoadItems();
    },
    // AutoPagertrue
    // AutoPagerloadItems(true)
    enableAutoPager: false,
    // AutoPagertrue
    itemsReachedEnd: false,
    // 
    pasteReverseOrder: false,
    bindEvents: function bindEvents() {
        var _this = this;

        var self = this;

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
            _this.requestLoadItems();
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);

        self.$itemsContainer.on('click', '.item', function (event) {
            if ($(event.target).is('a')) return;
            if ($(event.target).parents('a').length > 0) return;
            $(this).toggleClass('selected');

            self.selectedItemsChanged();
            return false;
        });

        self.$container.on('dblclick', '.item', function (event) {
            if ($(event.target).is('a')) return;
            if ($(event.target).parents('a').length > 0) return;
            self.insertItems([$(this)]);
            $(this).removeClass('selected');
            self.selectedItemsChanged();
            trackEvent(self.$pasteButton.attr('data-track-name'));
            return false;
        });

        self.$pasteButton.click(function (event) {
            var items = [];
            self.selectedItems().each(function () {
                items.push($(this));
                $(this).removeClass('selected');
            });
            self.insertItems(self.pasteReverseOrder ? items.reverse() : items);
            self.selectedItemsChanged();
        });

        self.tabs = new MyCurationTab({
            container: self.$tabsContainer,
            backupKey: self.serviceName
        });
        $(self.tabs).on('change', function () {
            self.removeItems();
            self.requestLoadItems();
        });

        if (self.enableAutoPager) {
            self.$itemsContainer.scroll(_.throttle(function () {
                var rate = (self.$itemsContainer.scrollTop() + self.$itemsContainer.height()) / self.$itemsContainer[0].scrollHeight;
                // 
                if (rate > 0.7 && !self.itemsReachedEnd) {
                    self.requestLoadItems(true);
                }
            }, 100));
        }
    },
    resize: function resize() {
        var self = this;

        var mainHeight = $(window).height();

        var padding = 0;
        padding += parseInt(self.$itemsContainer.css('padding-top'), 10) || 0;
        padding += parseInt(self.$itemsContainer.css('padding-bottom'), 10) || 0;
        self.$itemsContainer.height(mainHeight - self.$container.offset().top - self.$header.outerHeight(true) - self.$footer.outerHeight(true) - padding);
    },
    selectedItemsChanged: function selectedItemsChanged() {
        var self = this;

        if (self.selectedItems().length > 0) {
            self.$pasteButton.removeClass('disabled').addClass('enabled').prop('disabled', false);
        } else {
            self.$pasteButton.removeClass('enabled').addClass('disabled').prop('disabled', true);
        }
    },
    selectedItems: function selectedItems() {
        var self = this;

        return self.$itemsContainer.find('.selected');
    },
    requestLoadItems: function requestLoadItems(is_more) {
        var self = this;

        if (self.isLoading) return;
        if (!self.$container.is(':visible')) return;

        // request
        if (!is_more && self.getItemsOnPage().length > 0) return;

        self._requestLoadItems(is_more);
    },
    willRequestLoadItems: function willRequestLoadItems(is_more) {
        var self = this;
        // 
        // false 
        return true;
    },
    _requestLoadItems: function _requestLoadItems(is_more) {
        var self = this;

        if (!self.willRequestLoadItems(is_more)) return;

        self.isLoading = true;
        self.$indicator.show();
        self.$errorMessage.hide();

        self.loadItems(is_more).done(function (feed) {
            self.showItems(feed.entries);
        }).fail(function (res) {
            self.$errorMessage.show();
        }).always(function () {
            self.$indicator.hide();
            self.isLoading = false;
            self.loadItemsFinishedHandler();
        });
    },
    loadItemsFinishedHandler: function loadItemsFinishedHandler() {
        // 
    },
    requestReload: function requestReload(is_more) {
        var self = this;

        if (self.isLoading) return;

        self.removeItems();
        self._requestLoadItems();
    },
    getItemsOnPage: function getItemsOnPage() {
        var self = this;
        return self.$itemsContainer.find('.item');
    },
    removeItems: function removeItems() {
        var self = this;
        self.getItemsOnPage().remove();
    },
    loadItems: function loadItems() {
        throw "not implemented";
        // 
    },
    showItems: function showItems(items) {
        var self = this;

        var source = '';
        _.each(items, function (entry) {
            source += self.renderItem(entry);
        });
        self.$indicator.before(source);
        Locale.updateTimestamps(self.$container[0]);
        $(self).triggerHandler('items-appended');
    },
    renderItem: function renderItem(item) {
        var self = this;
        return self.template({
            item: item
        });
    },
    insertItems: function insertItems(items) {
        // 
        var self = this;
        var lines = [];
        _.each(items, function ($item) {
            var permalink = $item.attr('data-permalink');
            lines.push('[' + permalink + ':embed]');
        });
        self.editor.insertLines(lines);
    }
}, {
    type: {

        // override

        get: function get() {
            return null;
        },
        configurable: true,
        enumerable: true
    }
});

module.exports = MyCuration;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MyCurationTab":495,"js/Base/EventTracker":284,"js/Locale":561,"underscore":213}],495:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

// 
// 
// localStorage
// change
// get()
// set(value)
// args:
//   container: input
//   backupKey:  localStorage
var MyCurationTab = function MyCurationTab() {
    this.init.apply(this, arguments);
};
MyCurationTab.prototype = {
    // args: { container backupKey }
    init: function init(args) {
        var self = this;

        self.$container = args.container;
        self.backupKey = args.backupKey;
        self.localStorageKey = 'MyCuration.Tab.' + self.backupKey;
        self.values = self.$container.find('input').map(function () {
            return $(this).val();
        }).toArray();

        self.$container.delegate('input', 'change', function () {
            self.$container.find('label.selected').removeClass('selected');
            $(this).closest('label').addClass('selected');

            var value = $(this).val();
            self.value = value;
            try {
                localStorage[self.localStorageKey] = value;
            } catch (ignore) {}

            $(self).triggerHandler('change');
        });

        try {
            if (localStorage[self.localStorageKey]) {
                self.set(localStorage[self.localStorageKey]);
            }
        } catch (ignore) {}
    },
    get: function get() {
        return this.value || this.values[0];
    },
    set: function set(value) {
        var self = this;
        if (!_.include(self.values, value)) return;
        var $input = self.$container.find('input[value="' + value + '"]');
        $input.click();
    }
};

module.exports = MyCurationTab;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],496:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var keyString = require('js/keyString');
var BUG = require('js/Base/Logger').BUG;
var trackEvent = require('js/Base/EventTracker').trackEvent;
var extractSyntax = require('js/Base/extractSyntax');
var EditorConnector = require('js/Base/EditorConnector');

var Nicovideo = function Nicovideo() {
    this.init.apply(this, arguments);
};

Nicovideo.prototype = {
    init: function init(args) {
        this.type = 'editor-nicovideo';

        this.editor = args.editor;
        this.$container = args.container;
        this.$itemsContainer = this.$container.find('.items');
        this.$input = this.$container.find('.nicovideo-keyword');
        this.$inputReset = this.$container.find('.input-text-reset');
        this.$pasteButton = this.$container.find('.paste-button');
        this.$formatPlayer = this.$container.find('.nicovideo-formats label.player');
        this.$formatThumbnail = this.$container.find('.nicovideo-formats label.thumbnail');

        this.setupFormatSwitcher('.nicovideo-formats');

        this.bindEvents();
    },

    bindEvents: function bindEvents() {
        var self = this;

        self.$input.keyup(_.debounce(function () {
            if (self.$input.val().length === 0) return;

            self.updateThumb();
        }, 500));

        self.$input.keydown(function (e) {
            if (keyString(e) === 'RET') {
                if (self.findItem().length > 0) {
                    self.insertItem();
                    trackEvent(self.$pasteButton.attr('data-track-name'));
                }
                return false;
            }
        });

        self.$pasteButton.click(function () {
            self.insertItem();
        });

        self.setupInputReset();
    },

    setupInputReset: function setupInputReset() {
        var self = this;

        self.$inputReset.click(function () {
            self.$input.val('');
            self.$input.focus();
            self.$inputReset.hide();

            return false;
        });

        self.$input.keyup(function (e) {
            if (self.$input.val().length > 0) {
                self.$inputReset.show();
            } else {
                self.$inputReset.hide();
            }
        });
    },

    findItem: function findItem() {
        return this.$container.find('.items > .item');
    },

    itemChanged: function itemChanged() {
        var self = this;

        var $item = self.findItem();

        if ($item.length === 0) {
            self.setPasteButtonStatus(false);
            return;
        }

        self.setPasteButtonStatus(true);

        var $format_player = self.$formatPlayer;
        var $format_thumbnail = self.$formatThumbnail;

        // video, '' '' ''
        // , '' ''
        if ($item.data('type') === 'video') {
            // ''
            $format_player.addClass('format-left');
            $format_thumbnail.removeClass('format-left');

            $format_player.show();
        } else {
            // ''
            $format_player.removeClass('format-left');
            $format_thumbnail.addClass('format-left');

            if ($format_player.is('.selected')) {
                $format_player.removeClass('selected');
                $format_player.find('input').prop('checked', false);

                $format_thumbnail.addClass('selected');
                $format_thumbnail.find('input').prop('checked', true);
            }

            $format_player.hide();
        }
    },

    setPasteButtonStatus: function setPasteButtonStatus(status) {
        var self = this;

        if (status) {
            self.$pasteButton.removeClass('disabled').addClass('enabled').prop('disabled', false);
        } else {
            self.$pasteButton.addClass('disabled').removeClass('enabled').prop('disabled', true);
        }
    },

    updateThumb: function updateThumb() {
        var self = this;

        var input = self.$input.val();

        var canonical_input = self.removeParamsFromURL(input);

        var info = self.detectInfo(canonical_input);

        if (!info) {
            return;
        }

        var source = self.renderPreviewTemplate(info.type, {
            id: info.id
        });

        var $item = $($.trim(source));
        $item.data('type', info.type);
        $item.data('id', info.id);

        self.$itemsContainer.html($item);

        self.itemChanged();
    },

    removeParamsFromURL: function removeParamsFromURL(url) {
        return url.replace(/\?.*$/, '');
    },

    // return: { id: 'sm2168098', type: 'video' }
    // false
    detectInfo: function detectInfo(input) {
        var self = this;

        if (self.isNicovideoID(input)) {
            return self.detectInfoFromID(input);
        } else {
            return self.detectInfoFromURL(input);
        }
    },

    detectInfoFromID: function detectInfoFromID(id) {
        var self = this;

        return {
            id: id,
            type: self.detectIDType(id)
        };
    },

    detectInfoFromURL: function detectInfoFromURL(input) {
        // URL
        // URL: http://www.nicovideo.jp/watch/sm2168098
        var regexps = {
            video: new RegExp("nicovideo.jp/watch/(\\w{0,2}\\d+)$"),
            community: new RegExp("com.nicovideo.jp/community/(co\\d+)$"),
            mylist: new RegExp("nicovideo.jp/mylist/(\\d+)$")
        };

        var info = false;
        _.find(regexps, function (regexp, type) {
            var result = regexp.exec(input);
            if (result) {
                info = { id: result[1], type: type };
                return true;
            } else {
                return false;
            }
        });

        return info;
    },

    isNicovideoID: function isNicovideoID(str) {
        // sm2168098, nm20097844
        // (ex: http://www.nicovideo.jp/watch/1365403220)
        return (/^(\w{2})?\d+$/.test(str)
        );
    },

    // prefix
    detectIDType: function detectIDType(id) {
        var prefix = id.slice(0, 2);
        if (prefix === 'co') {
            return 'community';
        } else {
            return 'video';
        }
    },

    renderPreviewTemplate: function renderPreviewTemplate(type, data) {
        var template = this.$container.find('.template-nicovideo-preview-' + type).html();
        return _.template(template)(data);
    },

    renderTemplate: function renderTemplate(type, format, data) {
        var $template = this.$container.find('.template-nicovideo-' + type + '-' + format);
        var template = $.trim($template.html());
        return _.template(template)(data);
    },

    insertItem: function insertItem() {
        var self = this;

        var lines = [];

        var format = self.$container.find('[name="nicovideo-format"]:checked').val();

        var $item = self.findItem();
        var source = self.renderTemplate($item.data('type'), format, { id: $item.data('id') });

        lines.push(source);

        var lines_data = {
            html: lines,
            hatena: lines,
            markdown: lines
        };

        var editor = self.editor;
        // , 
        if (editor.mode === 'html' && format === 'link') {
            extractSyntax(lines).done(function (data) {
                lines_data.html = [data.html];
                EditorConnector.insertLines(lines_data);
            }).fail(function (error) {
                BUG(error);
                EditorConnector.insertLines(lines_data);
            });
        } else {
            EditorConnector.insertLines(lines_data);
        }
    },

    setupFormatSwitcher: function setupFormatSwitcher(format_container_selector) {
        var self = this;
        var $format_container = self.$container.find(format_container_selector);

        $format_container.on('change', function (e) {
            var $input = $(e.target);

            $format_container.find('label.selected').removeClass('selected');
            $input.closest('label').addClass('selected');
        });
    }
};

module.exports = Nicovideo;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EditorConnector":283,"js/Base/EventTracker":284,"js/Base/Logger":293,"js/Base/extractSyntax":301,"js/keyString":599,"underscore":213}],497:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var globalData = require('js/Base/globalData');

/**
 * og-description
 */
var OgDescriptionInput = function OgDescriptionInput() {
    this.init.apply(this, arguments);
};
OgDescriptionInput.prototype = {
    init: function init(editor) {
        this.$element = $('#og-description');

        // , 
        // 
        var self = this;
        editor.bind('change', _.debounce(function () {
            if (self.$element.is(':hidden')) {
                return;
            }
            self.update();
        }, 1000));
    },

    update: function update() {
        var $input = $('#og-description-input');

        $.ajax({
            url: './preview_og_description',
            method: 'POST',
            data: {
                body: $('#body').val(),
                syntax: $('#syntax').val(),
                rkm: globalData('rkm'),
                rkc: globalData('rkc')
            },
            dataType: 'json'
        }).done(function (data) {
            $('#og-description-input').attr('placeholder', _.escape(data.text));
        });
    }
};

module.exports = OgDescriptionInput;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"underscore":213}],498:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var keyString = require('js/keyString');
var globalData = require('js/Base/globalData');

/**
 * 
 */
var OgImageEditor = function OgImageEditor() {
    this.init.apply(this, arguments);
};
OgImageEditor.prototype = {
    init: function init(form, editor) {
        this.$form = $(form);
        this.$element = $('#og-image');
        this.$input = this.$element.find('#ogimage-input');
        this.$imgContainer = this.$element.find('#ogimage-img-container');
        this.$current = this.$element.find('.current-og-image');
        this.$remove = this.$element.find('.remove-og-image');
        this.$items = this.$form.find('.image-items');
        this.itemTemplate = _.template(this.$form.find('.ogimage-item-template').html());
        this.$indicator = this.$element.find('.indicator');
        this.$reload = this.$element.find('.reload');
        this.$errorMessage = this.$element.find('.error');
        this.isLoading = false;
        this.defaultOgImageURL = this.$element.data('default-ogimage-url');

        this.editor = editor;

        this.bindEvents();
        this.getImageSrcs();
    },
    bindEvents: function bindEvents() {
        var self = this;

        self.$element.change(function () {
            self.setOgImage();
        });

        self.$element.on('click', '.image-item', function () {
            self.setOgImageInput(this);
            self.setOgImage();
        });

        self.$input.keydown(function (e) {
            if (keyString(e) === 'RET') {
                self.setOgImage();
                return false;
            }
        });

        self.$reload.click(function () {
            self.reloadItems();
        });

        self.$remove.click(function () {
            self.removeCurrentImage();
        });
    },
    setOgImage: function setOgImage(src) {
        var self = this;
        self.$current.attr('src', self.$input.val());
    },
    removeCurrentImage: function removeCurrentImage() {
        var self = this;

        // chromesrc=""img
        var $image = $('<img>').addClass('current-og-image');
        self.$input.val("");
        self.$current.remove();
        self.$current = $image;
        self.$imgContainer.append($image);
        self.$items.find('.selected').removeClass('selected');
    },
    setOgImageInput: function setOgImageInput(item) {
        var self = this;
        var $item = $(item);

        self.$items.find('.selected').removeClass('selected');
        $item.addClass('selected');

        var src = $item.attr('data-image-src');
        self.$input.val(src);
    },
    showItems: function showItems(items) {
        var self = this;
        var source = "";
        _.each(items, function (item) {
            source += self.itemTemplate({
                item: { image_src: item }
            });
        });
        self.$indicator.before(source);
    },
    reloadItems: function reloadItems() {
        var self = this;
        if (!self.$element.is(':visible')) return;
        self.removeImageItems();
        self.getImageSrcs();
    },
    getImageSrcs: function getImageSrcs() {
        var self = this;
        var body = this.editor.getBody();

        // 
        if (!body) {
            self.showItems([self.defaultOgImageURL]);
            return;
        }

        if (self.isLoading) return;

        self.isLoading = true;
        self.$indicator.show();

        $.ajax({
            url: '/api/entry/images',
            type: 'POST',
            dataType: 'json',
            data: {
                body: body,
                syntax: $('#syntax').val(),
                rkm: globalData('rkm'),
                rkc: globalData('rkc')
            }
        }).done(function (items) {
            // 
            items.push(self.defaultOgImageURL);

            self.showItems(items);
            self.$errorMessage.hide();

            self.setSelectedImage();
        }).fail(function (res) {
            self.failed = true;
            self.$errorMessage.show();
        }).always(function () {
            self.isLoading = false;
            self.$indicator.hide();
        });
    },
    removeImageItems: function removeImageItems() {
        var self = this;
        self.$items.find('.image-item').remove();
    },
    // selected
    setSelectedImage: function setSelectedImage() {
        var self = this;
        var inputSrc = self.$input.val();
        if (!inputSrc) return;
        if (self.$items.find('.selected').length > 0) return;

        self.$items.find('.image-item').each(function () {
            var $item = $(this);
            var $img = $item.find('.image-container img');
            if ($img.attr('src') === inputSrc) {
                $item.addClass('selected');
                return false;
            }
        });
    }
};

module.exports = OgImageEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/keyString":599,"underscore":213}],499:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var extend = require('js/Util/extend');
var Fotolife = require('../Fotolife');
var UploadForm = require('./UploadForm');

/**
 * 
 *
 * 
 * - formcontrollerPaintUploadForm.js
 * - modelUploader.js
 */
var Paint = function Paint() {
    this.init.apply(this, arguments);
};

extend(Paint.prototype, Fotolife.prototype);

Paint.prototype.type = 'editor-paint';
Paint.prototype.defaultFolder = 'Hatena Blog Illust';
Paint.prototype._setupElements = function () {
    this.$items = $('#paint-items');
    this.$pasteButton = $('#paint-button-paste');
    this.$footerButtons = $('#paint-footer-buttons');
    this.$uploadForm = $('#paint-uploader');
    this.$uploadFormWrapper = $('#paint-uploader-wrapper');
};
Paint.prototype._setupUploadForm = function () {
    this.uploadForm = new UploadForm(this.$uploadForm, this);
};

module.exports = Paint;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Fotolife":477,"./UploadForm":501,"js/Util/extend":574}],500:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Logger = require('js/Base/Logger');

/**
 * DataURI
 * @param {string} dataURI
 * @return {{base64:string, ext:string}} - base64
 */
var parseDataUri = function parseDataUri(dataURI) {
    var barr, bin, i, len;
    var splitedDataURI = dataURI.split(',');
    var ext = splitedDataURI[0].match(/\/([a-zA-Z]+?);/)[1];
    var base64 = splitedDataURI[1];
    return { base64: splitedDataURI[1], ext: ext };
};

/**
 * canvas
 */
var fillCanvasWithImage = function fillCanvasWithImage(canvas, url) {
    var ret = $.Deferred();
    var ctx = canvas.getContext('2d');
    var img = new Image();
    img.src = url;
    img.onload = function () {
        ctx.drawImage(img, 0, 0);
        ret.resolve();
    };
    return ret.promise();
};

/**
 * canvas
 */
var fillCanvasWithColor = function fillCanvasWithColor(canvas, color) {
    var ctx = canvas.getContext('2d');
    var canvasWidth = canvas.width;
    var canvasHeight = canvas.height;
    ctx.fillStyle = color;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
};

function parseRGBa(rgba) {
    var matched = rgba.replace(/\s/g, '').match(/rgba\(([\d,.]+)\)/)[1];
    rgba = matched.split(',');
    return {
        r: rgba[0],
        g: rgba[1],
        b: rgba[2],
        a: rgba[3]
    };
}

function parseCssColor(color) {
    if (color.length === 4) {
        return {
            r: parseInt(color.charAt(1), 16),
            g: parseInt(color.charAt(2), 16),
            b: parseInt(color.charAt(3), 16),
            a: 1
        };
    }
    if (color.length === 7) {
        return {
            r: parseInt(color.substr(1, 2), 16),
            g: parseInt(color.substr(3, 2), 16),
            b: parseInt(color.substr(5, 2), 16),
            a: 1
        };
    }
}

/**
 * RGBaRGBa
 */
function parseColor(color) {
    if (color === 'transparent') {
        // for wColorPicker.
        return { r: 0, g: 0, b: 0, a: 0 };
    }
    if (color.charAt(0) === '#') {
        return parseCssColor(color);
    } else {
        return parseRGBa(color);
    }
}

/**
 * 
 * wPaint
 */
var Painter = function Painter() {
    this.init.apply(this, arguments);
};

Painter.prototype = {

    /**
     * @param {jQuery}     $element - 
     * @param {UploadForm} parent   - Form 
     */
    init: function init($element, parent) {
        var self = this;
        this.$canvasWindow = $element;
        this.$container = this.$canvasWindow.find('#paint-canvas');

        this.parent = parent;

        this.show(); // colorPickerinitCanvas
        this.initPosition();
        this.initCanvas();

        this.loadImage();

        this.$canvasWindow.find('#close').on('click', function (e) {
            self.hide();
        });

        this.parent.on('uploaded', function () {
            self.$canvasWindow.hide();
            self.wPaint('clear');
            Logger.REPORT_BUG('uploadPaint');
        });
    },

    /**
     * 
     */
    initPosition: function initPosition() {
        var width = parseInt(this.$canvasWindow.width());
        var height = parseInt(this.$canvasWindow.height());
        this.$canvasWindow.css({
            top: '40%',
            left: '50%',
            'margin-left': width * -0.5 + 'px',
            'margin-top': height * -0.5 + 'px'
        });
    },

    /**
     * wPaint
     */
    initCanvas: function initCanvas() {
        if (this.$container.data('_wPaint')) {
            return;
        } // 
        var self = this;

        this.wPaint({
            lineWidthMin: 1,
            lineWidth: 5,
            strokeStyle: '#000',
            isMenuDraggable: false,
            menu: ['undo', 'redo', 'clear', 'pencil', 'eraser', 'lineWidth', 'strokeColor']
        });

        this.$canvasWindow.draggable({
            handle: "#paint-menu",
            containment: $('body').is('.body-iframe') ? '#edit-form' : 'body'
        });

        // 
        this.setupMenu($('#paint-menu'));

        // 
        this.$uploadButton = this.$canvasWindow.find('.canvas-upload-button');
        this.$uploadButton.on('click', function (e) {
            $(this).attr('disabled', 'disabled');
            self.upload();
        });

        // 
        var $sizeSelectors = this.$canvasWindow.find('.canvas-size-selector > .selector');
        this.$canvasWindow.find('.canvas-size-selector input').on('click', function (e) {
            var range = $(e.target).val().split(':');
            self.resize(range[0], range[1]);

            // 
            $sizeSelectors.removeClass('active');
            $(e.target).closest('label').addClass('active');
        });
    },

    /**
     * 
     */
    loadImage: function loadImage() {
        // XXX parseHTML 
        var selectedImageUrl = $($.parseHTML($('#paint-items .item.selected').attr('data-html'))).find('img').attr('src');
        var imageUrl = selectedImageUrl ? '/-/proxy/image/?' + $.param({ url: selectedImageUrl }) : '';

        if (imageUrl) {
            fillCanvasWithImage(this.$container.data('_wPaint').canvas, imageUrl);
        }
    },

    /**
     * 
     */
    setupMenu: function setupMenu($menu) {
        var self = this;

        // undo, redo, 
        $menu.find('._wPaint_undo').on('click', function () {
            self.wPaint('undo');
        });
        $menu.find('._wPaint_redo').on('click', function () {
            self.wPaint('redo');
        });
        $menu.find('._wPaint_clear').on('click', function () {
            self.wPaint('clear');
        });

        // 
        var $tools = $menu.find('.paint-menu-tool');
        $tools.on('click', function () {
            self.wPaint('mode', $(this).data('mode'));
            $tools.removeClass('active');
            $(this).addClass('active');
        });

        // pencil, water
        $tools.filter('._wPaint_pencil').on('click', function () {
            var rgba = parseColor(self.wPaint('strokeStyle'));
            self.wPaint('strokeStyle', 'rgba(' + [rgba.r, rgba.g, rgba.b, 1].join(',') + ')');
        });
        $tools.filter('._wPaint_water').on('click', function () {
            var rgba = parseColor(self.wPaint('strokeStyle'));
            self.wPaint('strokeStyle', 'rgba(' + [rgba.r, rgba.g, rgba.b, 0.5].join(',') + ')');
        });

        // 
        self.$container.on('wPaint:dropper', function (e, colorString) {
            self.wPaint('fillStyle', colorString);
            $menu.find("._wColorPicker_buttonColor").css('backgroundColor', colorString);
        });

        // 
        var $lineWidthSelector = $menu.find('._wPaint_lineWidth .line');
        $lineWidthSelector.on('change', function (e) {
            $lineWidthSelector.removeClass('active');
            $(this).addClass('active');
            self.wPaint('lineWidth', parseInt($(this).find('input[type=radio]').val(), 10));
        });

        // 
        $menu.find('._wPaint_colorPicker').wColorPicker({
            mode: 'click',
            initColor: '#000',
            showSpeed: 300,
            hideSpeed: 300,
            onSelect: function onSelect(color) {
                var rgba = parseColor(color);
                if (color !== 'transparent') {
                    var current = parseColor(self.wPaint('strokeStyle'));
                    rgba.a = current.a;
                }

                rgba = 'rgba(' + [rgba.r, rgba.g, rgba.b, rgba.a].join(',') + ')';
                self.wPaint('strokeStyle', rgba);
                self.wPaint('fillStyle', rgba);
            }
        });
    },

    /**
     * wPaint
     *
     * @param {string} option   - 
     * @param {Object} settings - 
     */
    wPaint: function wPaint(option, settings) {
        return this.$container.wPaint(option, settings);
    },

    /**
     * 
     * confirm
     */
    resize: function resize(width, height) {
        var $canvas = $(this.$container.data('_wPaint').canvas);
        var $bufferCanvas = $(this.$container.data('_wPaint').bufferCanvas);

        if ($canvas.attr('width') > width && !confirm(this.$container.attr('data-resize-confirm'))) {
            return;
        }

        this.$container.css({ width: width, height: height });
        var imageData = this.wPaint("image");
        $canvas.attr('width', width + 'px').attr('height', height + 'px');
        $bufferCanvas.attr('width', width + 'px').attr('height', height + 'px');
        this.wPaint("image", imageData);
    },

    /**
     * canvasparent
     */
    upload: function upload() {
        var self = this;
        var dataUrl = self.wPaint('image');

        var canvas = self.$container.data('_wPaint').canvas;

        // 
        var width = parseInt($(canvas).attr('width').slice(0, -2));
        this.parent.emit('setFotoSize', width);

        // 
        // - 
        // - 
        fillCanvasWithColor(canvas, '#FFF');
        fillCanvasWithImage(canvas, dataUrl).then(function () {
            var parsed = parseDataUri(self.wPaint('image'));
            self.parent.emit('upload', parsed);
        }).always(function () {
            self.$uploadButton.removeAttr('disabled');
        });
    },

    show: function show() {
        this.$canvasWindow.show();
    },

    hide: function hide() {
        this.$canvasWindow.hide();
    }

};

module.exports = Painter;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Logger":293}],501:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var EventEmitter = require('events').EventEmitter;
var Uploader = require('../../Uploader');
var Painter = require('./Painter');

/**
 * 
 * PainterUploader
 *
 * @param {jQuery} $element - 
 * @param {Paint}  parent   - Paint
 */
var PaintUploadForm = function PaintUploadForm($element, parent) {

    this.$element = $element;
    this.parent = parent;

    this._fotoSize = Uploader.DEFAULT_SIZE;

    this.eventEmitter = new EventEmitter();
    this.initEvents();
};

PaintUploadForm.prototype = {

    initEvents: function initEvents() {
        var self = this;

        // 
        // visible
        // lazy
        this.$element.find('.canvas-open-button').on('click', function () {
            if (!self.painter) {
                self.painter = new Painter($('#paint-window'), self);
            }

            self.painter.show();
        });

        this.on('upload', function (parsed) {
            var uploader = new Uploader();
            self.parent.emit('upload', uploader);
            uploader.uploadPaint(parsed.base64, parsed.ext).then(function () {
                self.emit('uploaded');
            });
        });

        // 
        // 
        this.on('setFotoSize', function (fotoSize) {
            self._fotoSize = fotoSize;
        });
    },

    fotoSize: function fotoSize() {
        return this._fotoSize;
    },

    on: function on() {
        this.eventEmitter.on.apply(this.eventEmitter, arguments);
    },

    emit: function emit() {
        this.eventEmitter.emit.apply(this.eventEmitter, arguments);
    }

};

module.exports = PaintUploadForm;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../Uploader":558,"./Painter":500,"events":207}],502:[function(require,module,exports){
module.exports = require('./Paint');

},{"./Paint":499}],503:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var extractSyntax = require('js/Base/extractSyntax');
var BUG = require('js/Base/Logger').BUG;
var EditorConnector = require('js/Base/EditorConnector');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');

var Pixiv = function Pixiv() {
    this.init.apply(this, arguments);
};
Pixiv.prototype = {
    parent: MyCuration,
    serviceName: 'Pixiv',
    enableAutoPager: true,
    page: 1,
    init: function init(args) {
        this.type = 'editor-pixiv';
        this.$container = args.container;
        this.parent.prototype.init.call(this, args);
    },
    loadItems: function loadItems(is_more) {
        var self = this;

        return $.ajax({
            url: '/api/pixiv/my_works',
            data: {
                page: self.page++
            }
        }).success(function (res) {
            self.itemsReachedEnd = !(res.entries && res.entries.length > 0);
        }).fail(function (res) {
            self.pleaseReAuthorize();
            self.itemsReachedEnd = true;
        });
    },
    pleaseReAuthorize: function pleaseReAuthorize() {
        var self = this;
        self.$container.find('.disabled-box').show();
    },
    insertItems: function insertItems(items) {
        var self = this;
        var hatena_syntaxes = [];
        _.each(items, function ($item) {
            var permalink = $item.attr('data-permalink');
            hatena_syntaxes.push(self.editorTemplate({
                item: {
                    id: $item.attr('data-id'),
                    image_url: $item.attr('data-image-url')
                }
            }));
            hatena_syntaxes.push('[' + permalink + ':title]');
        });

        var lines = {
            hatena: hatena_syntaxes,
            markdown: hatena_syntaxes,
            html: hatena_syntaxes
        };

        extractSyntax(hatena_syntaxes).done(function (data) {
            lines.html = [data.html];
        }).fail(function (error) {
            lines.html = lines.hatena;
            BUG(error);
        }).always(function () {
            EditorConnector.insertLines(lines);
        });
    }
};

extend(Pixiv.prototype, MyCuration.prototype);

module.exports = Pixiv;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MyCuration":494,"js/Base/EditorConnector":283,"js/Base/Logger":293,"js/Base/extractSyntax":301,"js/Util/extend":574,"underscore":213}],504:[function(require,module,exports){
'use strict';

var actions = {
    SET_EDITOR: 'PROMOTION:SET_EDITOR',

    LOAD_ENTRIES: 'ENTRIES:LOAD_ENTRIES',
    SHOW_ENTRY: 'ENTRIES:SHOW_ENTRY',
    SHOW_ENTRY_AT: 'ENTRIES:SHOW_ENTRY_AT',
    CLOSE_ENTRY: 'ENTRIES:CLOSE_ENTRY',
    FILL_KEYWORD: 'ENTRIES:FILL_KEYWORD',

    LOAD_ODAIS: 'ODAI:LOAD_ODAIS',
    SELECT_ODAI: 'ODAI:SELECT_ODAI',
    TURN_SLOT: 'ODAI:TURN_SLOT',
    KILL_ODAISLOT: 'ODAI:KILL_ODAISLOT',
    SET_INACTIVE: 'ODAI:SET_INACTIVE',

    SHOW_WINDOW: 'PROMOTION:SHOW_WINDOW',
    HIDE_WINDOW: 'PROMOTION:HIDE_WINDOW',
    SET_PAGE: 'PROMOTION:SET_PAGE'
};

var pageIds = {
    ENTRIES_PAGE: 'ENTRIES_PAGE',
    ODAI_SLOT_PAGE: 'ODAI_SLOT_PAGE'
};

module.exports = {
    actions: actions,
    pageIds: pageIds
};

},{}],505:[function(require,module,exports){
'use strict';

/**
 * PR1Model
 */

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var PromotionEntry = (function () {

    /**
     * @param {string} id
     * @param {string} title
     * @param {string} body
     */

    function PromotionEntry(args) {
        _classCallCheck(this, PromotionEntry);

        this.id = args.id;
        this.title = args.title;
        this.body = args.body;
    }

    _createClass(PromotionEntry, [{
        key: 'isRead',
        value: function isRead() {
            try {
                return localStorage[this.localStorageKey()];
            } catch (ignore) {}
        }
    }, {
        key: 'setAsRead',
        value: function setAsRead() {
            try {
                localStorage[this.localStorageKey()] = true;
            } catch (ignore) {}
        }
    }, {
        key: 'localStorageKey',
        value: function localStorageKey() {
            return 'Hatena.Diary.Promotion.Entry.read.' + this.id;
        }
    }, {
        key: 'isClosed',
        value: function isClosed() {
            try {
                return localStorage['Hatena.Diary.Promotion.Entry.closed.' + this.id];
            } catch (ignore) {}
        }
    }, {
        key: 'setAsClosed',
        value: function setAsClosed() {
            try {
                localStorage['Hatena.Diary.Promotion.Entry.closed.' + this.id] = true;
            } catch (ignore) {}
        }
    }]);

    return PromotionEntry;
})();

module.exports = PromotionEntry;

},{}],506:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var actions = require('../Constants').actions;
var Dispatcher = require('js/Base/Dispatcher');

var EntriesActions = (function (_Dispatcher$Actions) {
    _inherits(EntriesActions, _Dispatcher$Actions);

    function EntriesActions() {
        _classCallCheck(this, EntriesActions);

        _get(Object.getPrototypeOf(EntriesActions.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntriesActions, [{
        key: 'setEditor',
        value: function setEditor(editor) {
            this.emit(actions.SET_EDITOR, editor);
        }
    }, {
        key: 'loadEntries',
        value: function loadEntries(entries) {
            this.emit(actions.LOAD_ENTRIES, entries);
        }
    }, {
        key: 'showEntry',
        value: function showEntry(entryId) {
            this.emit(actions.SHOW_ENTRY, entryId);
        }
    }, {
        key: 'showEntryAt',
        value: function showEntryAt(index) {
            this.emit(actions.SHOW_ENTRY_AT, index);
        }
    }, {
        key: 'closeEntry',
        value: function closeEntry(entryId) {
            this.emit(actions.CLOSE_ENTRY, entryId);
        }
    }, {
        key: 'fillKeyword',
        value: function fillKeyword(keyword) {
            this.emit(actions.FILL_KEYWORD, keyword);
        }
    }]);

    return EntriesActions;
})(Dispatcher.Actions);

module.exports = new EntriesActions();

},{"../Constants":504,"js/Base/Dispatcher":281}],507:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var get = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null).get;
var actions = require('../Constants').actions;
var Dispatcher = require('js/Base/Dispatcher');

var OdaiActions = (function (_Dispatcher$Actions) {
    _inherits(OdaiActions, _Dispatcher$Actions);

    function OdaiActions() {
        _classCallCheck(this, OdaiActions);

        _get(Object.getPrototypeOf(OdaiActions.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(OdaiActions, [{
        key: 'setEditor',
        value: function setEditor(editor) {
            this.emit(actions.SET_EDITOR, editor);
        }
    }, {
        key: 'loadOdais',
        value: function loadOdais() {
            var _this = this;

            get('/api/odais?type=official').then(function (res) {
                _this.emit(actions.LOAD_ODAIS, res.odais);
            }).fail(function (error) {
                throw error;
            });
        }
    }, {
        key: 'selectOdai',
        value: function selectOdai(odaiId) {
            this.emit(actions.SELECT_ODAI, odaiId);
        }
    }, {
        key: 'turnSlot',
        value: function turnSlot() {
            this.emit(actions.TURN_SLOT);
        }
    }, {
        key: 'killOdaiSlot',
        value: function killOdaiSlot() {
            this.emit(actions.KILL_ODAISLOT);
        }
    }, {
        key: 'setInactive',
        value: function setInactive() {
            this.emit(actions.SET_INACTIVE);
        }
    }]);

    return OdaiActions;
})(Dispatcher.Actions);

module.exports = new OdaiActions();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Constants":504,"js/Base/Dispatcher":281}],508:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var actions = require('../Constants').actions;
var Dispatcher = require('js/Base/Dispatcher');

var PromotionActions = (function (_Dispatcher$Actions) {
    _inherits(PromotionActions, _Dispatcher$Actions);

    function PromotionActions() {
        _classCallCheck(this, PromotionActions);

        _get(Object.getPrototypeOf(PromotionActions.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PromotionActions, [{
        key: 'setEditor',
        value: function setEditor(editor) {
            this.emit(actions.SET_EDITOR, editor);
        }
    }, {
        key: 'showWindow',
        value: function showWindow() {
            this.emit(actions.SHOW_WINDOW);
        }
    }, {
        key: 'hideWindow',
        value: function hideWindow() {
            this.emit(actions.HIDE_WINDOW);
        }
    }, {
        key: 'setPage',
        value: function setPage(pageId) {
            this.emit(actions.SET_PAGE, pageId);
        }
    }]);

    return PromotionActions;
})(Dispatcher.Actions);

module.exports = new PromotionActions();

},{"../Constants":504,"js/Base/Dispatcher":281}],509:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var EntryButton = require('./EntryButton');

/**
 * PromotionEntries
 * ID
 */

var EntriesBar = (function (_React$Component) {
    _inherits(EntriesBar, _React$Component);

    function EntriesBar() {
        _classCallCheck(this, EntriesBar);

        _get(Object.getPrototypeOf(EntriesBar.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntriesBar, [{
        key: 'renderButton',
        value: function renderButton(entry, i) {
            var trackingId = i === 0 ? 'first' : 'second';
            return React.createElement(EntryButton, {
                entry: entry,
                trackingId: trackingId,
                ref: trackingId,
                key: entry.id });
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'span',
                null,
                this.props.entries.activeEntries.map(function (entry, i) {
                    return _this.renderButton(entry, i);
                })
            );
        }
    }]);

    return EntriesBar;
})(React.Component);

EntriesBar.propTypes = {
    entries: React.PropTypes.object.isRequired
};

module.exports = EntriesBar;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./EntryButton":511}],510:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var EntriesActions = require('../actions/EntriesActions');
var PromotionContent = require('./PromotionContent');

/**
 * Promotion
 * 
 */

var EntriesPage = (function (_React$Component) {
    _inherits(EntriesPage, _React$Component);

    function EntriesPage() {
        _classCallCheck(this, EntriesPage);

        _get(Object.getPrototypeOf(EntriesPage.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntriesPage, [{
        key: 'render',
        value: function render() {
            return React.createElement(
                'div',
                { className: 'promotion-entries ' + this.props.device },
                React.createElement(
                    'div',
                    { className: 'promotion-entries-wrapper ' + this.props.device },
                    this.renderEntries()
                ),
                React.createElement(
                    'div',
                    { className: 'promotion-entries-pagers center ' + this.props.device },
                    this.renderPagers()
                )
            );
        }
    }, {
        key: 'renderEntries',
        value: function renderEntries() {
            var _this = this;

            return this.props.entries.map(function (entry) {
                return React.createElement(PromotionContent, {
                    entry: entry,
                    key: entry.id,
                    device: _this.props.device,
                    isSelected: _this.isEntrySelected(entry) });
            });
        }
    }, {
        key: 'renderPagers',
        value: function renderPagers() {
            var _this2 = this;

            if (this.props.entries.length < 2) {
                return;
            }

            return this.props.entries.map(function (entry, i) {
                var className = 'promotion-entries-pager btn';
                className += _this2.isEntrySelected(entry) ? ' selected' : '';

                return React.createElement(
                    'span',
                    { className: className,
                        'data-target-promotion-index': i, tabIndex: '0',
                        ref: 'marker' + i,
                        key: entry.id,
                        onClick: function () {
                            return _this2.showEntryAt(i);
                        } },
                    i + 1
                );
            });
        }
    }, {
        key: 'isEntrySelected',
        value: function isEntrySelected(entry) {
            return !!(this.props.currentEntry && entry.id === this.props.currentEntry.id);
        }
    }, {
        key: 'showEntryAt',
        value: function showEntryAt(i) {
            EntriesActions.showEntryAt(i);
        }
    }]);

    return EntriesPage;
})(React.Component);

EntriesPage.propTypes = {
    entries: React.PropTypes.array.isRequired,
    currentEntry: React.PropTypes.object,
    device: React.PropTypes.string.isRequired
};

module.exports = EntriesPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../actions/EntriesActions":506,"./PromotionContent":517}],511:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var PromotionActions = require('../actions/PromotionActions');
var EntriesActions = require('../actions/EntriesActions');
var pageIds = require('../Constants').pageIds;
var Locale = require('js/Locale');

// PR

var EntryButton = (function (_React$Component) {
    _inherits(EntryButton, _React$Component);

    function EntryButton() {
        _classCallCheck(this, EntryButton);

        _get(Object.getPrototypeOf(EntryButton.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntryButton, [{
        key: 'showEntry',
        value: function showEntry() {
            EntriesActions.showEntry(this.props.entry.id);
            PromotionActions.setPage(pageIds.ENTRIES_PAGE);
            PromotionActions.showWindow();
        }
    }, {
        key: 'closeEntry',
        value: function closeEntry(e) {
            EntriesActions.closeEntry(this.props.entry.id);
            e.stopPropagation();
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            if (this.props.entry.isClosed()) {
                return React.createElement('span', null);
            }

            var className = 'promotion-button';
            if (!this.props.entry.isRead()) {
                className += ' is-active';
            }

            return React.createElement(
                'span',
                { tabIndex: '-1', type: 'button',
                    className: className,
                    'data-track-name': 'editor-toolbar-button-promotion-' + this.props.trackingId,
                    ref: 'showButton',
                    onClick: function () {
                        return _this.showEntry();
                    } },
                React.createElement(
                    'span',
                    { className: 'promotion-label' },
                    '<NEW>'
                ),
                React.createElement(
                    'span',
                    { className: 'promotion-entry-title' },
                    this.props.entry.title
                ),
                React.createElement('i', { className: 'blogicon-close promotion-cancel-button tipsy-top',
                    title: Locale.text('close'),
                    ref: 'closeButton',
                    onClick: function (e) {
                        return _this.closeEntry(e);
                    } })
            );
        }
    }]);

    return EntryButton;
})(React.Component);

EntryButton.propTypes = {
    entry: React.PropTypes.object.isRequired,
    trackingId: React.PropTypes.string.isRequired
};

module.exports = EntryButton;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Constants":504,"../actions/EntriesActions":506,"../actions/PromotionActions":508,"js/Locale":561}],512:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var OdaiSlotButton = require('./OdaiSlotButton');

/**
 * PromotionOdaiSlot
 * input[type=hidden]
 */

var OdaiSlotBar = (function (_React$Component) {
    _inherits(OdaiSlotBar, _React$Component);

    function OdaiSlotBar() {
        _classCallCheck(this, OdaiSlotBar);

        _get(Object.getPrototypeOf(OdaiSlotBar.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(OdaiSlotBar, [{
        key: 'render',
        value: function render() {
            var _props$odai = this.props.odai;
            var selectedOdais = _props$odai.selectedOdais;
            var isActive = _props$odai.isActive;
            var isKilled = _props$odai.isKilled;

            var className = 'odaislot-bar';
            if (this.props.odai.odais.length === 0) {
                className += '--hidden';
            }

            return React.createElement(
                'span',
                { className: className },
                React.createElement(OdaiSlotButton, {
                    selectedOdais: selectedOdais,
                    isActive: isActive,
                    isKilled: isKilled })
            );
        }
    }]);

    return OdaiSlotBar;
})(React.Component);

OdaiSlotBar.propTypes = {
    odai: React.PropTypes.object.isRequired
};

module.exports = OdaiSlotBar;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./OdaiSlotButton":513}],513:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var PromotionActions = require('../actions/PromotionActions');
var OdaiActions = require('../actions/OdaiActions');
var pageIds = require('../Constants').pageIds;
var Locale = require('js/Locale');

// 

var OdaiSlotButton = (function (_React$Component) {
    _inherits(OdaiSlotButton, _React$Component);

    function OdaiSlotButton() {
        _classCallCheck(this, OdaiSlotButton);

        _get(Object.getPrototypeOf(OdaiSlotButton.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(OdaiSlotButton, [{
        key: 'showOdaiSlot',
        value: function showOdaiSlot() {
            PromotionActions.setPage(pageIds.ODAI_SLOT_PAGE);
            PromotionActions.showWindow();
            OdaiActions.turnSlot();
            OdaiActions.setInactive();
        }
    }, {
        key: 'killOdaiSlot',
        value: function killOdaiSlot(e) {
            OdaiActions.killOdaiSlot();
            e.stopPropagation();
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            if (this.props.isKilled) {
                return React.createElement('span', null);
            }

            var className = 'odaislot-button';

            if (this.props.isActive) {
                className += ' is-active';
            }

            return React.createElement(
                'span',
                { tabIndex: '-1', type: 'button',
                    className: className,
                    'data-track-name': 'editor-toolbar-button-odaislot',
                    ref: 'showButton',
                    onClick: function () {
                        return _this.showOdaiSlot();
                    } },
                React.createElement(
                    'span',
                    { className: 'odaislot-label' },
                    '<NEW>'
                ),
                React.createElement(
                    'span',
                    { className: 'odaislot-title' },
                    Locale.text('admin.odai.odai_slot')
                ),
                React.createElement('i', { className: 'blogicon-close odaislot-cancel-button tipsy-top',
                    title: Locale.text('close'),
                    ref: 'closeButton',
                    onClick: function (e) {
                        return _this.killOdaiSlot(e);
                    } })
            );
        }
    }]);

    return OdaiSlotButton;
})(React.Component);

OdaiSlotButton.propTypes = {
    isActive: React.PropTypes.bool.isRequired,
    isKilled: React.PropTypes.bool.isRequired
};

module.exports = OdaiSlotButton;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Constants":504,"../actions/OdaiActions":507,"../actions/PromotionActions":508,"js/Locale":561}],514:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');
var HtmlText = require('js/Base/HtmlText');
var OdaiActions = require('../actions/OdaiActions');
var PromotionActions = require('../actions/PromotionActions');

/**
 * 
 * @param {string} className - class
 * @param {string} text      - 
 * @param {number} lines     - 
 * @returns {string}         - 
 */
var shortener = (function () {
  // window.load
  if (!document.body) {
    return '';
  }

  var mock = document.createElement('div');
  mock.style.top = '-9999px';
  mock.style.zIndex = '-9999';

  document.addEventListener('DOMContentLoaded', function () {
    document.body.appendChild(mock);
  });

  return function (className, text, lines) {
    mock.className = className;

    // 
    mock.innerHTML = 'a';
    var lineHeight = mock.offsetHeight;
    var height = lineHeight * lines;

    // 
    mock.innerHTML = text;
    var i = 0;
    while (mock.offsetHeight > height) {
      i++;
      mock.innerHTML = text.slice(0, -i) + '';
    }

    if (i === 0) {
      return text;
    }
    return text.slice(0, -i) + '';
  };
})();

/**
 * Promotion
 * 
 */

var OdaiSlotPage = (function (_React$Component) {
  _inherits(OdaiSlotPage, _React$Component);

  function OdaiSlotPage() {
    _classCallCheck(this, OdaiSlotPage);

    _get(Object.getPrototypeOf(OdaiSlotPage.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(OdaiSlotPage, [{
    key: 'turnSlot',
    value: function turnSlot(i) {
      OdaiActions.turnSlot(i);
    }
  }, {
    key: 'selectOdai',
    value: function selectOdai() {
      OdaiActions.selectOdai(this.props.randomOdai.uuid);
      PromotionActions.hideWindow();
    }
  }, {
    key: 'renderOdaiSlot',
    value: function renderOdaiSlot() {
      var _this = this;

      if (!this.props.randomOdai) {
        return;
      }

      var descHead = Locale.text('admin.odai.slot_description_head');
      var descFoot = Locale.text('admin.odai.slot_description_foot');
      var descList = [Locale.text('admin.odai.slot_description_1'), Locale.text('admin.odai.slot_description_2')];

      var device = this.props.device;

      var shortenedTitle = shortener('promotion-odaislot-randomodai-title-inner ' + device, this.props.randomOdai.title, 2);

      return React.createElement(
        'div',
        null,
        React.createElement(
          'div',
          { className: 'promotion-odaislot-header' },
          React.createElement(
            'span',
            null,
            React.createElement('i', { className: 'blogicon-odaislot lg' }),
            Locale.text('admin.odai.odai_slot')
          )
        ),
        React.createElement(
          'div',
          { className: 'promotion-odaislot-tagline ' + device },
          React.createElement(
            'p',
            null,
            React.createElement(HtmlText, { body: descHead })
          )
        ),
        React.createElement(
          'div',
          { className: 'promotion-odaislot-description ' + device },
          React.createElement(
            'ul',
            null,
            descList.map(function (d, i) {
              return React.createElement(
                'li',
                { key: i },
                React.createElement(HtmlText, { body: d })
              );
            })
          )
        ),
        React.createElement(
          'div',
          { className: 'promotion-odaislot-randomodai ' + device },
          React.createElement(
            'span',
            { className: 'promotion-odaislot-randomodai-title ' + device },
            React.createElement(
              'span',
              { className: 'promotion-odaislot-randomodai-title-inner ' + device },
              shortenedTitle
            )
          ),
          React.createElement(
            'div',
            { className: 'promotion-odaislot-randomodai-slotbutton ' + device,
              ref: 'slotButton',
              onClick: function () {
                return _this.turnSlot();
              } },
            React.createElement('i', { className: 'blogicon-repeat tipsy-top',
              title: Locale.text('admin.odai.turn') })
          )
        ),
        React.createElement(
          'button',
          { type: 'button', className: 'promotion-odaislot-insertbutton',
            ref: 'insertButton',
            onClick: function () {
              return _this.selectOdai();
            } },
          Locale.text('admin.odai.insert')
        ),
        React.createElement(
          'div',
          { className: 'promotion-odaislot-footer' },
          React.createElement(
            'p',
            null,
            descFoot
          )
        )
      );
    }
  }, {
    key: 'render',
    value: function render() {
      return React.createElement(
        'div',
        { className: 'promotion-odaislot ' + this.props.device },
        this.renderOdaiSlot()
      );
    }
  }]);

  return OdaiSlotPage;
})(React.Component);

OdaiSlotPage.propTypes = {
  randomOdai: React.PropTypes.object,
  selectedOdais: React.PropTypes.array.isRequired,
  device: React.PropTypes.string.isRequired
};

module.exports = OdaiSlotPage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../actions/OdaiActions":507,"../actions/PromotionActions":508,"js/Base/HtmlText":290,"js/Locale":561}],515:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');
var PromotionActions = require('../actions/PromotionActions');
var EntriesActions = require('../actions/EntriesActions');
var EntriesPage = require('./EntriesPage');
var OdaiSlotPage = require('./OdaiSlotPage');
var pageIds = require('../Constants').pageIds;

/**
 * Promotion
 * 
 */

var PageSwitcher = (function (_React$Component) {
    _inherits(PageSwitcher, _React$Component);

    function PageSwitcher() {
        _classCallCheck(this, PageSwitcher);

        _get(Object.getPrototypeOf(PageSwitcher.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PageSwitcher, [{
        key: 'openOdaiSlotPage',
        value: function openOdaiSlotPage(e) {
            // preventDefaultiOSWebView
            e.preventDefault();
            PromotionActions.setPage(pageIds.ODAI_SLOT_PAGE);
        }
    }, {
        key: 'openEntriesPage',
        value: function openEntriesPage(e) {
            e.preventDefault();
            EntriesActions.showEntryAt(0);
            PromotionActions.setPage(pageIds.ENTRIES_PAGE);
        }
    }, {
        key: 'renderPage',
        value: function renderPage() {
            if (this.props.currentPage === pageIds.ENTRIES_PAGE) {
                return React.createElement(EntriesPage, {
                    device: this.props.device,
                    entries: this.props.entries.entries,
                    currentEntry: this.props.entries.currentEntry });
            }
            if (this.props.currentPage === pageIds.ODAI_SLOT_PAGE) {
                return React.createElement(OdaiSlotPage, {
                    device: this.props.device,
                    randomOdai: this.props.odai.randomOdai,
                    selectedOdais: this.props.odai.selectedOdais });
            }
        }
    }, {
        key: 'renderSwitch',
        value: function renderSwitch() {
            if (this.props.currentPage === pageIds.ENTRIES_PAGE) {
                return this.renderOdaiSlotSwitch();
            }
            if (this.props.currentPage === pageIds.ODAI_SLOT_PAGE) {
                return this.renderEntriesSwitch();
            }
        }
    }, {
        key: 'renderOdaiSlotSwitch',
        value: function renderOdaiSlotSwitch() {
            var _this = this;

            if (this.props.odai.odais.length === 0) {
                return null;
            }

            return React.createElement(
                'div',
                { className: 'promotion-pages-switch' },
                React.createElement(
                    'div',
                    { className: 'promotion-pages-switch-link ' + this.props.device },
                    React.createElement(
                        'a',
                        { href: '#',
                            ref: 'switchToOdaiSlotPage',
                            onClick: function (e) {
                                return _this.openOdaiSlotPage(e);
                            } },
                        Locale.text('admin.odai.open_slot'),
                        ' >'
                    )
                )
            );
        }
    }, {
        key: 'renderEntriesSwitch',
        value: function renderEntriesSwitch() {
            var _this2 = this;

            if (this.props.entries.entries.length === 0) {
                return null;
            }

            return React.createElement(
                'div',
                { className: 'promotion-pages-switch' },
                React.createElement(
                    'div',
                    { className: 'promotion-pages-switch-link ' + this.props.device },
                    React.createElement(
                        'a',
                        { href: '#',
                            ref: 'switchToEntriesPage',
                            onClick: function (e) {
                                return _this2.openEntriesPage(e);
                            } },
                        '< ',
                        Locale.text('admin.odai.leave_slot')
                    )
                )
            );
        }
    }, {
        key: 'render',
        value: function render() {
            return React.createElement(
                'div',
                { className: 'promotion-pages ' + this.props.device },
                this.renderPage(),
                this.renderSwitch()
            );
        }
    }]);

    return PageSwitcher;
})(React.Component);

PageSwitcher.propTypes = {
    entries: React.PropTypes.object.isRequired,
    odai: React.PropTypes.object.isRequired,
    currentPage: React.PropTypes.string.isRequired,
    device: React.PropTypes.string.isRequired
};

module.exports = PageSwitcher;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Constants":504,"../actions/EntriesActions":506,"../actions/PromotionActions":508,"./EntriesPage":510,"./OdaiSlotPage":514,"js/Locale":561}],516:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var EntriesBar = require('./EntriesBar');
var OdaiSlotBar = require('./OdaiSlotBar');
var EntriesStorePC = require('../stores/EntriesStorePC');
var OdaiStorePC = require('../stores/OdaiStorePC');

/**
 * Promotion
 * IDStore
 */

var PromotionBar = (function (_React$Component) {
    _inherits(PromotionBar, _React$Component);

    function PromotionBar() {
        _classCallCheck(this, PromotionBar);

        _get(Object.getPrototypeOf(PromotionBar.prototype), 'constructor', this).call(this);

        this.state = {
            entries: EntriesStorePC.getState(),
            odai: OdaiStorePC.getState()
        };

        this.updateState = this._updateState.bind(this);
    }

    _createClass(PromotionBar, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            EntriesStorePC.on('change', this.updateState);
            OdaiStorePC.on('change', this.updateState);
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            EntriesStorePC.removeListener('change', this.updateState);
            OdaiStorePC.removeListener('change', this.updateState);
        }
    }, {
        key: '_updateState',
        value: function _updateState() {
            this.setState({
                entries: EntriesStorePC.getState(),
                odai: OdaiStorePC.getState()
            });
        }
    }, {
        key: 'render',
        value: function render() {
            return React.createElement(
                'div',
                null,
                React.createElement(EntriesBar, { entries: this.state.entries }),
                React.createElement(OdaiSlotBar, { odai: this.state.odai })
            );
        }
    }]);

    return PromotionBar;
})(React.Component);

module.exports = PromotionBar;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../stores/EntriesStorePC":524,"../stores/OdaiStorePC":527,"./EntriesBar":509,"./OdaiSlotBar":512}],517:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var PromotionActions = require('../actions/PromotionActions');
var EntriesActions = require('../actions/EntriesActions');

/**
 * Promotion
 */

var PromotionContent = (function (_React$Component) {
    _inherits(PromotionContent, _React$Component);

    function PromotionContent() {
        _classCallCheck(this, PromotionContent);

        _get(Object.getPrototypeOf(PromotionContent.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PromotionContent, [{
        key: 'render',
        value: function render() {
            var _this = this;

            var className = 'promotion-entry';
            className += this.props.isSelected ? ' selected' : '';
            className += ' ' + this.props.device;

            var body = function body() {
                return { __html: _this.props.entry.body };
            };

            return React.createElement(
                'div',
                { className: className,
                    onClick: function (e) {
                        return _this.onClick(e);
                    } },
                React.createElement('div', { dangerouslySetInnerHTML: body() })
            );
        }

        /**
         * data-keyword
         */
    }, {
        key: 'onClick',
        value: function onClick(e) {
            var keyword = e.target.getAttribute('data-keyword');
            if (!keyword) {
                return;
            }

            EntriesActions.fillKeyword(keyword);
            PromotionActions.hideWindow();
        }
    }]);

    return PromotionContent;
})(React.Component);

PromotionContent.propTypes = {
    entry: React.PropTypes.object.isRequired,
    isSelected: React.PropTypes.bool.isRequired,
    device: React.PropTypes.string.isRequired
};

module.exports = PromotionContent;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../actions/EntriesActions":506,"../actions/PromotionActions":508}],518:[function(require,module,exports){
(function (global){
'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactCSSTransitionGroup = React.addons.CSSTransitionGroup;
var PromotionStore = require('../stores/PromotionStore');
var EntriesStorePC = require('../stores/EntriesStorePC');
var OdaiStorePC = require('../stores/OdaiStorePC');
var PromotionModalWrapper = require('./PromotionModalWrapper');

/**
 * Promotion
 */

var PromotionModal = (function (_React$Component) {
    _inherits(PromotionModal, _React$Component);

    function PromotionModal() {
        _classCallCheck(this, PromotionModal);

        _get(Object.getPrototypeOf(PromotionModal.prototype), 'constructor', this).call(this);

        this.state = _extends({}, PromotionStore.getState(), {
            odai: OdaiStorePC.getState(),
            entries: EntriesStorePC.getState()
        });

        this.updateState = this._updateState.bind(this);
    }

    _createClass(PromotionModal, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            PromotionStore.on('change', this.updateState);
            EntriesStorePC.on('change', this.updateState);
            OdaiStorePC.on('change', this.updateState);
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            PromotionStore.removeListener('change', this.updateState);
            EntriesStorePC.removeListener('change', this.updateState);
            OdaiStorePC.removeListener('change', this.updateState);
        }
    }, {
        key: '_updateState',
        value: function _updateState() {
            this.setState(_extends({}, PromotionStore.getState(), {
                odai: OdaiStorePC.getState(),
                entries: EntriesStorePC.getState()
            }));
        }
    }, {
        key: 'render',
        value: function render() {
            return React.createElement(
                ReactCSSTransitionGroup,
                { transitionName: 'fade', transitionEnterTimeout: 300, transitionLeaveTimeout: 300 },
                React.createElement(PromotionModalWrapper, this.state)
            );
        }
    }]);

    return PromotionModal;
})(React.Component);

module.exports = PromotionModal;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../stores/EntriesStorePC":524,"../stores/OdaiStorePC":527,"../stores/PromotionStore":529,"./PromotionModalWrapper":519}],519:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var PromotionWindow = require('./PromotionWindow');
var PromotionActions = require('../actions/PromotionActions');

/**
 * Promotion
 * PromotionWindow/
 */

var PromotionModalWrapper = (function (_React$Component) {
    _inherits(PromotionModalWrapper, _React$Component);

    function PromotionModalWrapper() {
        _classCallCheck(this, PromotionModalWrapper);

        _get(Object.getPrototypeOf(PromotionModalWrapper.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PromotionModalWrapper, [{
        key: 'render',
        value: function render() {
            var _this = this;

            var style = {
                display: this.props.isWindowVisible ? 'block' : 'none'
            };

            return React.createElement(
                'div',
                { className: 'promotion-wrapper', key: 0, style: style,
                    ref: 'wrapper' },
                React.createElement('div', { className: 'promotion-background',
                    ref: 'background',
                    onClick: function () {
                        return _this.hideWindow();
                    } }),
                React.createElement(PromotionWindow, {
                    entries: this.props.entries,
                    odai: this.props.odai,
                    currentPage: this.props.currentPage })
            );
        }
    }, {
        key: 'hideWindow',
        value: function hideWindow() {
            PromotionActions.hideWindow();
        }
    }]);

    return PromotionModalWrapper;
})(React.Component);

PromotionModalWrapper.propTypes = {
    odai: React.PropTypes.object.isRequired,
    entries: React.PropTypes.object.isRequired,
    currentPage: React.PropTypes.string.isRequired
};

module.exports = PromotionModalWrapper;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../actions/PromotionActions":508,"./PromotionWindow":521}],520:[function(require,module,exports){
(function (global){
'use strict';

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var PromotionStore = require('../stores/PromotionStore');
var EntriesStoreTouch = require('../stores/EntriesStoreTouch');
var OdaiStoreTouch = require('../stores/OdaiStoreTouch');
var PageSwitcher = require('./PageSwitcher');

/**
 * Promotion
 */

var PromotionTouch = (function (_React$Component) {
    _inherits(PromotionTouch, _React$Component);

    function PromotionTouch() {
        _classCallCheck(this, PromotionTouch);

        _get(Object.getPrototypeOf(PromotionTouch.prototype), 'constructor', this).call(this);

        this.state = _extends({}, PromotionStore.getState(), {
            odai: OdaiStoreTouch.getState(),
            entries: EntriesStoreTouch.getState()
        });

        this.updateState = this._updateState.bind(this);
    }

    _createClass(PromotionTouch, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            PromotionStore.on('change', this.updateState);
            EntriesStoreTouch.on('change', this.updateState);
            OdaiStoreTouch.on('change', this.updateState);
        }
    }, {
        key: 'componentWillUnmount',
        value: function componentWillUnmount() {
            PromotionStore.removeListener('change', this.updateState);
            EntriesStoreTouch.removeListener('change', this.updateState);
            OdaiStoreTouch.removeListener('change', this.updateState);
        }
    }, {
        key: '_updateState',
        value: function _updateState() {
            this.setState(_extends({}, PromotionStore.getState(), {
                odai: OdaiStoreTouch.getState(),
                entries: EntriesStoreTouch.getState()
            }));
        }
    }, {
        key: 'render',
        value: function render() {
            return React.createElement(PageSwitcher, {
                entries: this.state.entries,
                odai: this.state.odai,
                device: 'Touch',
                currentPage: this.state.currentPage });
        }
    }]);

    return PromotionTouch;
})(React.Component);

module.exports = PromotionTouch;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../stores/EntriesStoreTouch":525,"../stores/OdaiStoreTouch":528,"../stores/PromotionStore":529,"./PageSwitcher":515}],521:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var PromotionActions = require('../actions/PromotionActions');
var PageSwitcher = require('./PageSwitcher');

/**
 * Promotion
 * 
 */

var PromotionWindow = (function (_React$Component) {
    _inherits(PromotionWindow, _React$Component);

    function PromotionWindow() {
        _classCallCheck(this, PromotionWindow);

        _get(Object.getPrototypeOf(PromotionWindow.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PromotionWindow, [{
        key: 'hideWindow',
        value: function hideWindow() {
            PromotionActions.hideWindow();
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'div',
                { className: 'promotion-window' },
                React.createElement(
                    'div',
                    { className: 'promotion-window-close',
                        ref: 'closeButton',
                        onClick: function () {
                            return _this.hideWindow();
                        } },
                    React.createElement('i', { className: 'blogicon-close' })
                ),
                React.createElement(PageSwitcher, {
                    entries: this.props.entries,
                    odai: this.props.odai,
                    device: 'PC',
                    currentPage: this.props.currentPage })
            );
        }
    }]);

    return PromotionWindow;
})(React.Component);

PromotionWindow.propTypes = {
    entries: React.PropTypes.object.isRequired,
    odai: React.PropTypes.object.isRequired,
    currentPage: React.PropTypes.string.isRequired
};

module.exports = PromotionWindow;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../actions/PromotionActions":508,"./PageSwitcher":515}],522:[function(require,module,exports){
(function (global){
'use strict';

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactDOM = (typeof window !== "undefined" ? window['ReactDOM'] : typeof global !== "undefined" ? global['ReactDOM'] : null);
var Logger = require('js/Base/Logger');

var PromotionEntry = require('./PromotionEntry');
var PromotionModal = require('./components/PromotionModal');
var PromotionBar = require('./components/PromotionBar');
var EntriesActions = require('./actions/EntriesActions');
var OdaiActions = require('./actions/OdaiActions');

var PromotionStore = require('js/Editor/Component/Promotion/stores/PromotionStore');
var EntriesStorePC = require('js/Editor/Component/Promotion/stores/EntriesStorePC');
var OdaiStorePC = require('js/Editor/Component/Promotion/stores/OdaiStorePC');

/**
 * Promotion
 * - PromotionWrapper, PromotionButtons
 * - DOMStore
 *
 * @param {Element} wrapperElement - PromotionWrapper
 * @param {Element} buttonsElement - PromotionButtons
 * @param {Editor}  editor
 */
var initPromotion = function initPromotion(modalElement, buttonsElement, editor) {
    // Store
    PromotionStore.init();
    EntriesStorePC.init();
    OdaiStorePC.init();

    // editor
    EntriesActions.setEditor(editor);
    OdaiActions.setEditor(editor);

    // PRPR
    // 21
    ReactDOM.render(React.createElement(PromotionBar, null), buttonsElement);
    ReactDOM.render(React.createElement(PromotionModal, null), modalElement);

    // HTMLJSON
    var entriesJson = modalElement.getAttribute('data-entries-json');
    var entries = [];
    try {
        entries = JSON.parse(entriesJson).map(function (e) {
            return new PromotionEntry(e);
        });
    } catch (e) {
        Logger.BUG(e, 'Cannot parse embedded PromotionEntry JSON data');
    }

    // Store
    EntriesActions.loadEntries(entries);
    OdaiActions.loadOdais();
};

module.exports = {
    init: initPromotion
};

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./PromotionEntry":505,"./actions/EntriesActions":506,"./actions/OdaiActions":507,"./components/PromotionBar":516,"./components/PromotionModal":518,"js/Base/Logger":293,"js/Editor/Component/Promotion/stores/EntriesStorePC":524,"js/Editor/Component/Promotion/stores/OdaiStorePC":527,"js/Editor/Component/Promotion/stores/PromotionStore":529}],523:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _ = require('underscore');

var trackEvent = require('js/Base/EventTracker').trackEvent;
var Dispatcher = require('js/Base/Dispatcher');
var actions = require('../Constants').actions;

var EntriesStore = (function (_Dispatcher$Store) {
    _inherits(EntriesStore, _Dispatcher$Store);

    function EntriesStore() {
        _classCallCheck(this, EntriesStore);

        _get(Object.getPrototypeOf(EntriesStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntriesStore, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this.state = {
                entries: [],
                activeEntries: [],
                currentEntry: null
            };

            Dispatcher.on(actions.LOAD_ENTRIES, function (data) {
                _this.loadEntries(data);
                _this.emit('change');
            });
            Dispatcher.on(actions.SHOW_ENTRY_AT, function (i) {
                _this.showEntryAt(i);
                _this.emit('change');
            });
            Dispatcher.on(actions.SHOW_ENTRY, function (entryId) {
                _this.showEntry(entryId);
                _this.emit('change');
            });
            Dispatcher.on(actions.FILL_KEYWORD, function (keyword) {
                _this.fillKeyword(keyword);
                _this.emit('change');
            });
        }

        /**
         * 
         * activeEntries
         *
         * @param {Array<PromotionEntry>} entries
         */
    }, {
        key: 'loadEntries',
        value: function loadEntries(entries) {
            //  2 
            // 
            var unreadEntries = entries.filter(function (e) {
                return !e.isRead() && !e.isClosed();
            });
            var readEntries = entries.filter(function (e) {
                return e.isRead() && !e.isClosed();
            });
            var activeEntries = _.first(unreadEntries.concat(_.shuffle(readEntries)), 2);

            this.state.entries = entries;
            this.state.activeEntries = activeEntries;
        }

        /**
         * ID
         * @param {string} entryId - ID
         */
    }, {
        key: 'showEntry',
        value: function showEntry(entryId) {
            var i = _.findIndex(this.state.entries, function (entry) {
                return entry.id === entryId;
            });
            if (i === -1) {
                return;
            }
            this.showEntryAt(i);
        }

        /**
         * index
         * @param {number} index - index
         */
    }, {
        key: 'showEntryAt',
        value: function showEntryAt(i) {
            var entry = this.state.entries[i];
            entry.setAsRead();
            this.state.currentEntry = entry;
            trackEvent('Promotion.Entry.Show.' + entry.id);
        }

        /**
         * 
         * @abstract
         * @param {string} keyword
         */
    }, {
        key: 'fillKeyword',
        value: function fillKeyword(keyword) {
            throw new Error('Abstract method "EntriesStore.prototype.fillKeyword" was called');
        }
    }]);

    return EntriesStore;
})(Dispatcher.Store);

module.exports = EntriesStore;

},{"../Constants":504,"js/Base/Dispatcher":281,"js/Base/EventTracker":284,"underscore":213}],524:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var EntriesStore = require('./EntriesStore');
var Dispatcher = require('js/Base/Dispatcher');
var actions = require('../Constants').actions;

/**
 * PCPromotionEntry
 * /
 */

var EntriesStorePC = (function (_EntriesStore) {
    _inherits(EntriesStorePC, _EntriesStore);

    function EntriesStorePC() {
        _classCallCheck(this, EntriesStorePC);

        _get(Object.getPrototypeOf(EntriesStorePC.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntriesStorePC, [{
        key: 'init',
        value: function init() {
            var _this = this;

            _get(Object.getPrototypeOf(EntriesStorePC.prototype), 'init', this).call(this);

            Dispatcher.on(actions.SET_EDITOR, function (editor) {
                _this.setEditor(editor);
            });
            Dispatcher.on(actions.CLOSE_ENTRY, function (entryId) {
                _this.closeEntry(entryId);
                _this.emit('change');
            });
        }

        /**
         * Editor
         * @param {Editor} editor
         */
    }, {
        key: 'setEditor',
        value: function setEditor(editor) {
            this.editor = editor;
        }

        /**
         * PromotionButton
         * @param {string} entryId
         */
    }, {
        key: 'closeEntry',
        value: function closeEntry(entryId) {
            var _this2 = this;

            var i = _.findIndex(this.state.entries, function (entry) {
                return entry.id === entryId;
            });
            var entry = this.state.entries[i];

            // 1
            entry.setAsClosed();

            // XXX 
            $('.tipsy > *').remove();

            // 
            setTimeout(function () {
                return _this2.editor.emit('resizeRequired');
            }, 0);
        }

        /**
         * 
         * @override
         * @param {string} keyword
         */
    }, {
        key: 'fillKeyword',
        value: function fillKeyword(keyword) {
            this.editor.insertLines([keyword]);
        }
    }]);

    return EntriesStorePC;
})(EntriesStore);

module.exports = new EntriesStorePC();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Constants":504,"./EntriesStore":523,"js/Base/Dispatcher":281,"underscore":213}],525:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var EntriesStore = require('./EntriesStore');
var EditorConnector = require('js/Base/EditorConnector');

/**
 * TouchPromotionEntry
 * PCEditorConnector
 */

var EntriesStoreTouch = (function (_EntriesStore) {
    _inherits(EntriesStoreTouch, _EntriesStore);

    function EntriesStoreTouch() {
        _classCallCheck(this, EntriesStoreTouch);

        _get(Object.getPrototypeOf(EntriesStoreTouch.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(EntriesStoreTouch, [{
        key: 'fillKeyword',

        /**
         * 
         * @override
         * @param {string} keyword
         */
        value: function fillKeyword(keyword) {
            var lines = [keyword];
            EditorConnector.insertLines({
                html: lines,
                hatena: lines,
                markdown: lines
            });
        }
    }]);

    return EntriesStoreTouch;
})(EntriesStore);

module.exports = new EntriesStoreTouch();

},{"./EntriesStore":523,"js/Base/EditorConnector":283}],526:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _ = require('underscore');
var Dispatcher = require('js/Base/Dispatcher');
var actions = require('../Constants').actions;

var OdaiStore = (function (_Dispatcher$Store) {
    _inherits(OdaiStore, _Dispatcher$Store);

    function OdaiStore() {
        _classCallCheck(this, OdaiStore);

        _get(Object.getPrototypeOf(OdaiStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(OdaiStore, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this.state = {
                odais: [],
                randomOdai: null,
                slotCount: 0,
                selectedOdais: [],
                isKilled: this.isKilled(),
                isActive: this.isActive()
            };

            Dispatcher.on(actions.LOAD_ODAIS, function (odais) {
                _this.loadOdais(odais);
                _this.emit('change');
            });
            Dispatcher.on(actions.SELECT_ODAI, function (odaiId) {
                _this.selectOdai(odaiId);
                _this.emit('change');
            });
            Dispatcher.on(actions.TURN_SLOT, function () {
                _this.turnSlot();
                _this.emit('change');
            });
        }
    }, {
        key: 'isKilled',
        value: function isKilled() {
            try {
                return !!localStorage['Hatena.Diary.Promotion.OdaiSlot.isKilled'] || false;
            } catch (ignore) {}

            return false;
        }
    }, {
        key: 'isActive',
        value: function isActive() {
            try {
                var isActive = localStorage['Hatena.Diary.Promotion.OdaiSlot.isActive'];
                if (isActive === 'false') {
                    return false;
                }
            } catch (ignore) {}

            return true;
        }

        /**
         * 
         *
         * @param {Array<Odai>} odais
         */
    }, {
        key: 'loadOdais',
        value: function loadOdais(odais) {
            this.state.odais = _.shuffle(odais);
            this.turnSlot();
        }

        /**
         * 
         * @param {string} odaiId
         * @abstract
         */
    }, {
        key: 'selectOdai',
        value: function selectOdai(odaiId) {
            throw new Error('Abstract method "OdaiStore.prototype.selectOdai" was called');
        }

        /**
         * 
         * shuffleodais
         */
    }, {
        key: 'turnSlot',
        value: function turnSlot() {
            if (this.state.slotCount === this.state.odais.length) {
                this.state.slotCount = 0;
                this.state.odais = _.shuffle(this.state.odais);
            }

            this.state.randomOdai = this.state.odais[this.state.slotCount];
            this.state.slotCount += 1;
        }
    }]);

    return OdaiStore;
})(Dispatcher.Store);

module.exports = OdaiStore;

},{"../Constants":504,"js/Base/Dispatcher":281,"underscore":213}],527:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var globalData = require('js/Base/globalData');
var Dispatcher = require('js/Base/Dispatcher');
var actions = require('../Constants').actions;
var OdaiStore = require('./OdaiStore');

var OdaiStorePC = (function (_OdaiStore) {
    _inherits(OdaiStorePC, _OdaiStore);

    function OdaiStorePC() {
        _classCallCheck(this, OdaiStorePC);

        _get(Object.getPrototypeOf(OdaiStorePC.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(OdaiStorePC, [{
        key: 'init',
        value: function init() {
            var _this = this;

            _get(Object.getPrototypeOf(OdaiStorePC.prototype), 'init', this).call(this);

            Dispatcher.on(actions.SET_EDITOR, function (editor) {
                _this.setEditor(editor);
            });
            Dispatcher.on(actions.KILL_ODAISLOT, function () {
                _this.killSlot();
                _this.emit('change');
            });
            Dispatcher.on(actions.SET_INACTIVE, function () {
                _this.setInactive();
                _this.emit('change');
            });
        }

        /**
         * Editor
         * @param {Editor} editor
         */
    }, {
        key: 'setEditor',
        value: function setEditor(editor) {
            this.editor = editor;
        }

        /**
         * 
         */
    }, {
        key: 'selectOdai',
        value: function selectOdai(odaiId) {
            var i = _.findIndex(this.state.odais, function (odai) {
                return odai.uuid === odaiId;
            });
            var odai = this.state.odais[i];
            if (!odai) {
                return;
            }

            // 
            if (_.findIndex(this.state.selectedOdais, function (o) {
                return o.uuid === odaiId;
            }) === -1) {
                this.state.selectedOdais.push(odai);
            }

            // 
            if (this.editor.getBody().indexOf('/-/odai/' + odai.uuid) === -1) {
                var title = Locale.text('admin.odai.fillin', odai.title);
                var fillIn = '[' + globalData('admin-domain') + '/-/odai/' + odai.uuid + ':title=' + title + ']';

                this.editor.insertLines([fillIn]);
            }
        }

        /**
         * 
         */
    }, {
        key: 'killSlot',
        value: function killSlot() {
            this.state.isKilled = true;

            // XXX 
            $('.tipsy > *').remove();

            try {
                localStorage['Hatena.Diary.Promotion.OdaiSlot.isKilled'] = true;
            } catch (ignore) {}
        }

        /**
         * <NEW> 
         */
    }, {
        key: 'setInactive',
        value: function setInactive() {
            this.state.isActive = false;
            try {
                localStorage['Hatena.Diary.Promotion.OdaiSlot.isActive'] = false;
            } catch (ignore) {}
        }
    }]);

    return OdaiStorePC;
})(OdaiStore);

module.exports = new OdaiStorePC();

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Constants":504,"./OdaiStore":526,"js/Base/Dispatcher":281,"js/Base/globalData":302,"js/Locale":561,"underscore":213}],528:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _ = require('underscore');
var Locale = require('js/Locale');
var globalData = require('js/Base/globalData');
var EditorConnector = require('js/Base/EditorConnector');
var OdaiStore = require('./OdaiStore');

var OdaiStoreTouch = (function (_OdaiStore) {
    _inherits(OdaiStoreTouch, _OdaiStore);

    function OdaiStoreTouch() {
        _classCallCheck(this, OdaiStoreTouch);

        _get(Object.getPrototypeOf(OdaiStoreTouch.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(OdaiStoreTouch, [{
        key: 'selectOdai',

        /**
         * 
         * @override
         * @param {string} odaiId
         */
        value: function selectOdai(odaiId) {
            var i = _.findIndex(this.state.odais, function (odai) {
                return odai.uuid === odaiId;
            });
            var odai = this.state.odais[i];
            if (!odai) {
                return;
            }

            // 
            if (_.findIndex(this.state.selectedOdais, function (o) {
                return o.uuid === odaiId;
            }) === -1) {
                this.state.selectedOdais.push(odai);
            }

            // 
            var title = Locale.text('admin.odai.fillin', odai.title);
            var fillIn = '[' + globalData('admin-domain') + '/-/odai/' + odai.uuid + ':title=' + title + ']';

            var lines = [fillIn];
            EditorConnector.insertLines({
                html: lines,
                hatena: lines,
                markdown: lines
            });
        }
    }]);

    return OdaiStoreTouch;
})(OdaiStore);

module.exports = new OdaiStoreTouch();

},{"./OdaiStore":526,"js/Base/EditorConnector":283,"js/Base/globalData":302,"js/Locale":561,"underscore":213}],529:[function(require,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var Dispatcher = require('js/Base/Dispatcher');
var actions = require('../Constants').actions;
var pageIds = require('../Constants').pageIds;

var PromotionStore = (function (_Dispatcher$Store) {
    _inherits(PromotionStore, _Dispatcher$Store);

    function PromotionStore() {
        _classCallCheck(this, PromotionStore);

        _get(Object.getPrototypeOf(PromotionStore.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(PromotionStore, [{
        key: 'init',
        value: function init() {
            var _this = this;

            this.state = {
                isWindowVisible: false,
                currentPage: pageIds.ENTRIES_PAGE
            };

            Dispatcher.on(actions.SHOW_WINDOW, function () {
                _this.showWindow();
                _this.emit('change');
            });
            Dispatcher.on(actions.HIDE_WINDOW, function () {
                _this.hideWindow();
                _this.emit('change');
            });
            Dispatcher.on(actions.SET_PAGE, function (pageId) {
                _this.setPage(pageId);
                _this.emit('change');
            });
        }

        /**
         * Promotion
         */
    }, {
        key: 'showWindow',
        value: function showWindow() {
            this.state.isWindowVisible = true;
        }

        /**
         * Promotion
         */
    }, {
        key: 'hideWindow',
        value: function hideWindow() {
            this.state.isWindowVisible = false;
        }
    }, {
        key: 'setPage',
        value: function setPage(pageId) {
            this.state.currentPage = pageId;
        }
    }]);

    return PromotionStore;
})(Dispatcher.Store);

module.exports = new PromotionStore();

},{"../Constants":504,"js/Base/Dispatcher":281}],530:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var keyString = require('js/keyString');
var BUG = require('js/Base/Logger').BUG;
var EditorConnector = require('js/Base/EditorConnector');
var extractSyntax = require('js/Base/extractSyntax');
var globalData = require('js/Base/globalData');
var extend = require('js/Util/extend');
var MyCuration = require('./MyCuration');

/**
 * 
 */
var TEMPLATE = _.template('<blockquote cite="<%- url %>" data-uuid="<%- uuid %>"><p><%- body %></p><cite><a href="<%- url %>"><%- title %></a></cite></blockquote>');
var Quote = function Quote() {
    this.init.apply(this, arguments);
};

Quote.prototype = {
    parent: MyCuration,
    init: function init(args) {
        this.type = 'editor-quote';

        this.$indicator = args.container.find('.indicator');

        this.parent.prototype.init.call(this, args);

        this._templatesByType = {
            'default': _.template(this.$container.find('.quote-item-template').html())
        };
    },

    bindEvents: function bindEvents() {
        var self = this;

        self.parent.prototype.bindEvents.call(self);

        self.$submit = self.$container.find('.quote-keyword-submit');
        self.$keyword = self.$container.find('.quote-keyword');

        self.$submit.on('click', function (event) {
            self.initLoadCondition();
            self.requestReload();
            return false;
        });

        self.$keyword.on('keydown', function (event) {
            if (keyString(event) == 'RET') {
                self.initLoadCondition();
                self.requestReload();
                return false;
            }
        });

        self.$itemsContainer.on('click', '.js-button-quote-delete', function (event) {
            var $target = $(event.target);
            var uuid = $target.attr("data-uuid");
            $.ajax({
                url: '/api/quotes/delete',
                data: {
                    uuid: uuid,
                    rkm: globalData('rkm'),
                    rkc: globalData('rkc')
                },
                cache: false,
                type: 'post',
                dataType: 'json'
            }).done(function (res) {
                $('.item[data-uuid="' + uuid + '"]').remove();
            }).fail(function (res) {
                console.log("quote delete failed.");
            });
        });
    },

    initLoadCondition: function initLoadCondition() {
        this.itemsReachedEnd = false;
        this.untilEpoch = null;
    },

    serviceName: 'Quote',
    enableAutoPager: true,
    pasteReverseOrder: true,
    willRequestLoadItems: function willRequestLoadItems(more) {
        return true;
    },

    loadItems: function loadItems(more) {
        var self = this;

        return $.ajax({
            url: '/api/quotes',
            type: 'GET',
            dataType: 'json'
        }).then(function (json) {
            if (json.entries.length > 0) {
                self.itemsReachedEnd = true;
                return $.Deferred().resolve(json);
            } else {
                // 0
                return $.Deferred().reject();
            }
        });
    },

    renderItem: function renderItem(item) {
        var self = this;

        item.datetimeEpoch = Date.parse(item.datetime);

        var template = self._templateByType('default');

        return template({
            entry: item,
            trim: function trim(text, chars) {
                if (text.length <= chars) return text;
                return text.substr(0, chars - 1) + ' ...';
            }
        });
    },

    _templateByType: function _templateByType(type) {
        var self = this;
        return self._templatesByType[type] || self._templatesByType['default'];
    },

    insertItems: function insertItems(items) {
        var self = this;

        var lines = {
            hatena: [],
            markdown: []
        };

        _.each(items, function ($item) {
            var title = $item.attr('data-title') || '';
            var blog = $item.attr('data-blog') || '';
            if (blog !== '') {
                blog = ' - ' + blog;
            }
            var html = TEMPLATE({
                uuid: $item.attr('data-uuid') || '',
                url: $item.attr('data-url'),
                body: $item.attr('data-body'),
                title: title + blog
            });

            // p><
            lines.hatena.push('>' + html + '<');
            lines.markdown.push(html);
        });

        extractSyntax(lines.hatena).done(function (data) {
            lines.html = ['', data.html, ''];
        }).fail(function (error) {
            lines.html = lines.hatena;
            BUG(error);
        }).always(function () {
            if (EditorConnector.isiOS() || EditorConnector.isAndroid()) {
                // 
                lines.html = lines.hatena;
            }
            EditorConnector.insertLines(lines);
        });
    },

    /**
     * URL '#auto_fillin' quote
     */
    fillInFirstItem: function fillInFirstItem() {
        if (location.hash !== '#auto_fillin') {
            return;
        }

        var $item = this.$container.find('.item').first();

        if ($item.length > 0) {
            this.insertItems([$item]);
        }
    },

    /**
     * ReQuote
     */
    fillInReQuote: function fillInReQuote() {
        if (localStorage['ReQuote'] === undefined) {
            return;
        }
        var quote = JSON.parse(localStorage['ReQuote']);
        var $item = $('<div>').attr({
            'data-url': quote.url,
            'data-title': quote.title,
            'data-body': quote.body,
            'data-blog': ''
        });
        this.insertItems([$item]);

        localStorage.removeItem('ReQuote');
    },

    /**
     * loadItems
     */
    loadItemsFinishedHandler: function loadItemsFinishedHandler() {
        this.fillInReQuote();
        this.fillInFirstItem();
    }

};

extend(Quote.prototype, MyCuration.prototype);

module.exports = Quote;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./MyCuration":494,"js/Base/EditorConnector":283,"js/Base/Logger":293,"js/Base/extractSyntax":301,"js/Base/globalData":302,"js/Locale":561,"js/Util/extend":574,"js/keyString":599,"underscore":213}],531:[function(require,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
    value: true
});
var KNOWN_ERRORS = {
    400: true,
    429: true
};

exports.KNOWN_ERRORS = KNOWN_ERRORS;
var ERROR_MSGID = {
    429: 'edit_form.rakuten.api_limit_exceeded'
};
exports.ERROR_MSGID = ERROR_MSGID;

},{}],532:[function(require,module,exports){
Object.defineProperty(exports, '__esModule', {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _events = require('events');

var _underscore = require('underscore');

var _jsBaseEditorConnector = require('js/Base/EditorConnector');

var _jsBaseEditorConnector2 = _interopRequireDefault(_jsBaseEditorConnector);

var _jsBaseEventTracker = require('js/Base/EventTracker');

var _jsBaseEventTracker2 = _interopRequireDefault(_jsBaseEventTracker);

var _fetcher = require('./fetcher');

/**
 * @typedef {Object} Item
 * @property {string} itemName
 * @property {string} itemCode
 * @property {number} itemPrice
 * @property {number} imageFlag
 * @property {string} smallImageUrls
 * @property {string} shopName
 */

'use strict';

var RakutenViewModel = (function (_EventEmitter) {
    _inherits(RakutenViewModel, _EventEmitter);

    function RakutenViewModel() {
        _classCallCheck(this, RakutenViewModel);

        _get(Object.getPrototypeOf(RakutenViewModel.prototype), 'constructor', this).call(this);
        this.state = {
            items: [],
            selectedItemCodes: {},
            keyword: null,
            page: 1,
            error: null,
            isLoading: false
        };
    }

    _createClass(RakutenViewModel, [{
        key: 'setState',
        value: function setState(newState) {
            this.state = _extends({}, this.state, newState);
            this.emit('change');
        }
    }, {
        key: 'getState',
        value: function getState() {
            return _extends({}, this.state);
        }

        /**
         * 
         * @param {string} keyword
         * @returns {Promise}
         */
    }, {
        key: 'searchItems',
        value: function searchItems(keyword) {
            var _this = this;

            if (keyword.match(/^\s*$/)) {
                return;
            }

            this.setState({ keyword: keyword, isLoading: true });
            return (0, _fetcher.fetch)({ keyword: keyword }).then(function (items) {
                return _this.setState({ items: items, page: 1, error: null });
            })['catch'](function (error) {
                return _this.setState({ error: error });
            }).then(function () {
                return _this.setState({ isLoading: false });
            });
        }

        /**
         * 
         * @returns {Promise}
         */
    }, {
        key: 'loadNextItems',
        value: function loadNextItems() {
            var _this2 = this;

            if (this.state.error) {
                return Promise.resolve();
            }

            this.setState({ isLoading: true });

            var keyword = this.state.keyword;
            var page = this.state.page + 1;
            return (0, _fetcher.fetch)({ keyword: keyword, page: page }).then(function (items) {
                return _this2.setState({ items: _this2.state.items.concat(items), page: page });
            })['catch'](function (error) {
                return _this2.setState({ error: error });
            }).then(function () {
                return _this2.setState({ isLoading: false });
            });
        }

        /**
         * 
         * 
         * @param {Item} item
         */
    }, {
        key: 'toggleItemSelection',
        value: function toggleItemSelection(item) {
            this.setState({
                selectedItemCodes: _extends({}, this.state.selectedItemCodes, _defineProperty({}, item.itemCode, !this.state.selectedItemCodes[item.itemCode]))
            });
        }

        /**
         * rakuten
         */
    }, {
        key: 'insertSelectedItems',
        value: function insertSelectedItems() {
            var _this3 = this;

            var items = Object.keys(this.state.selectedItemCodes).filter(function (k) {
                return _this3.state.selectedItemCodes[k];
            });
            var lines = items.map(function (code) {
                return '[rakuten:' + code + ':detail]';
            });
            _jsBaseEditorConnector2['default'].insertLines({ html: lines, hatena: lines, markdown: lines });
            _jsBaseEventTracker2['default'].trackEvent('curation-rakuten-insert-item');

            // 
            this.setState({ selectedItemCodes: {} });
        }

        /**
         * rakuten
         * 
         * @param {Item} item
         */
    }, {
        key: 'insertItem',
        value: function insertItem(item) {
            var lines = ['[rakuten:' + item.itemCode + ':detail]'];
            _jsBaseEditorConnector2['default'].insertLines({ html: lines, hatena: lines, markdown: lines });
            _jsBaseEventTracker2['default'].trackEvent('curation-rakuten-insert-item');

            if (this.isItemSelected(item)) {
                this.toggleItemSelection(item);
            }
        }

        /**
         * @param {Item} item
         * @returns {boolean}
         */
    }, {
        key: 'isItemSelected',
        value: function isItemSelected(item) {
            return !!this.state.selectedItemCodes[item.itemCode];
        }

        /**
         * 
         * @returns {boolean}
         */
    }, {
        key: 'hasSelectedItems',
        value: function hasSelectedItems() {
            return (0, _underscore.values)(this.state.selectedItemCodes).filter(function (x) {
                return x;
            }).length !== 0;
        }
    }]);

    return RakutenViewModel;
})(_events.EventEmitter);

exports['default'] = RakutenViewModel;
module.exports = exports['default'];

},{"./fetcher":537,"events":207,"js/Base/EditorConnector":283,"js/Base/EventTracker":284,"underscore":213}],533:[function(require,module,exports){
(function (global){
Object.defineProperty(exports, '__esModule', {
    value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var _react2 = _interopRequireDefault(_react);

var _jsLocale = require('js/Locale');

var _jsLocale2 = _interopRequireDefault(_jsLocale);

var _Constants = require('../Constants');

'use strict';

var ErrorMessage = (function (_React$Component) {
    _inherits(ErrorMessage, _React$Component);

    function ErrorMessage() {
        _classCallCheck(this, ErrorMessage);

        _get(Object.getPrototypeOf(ErrorMessage.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(ErrorMessage, [{
        key: 'render',
        value: function render() {
            if (!this.props.error) {
                return null;
            }
            var msgid = _Constants.ERROR_MSGID[this.props.error];

            // 
            if (!msgid) {
                return null;
            }

            return _react2['default'].createElement(
                'div',
                { className: 'editor-rakuten-error' },
                _jsLocale2['default'].text(msgid)
            );
        }
    }]);

    return ErrorMessage;
})(_react2['default'].Component);

ErrorMessage.propTypes = {
    error: _react2['default'].PropTypes.any };

// number or null
exports['default'] = ErrorMessage;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Constants":531,"js/Locale":561}],534:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var SidebarInsertButton = require('js/Editor/Component/SidebarInsertButton');

var Footer = (function (_React$Component) {
    _inherits(Footer, _React$Component);

    function Footer() {
        _classCallCheck(this, Footer);

        _get(Object.getPrototypeOf(Footer.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(Footer, [{
        key: 'render',
        value: function render() {
            // disable
            var disabled = !this.props.hasSelectedItems;

            return React.createElement(
                'div',
                { className: 'editor-rakuten-footer' },
                React.createElement(SidebarInsertButton, { disabled: disabled,
                    onClick: this.props.onSubmit })
            );
        }
    }]);

    return Footer;
})(React.Component);

Footer.propTypes = {
    hasSelectedItems: React.PropTypes.bool.isRequired,
    onSubmit: React.PropTypes.func.isRequired
};

module.exports = Footer;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Editor/Component/SidebarInsertButton":540}],535:[function(require,module,exports){
(function (global){
Object.defineProperty(exports, '__esModule', {
  value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var _react2 = _interopRequireDefault(_react);

var _jsLocale = require('js/Locale');

var _jsLocale2 = _interopRequireDefault(_jsLocale);

'use strict';

var shallowCompare = _react2['default'].addons.shallowCompare;

/**
 * 
 *  "" 
 */
var shorten = function shorten(s, length) {
  return s.slice(0, length) + (s.length > length ? '' : '');
};

var Item = (function (_React$Component) {
  _inherits(Item, _React$Component);

  function Item() {
    _classCallCheck(this, Item);

    _get(Object.getPrototypeOf(Item.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(Item, [{
    key: 'shouldComponentUpdate',
    value: function shouldComponentUpdate(nextProps, nextState) {
      return shallowCompare(this, nextProps, nextState);
    }
  }, {
    key: 'renderImage',
    value: function renderImage() {
      if (!this.props.item.imageFlag) {
        return null;
      }
      return _react2['default'].createElement(
        'div',
        { className: 'editor-rakuten-item__thumbnail' },
        _react2['default'].createElement('img', { src: this.props.item.smallImageUrls[0] })
      );
    }
  }, {
    key: 'render',
    value: function render() {
      var item = this.props.item;
      return _react2['default'].createElement(
        'div',
        { className: 'editor-rakuten-item item ' + (this.props.isSelected ? 'selected' : ''),
          onClick: this.props.onSelect,
          onDoubleClick: this.props.onDoubleClick },
        _react2['default'].createElement(
          'div',
          { className: 'editor-rakuten-item__inner' },
          this.renderImage(),
          _react2['default'].createElement(
            'div',
            { className: 'editor-rakuten-item__right' },
            _react2['default'].createElement(
              'span',
              { className: 'editor-rakuten-item__name' },
              shorten(item.itemName, 60)
            ),
            _react2['default'].createElement(
              'span',
              { className: 'editor-rakuten-item__price' },
              _jsLocale2['default'].text('edit_form.rakuten.price', item.itemPrice)
            ),
            _react2['default'].createElement(
              'span',
              { className: 'editor-rakuten-item__shop-name' },
              item.shopName
            )
          )
        )
      );
    }
  }]);

  return Item;
})(_react2['default'].Component);

Item.propTypes = {
  item: _react2['default'].PropTypes.object.isRequired,
  onDoubleClick: _react2['default'].PropTypes.func.isRequired,
  onSelect: _react2['default'].PropTypes.func.isRequired,
  isSelected: _react2['default'].PropTypes.bool.isRequired
};

exports['default'] = Item;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561}],536:[function(require,module,exports){
(function (global){
Object.defineProperty(exports, '__esModule', {
  value: true
});

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _react = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var _react2 = _interopRequireDefault(_react);

var _jsLocale = require('js/Locale');

var _jsLocale2 = _interopRequireDefault(_jsLocale);

var _jsBaseURLGenerator = require('js/Base/URLGenerator');

var _jsBaseURLGenerator2 = _interopRequireDefault(_jsBaseURLGenerator);

var _jsEditorComponentInfiniteScroll = require('js/Editor/Component/InfiniteScroll');

var _jsEditorComponentInfiniteScroll2 = _interopRequireDefault(_jsEditorComponentInfiniteScroll);

var _jsEditorComponentSidebarSearchForm = require('js/Editor/Component/SidebarSearchForm');

var _jsEditorComponentSidebarSearchForm2 = _interopRequireDefault(_jsEditorComponentSidebarSearchForm);

var _Footer = require('./Footer');

var _Footer2 = _interopRequireDefault(_Footer);

var _Item = require('./Item');

var _Item2 = _interopRequireDefault(_Item);

var _ErrorMessage = require('./ErrorMessage');

var _ErrorMessage2 = _interopRequireDefault(_ErrorMessage);

/**
 * 
 * TODO: Flickr
 */
'use strict';
var LoadingIndicator = function LoadingIndicator() {
  return _react2['default'].createElement(
    'div',
    { className: 'indicator active' },
    _react2['default'].createElement('img', { src: _jsBaseURLGenerator2['default'].static_url('/images/loading.gif') }),
    _jsLocale2['default'].text('edit_form.loading')
  );
};

var Message = function Message(props) {
  return _react2['default'].createElement(
    'div',
    { className: 'editor-rakuten-items-message' },
    props.children
  );
};

/**
 * 
 */

var RakutenSidebar = (function (_React$Component) {
  _inherits(RakutenSidebar, _React$Component);

  function RakutenSidebar(props) {
    _classCallCheck(this, RakutenSidebar);

    _get(Object.getPrototypeOf(RakutenSidebar.prototype), 'constructor', this).call(this);
    this.state = props.vm.getState();
  }

  /**
   * vmthis.state
   */

  _createClass(RakutenSidebar, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      var _this = this;

      this.update = function () {
        return _this.setState(_this.props.vm.getState());
      };
      this.props.vm.on('change', this.update);
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      this.props.vm.removeListener('change', this.update);
      this.update = null;
    }
  }, {
    key: 'render',
    value: function render() {
      var _this2 = this;

      var _state = this.state;
      var items = _state.items;
      var keyword = _state.keyword;

      var isFirst = keyword === null;
      var isLoading = this.state.isLoading;
      var isEmpty = !isFirst && !isLoading && items.length === 0;

      return _react2['default'].createElement(
        'div',
        { className: 'editor-rakuten-content' },
        _react2['default'].createElement(
          'div',
          { className: 'editor-rakuten-header' },
          _react2['default'].createElement(
            'h2',
            null,
            _jsLocale2['default'].text('edit_form.rakuten')
          ),
          _react2['default'].createElement(_jsEditorComponentSidebarSearchForm2['default'], { placeholder: _jsLocale2['default'].text('edit_form.rakuten.placeholder'),
            onSubmit: function (keyword) {
              return _this2.props.vm.searchItems(keyword);
            } }),
          _react2['default'].createElement(_ErrorMessage2['default'], { error: this.state.error })
        ),
        _react2['default'].createElement(
          'div',
          { className: 'editor-rakuten-main', ref: 'main' },
          _react2['default'].createElement(
            _jsEditorComponentInfiniteScroll2['default'],
            { onScroll: function () {
                return _this2.props.vm.loadNextItems();
              }, interval: 1000 },
            _react2['default'].createElement(
              'div',
              { className: 'editor-rakuten-items' },
              items.map(function (item, i) {
                return _react2['default'].createElement(_Item2['default'], { item: item, key: i,
                  isSelected: _this2.props.vm.isItemSelected(item),
                  onSelect: function () {
                    return _this2.props.vm.toggleItemSelection(item);
                  },
                  onDoubleClick: function () {
                    return _this2.props.vm.insertItem(item);
                  } });
              }),
              isFirst ? _react2['default'].createElement(
                Message,
                null,
                _jsLocale2['default'].text('edit_form.rakuten.description')
              ) : null,
              isEmpty ? _react2['default'].createElement(
                Message,
                null,
                _jsLocale2['default'].text('edit_form.rakuten.empty', keyword)
              ) : null,
              isLoading ? _react2['default'].createElement(LoadingIndicator, null) : null
            )
          )
        ),
        _react2['default'].createElement(_Footer2['default'], {
          hasSelectedItems: this.props.vm.hasSelectedItems(),
          onSubmit: function () {
            return _this2.props.vm.insertSelectedItems();
          } })
      );
    }
  }]);

  return RakutenSidebar;
})(_react2['default'].Component);

RakutenSidebar.propTypes = {
  vm: _react2['default'].PropTypes.object.isRequired
};

exports['default'] = RakutenSidebar;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./ErrorMessage":533,"./Footer":534,"./Item":535,"js/Base/URLGenerator":298,"js/Editor/Component/InfiniteScroll":487,"js/Editor/Component/SidebarSearchForm":541,"js/Locale":561}],537:[function(require,module,exports){
Object.defineProperty(exports, '__esModule', {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports.fetch = fetch;

var _axios = require('axios');

var _jsBaseLogger = require('js/Base/Logger');

var _Constants = require('./Constants');

'use strict';

var opts = {
    headers: { 'X-Requested-With': 'XMLHttpRequest' }
};

/**
 * EpicAPI
 * 10reject
 * @param   {Object}
 * @returns {Promise<Array<Item>}
 */

function fetch(params) {
    return (0, _axios.get)('/api/rakuten', _extends({}, opts, {
        params: params
    })).then(function (res) {
        if (res.data.error) {
            throw res.data.error;
        }
        return res.data.Items;
    })['catch'](function (e) {
        // 
        if (_Constants.KNOWN_ERRORS[e.message]) {
            throw e;
        }

        // 
        (0, _jsBaseLogger.BUG)(e);
    });
}

},{"./Constants":531,"axios":1,"js/Base/Logger":293}],538:[function(require,module,exports){
(function (global){
'use strict';

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var ReactDOM = (typeof window !== "undefined" ? window['ReactDOM'] : typeof global !== "undefined" ? global['ReactDOM'] : null);
var RakutenSidebar = require('./components/RakutenSidebar');
var RakutenViewModel = require('./RakutenViewModel');

var Rakuten = function Rakuten(element) {
    _classCallCheck(this, Rakuten);

    var vm = new RakutenViewModel();
    this.main = ReactDOM.render(React.createElement(RakutenSidebar, { vm: vm }), element);
};

module.exports = Rakuten;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./RakutenViewModel":532,"./components/RakutenSidebar":536}],539:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

/**
 * SidebarButtons
 *
 * 
 */
var SidebarButtons = function SidebarButtons() {
    this.init.apply(this, arguments);
};
SidebarButtons.prototype = {

    /**
     * @param {jQuery}        $element - 
     * @param {EditorSidebar} parent   - 
     */
    init: function init($element, parent) {
        this.$element = $element;
        this.parent = parent;

        // DOM
        this.$visibleButtonsContainer = this.$element.find('.curation-bar-itemlist-visible');
        this.$overflowButtonsContainer = this.$element.find('.curation-bar-itemlist-overflow');
        this.$toggleButton = this.$element.find('.curation-bar-toggle');
        this.$othersButton = this.$element.find('.editor-others');
        this.$addButton = this.$element.find('.curation-add-button');

        // 1
        this.buttonSize = this.$othersButton.height();

        // 
        this.services = JSON.parse(this.$element.attr('data-services-json'));

        // 
        this.activeService = 'editor-home';

        // 
        this.template = _.template(this.$element.find('.template').html());
        this.render();

        this.initEvents();
    },

    initEvents: function initEvents() {
        var _this = this;

        var self = this;

        this.$toggleButton.on('click', function () {
            self.parent.emit('toggle');
        });

        this.$othersButton.on('click', function () {
            self.toggleOverflow();
        });

        // 
        this.$element.on('click', '[data-support-type]', function () {
            self.parent.emit('openByType', $(this).attr('data-support-type'));
        });

        this.parent.on('tabChange', function (type) {
            return _this.onTabChange(type);
        });
        this.parent.on('resize', function () {
            return _this.render();
        });

        this.parent.on('reloadSidebarButtons', function (res) {
            self.services = res;
            self.render();
        });
    },

    onTabChange: function onTabChange(type) {
        this.activeService = type;
        this.activateButton();
    },

    /**
     * is-active
     */
    activateButton: function activateButton() {
        var self = this;
        this.$visibleButtonsContainer.children().each(function () {
            $(this).toggleClass('is-active', $(this).attr('data-support-type') === self.activeService);
        });
        this.$overflowButtonsContainer.children().each(function () {
            $(this).toggleClass('is-active', $(this).attr('data-support-type') === self.activeService);
        });
    },

    /**
     * visibleoverflow
     * 
     */
    render: function render() {
        var self = this;

        this.$visibleButtonsContainer.empty();
        this.$overflowButtonsContainer.empty();
        this.$othersButton.show();

        this.services.forEach(function (service) {
            if (!service.showShortcut) {
                return;
            }
            self.$visibleButtonsContainer.append(self.renderButton(service));
        });

        // 
        // - overflow
        // - $othersButton
        var overflowSize = this.$addButton[0].getBoundingClientRect().bottom - $(window).height();
        if (overflowSize > 0) {
            var overflowNum = Math.floor(overflowSize / this.buttonSize) + 1;
            var $overflowButtons = this.$visibleButtonsContainer.children().splice(-overflowNum);
            this.$overflowButtonsContainer.append($overflowButtons);
            this.fixOverflowPosition();
        } else {
            this.$othersButton.hide();
        }

        this.activateButton();
    },

    renderButton: function renderButton(service) {
        var html = this.template(service);
        return $(html.trim());
    },

    /**
     * overflow/
     */
    toggleOverflow: function toggleOverflow() {
        this.$othersButton.toggleClass('is-active tipsy-left');
        this.$overflowButtonsContainer.toggleClass('is-active');

        if (this.$overflowButtonsContainer.hasClass('is-active')) {
            this.fixOverflowPosition();
        }

        // $othersButtontipsyoverflow
        this.$othersButtonTipsy = this.$othersButtonTipsy || $('.tipsy > *');
        this.$othersButtonTipsy.toggle();
    },

    /**
     * overflow
     */
    fixOverflowPosition: function fixOverflowPosition() {
        var elementTop = this.$element.offset().top;
        var bottom = this.$othersButton.offset().top - elementTop + this.$othersButton.outerHeight();
        var top = bottom - this.$overflowButtonsContainer.height();
        this.$overflowButtonsContainer.css({
            top: top
        });
    }

};

module.exports = SidebarButtons;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],540:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('../../Locale');

var SidebarInsertButton = (function (_React$Component) {
  _inherits(SidebarInsertButton, _React$Component);

  function SidebarInsertButton() {
    _classCallCheck(this, SidebarInsertButton);

    _get(Object.getPrototypeOf(SidebarInsertButton.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(SidebarInsertButton, [{
    key: 'render',
    value: function render() {
      var buttonClassName = 'paste-button btn ' + (this.props.disabled ? 'disabled' : 'enabled');

      return React.createElement(
        'div',
        { className: 'editor-sidebar-insert-button' },
        React.createElement(
          'button',
          { className: buttonClassName,
            type: 'button',
            'data-track-name': this.props.trackingId,
            disabled: this.props.disabled,
            onClick: this.props.onClick,
            ref: 'insertButton' },
          Locale.text('edit_form.paste')
        )
      );
    }
  }]);

  return SidebarInsertButton;
})(React.Component);

SidebarInsertButton.propTypes = {
  disabled: React.PropTypes.bool.isRequired,
  onClick: React.PropTypes.func.isRequired,
  trackingId: React.PropTypes.string
};

module.exports = SidebarInsertButton;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../../Locale":561}],541:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var keyString = require('js/keyString');

/**
 * 
 */

var SidebarSearchForm = (function (_React$Component) {
    _inherits(SidebarSearchForm, _React$Component);

    function SidebarSearchForm() {
        _classCallCheck(this, SidebarSearchForm);

        _get(Object.getPrototypeOf(SidebarSearchForm.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(SidebarSearchForm, [{
        key: 'onKeyPress',

        /**
         * Input
         */
        value: function onKeyPress(e) {
            // Enter
            if (keyString(e) === 'RET') {
                e.preventDefault();
                this.submit();
            }
        }
    }, {
        key: 'submit',
        value: function submit() {
            this.props.onSubmit(this.refs.input.value);
        }
    }, {
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'div',
                { className: 'editor-sidebar-search-form' },
                React.createElement('input', {
                    type: 'text',
                    placeholder: this.props.placeholder,
                    className: 'search-keyword editor-sidebar-text-input',
                    'data-ignore-click-jacking': '1',
                    size: '30',
                    onKeyPress: function (e) {
                        return _this.onKeyPress(e);
                    },
                    ref: 'input' }),
                React.createElement(
                    'button',
                    {
                        type: 'button',
                        className: 'search-keyword-submit editor-sidebar-text-submit',
                        onClick: function () {
                            return _this.submit();
                        },
                        ref: 'button' },
                    React.createElement('i', { className: 'blogicon-search' })
                )
            );
        }
    }]);

    return SidebarSearchForm;
})(React.Component);

SidebarSearchForm.propTypes = {
    placeholder: React.PropTypes.string,
    onSubmit: React.PropTypes.func
};

module.exports = SidebarSearchForm;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/keyString":599}],542:[function(require,module,exports){
(function (global){
Object.defineProperty(exports, '__esModule', {
    value: true
});

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _jquery = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var _jquery2 = _interopRequireDefault(_jquery);

var _underscore = require('underscore');

var _events = require('events');

/**
 * window resize
 * touch
 * 
 */
'use strict';

var SidebarSimulator = (function (_EventEmitter) {
    _inherits(SidebarSimulator, _EventEmitter);

    function SidebarSimulator() {
        var _this = this;

        _classCallCheck(this, SidebarSimulator);

        _get(Object.getPrototypeOf(SidebarSimulator.prototype), 'constructor', this).call(this);

        // type
        // .curation-tab-content
        this.type = document.querySelector('.curation-tab-content').id;

        (0, _jquery2['default'])('input').on('blur', function () {
            return _this.emit('resize', _this.type);
        });
        (0, _jquery2['default'])(window).on('resize', (0, _underscore.debounce)(function () {
            return _this.emit('resize', _this.type);
        }, 100));
    }

    return SidebarSimulator;
})(_events.EventEmitter);

exports['default'] = SidebarSimulator;
module.exports = exports['default'];

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"events":207,"underscore":213}],543:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var SidebarUserInfo = require('./SidebarUserInfo');
var SidebarUserForm = require('./SidebarUserForm');

var SidebarUserAssociation = (function (_React$Component) {
    _inherits(SidebarUserAssociation, _React$Component);

    function SidebarUserAssociation() {
        _classCallCheck(this, SidebarUserAssociation);

        _get(Object.getPrototypeOf(SidebarUserAssociation.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(SidebarUserAssociation, [{
        key: 'render',
        value: function render() {
            var _this = this;

            // user
            // 
            var className = "editor-sidebar-user-association";

            if (this.props.user) {
                return React.createElement(
                    'div',
                    { className: className },
                    React.createElement(SidebarUserInfo, {
                        user: this.props.user,
                        onUnregister: function () {
                            return _this.props.onUnregister();
                        },
                        ref: 'userInfo' })
                );
            } else {
                return React.createElement(
                    'div',
                    { className: className },
                    React.createElement(SidebarUserForm, {
                        placeholder: this.props.placeholder,
                        onRegister: function (name) {
                            return _this.props.onRegister(name);
                        },
                        ref: 'userForm' })
                );
            }
        }
    }]);

    return SidebarUserAssociation;
})(React.Component);

SidebarUserAssociation.propTypes = {
    user: React.PropTypes.object,
    onRegister: React.PropTypes.func.isRequired,
    onUnregister: React.PropTypes.func.isRequired,
    placeholder: React.PropTypes.string.isRequired
};

module.exports = SidebarUserAssociation;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./SidebarUserForm":544,"./SidebarUserInfo":545}],544:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);
var Locale = require('js/Locale');
var keyString = require('js/keyString');

var SidebarUserForm = (function (_React$Component) {
    _inherits(SidebarUserForm, _React$Component);

    function SidebarUserForm() {
        _classCallCheck(this, SidebarUserForm);

        _get(Object.getPrototypeOf(SidebarUserForm.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(SidebarUserForm, [{
        key: 'render',
        value: function render() {
            var _this = this;

            return React.createElement(
                'div',
                { className: 'user-form' },
                React.createElement('input', {
                    type: 'text',
                    className: 'user-form-name editor-sidebar-text-input',
                    placeholder: this.props.placeholder,
                    onKeyPress: function (e) {
                        return _this.onKeyPress(e);
                    },
                    ref: 'input' }),
                React.createElement(
                    'button',
                    {
                        type: 'button',
                        className: 'user-form-name-submit editor-sidebar-text-submit',
                        onClick: function () {
                            return _this.register();
                        },
                        ref: 'button' },
                    Locale.text('edit_form.flickr.register')
                )
            );
        }
    }, {
        key: 'onKeyPress',
        value: function onKeyPress(e) {
            // Enter
            if (keyString(e) === 'RET') {
                e.preventDefault();
                this.register();
            }
        }
    }, {
        key: 'register',
        value: function register() {
            this.props.onRegister(this.refs.input.value);
        }
    }]);

    return SidebarUserForm;
})(React.Component);

SidebarUserForm.propTypes = {
    onRegister: React.PropTypes.func.isRequired,
    placeholder: React.PropTypes.string.isRequired
};

module.exports = SidebarUserForm;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Locale":561,"js/keyString":599}],545:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var SidebarUserInfo = (function (_React$Component) {
  _inherits(SidebarUserInfo, _React$Component);

  function SidebarUserInfo() {
    _classCallCheck(this, SidebarUserInfo);

    _get(Object.getPrototypeOf(SidebarUserInfo.prototype), 'constructor', this).apply(this, arguments);
  }

  _createClass(SidebarUserInfo, [{
    key: 'render',
    value: function render() {
      var _this = this;

      return React.createElement(
        'div',
        { className: 'user-info' },
        React.createElement(
          'div',
          { className: 'user-info-icon' },
          React.createElement(
            'a',
            { href: this.props.user.uri },
            React.createElement('img', {
              src: this.props.user.icon,
              alt: '',
              className: 'user-image' })
          )
        ),
        React.createElement(
          'div',
          { className: 'user-info-name' },
          React.createElement(
            'a',
            { href: this.props.user.uri, target: '_blank' },
            this.props.user.name
          )
        ),
        React.createElement(
          'button',
          {
            type: 'button',
            className: 'user-info-unregister-button',
            onClick: function () {
              return _this.props.onUnregister();
            },
            ref: 'button' },
          React.createElement('i', { className: 'blogicon-close' })
        )
      );
    }
  }]);

  return SidebarUserInfo;
})(React.Component);

SidebarUserInfo.propTypes = {
  user: React.PropTypes.object.isRequired,
  onUnregister: React.PropTypes.func.isRequired
};

module.exports = SidebarUserInfo;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],546:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var trackEvent = require('js/Base/EventTracker').trackEvent;
var backupTab = require('js/Util/backupTab');
var EditorConnector = require('js/Base/EditorConnector');

// Twitter
var Twitter = function Twitter() {
    this.init.apply(this, arguments);
};
Twitter.prototype = {
    pasteReverseOrder: true,
    // args: { container }
    init: function init(args) {
        this.type = 'editor-twitter';

        this.$container = args.container;
        if (!this.$container.get(0)) {
            return;
        }

        this.$itemsContainer = this.$container.find('.twitter-items');
        this.$indicator = this.$container.find('.indicator');
        this.itemTemplate = _.template($('.twitter-item-template').html());
        this.$pasteButton = this.$container.find('.twitter-paste-button');
        this.$listTypeContainer = this.$container.find('.twitter-list-type-container');
        this.$formatsContainer = this.$container.find('.twitter-formats');
        this.$reloadButton = this.$container.find('.reload');
        this.$errorMessage = this.$container.find('.error');
        this.$detailOnlyMessage = this.$container.find('.twitter-formats-detail-only');
        this.$header = this.$container.find('.twitter-header');
        this.$footer = this.$container.find('.twitter-footer');

        this.sidebar = args.sidebar;

        this.bindEvents();
        this.resize();

        this.loadTweets();
    },
    bindEvents: function bindEvents() {
        var _this = this;

        var self = this;

        var resize = function resize(type) {
            if (type !== _this.type) {
                return;
            }
            _this.resize();
            _this.loadTweets();
        };
        this.sidebar.on('resize', resize);
        this.sidebar.on('tabChange', resize);

        self.$itemsContainer.delegate('.twitter-item', 'click', function (event) {
            if ($(event.target).is('a')) return;
            if ($(this).is('.private')) return;
            $(this).toggleClass('selected');

            self.selectedItemsChanged();
        });

        self.$container.delegate('.twitter-item', 'dblclick', function (event) {
            if ($(event.target).is('a')) return;
            if ($(this).is('.private')) return;
            self.insertSyntaxes([{
                id_str: $(this).attr('data-id-str'),
                screen_name: $(this).attr('data-screen-name'),
                text: $(this).attr('data-text')
            }]);
            $(this).removeClass('selected');
            self.selectedItemsChanged();
            trackEvent(self.$pasteButton.attr('data-track-name'));
            return false;
        });

        self.$pasteButton.click(function (event) {
            var id_strs = [];
            self.$itemsContainer.find('.selected').each(function () {
                id_strs.push({
                    id_str: $(this).attr('data-id-str'),
                    screen_name: $(this).attr('data-screen-name'),
                    text: $(this).attr('data-text')
                });
                $(this).removeClass('selected');
            });
            self.insertSyntaxes(id_strs);
            self.selectedItemsChanged();
        });

        // list type
        self.$listTypeContainer.delegate('input', 'change', function () {
            if (self.getListType == $(this).val()) return;
            self.setListType($(this).val());
            self.$listTypeContainer.find('label.selected').removeClass('selected');
            $(this).closest('label').addClass('selected');
            self.loadTweets();
        });

        backupTab({
            $container: self.$formatsContainer,
            key: 'twitter-format',
            onchange: function onchange($input) {
                self.$formatsContainer.find('label.selected').removeClass('selected');
                $input.closest('label').addClass('selected');
            }
        });

        backupTab({
            $container: self.$listTypeContainer,
            key: 'twitter-list-type',
            onchange: function onchange($input) {
                self.setListType($input.val());
                self.$listTypeContainer.find('label.selected').removeClass('selected');
                $input.closest('label').addClass('selected');
                self.loadTweets();

                // 
                if ($input.val() == 'tweets') {
                    self.$formatsContainer.css('visibility', 'visible');
                    self.$detailOnlyMessage.hide();
                } else {
                    self.$formatsContainer.css('visibility', 'hidden');
                    self.$detailOnlyMessage.show();
                }
            }
        });

        self.$reloadButton.click(function (event) {
            self.loadTweets(null, true);
        });

        // 
        self.$itemsContainer.scroll(_.throttle(function () {
            var rate = (self.$itemsContainer.scrollTop() + self.$itemsContainer.height()) / self.$itemsContainer[0].scrollHeight;
            if (rate > 0.7) {
                // 
                self.loadMore();
            }
        }, 100));
    },
    resize: function resize() {
        var self = this;

        var mainHeight = $(window).height();

        var padding = 0;
        padding += parseInt(self.$itemsContainer.css('padding-top'), 10) || 0;
        padding += parseInt(self.$itemsContainer.css('padding-bottom'), 10) || 0;
        self.$itemsContainer.height(mainHeight - self.$container.offset().top - self.$header.outerHeight(true) - self.$footer.outerHeight(true) - padding);
    },
    setListType: function setListType(type) {
        if (!type.match(/^(tweets|favorites|timeline)$/)) return;
        this.listType = type;
    },
    getListType: function getListType() {
        // 
        if (this.listType) {
            return this.listType;
        }
        // 
        return 'tweets';
    },
    selectedItemsChanged: function selectedItemsChanged() {
        var self = this;

        if (self.$itemsContainer.find('.selected').length > 0) {
            self.$pasteButton.removeClass('disabled').addClass('enabled').prop('disabled', false);
        } else {
            self.$pasteButton.removeClass('enabled').addClass('disabled').prop('disabled', true);
        }
    },
    loadTweets: function loadTweets(max_id, force) {
        var self = this;

        if (self.isLoading) return;
        if (!self.$container.is(':visible')) return;

        self.isLoading = true;
        self.$indicator.show();

        if (!max_id) {
            self.$itemsContainer.find('.twitter-item').remove();
        }

        var data = {};

        if (max_id) {
            data.max_id = max_id;
        }

        var list_type = self.getListType();

        var url = '/api/twitter/' + list_type + (max_id ? '?max_id=' + max_id : '');

        self.ajaxGetOrCache(url, force).done(function (items) {
            // 
            // _.deferalways
            if (self.getListType() != list_type) {
                _.defer(function () {
                    self.loadTweets();
                });
                return;
            }
            if (max_id) {
                // 1
                items.shift();
            }
            self.showItems(items);

            self.$errorMessage.hide();
        }).fail(function (res) {
            self.$errorMessage.show();
        }).always(function () {
            self.$indicator.hide();
            self.isLoading = false;
        });
    },
    showItems: function showItems(items) {
        var self = this;

        var source = '';
        _.each(items, function (item) {
            source += self.itemTemplate({
                item: item
            });
        });
        self.$indicator.before(source);
    },
    loadMore: function loadMore() {
        var self = this;

        var $lastItem = self.$itemsContainer.find('.twitter-item:last');
        if (!$lastItem.length) return;

        var maxId = $lastItem.attr('data-id-str');

        self.loadTweets(maxId);
    },
    // tweet: { screen_name, id_str, text }
    insertSyntaxes: function insertSyntaxes(tweets) {
        var self = this;

        var format = self.getFormat();

        // markdownscreen_nameescape
        var syntaxes = [];
        var syntaxes_for_markdown = [];
        _.each(tweets.reverse(), function (tweet) {
            syntaxes.push(self.createSyntax(tweet, format, false));
            syntaxes_for_markdown.push(self.createSyntax(tweet, format, true));
        });

        EditorConnector.insertLines({
            html: syntaxes,
            hatena: syntaxes,
            markdown: syntaxes_for_markdown
        });
    },
    createSyntax: function createSyntax(tweet, format, is_markdown) {
        if (format == "detail") {
            var screen_name = tweet.screen_name;

            // __hoge__markdown
            // markdown
            if (is_markdown) screen_name = screen_name.replace(/_(.*?)_/g, '\\_$1\\_');

            var text = tweet.text;
            text = text.replace(/[\[\]\n]/g, '').replace(/([\*`_])/g, "\\$1");

            return "[https://twitter.com/" + screen_name + "/status/" + tweet.id_str + ":embed#" + text + "]";
        } else if (format == "text") {
            return tweet.text;
        }
    },
    getFormat: function getFormat() {
        if (this.getListType() == "tweets") {
            return this.$container.find('[name="twitter-format"]:checked').val();
        }
        return "detail";
    },
    ajaxGetOrCache: function ajaxGetOrCache(url, force_disable_cache) {
        // ajax get
        // 
        // jqXHRDeferred
        var self = this;

        // force
        if (!force_disable_cache && self.ajaxGetOrCacheCache[url]) {
            var dfd = $.Deferred();
            dfd.resolve(self.ajaxGetOrCacheCache[url]);
            return dfd.promise();
        }

        // then
        return $.ajax({
            url: url
        }).done(function (res) {
            self.ajaxGetOrCacheCache[url] = res;
        });
    },
    ajaxGetOrCacheCache: {}
};

module.exports = Twitter;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EditorConnector":283,"js/Base/EventTracker":284,"js/Util/backupTab":571,"underscore":213}],547:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var validateTweetLength = require('js/Base/validateTweetLength');

/**
 * Twitter
 * disabled
 */
var TwitterMessage = function TwitterMessage() {
    this.init.apply(this, arguments);
};
TwitterMessage.prototype = {
    init: function init() {
        this.$el = $('.js-edit-socialize-box-li.twitter');
        this.$textarea = this.$el.find('textarea');
        this.$errorMessage = this.$el.find('.js-twitter-length-error');
        this.$checkBox = this.$el.find('input[name="post_to_twitter"]');
        this.bindEvents();
    },
    bindEvents: function bindEvents() {
        var self = this;
        self.$textarea.keyup(function () {
            if (validateTweetLength(self.$textarea.val()) === false) {
                self.showErrorMessage();
                self.disableCheckBox();
            } else {
                self.hideErrorMessage();
                self.enableCheckBox();
            }
        });
    },
    hideErrorMessage: function hideErrorMessage() {
        this.$errorMessage.hide();
    },
    showErrorMessage: function showErrorMessage() {
        this.$errorMessage.show();
    },
    disableCheckBox: function disableCheckBox() {
        this.$checkBox.attr('disabled', true);
    },
    enableCheckBox: function enableCheckBox() {
        this.$checkBox.attr('disabled', false);
    }
};

module.exports = TwitterMessage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/validateTweetLength":307}],548:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * 
 * 
 */
var $background = $('<div>').css({
    position: 'fixed',
    top: 0,
    left: 0,
    width: '100%',
    height: '100%'
});
$background.hide().appendTo(document.body);

$background.on('click', function (e) {
    $background.hide();

    // 
    var target = document.elementFromPoint(e.pageX, e.pageY);
    $(target).click();
});

/**
 * 
 * show / hide 
 * 
 */

var Dropdown = (function () {

    /**
     * @param {jQuery} $element - 
     * @param {jQuery} $window  - $(window)
     */

    function Dropdown($element, $window) {
        _classCallCheck(this, Dropdown);

        this.$element = $element;
        this.$window = $window;
        this.bindEvents();
    }

    _createClass(Dropdown, [{
        key: 'bindEvents',
        value: function bindEvents() {
            var self = this;

            this.$element.on('click', function () {
                // 
                // 
                self.setPosition();

                $background.show();
                self.$window.show();
                $background.on('click', onClickBackground);
            });

            this.$window.on('click', function () {
                self.$window.hide();
                $background.hide();
            });

            var onClickBackground = function onClickBackground() {
                self.$window.hide();
                $background.off('click', onClickBackground);
            };
        }

        /**
         * 
         */
    }, {
        key: 'setPosition',
        value: function setPosition() {
            var rect = this.$element[0].getBoundingClientRect();
            this.$window.css({
                top: rect.bottom,
                left: rect.left
            });
        }
    }]);

    return Dropdown;
})();

module.exports = Dropdown;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],549:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var EventEmitter = require('events').EventEmitter;

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Locale = require('js/Locale');
var Logger = require('js/Base/Logger');
var Browser = require('js/Base/Browser');
var Backup = require('js/Admin/Backup/');
var EditorConnector = require('js/Base/EditorConnector');

var ShareDraft = require('./ShareDraft');
var Preview = require('./Preview');
var Dropdown = require('./Dropdown');
var Toolbar = require('./Toolbar');
var SyntaxSwitcher = require('./SyntaxSwitcher');
var Footer = require('./Component/Footer');

// 
var Home = require('js/Editor/Component/Home');
var Fotolife = require('js/Editor/Component/Fotolife');
var Paint = require('js/Editor/Component/Paint');
var GooglePicker = require('js/Editor/Component/GooglePicker');
var EditorSidebar = require('js/Editor/Component/EditorSidebar');
var EntryOption = require('js/Editor/Component/EntryOption');
var CategoryEditor = require('js/Editor/Component/CategoryEditor');
var AmazonSearch = require('js/Editor/Component/AmazonSearch');
var Twitter = require('js/Editor/Component/Twitter');
var HatenaBookmark = require('js/Editor/Component/HatenaBookmark');
var Archive = require('js/Editor/Component/Archive');
var Instagram = require('js/Editor/Component/Instagram');
var Evernote = require('js/Editor/Component/Evernote');
var Miil = require('js/Editor/Component/Miil');
var Gourmet = require('js/Editor/Component/Gourmet');
var Nicovideo = require('js/Editor/Component/Nicovideo');
var Pixiv = require('js/Editor/Component/Pixiv');
var Gist = require('js/Editor/Component/Gist');
var Flickr = require('js/Editor/Component/Flickr');
var Itunes = require('js/Editor/Component/Itunes');
var Quote = require('js/Editor/Component/Quote');
var Rakuten = require('js/Editor/Component/Rakuten');

var ACTIONS = require('./Actions');

var Editor = (function (_EventEmitter) {
    _inherits(Editor, _EventEmitter);

    function Editor(form) {
        var _this = this;

        _classCallCheck(this, Editor);

        _get(Object.getPrototypeOf(Editor.prototype), 'constructor', this).call(this);

        /** @constant */
        this.URLPattern = /^https?:\/\/\S+$/;

        var id = Math.random().toString(32).substring(2);
        this.id = 'editor-' + id;
        this.$form = $(form);

        this.$editor = $('#editor');
        this.$title = this.$form.find('[name="title"]');
        this.$body = this.$form.find('textarea[name="body"]');
        this.$datetime = this.$form.find('[name="datetime"]');
        this.$tabs = this.$form.find('.tabs');
        this.$toolbar = this.$form.find('.toolbar');
        this.$subToolbar = this.$form.find('.toolbar-sub');
        this.$preview = this.$form.find('#preview');
        this.$buttons = this.$form.find('.buttons');
        this.$entryId = this.$form.find('input[name="entry"]');
        this.$syntax = this.$form.find('#syntax');

        this.mode = this.$form.find('[name = "syntax"]').val();
        this.actions = ACTIONS[this.mode];

        this.$editarea = $('<div class="editarea"></div>').appendTo(this.$body.parent());
        this.$editareaHover = $(('\n            <div class="editarea-hover">\n              <div class="editarea-hover-inner">\n                ' + Locale.text('epic.editarea.hover') + '\n              </div>\n            </div>\n        ').trim()).appendTo(this.$editarea);

        this.backup = Backup.createMessage(this.$form, this.$editarea, this);
        this.$form.on('backup-save', function () {
            _this.trigger('change');
        });

        Toolbar.init(this.$toolbar, this.$subToolbar, this);

        // jQuery UI tabs
        this.$tabs.tabs();

        // 
        this.shareDraft = new ShareDraft(this);
        this.preview = new Preview(this);
        this.setupPreviewDropdown();

        // syntax
        this.syntaxSwitcher = new SyntaxSwitcher(this.$editor.find('.js-syntax-switcher'), this.$editor.find('.js-select-dropdown-window-syntax'), this);

        this.footer = new Footer(this);

        this.setupSidebar();

        // window resize#editor-main.curation-tab-contents
        // resize
        $(window).on('resize', _.throttle(function () {
            _this.emit('resize');
            _this.setHeight();
        }, 50));
        this.on('resizeRequired', function () {
            return _this.setHeight();
        });
        this.setHeight();

        if (Browser.isIE) {
            this.setupRestoreFocus();
        }

        EditorConnector.registerCurrentEditor(this);
    }

    _createClass(Editor, [{
        key: 'getTitle',
        value: function getTitle() {
            return this.$title.val();
        }
    }, {
        key: 'setTitle',
        value: function setTitle(title) {
            return this.$title.val(title);
        }
    }, {
        key: 'getBody',
        value: function getBody() {
            return this.$body.val();
        }
    }, {
        key: 'getDateTime',
        value: function getDateTime() {
            return this.$datetime.val();
        }
    }, {
        key: 'getAuthorName',
        value: function getAuthorName() {
            return this.$form.data('authorName');
        }
    }, {
        key: 'getCategories',
        value: function getCategories() {
            return this.$form.find('input[name="category"]').map(function (i, e) {
                return e.value;
            });
        }
    }, {
        key: 'getCategoriesAsParamsArray',
        value: function getCategoriesAsParamsArray() {
            return this.getCategories().map(function (categoryName) {
                return {
                    name: 'category',
                    value: '' + categoryName
                };
            });
        }
    }, {
        key: 'getSyntax',
        value: function getSyntax() {
            return this.$syntax.val();
        }
    }, {
        key: 'getEntryId',
        value: function getEntryId() {
            return this.$entryId.val();
        }
    }, {
        key: 'setEntryId',
        value: function setEntryId(id) {
            this.$entryId.val(id);
        }

        /**
         * $forminput, textareaPOST
         * nameinputname, value 
         * @return {Array<{name: string, value: (string|number)}>}
         */
    }, {
        key: 'getAllInputData',
        value: function getAllInputData() {
            var data = [];

            this.$form.find('input[name], textarea[name]').each(function (i, elem) {
                // submitvalue
                if (elem.type === 'submit') {
                    return;
                }

                // checkboxboolean_param
                // keytruefalsedata
                if (elem.type === 'checkbox') {
                    if (!elem.checked) {
                        return;
                    }
                    data.push({
                        name: elem.name,
                        value: elem.checked
                    });
                } else {
                    data.push({
                        name: elem.name,
                        value: elem.value
                    });
                }
            });
            return data;
        }
    }, {
        key: 'invokeAction',
        value: function invokeAction(action, data) {
            try {
                Logger.LOG('invokeAction: ' + action);
                this.trigger('actionbefore', { action: action });
                this.actions[action].call(this, data);
                this.trigger('actionafter', { action: action });
            } catch (e) {
                Logger.BUG(e);
            }
        }
    }, {
        key: 'bind',
        value: function bind(event, func) {
            this.$form.on('editor.' + event, func);
        }
    }, {
        key: 'unbind',
        value: function unbind(event, func) {
            this.$form.off('editor.' + event, func);
        }
    }, {
        key: 'trigger',
        value: function trigger(event, obj) {
            this.$form.trigger('editor.' + event, obj);
        }
    }, {
        key: 'getCharacterCount',
        value: function getCharacterCount() {
            return this.$body.val().length;
        }
    }, {
        key: 'getByteCount',
        value: function getByteCount() {
            var text = this.$body.val();
            return encodeURIComponent(text).replace(/%../g, 'x').length;
        }
    }, {
        key: 'setupRestoreFocus',
        value: function setupRestoreFocus() {
            var _this2 = this;

            // IEfocusfocus
            var range;

            // range
            setInterval(function () {
                if (_this2.isFocused()) {
                    range = _this2.getSelectionRange();
                }
            }, 100);

            // inputfocus
            $('#editor-support-container, .curation-tab-contents, .toolbar').on('click', function (event) {
                if ($(event.target).is('textarea, :text')) {
                    return;
                }

                _this2.focus();
                if (range) {
                    _this2.setSelectionRange(range);
                }
            });
        }
    }, {
        key: 'setupPreviewDropdown',
        value: function setupPreviewDropdown() {
            var _this3 = this;

            var $dropdownButton = this.$tabs.find('.js-preview-dropdown');
            var $dropdownWindow = this.$editor.find('.js-select-dropdown-window-preview');

            this.previewDropdown = new Dropdown($dropdownButton, $dropdownWindow);

            $dropdownButton.on('click', function (e) {
                // URL
                var marginTop = parseInt($dropdownWindow.css('margin-top'), 10);
                var rect = e.currentTarget.getBoundingClientRect();
                var base = $(e.currentTarget).offsetParent().offset();

                _this3.shareDraft.setWindowPosition({
                    top: rect.bottom - base.top + marginTop,
                    left: rect.left - base.left
                });
                return false;
            });
        }

        /**
         * 
         */
    }, {
        key: 'setupSidebar',
        value: function setupSidebar() {
            var _this4 = this;

            this.sidebar = new EditorSidebar(this);
            var $form = $('#edit-form');

            // 
            var $beginnerTab = $('#editor-beginner');
            if ($beginnerTab.length > 0) {
                this.sidebar.emit('openByType', 'editor-beginner');

                $('.twitter-open-button').on('click', function () {
                    _this4.sidebar.emit('openByType', 'editor-twitter');
                    return false;
                });
            }

            new Home({
                container: $('#editor-home'),
                sidebar: this.sidebar
            });

            //  
            new CategoryEditor($form, this.sidebar);

            //  
            new EntryOption($form, this, this.sidebar);

            new AmazonSearch({
                container: $('#editor-amazon-search'),
                sidebar: this.sidebar
            });

            new HatenaBookmark({
                container: $('#editor-hatena-bookmark'),
                sidebar: this.sidebar
            });

            new Fotolife({
                editor: this,
                sidebar: this.sidebar,
                container: $('#editor-fotolife')
            });

            new Paint({
                editor: this,
                sidebar: this.sidebar,
                container: $('#editor-paint')
            });

            // 
            //  enabled 
            if ($('#editor-twitter').hasClass('enabled')) {
                new Twitter({
                    container: $('#editor-twitter'),
                    sidebar: this.sidebar
                });
            }

            if ($('#editor-itunes.enabled').get(0)) {
                new Itunes({
                    container: $('#editor-itunes'),
                    sidebar: this.sidebar
                });
            }

            if ($('#editor-archive.enabled').get(0)) {
                Archive.init(document.querySelector('#editor-archive'));
            }

            if ($('#editor-instagram.enabled').get(0)) {
                new Instagram({
                    container: $('#editor-instagram'),
                    sidebar: this.sidebar
                });
            }

            if ($('#editor-evernote.enabled').get(0)) {
                new Evernote({
                    editor: this,
                    sidebar: this.sidebar,
                    container: $('#editor-evernote')
                });
            }

            if ($('#editor-pixiv.enabled').get(0)) {
                new Pixiv({
                    container: $('#editor-pixiv'),
                    sidebar: this.sidebar
                });
            }

            GooglePicker.setup(this);

            new Miil({
                editor: this,
                sidebar: this.sidebar,
                container: $('#editor-miil')
            });

            new Gourmet({
                container: $('#editor-gourmet'),
                sidebar: this.sidebar
            });

            new Nicovideo({
                editor: this,
                container: $('#editor-nicovideo')
            });

            new Gist({
                editor: this,
                sidebar: this.sidebar,
                container: $('#editor-gist')
            });

            new Quote({
                container: $('#editor-quote'),
                sidebar: this.sidebar
            });

            Flickr.init({
                container: document.querySelector('#editor-flickr'),
                sidebar: this.sidebar
            });

            this.rakuten = new Rakuten(document.querySelector('#editor-rakuten'));
        }
    }]);

    return Editor;
})(EventEmitter);

module.exports = Editor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Actions":428,"./Component/Footer":473,"./Dropdown":548,"./Preview":553,"./ShareDraft":555,"./SyntaxSwitcher":556,"./Toolbar":557,"events":207,"js/Admin/Backup/":219,"js/Base/Browser":278,"js/Base/EditorConnector":283,"js/Base/Logger":293,"js/Editor/Component/AmazonSearch":430,"js/Editor/Component/Archive":442,"js/Editor/Component/CategoryEditor":445,"js/Editor/Component/EditorSidebar":447,"js/Editor/Component/EntryOption":450,"js/Editor/Component/Evernote":451,"js/Editor/Component/Flickr":468,"js/Editor/Component/Fotolife":477,"js/Editor/Component/Gist":478,"js/Editor/Component/GooglePicker":482,"js/Editor/Component/Gourmet":483,"js/Editor/Component/HatenaBookmark":485,"js/Editor/Component/Home":486,"js/Editor/Component/Instagram":488,"js/Editor/Component/Itunes":489,"js/Editor/Component/Miil":490,"js/Editor/Component/Nicovideo":496,"js/Editor/Component/Paint":502,"js/Editor/Component/Pixiv":503,"js/Editor/Component/Quote":530,"js/Editor/Component/Rakuten":538,"js/Editor/Component/Twitter":546,"js/Locale":561,"underscore":213}],550:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var tinymce = (typeof window !== "undefined" ? window['tinymce'] : typeof global !== "undefined" ? global['tinymce'] : null);
var ace = (typeof window !== "undefined" ? window['ace'] : typeof global !== "undefined" ? global['ace'] : null);

var keyString = require('js/keyString');
var LOG = require('js/Base/Logger');
var URLGenerator = require('js/Base/URLGenerator');
var Browser = require('js/Base/Browser');

var Editor = require('./Editor');
var EditorSidebar = require('./Component/EditorSidebar');
var Uploader = require('./Uploader');

/* WYSIWYG
 *  WYSIWYG  HTML 
 */

var HTMLEditor = (function (_Editor) {
    _inherits(HTMLEditor, _Editor);

    function HTMLEditor(form) {
        _classCallCheck(this, HTMLEditor);

        _get(Object.getPrototypeOf(HTMLEditor.prototype), 'constructor', this).call(this, form);

        var self = this;
        self.source = self.$tabs.find('#source');

        self.initWYSIWYG();
        self.initAce();

        self.currentTab = 'wysiwyg'; // 'wysiwyg' | 'source' | 'preview'
        self.$tabs.on('tabsactivate', function (event, ui) {
            var panelID = ui.newPanel.attr('id');
            self.currentTab = panelID;
            if (/source/.test(panelID)) {
                setTimeout(function () {
                    self.ace.resize();
                    self.ace.focus();
                }, 0);
                self.writeBack();
                self.setValue(self.$body.val());
                self.syntaxSwitcher.disable();
            } else if (/preview/.test(panelID)) {
                self.writeBack();
                self.preview.updatePreview();
                self.syntaxSwitcher.disable();
            } else {
                self.setValue(self.$body.val());
                self.tinymce.focus();
                self.syntaxSwitcher.enable();
            }
            self.setHeight();
        });

        self.bind('actionafter', function () {
            self.writeBack();
        });

        self.$form.bind('backup-restore', function () {
            self.setValue(self.$body.val());
        });

        // true
        this.justImageHasDropped = false;
    }

    _createClass(HTMLEditor, [{
        key: 'initWYSIWYG',
        value: function initWYSIWYG() {
            var self = this;
            self.$editarea.show();
            self.$body.appendTo(self.$editarea);

            // iframeTinyMCE, IE9TinyMCEdocument.activeElement`Unspecified error`
            // tinymce.initdocument.bodyfocus()document.activeElement, 
            document.body.focus();

            self.tinymce = tinymce.init({
                mode: "exact",
                elements: self.$body.attr('id'),

                keep_styles: false,
                custom_shortcuts: false,

                height: '100%',
                width: '100%',

                body_class: ['preview', 'mce-inner-body'],

                theme: "modern",
                skin: "lightgray",

                toolbar: false,
                menubar: false,
                statusbar: false,

                content_css: URLGenerator.static_url('/css/editor-wysiwyg.css'),
                convert_urls: false,

                // 
                entity_encoding: "raw",

                // 
                // valid_elementsTinyMCEextended_valid_elements
                extended_valid_elements: '*[*],#ins[*]',
                // bodystyle
                valid_children: "+body[style]",

                plugins: ["pagebreak", "paste"],
                paste_data_images: Browser.isChrome,
                pagebreak_separator: "<!-- more -->",
                paste_webkit_styles: "all",

                paste_preprocess: function paste_preprocess(plugin, event) {

                    // fotolife
                    // Google Chrome
                    if (Browser.isChrome) {
                        try {
                            self.handleImagePasteEvent(event);
                        } catch (error) {
                            LOG.BUG(error, 'upload pasted image filed(wysiwyg)');
                        }
                    }

                    var content = event.content.replace(/^[\s]*/, '').replace(/[\s]*$/, '');

                    // URL
                    if (content.match(self.URLPattern)) {
                        var url = event.content;
                        $(self).triggerHandler('paste-url', [url]);
                        event.content = '';

                        event.preventDefault();
                        event.stopPropagation();
                    }

                    // [:contents]plain text
                    if (content.match(/^(<[^>]+?>)+\[:contents\](<\/[^<]+?>)+$/)) {
                        event.content = '[:contents]';
                    }
                },

                setup: function setup(ed) {
                    ed.on('PreInit', function () {
                        // iframesrcjavascript:
                        // onerrorSchema.js
                        // java&#9;script:DOM
                        var javascript_protocol = 'javascript:';
                        var data_protocol = 'data:'; // data:script, Firefoxsame origin
                        var $dummy_div = $('<div>');
                        var $dummy_a = $('<a>');
                        ed.parser.addNodeFilter('iframe', function (nodes) {
                            _.each(nodes, function (node) {
                                var src = node.attr('src');
                                if (!src) return;
                                var normalized_src = $dummy_div.html(src).text();
                                var protocol = $dummy_a.attr('href', normalized_src)[0].protocol; // DOMprotocoljavascript:
                                if (protocol === javascript_protocol || protocol === data_protocol) {
                                    var escaped = 'ignored:' + src;
                                    node.attr('src', escaped);
                                }
                            });
                        });

                        // freezeddivcontenteditable = falseHTMLcontenteditable
                        ed.parser.addNodeFilter('div', function (nodes) {
                            _.each(nodes, function (node) {
                                if (node.attr('class') && node.attr('class').match(/\bfreezed\b/)) {
                                    node.attr('contenteditable', 'false');
                                }
                            });
                        });

                        ed.serializer.addNodeFilter('div', function (nodes) {
                            _.each(nodes, function (node) {
                                if (node.attr('class') && node.attr('class').match(/\bfreezed\b/)) {
                                    node.attr('contenteditable', null);
                                }
                            });
                        });

                        ed.on('ObjectResized', function (e) {
                            // 
                            // max-width: 100%height
                            // height
                            if (e.target.hasAttribute('height')) {
                                e.target.removeAttribute('height');
                            }
                        });
                    });

                    ed.on('submit', function (e) {
                        var originalBody = self.tinymce.getContent();
                        var body = originalBody;

                        // 
                        if ($('<iframe><p></p></iframe>').html().match(/&lt;/)) {
                            body = self.unescapeEntities(body);
                            if (!body) {
                                body = originalBody;
                            }
                        }
                        $('<input type="hidden" name="unescaped_body"/>').val(body).appendTo(e.target);
                    });
                },

                oninit: function oninit() {
                    // http://www.tinymce.com/wiki.php/API4:class.tinymce.Editor
                    self.tinymce = tinymce.get(self.$body.attr('id'));

                    // IME
                    self.isIMEComposing = false;
                    $(self.tinymce.getBody()).on('compositionstart', function () {
                        self.isIMEComposing = true;
                    }).on('compositionend', function (e) {
                        self.isIMEComposing = false;
                    });

                    self.$editarea.find('.mce-edit-area').css({
                        display: 'block',
                        width: '100%',
                        'min-height': '100%',
                        'border-width': '0px'
                    });

                    self.tinymce.on('KeyUp', function (e) {
                        var key = keyString(e);
                        if (key == 'RET') {
                            self.newLine(e);
                        } else if (key == 'BS') {
                            self.backspace(e);
                        }
                    });

                    self.tinymce.on('KeyUp', function (e) {
                        self.writeBack();
                        self.trigger('change');
                    });

                    // tinymceiframehtmliframe
                    self.editorHTMLElement = $(self.tinymce.getDoc()).find('html').eq(0);
                    self.editorHTMLElement.css({
                        height: '100%'
                    });

                    self.initDropper();

                    // editarea
                    self.setHeight();
                }
            });
        }

        // Drag & Drop URL / images
    }, {
        key: 'initDropper',
        value: function initDropper() {
            if (Browser.isIE && !Browser.isIE11) {
                return;
            }

            var self = this;
            var isDraggingInner = false;

            var isFile = function isFile(e) {
                return e.dataTransfer.files.length > 0;
            };

            var onDragEnter = _.debounce(function (e) {
                console.log('drag');
                if (isDraggingInner) {
                    return;
                }
                self.$editareaHover.addClass('dragging');
            }, 20);
            var onDragLeave = function onDragLeave(e) {
                console.log('dragleave');
                self.$editareaHover.removeClass('dragging');
            };
            var onDrop = function onDrop(e) {
                console.log('drop');
                self.$editareaHover.removeClass('dragging');
                if (isFile(e)) {
                    // Filefotolife

                    // justImageHasDroppedtrue
                    self.justImageHasDropped = true;
                    _.defer(function () {
                        self.justImageHasDropped = false;
                    });

                    self.sidebar.openByType('editor-fotolife');
                    Uploader.uploadDroppedFiles(e);
                } else {
                    // URL
                    var content = e.dataTransfer.getData('Text').trim();
                    if (content.match(self.URLPattern)) {
                        $(self).triggerHandler('paste-url', [content]);
                    }
                }
            };

            // tinyMCEDragOver
            var cancelEvent = function cancelEvent(e) {
                e.stopPropagation();
                e.preventDefault();
            };

            var leaveTimer = null;
            var cancelLeaving = function cancelLeaving() {
                clearTimeout(leaveTimer);
                leaveTimer = null;
            };
            var isDragging = false;
            var editorAce = $(self.tinymce.getDoc()); // 
            var editorHTML = self.ace.container; // HTML
            var editors = editorAce.add(editorHTML);
            editors.on('dragstart', function () {
                isDraggingInner = true;
            }).on('dragend', function () {
                isDraggingInner = false;
            }).on('dragenter', function (_e) {
                if (isDraggingInner) {
                    return;
                }
                if (leaveTimer !== null) {
                    return cancelLeaving();
                }
                if (isDragging) {
                    return;
                }
                isDragging = true;

                var e = _e.originalEvent;
                cancelEvent(e);
                onDragEnter(e);
            }).on('dragenter', '*', function (_e) {
                if (isDraggingInner) {
                    return;
                }
                if (leaveTimer !== null) {
                    return cancelLeaving();
                }
                if (isDragging) {
                    return;
                }
                isDragging = true;

                var e = _e.originalEvent;
                cancelEvent(e);
                onDragEnter(e);
            }).on('dragover', function (_e) {
                if (isDraggingInner) {
                    return;
                }
                if (leaveTimer !== null) {
                    return cancelLeaving();
                }
                var e = _e.originalEvent;
                cancelEvent(e);
            }).on('dragleave', function (_e) {
                if (isDraggingInner) {
                    return;
                }
                var e = _e.originalEvent;
                cancelLeaving();
                leaveTimer = setTimeout(function () {
                    isDragging = false;
                    onDragLeave(e);
                }, 50);
            }).on('drop', function (_e) {
                if (isDraggingInner) {
                    return;
                }
                isDragging = false;
                var e = _e.originalEvent;
                cancelEvent(e);
                onDrop(e);
            });
        }
    }, {
        key: 'execCommand',
        value: function execCommand(command, value) {
            if (this.tinymce) {
                this.tinymce.execCommand(command, false, value);
            }
            this.writeBack();
        }
    }, {
        key: 'newLine',
        value: function newLine(e) {
            var self = this;

            var window = self.tinymce.getWin();
            var document = self.tinymce.getDoc();

            var selection = self.tinymce.selection;
            var node = selection.getNode();
            var container = $(node).closest('div.hatena-embed')[0];

            if (container) {
                var p = container.nextSibling;
                if (!p || p.nodeName.toLowerCase() != 'p') {
                    p = document.createElement('p');
                    p.appendChild(document.createElement('br'));
                    container.parentNode.insertBefore(p, container.nextSibling);
                }

                var range = selection.getRng();
                range.setStart(p, 0);
                range.setEnd(p, 0);
                selection.setRng(range);
                e.preventDefault();
            }
        }
    }, {
        key: 'backspace',
        value: function backspace(e) {
            var self = this;

            var window = self.tinymce.getWin();
            var document = self.tinymce.getDoc();

            var selection = self.tinymce.selection;
            var node = selection.getNode();
            var container = $(node).closest('div.hatena-embed')[0];

            if (container) {
                var p = container.previousSibling || document.body;
                var range = selection.getRng();
                range.selectNodeContents(p);
                range.collapse(false);
                selection.setRng(range);
                e.preventDefault();

                container.parentNode.removeChild(container);
            }
        }
    }, {
        key: 'initAce',
        value: function initAce() {
            var self = this;
            var container = document.createElement('div');

            $(container).css({
                position: 'absolute',
                height: '100%',
                width: '100%',
                padding: '0px',
                margin: '0px'
            });

            self.source.append(container);

            var editor = ace.edit(container);
            editor.commands.removeCommand('gotoline'); // fucking default keybinding of ace
            editor.commands.removeCommand('indent');
            editor.commands.removeCommand('outdent');

            editor.renderer.setShowGutter(false);
            editor.renderer.setHScrollBarAlwaysVisible(false);
            editor.renderer.setPadding(5);
            editor.renderer.setShowPrintMargin(false);

            editor.setHighlightActiveLine(false);

            var HtmlMode = ace.require('ace/mode/html').Mode;
            var mode = new HtmlMode();
            mode.$modes['js-'].$behaviour.remove('braces');
            mode.$modes['js-'].$behaviour.remove('parens');
            mode.$modes['js-'].$behaviour.remove('string_dquotes');

            var session = editor.getSession();
            session.setMode(mode);
            session.setUseWrapMode(true);
            session.setValue(self.$body.val());
            session.on('change', function () {
                var val = session.getValue();
                self.$body.val(val);
                if (self.tinymce) {
                    self.tinymce.setContent(val);
                }
            });

            editor.$blockScrolling = Infinity;

            self.ace = editor;
        }
    }, {
        key: 'setHeight',
        value: function setHeight() {
            this.currentTab = this.currentTab || 'wysiwyg';

            var withoutButtons = $(window).height() - this.$buttons.outerHeight();
            var tabTop = $('#' + this.currentTab).offset().top;

            this.$editarea.height(withoutButtons - this.$editarea.offset().top);
            this.$preview.height(withoutButtons - tabTop - 2); // subtract border width

            // HTMLinitEditor
            var $source = this.source || $('#source');
            $source.height(withoutButtons - tabTop - 2);
        }
    }, {
        key: 'focus',
        value: function focus() {
            var self = this;
            self.writeBack();
            if (self.tinymce) self.tinymce.focus();
        }
    }, {
        key: 'getSelectionRange',
        value: function getSelectionRange() {
            return this.tinymce.selection.getRng();
        }
    }, {
        key: 'setSelectionRange',
        value: function setSelectionRange(range) {
            this.tinymce.selection.setRng(range);
        }
    }, {
        key: 'isFocused',
        value: function isFocused() {
            return $(document.activeElement).is('#body_ifr');
        }
    }, {
        key: 'setValue',
        value: function setValue(val) {
            var unescaped = this.unescapeEntities(val);
            this.$body.val(unescaped);
            this.execCommand('mceSetContent', unescaped);
            this.ace.getSession().setValue(unescaped);
        }
    }, {
        key: 'unescapeEntities',
        value: function unescapeEntities(val) {
            $.each(['style', 'script', 'xmp', 'iframe', 'noembed', 'noframes', 'plaintext', 'noscript'], function () {
                var tag = this;
                val = val.replace(new RegExp('<' + tag + '(.*?)>(.*?)<\\/' + tag + '>', 'g'), function (match, attr, content) {
                    content = content.replace(/&lt;/g, '<');
                    content = content.replace(/&gt;/g, '>');
                    content = content.replace(/&quot;/g, '"');
                    content = content.replace(/&amp;/g, '&');
                    return '<' + tag + attr + '>' + content + '</' + tag + '>';
                });
            });
            return val;
        }
    }, {
        key: 'insert',
        value: function insert(text) {
            this.execCommand('mceInsertContent', text);
        }
    }, {
        key: 'insertLines',
        value: function insertLines(lines) {
            var syntax = _.map(lines, function (line) {
                return '<p>' + line + '</p>';
            });
            this.insert(syntax.join(''));
        }
    }, {
        key: 'getCharacterCount',
        value: function getCharacterCount() {
            var self = this;
            var body = self.tinymce.getBody();
            var text = typeof body.textContent === 'undefined' ? body.innerText : body.textContent;
            text = text.replace(/\s+/g, ' ');
            return text.length;
        }
    }, {
        key: 'insertAndSelectText',
        value: function insertAndSelectText(text) {
            var range = this.tinymce.selection.getRng(true);

            var text_node = this.tinymce.getDoc().createTextNode(text);

            range.insertNode(text_node);
            range.selectNode(text_node);

            this.setSelectionRange(range);
        }
    }, {
        key: 'writeBack',
        value: function writeBack() {
            if (this.isIMEComposing) {
                // Modern UIIE11IMETinyMCEDOM
                // Modern UIIE11TinyMCE.Editor.save()IME
                // TinyMCEIE11iframebrgetContentDOM
                // : https://github.com/tinymce/tinymce/commit/f9e8f02ed9c1122c5bf03c985e267dcaf16155dd
                return;
            }
            if (this.tinymce) this.tinymce.save();
        }
    }, {
        key: 'isCollapsed',
        value: function isCollapsed() {
            return this.tinymce.selection.isCollapsed();
        }
    }, {
        key: 'getSelectionText',
        value: function getSelectionText() {
            return this.tinymce.selection.getContent();
        }

        // url
    }, {
        key: 'createLink',
        value: function createLink(url) {
            this.tinymce.execCommand("CreateLink", false, url);
        }
    }, {
        key: 'formatBlock',
        value: function formatBlock(tagName) {
            // IEFormatBlock
            // nodeselectFormatBlock
            // bodyselectbodyselect
            var currentNode = this.tinymce.selection.getNode();
            if (currentNode.tagName.toLowerCase() !== "body") {
                this.tinymce.selection.select(currentNode);
            }

            // FormatBlock2
            // UIp

            if (tagName !== "p") {
                this.execCommand('FormatBlock', 'p');
            }

            this.execCommand('FormatBlock', tagName);
        }
    }, {
        key: 'replace',
        value: function replace(text) {
            this.tinymce.selection.setContent(text);
        }
    }, {
        key: 'moveCaretToNodeEnd',
        value: function moveCaretToNodeEnd(node) {
            this.tinymce.selection.select(node);
            this.tinymce.selection.collapse(false);
        }

        // blockquote, <p>
        // blockquote
    }, {
        key: 'insertBlockQuoteWithNewLine',
        value: function insertBlockQuoteWithNewLine() {
            if (this.tinymce.selection.isCollapsed()) {
                this.insert('<blockquote><p>&nbsp;</p></blockquote><p>&nbsp;</p>');

                var node_in_blockquote = $(this.tinymce.selection.getNode()).prev('blockquote').find('p')[0];

                this.tinymce.selection.setCursorLocation(node_in_blockquote, 0);
            } else {
                this.insert('<blockquote><p>' + this.tinymce.selection.getContent() + '</p></blockquote><p>&nbsp;</p>');

                var blockquote_node = $(this.tinymce.selection.getNode()).prev('blockquote')[0];

                this.tinymce.selection.select(blockquote_node);
            }
        }
    }, {
        key: 'formatBlockQuote',
        value: function formatBlockQuote() {
            // IEblockquote
            if (Browser.isIE && this.tinymce.selection.isCollapsed()) {
                var current_node = this.tinymce.selection.getNode();
                this.tinymce.selection.select(current_node);
            }

            this.execCommand('mceBlockQuote');
        }

        // fotolife
        // TinyMCEBlobData URLBlobFile
        // http://stackoverflow.com/questions/4998908/convert-data-uri-to-file-then-append-to-formdata/5100158#5100158
    }, {
        key: 'handleImagePasteEvent',
        value: function handleImagePasteEvent(event) {
            // 
            // TinyMCE
            if (this.justImageHasDropped) {
                event.preventDefault();
                event.stopPropagation();

                return;
            }

            var content = event.content.replace(/^[\s]*/, '').replace(/[\s]*$/, '');

            var img = content.match(/^<img src="data:(.+);base64,(.*)">$/);
            if (!img) return;

            var contentType = img[1];
            var byteString = window.atob(img[2]);

            var bytesArray = new Uint8Array(byteString.length);
            for (var i = 0; i < byteString.length; i++) {
                bytesArray[i] = byteString.charCodeAt(i);
            }

            var blob = new Blob([bytesArray], { type: contentType });
            var ext = contentType.split(/\//)[1];
            var file = new File([blob], 'a.' + ext);

            this.sidebar.openByType('editor-fotolife');
            $(document).trigger('uploadDroppedFiles', [[file]]);

            event.preventDefault();
            event.stopPropagation();
        }
    }]);

    return HTMLEditor;
})(Editor);

module.exports = HTMLEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Component/EditorSidebar":447,"./Editor":549,"./Uploader":558,"js/Base/Browser":278,"js/Base/Logger":293,"js/Base/URLGenerator":298,"js/keyString":599,"underscore":213}],551:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var Browser = require('js/Base/Browser');
var EventTracker = require('js/Base/EventTracker');
var LOG = require('js/Base/Logger');

var Editor = require('./Editor');
var EditorSidebar = require('./Component/EditorSidebar');
var Uploader = require('./Uploader');
var RealtimePreview = require('./RealtimePreview');

/* Hatena Syntax
 *  
 *  window) 
 */

var HatenaEditor = (function (_Editor) {
    _inherits(HatenaEditor, _Editor);

    // 
    // markdownhatena

    function HatenaEditor(form) {
        _classCallCheck(this, HatenaEditor);

        _get(Object.getPrototypeOf(HatenaEditor.prototype), 'constructor', this).call(this, form);

        var self = this;
        self.$body.attr('style', 'position: absolute; height: 100%; width: 100%; padding: 0; margin: 0');
        self.$body.appendTo(self.$editarea);

        self.currentTab = 'textarea'; // 'textarea' | 'preview';
        self.$tabs.on('tabsactivate', function (event, ui) {
            var panelID = ui.newPanel.attr('id');
            self.currentTab = panelID;
            if (/preview/.test(panelID) && !self.preview.isOpeningWindow()) {
                // updatePreview  iframe 
                // setHeight 
                self.preview.updatePreview();
                self.syntaxSwitcher.disable();
            } else {
                // setHeighttextareafocus
                // focus  setHeight 
                setTimeout(function () {
                    self.focus();
                }, 0);
                self.syntaxSwitcher.enable();
            }
            self.setHeight();
        });

        self.bind('actionafter', function () {
            self.focus();
        });

        self.initRealtimePreview();

        self.$body.on('input propertychange', function () {
            self.trigger('change');
        });

        self.$body.on('paste', function (event) {

            // fotolife
            try {
                var success = self.handleImagePasteEvent(event);
                if (success) return false;
            } catch (error) {
                LOG.BUG(error, 'upload pasted image filed(hatena or markdown)');
            }

            // URL
            // IEIEwindow
            var originalEvent = event.originalEvent;
            var content = (originalEvent.clipboardData ? originalEvent.clipboardData.getData('text/plain') : window.clipboardData.getData("text")).replace(/^[\s]*/, '').replace(/[\s]*$/, '');
            if (content.match(self.URLPattern) && !self.onInsertingLink()) {
                var url = content;
                $(self).triggerHandler('paste-url', [url]);
                return false;
            }
        });

        self.initDropper();
    }

    // fotolife
    // fotolifeblob.typeFilewrap
    // true

    _createClass(HatenaEditor, [{
        key: 'handleImagePasteEvent',
        value: function handleImagePasteEvent(event) {
            var data = event.clipboardData || event.originalEvent.clipboardData;
            if (!data) return;

            // ()
            var textContent = data.getData('text/plain');
            if (textContent) return;

            var items = data.items;
            var files = [];
            for (var i in items) {
                var item = items[i];
                if (item.kind === 'file') {
                    var blob = item.getAsFile();
                    var ext = blob.type.split(/\//)[1];
                    var file = new File([blob], 'a.' + ext);
                    files.push(file);
                }
            }

            if (files.length > 0) {
                this.sidebar.openByType('editor-fotolife');
                $(document).trigger('uploadDroppedFiles', [files]);
                return true;
            }
        }
    }, {
        key: 'setHeight',
        value: function setHeight() {
            this.currentTab = this.currentTab || 'textarea';

            var withoutButtons = $(window).height() - this.$buttons.outerHeight();
            var tabTop = $('#' + this.currentTab).offset().top;

            this.$editarea.height(withoutButtons - this.$editarea.offset().top);
            this.$preview.height(withoutButtons - tabTop - 2); // subtract border width

            this.emit('resize');
        }
    }, {
        key: 'focus',
        value: function focus() {
            this.$body.focus();
        }
    }, {
        key: 'isFocused',
        value: function isFocused() {
            return this.$body.is(':focus');
        }
    }, {
        key: 'setValue',
        value: function setValue(val) {
            this.$body.val(val);
        }
    }, {
        key: 'getSelectionRange',
        value: function getSelectionRange() {
            var textarea = this.$body[0];

            // Operatextarea selectionStart, selectionEnd
            // (placeholder???)
            // , textarea
            // 
            if (Browser.isOpera && !textarea.value) {
                return {
                    start: 0,
                    end: 0
                };
            }

            if ('selectionStart' in textarea) {
                return {
                    start: textarea.selectionStart,
                    end: textarea.selectionEnd
                };
            } else if (document.selection) {
                var range = document.selection.createRange();
                var clone = range.duplicate();
                clone.moveToElementText(textarea);
                clone.setEndPoint('EndToEnd', range);
                var range_length = range.text.replace(/\x0d/g, '').length;
                var start = clone.text.replace(/\x0d/g, '').length - range_length;
                return {
                    start: start,
                    end: start + range_length
                };
            }
        }
    }, {
        key: 'setSelectionRange',
        value: function setSelectionRange(range) {
            var textarea = this.$body[0];
            if (textarea.setSelectionRange) {
                textarea.setSelectionRange(range.start, range.end);
            } else if (textarea.createTextRange) {
                var rng = textarea.createTextRange();
                rng.collapse(true);
                rng.moveStart('character', range.start);
                rng.moveEnd('character', range.end - range.start);
                rng.select();
            }
        }
    }, {
        key: 'getSelectionText',
        value: function getSelectionText(range) {
            range = range || this.getSelectionRange();
            return this.$body.val().substring(range.start, range.end);
        }
    }, {
        key: 'isCollapsed',
        value: function isCollapsed() {
            var range = this.getSelectionRange();
            return range.start === range.end;
        }
    }, {
        key: 'getCharacterAtCursor',
        value: function getCharacterAtCursor(lines) {
            var range = this.getSelectionRange();

            return this.$body.val()[range.start - 1];
        }

        // 
        // [[$url:title]
        // >
        // "HTML
    }, {
        key: 'onInsertingLink',
        value: function onInsertingLink() {
            return _.include(['[', '>', '"'], this.getCharacterAtCursor());
        }

        // url
    }, {
        key: 'createLink',
        value: function createLink(url) {
            var range = this.getSelectionRange();
            var text = this.getSelectionText();

            var syntax;
            // a
            // 1
            if (text.match(/\n/)) {
                syntax = '<a href="' + url + '">' + text + '</a>';
            } else {
                syntax = '[' + url + ':title=' + text + ']';
            }

            var newRange = this.replace(syntax, range);
            this.setSelectionRange(newRange);
        }
    }, {
        key: 'replace',
        value: function replace(text, range) {
            range = range || this.getSelectionRange();
            var textarea = this.$body[0];
            var content = textarea.value;
            var t = textarea.scrollTop,
                l = textarea.scrollLeft;
            this.$body.val(this.$body.val().substring(0, range.start) + text + this.$body.val().substring(range.end));
            textarea.scrollTop = t;textarea.scrollLeft = l;

            this.$body.trigger("input");
            return { start: range.start, end: range.start + text.length };
        }
    }, {
        key: 'insert',
        value: function insert(text) {
            var range = this.getSelectionRange();
            var textarea = this.$body[0];
            var content = textarea.value;
            var t = textarea.scrollTop,
                l = textarea.scrollLeft;
            textarea.value = content.substring(0, range.end) + text + content.substring(range.end);
            textarea.scrollTop = t;textarea.scrollLeft = l;

            this.setSelectionRange({ start: range.end + text.length, end: range.end + text.length });
            this.$body.trigger("input");
            return { start: range.end, end: range.end + text.length };
        }
    }, {
        key: 'insertLines',
        value: function insertLines(lines) {
            var range = this.getSelectionRange();

            var lastChar = this.$body.val()[range.start - 1];
            var prefix = '';
            if (lastChar === "\n" || lastChar === undefined) {
                // do nothing
            } else {
                    prefix = "\n";
                }
            this.insert(prefix + lines.join("\n") + "\n");
        }
    }, {
        key: 'modifyCurrentLine',
        value: function modifyCurrentLine(callback) {
            var range = this.getSelectionRange();
            var lines = this.$body.val().split(/\r?\n/);

            var currentIndex = 0;
            var lastIndex = lines.length;
            var total = 0;
            while (lastIndex > currentIndex) {
                // +1 
                total += lines[currentIndex].length + 1;
                if (total > range.start) break;
                currentIndex++;
            }

            var modifiedLine = callback(lines[currentIndex]);
            var lineHeadPosition = total - lines[currentIndex].length;
            var diff = modifiedLine.length - lines[currentIndex].length;
            lines[currentIndex] = modifiedLine;

            // 
            var modifiedRange = {
                start: Math.max(lineHeadPosition, range.start + diff),
                end: Math.max(lineHeadPosition, range.end + diff)
            };

            this.$body.val(lines.join("\n"));
            this.setSelectionRange(modifiedRange);
        }
    }, {
        key: 'wrapString',
        value: function wrapString(start, end) {
            var text = this.getSelectionText();
            var range;
            if (text.indexOf(start) === 0) {
                text = text.replace(start, '').replace(end, '');
                range = this.replace(text);
            } else {
                range = this.replace(start + text + end);
            }
            this.setSelectionRange(range);
            return range;
        }

        // , startend
        // wrapString
    }, {
        key: 'wrapStringAround',
        value: function wrapStringAround(start, end) {
            var selection_text = this.getSelectionText();

            this.wrapString(start, end);

            if (selection_text.length === 0) {
                this.moveCaret(start.length);
            }
        }

        // , startend
        // wrapString
        //
        // example:
        //  wrapStringAroundLabel('((', '', '))')
        //=> "(())"
        //    
    }, {
        key: 'wrapStringAroundLabel',
        value: function wrapStringAroundLabel(start, label, end) {
            var self = this;
            var selection_text = this.getSelectionText();

            this.wrapStringAround(start, end);

            if (selection_text.length === 0) {
                var range = this.replace(label);
                this.setSelectionRange(range);
            }
        }
    }, {
        key: 'headingAction',
        value: function headingAction(replaceString) {
            this.modifyCurrentLine(function (line) {
                return line.replace(/^[*]*(\s+)*/, replaceString);
            });
        }
    }, {
        key: 'moveCaret',
        value: function moveCaret(length) {
            var range = this.getSelectionRange();
            range.start += length;
            range.end = range.start;

            this.setSelectionRange(range);
        }
    }, {
        key: 'toggleFontSize',
        value: function toggleFontSize(value) {
            var text = this.getSelectionText();
            var range;
            if (/^(<span style="font-size: (\d+)%">)/.test(text)) {
                var current_value = Math.floor(+RegExp.$2);
                if (current_value === value) {
                    text = text.replace(RegExp.$1, '').replace(/<\/span>/, '');
                } else {
                    text = text.replace(RegExp.$1, '<span style="font-size: ' + value + '%">');
                }
                range = this.replace(text);
            } else {
                range = this.replace('<span style="font-size: ' + value + '%">' + text + '</span>');
            }
            this.setSelectionRange(range);
        }
    }, {
        key: 'removeFontSize',
        value: function removeFontSize() {
            var text = this.getSelectionText();
            var range;
            if (/^(<span style="font-size: \d+%">)/.test(text)) {
                text = text.replace(RegExp.$1, '').replace(/<\/span>/, '');

                range = this.replace(text);

                this.setSelectionRange(range);
            }
        }
    }, {
        key: 'initRealtimePreview',
        value: function initRealtimePreview() {
            var self = this;

            self.$rp = self.$form.find('#realtime-preview');
            self.$rp_button = self.$form.find('#realtime-preview-button');
            self.$rp_placeholder = self.$form.find('#realtime-preview-placeholder');
            self.$editarea.append(self.$rp).append(self.$rp_button).append(self.$rp_placeholder);

            self.realtime_preview = new RealtimePreview(self.$rp, self);

            self.$rp_button.click(function () {
                if (self.$rp.is(":visible")) {
                    EventTracker.trackEvent('RealtimePreview.off');
                    self.$editarea.removeClass("realtime-preview");
                    self.realtime_preview.hide();
                } else {
                    EventTracker.trackEvent('RealtimePreview.on');
                    self.$editarea.addClass("realtime-preview");
                    self.realtime_preview.show();
                }
            });

            // 
            this.setHeight();
        }
    }, {
        key: 'initDropper',
        value: function initDropper() {
            if (Browser.isIE && !Browser.isIE11) {
                return;
            }

            var self = this;
            var isFile = function isFile(e) {
                return e.dataTransfer.files.length > 0;
            };
            var onDrop = function onDrop(e) {
                console.log('drop');
                if (isFile(e)) {
                    // Filefotolife 
                    self.sidebar.openByType('editor-fotolife');
                    Uploader.uploadDroppedFiles(e);
                } else {
                    // URL
                    var content = e.dataTransfer.getData('Text').trim();
                    if (content.match(self.URLPattern)) {
                        $(self).triggerHandler('paste-url', [content]);
                    }
                }
            };

            // editarea
            self.editorTextbox = self.$editarea.find('#body').eq(0);

            var isDragging = false;
            var isDraggingInner = false;
            var cancelEvent = function cancelEvent(e) {
                e.stopPropagation();
                e.preventDefault();
            };
            this.$editarea.on('dragstart', function () {
                isDraggingInner = true;
            }).on('dragend', function () {
                isDraggingInner = false;
            }).on('dragenter', function () {
                if (isDraggingInner) {
                    return;
                }
                isDragging = true;
                self.$editareaHover.addClass('dragging');
            }).on('dragleave', function () {
                if (isDraggingInner) {
                    return;
                }
                isDragging = false;
                self.$editareaHover.removeClass('dragging');
            }).on('dragover', function (_e) {
                if (isDraggingInner) {
                    return;
                }
                self.$editareaHover.addClass('dragging');
                cancelEvent(_e.originalEvent);
            }).on('drop', function (_e) {
                if (isDraggingInner) {
                    return;
                }
                isDragging = false;
                self.$editareaHover.removeClass('dragging');

                var e = _e.originalEvent;
                cancelEvent(e);
                onDrop(e);
            });
        }
    }]);

    return HatenaEditor;
})(Editor);

module.exports = HatenaEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Component/EditorSidebar":447,"./Editor":549,"./RealtimePreview":554,"./Uploader":558,"js/Base/Browser":278,"js/Base/EventTracker":284,"js/Base/Logger":293,"underscore":213}],552:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var HatenaEditor = require('./HatenaEditor');

/* Markdown
 *  
 */

var MarkdownEditor = (function (_HatenaEditor) {
    _inherits(MarkdownEditor, _HatenaEditor);

    function MarkdownEditor() {
        _classCallCheck(this, MarkdownEditor);

        _get(Object.getPrototypeOf(MarkdownEditor.prototype), 'constructor', this).apply(this, arguments);
    }

    _createClass(MarkdownEditor, [{
        key: 'insertLines',
        value: function insertLines(lines) {
            var range = this.getSelectionRange();

            var lastChars = this.$body.val().substr(range.start - 2, range.start);
            var prefix = '';
            if (lastChars === "\n\n" || lastChars === "") {
                // do nothing
            } else if (lastChars.match(/\n$/)) {
                    prefix = "\n";
                } else {
                    prefix = "\n\n";
                }
            this.insert((prefix + lines.join("\n\n") + "\n\n").replace(/\n+$/, "\n\n"));
        }
    }, {
        key: 'headingAction',
        value: function headingAction(replaceString) {
            this.modifyCurrentLine(function (line) {
                return line.replace(/^[#]*(\s+)*/, replaceString);
            });
        }

        // url
    }, {
        key: 'createLink',
        value: function createLink(url) {
            var range = this.getSelectionRange();
            var text = this.getSelectionText();

            var syntax;
            // Markdowna
            // 1Markdown
            if (text.match(/\n/)) {
                syntax = '<a href="' + url + '">' + text + '</a>';
            } else {
                syntax = '[' + text + '](' + url + ')';
            }

            var newRange = this.replace(syntax, range);
            this.setSelectionRange(newRange);
        }

        // 
        // ([$title]($url)
        // [[$url:title]
        // "HTML
    }, {
        key: 'onInsertingLink',
        value: function onInsertingLink() {
            return _.include(['(', '[', '"'], this.getCharacterAtCursor());
        }
    }]);

    return MarkdownEditor;
})(HatenaEditor);

module.exports = MarkdownEditor;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./HatenaEditor":551,"underscore":213}],553:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) arr2[i] = arr[i]; return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Messenger = require('js/Messenger');
var globalData = require('js/Base/globalData');
var waitForResource = require('js/Util/waitForResource');
var positionToString = require('js/Util/positionToString');

var DEVICE = {
    pc: 'pc',
    touch: 'touch'
};

/**
 * 
 * , Iframe, toggle
 */

var Preview = (function () {

    /**
     * @param {Editor} editor
     */

    function Preview(editor) {
        _classCallCheck(this, Preview);

        this.editor = editor;

        this.previewWindow = null;
        this.device = DEVICE.pc;

        this.$wrapper = $('#preview');
        this.$closeWindowButton = $('#js-new-window-close-btn');

        this.$newWindowDropdown = $('.js-select-dropdown-window-preview');
        this.$newWindowButton = $('.js-dropdown-preview-in-new-window');
        this.$previewButton = $('.js-icon-preview-in-new-window');

        this.$reloadButton = $('.js-icon-preview-in-new-window-reload');
        this.$toggleDevice = $('.editor-preview-device');

        this.$iframeWrapper = $('.editor-preview-iframe-wrapper');
        this.$iframe = $('.editor-preview-iframe');
        this.$placeholder = $('.js-preview-placeholder');

        this.forcePcView = this.$wrapper.data('forcePcView');

        this.initEvent();
    }

    _createClass(Preview, [{
        key: 'initEvent',
        value: function initEvent() {
            var _this = this;

            this.$newWindowButton.on('click', function () {
                return _this.previewInWindow();
            });
            this.$reloadButton.on('click', function () {
                _this.previewInWindow();return false;
            });

            this.$toggleDevice.on('change', function (e) {
                return _this.setDevice(e.target.value);
            });

            // iframe
            var messenger = Messenger.createForParent();
            messenger.addEventListener('close-preview-window', function () {
                _this.editor.preview.closePreviewWindow();
            });

            // pageLeaveEvent
            $(window).on('close-preview-window', function () {
                _this.editor.preview.closePreviewWindow();
            });
        }
    }, {
        key: 'isOpeningWindow',
        value: function isOpeningWindow() {
            return this.previewWindow && !this.previewWindow.closed;
        }

        /**
         * Blogs::Preview#preview HTMLtarget
         * @param {string} target - iframe/windowname
         */
    }, {
        key: 'appendPreviewHTML',
        value: function appendPreviewHTML(target) {
            var _this2 = this;

            var title = this.editor.getTitle();
            var body = this.editor.getBody();
            var datetime = this.editor.getDateTime();
            var author_name = this.editor.getAuthorName();

            $.ajax({
                url: './preview',
                type: 'post',
                dataType: 'json',
                data: [{ name: 'title', value: title }, { name: 'body', value: body }, { name: 'datetime', value: datetime }, { name: 'author_name', value: author_name }, { name: 'rkm', value: globalData('rkm') }, { name: 'rkc', value: globalData('rkc') }].concat(_toConsumableArray(this.editor.getCategoriesAsParamsArray()))
            }).done(function (res) {
                var params = {
                    title: title, body: body, datetime: datetime, author_name: author_name,
                    device: _this2.device,
                    syntax: _this2.editor.getSyntax(),
                    datetime_tz: res.datetime_tz,
                    signature: res.signature,
                    editor_id: _this2.editor.id
                };

                if (_this2.forcePcView) {
                    params['force-pc-view'] = 1;
                }

                // form
                var form = $('<form method=\'POST\' target="' + target + '" action=' + res.uri + '/>');
                _.each(params, function (value, key) {
                    $('<textarea name="' + key + '"/>').val(value).appendTo(form);
                });
                _this2.editor.getCategories().each(function (i, category) {
                    $('<textarea name="category"/>').val(category).appendTo(form);
                });

                form.appendTo(document.body);
                form.submit();
                form.remove();
            });
        }
    }, {
        key: 'openPreviewWindow',
        value: function openPreviewWindow() {
            var _this3 = this;

            var position = {
                width: screen.width / 2,
                height: screen.height,
                top: 0,
                left: screen.width / 2
            };

            if (this.device === DEVICE.touch) {
                position.width = 320;
                position.height = 568;
            }

            var options = 'scrollbars=1,' + positionToString(position);
            this.previewWindow = window.open('', 'hatena-preview-new-window', options);

            // windowcloseiframe
            waitForResource(function () {
                return _this3.previewWindow.closed;
            }, function () {
                return _this3.updateWindowMode();
            });

            this.$closeWindowButton.on('click', function () {
                _this3.previewWindow.close();
            });

            this.updateWindowMode();
        }
    }, {
        key: 'previewInWindow',
        value: function previewInWindow() {
            // window, window
            if (!this.isOpeningWindow()) {
                this.openPreviewWindow();
            }

            this.appendPreviewHTML('hatena-preview-new-window');
            this.previewWindow.focus();
        }
    }, {
        key: 'previewInIframe',
        value: function previewInIframe() {
            this.$wrapper.toggleClass('is-device-touch', this.device === DEVICE.touch);
            this.appendPreviewHTML('hatena-preview-iframe');
        }
    }, {
        key: 'closePreviewWindow',
        value: function closePreviewWindow() {
            if (this.isOpeningWindow()) {
                this.previewWindow.close();
            }
        }

        /**
         * isOpeningWindowiframe
         */
    }, {
        key: 'updateWindowMode',
        value: function updateWindowMode() {
            var isOpeningWindow = this.isOpeningWindow();

            // Placeholder
            this.$wrapper.toggleClass('is-opening-new-window', isOpeningWindow);

            // 
            this.$newWindowDropdown.toggleClass('is-opening-new-window', isOpeningWindow);
            this.$reloadButton.toggle(isOpeningWindow);

            if (isOpeningWindow) {
                this.previewInIframe();
            }
        }

        /**
         * 
         * Editor
         */
    }, {
        key: 'updatePreview',
        value: function updatePreview() {
            if (this.isOpeningWindow()) {
                this.closePreviewWindow();
                this.previewInWindow();
            } else {
                this.previewInIframe();
            }
        }

        /**
         * device
         * @param {DEVICE} device
         */
    }, {
        key: 'setDevice',
        value: function setDevice(device) {
            this.device = device;
            this.updatePreview();
        }
    }]);

    return Preview;
})();

module.exports = Preview;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302,"js/Messenger":562,"js/Util/positionToString":584,"js/Util/waitForResource":592,"underscore":213}],554:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

// 

var RealtimePreview = (function () {

    /**
     * @param {jQuery} $container
     * @param {Editor} editor
     */

    function RealtimePreview($container, editor) {
        var _this = this;

        _classCallCheck(this, RealtimePreview);

        this.$container = $container;
        this.$iframes = this.$container.find('.realtime-preview-iframe');

        this.isVisible = false;
        this.onInput = function () {
            return _this._onInput();
        };

        this.count = 0;
        this.interval = 600;

        this.timer = setTimeout(function () {
            return _this.update();
        }, this.interval);
        this.editor = editor;
        this.editor.$rp_placeholder.css('z-index', '-1'); // TODO: editor
    }

    _createClass(RealtimePreview, [{
        key: '_onInput',
        value: function _onInput() {
            var _this2 = this;

            clearTimeout(this.timer);
            this.timer = setTimeout(function () {
                _this2.update();
            }, this.interval);
        }
    }, {
        key: 'show',
        value: function show() {
            this.editor.bind('change', this.onInput);
            this.isVisible = true;
            this.update();
        }
    }, {
        key: 'hide',
        value: function hide() {
            this.editor.unbind('change', this.onInput);
            this.isVisible = false;
        }

        /**
         * bodyiframe
         * 2iframe
         */
    }, {
        key: 'update',
        value: function update() {
            var _this3 = this;

            if (!this.isVisible) {
                return;
            }

            var $current = $(this.$iframes[this.count % 2]);
            this.count++;
            var $next = $(this.$iframes[this.count % 2]);

            var body = this.editor.getBody();
            var syntax = $('#syntax').val();

            $.ajax({
                url: './preview',
                type: 'post',
                dataType: 'json',
                data: [{ name: 'body', value: body }, { name: 'editor_id', value: this.editor.id }, { name: 'rkm', value: globalData('rkm') }, { name: 'rkc', value: globalData('rkc') }]
            }).done(function (res) {
                var $form = $('<form method="POST" target="realtime-preview-iframe-' + _this3.count % 2 + '"></form>').attr('action', res.uri_realtime);

                $('<textarea/>').attr('name', 'body').val(body).appendTo($form);
                $('<textarea/>').attr('name', 'syntax').val(syntax).appendTo($form);
                $('<textarea/>').attr('name', 'signature').val(res.signature).appendTo($form);
                $('<textarea/>').attr('name', 'editor_id').val(_this3.editor.id).appendTo($form);

                // iframesubmit
                // success
                _this3.$iframes.off('load.ajaxsubmit').on('load.ajaxsubmit', function () {
                    if (body.match(/^\s*$/)) {
                        _this3.editor.$rp_placeholder.css('z-index', '1');
                    } else {
                        _this3.editor.$rp_placeholder.css('z-index', '-1');
                    }
                    $next.css('z-index', 1);
                    $current.css('z-index', -1);
                });

                $form.appendTo(document.body);
                $form.submit();
                $form.remove();
            });
        }
    }]);

    return RealtimePreview;
})();

module.exports = RealtimePreview;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],555:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');
var Logger = require('js/Base/Logger');

// 

var ShareDraft = (function () {
    /**
     * @param {Editor} editor
     */

    function ShareDraft(editor) {
        var _this = this;

        _classCallCheck(this, ShareDraft);

        this.editor = editor;

        this.$shareButton = $('.js-dropdown-share-draft');

        this.$shareBoxWrapper = $('.js-share-draft-box-wrapper');
        this.$shareBox = $('.js-share-draft-box');
        this.$tokenInput = this.$shareBox.find('input');
        this.$closeButton = this.$shareBox.find('.btn-close');
        this.$mask = this.$shareBoxWrapper.find('.mask');
        this.entryId = this.editor.getEntryId();

        this.$shareButton.on('click', function (e) {
            _this.openShareDraftWindow(e);
        });

        this.$closeButton.on('click', function () {
            _this.closeShareDraftWindow();
            return false;
        });

        this.$mask.on('click', function () {
            _this.closeShareDraftWindow();
            return false;
        });

        // 
        this.$draftLabel = $('.js-label-save-draft-and-share-preview');
        this.$scheduledLabel = $('.js-label-save-scheduled-and-share-preview');
        this.editor.on('toggleScheduledEntry', function (isScheduled) {
            _this.$draftLabel.toggle(!isScheduled);
            _this.$scheduledLabel.toggle(isScheduled);
        });
    }

    /**
     * URL
     * @param {Object} pos
     */

    _createClass(ShareDraft, [{
        key: 'setWindowPosition',
        value: function setWindowPosition(pos) {
            this.$shareBox.css(pos);
        }

        /**
         * URL
         */
    }, {
        key: 'openShareDraftWindow',
        value: function openShareDraftWindow() {
            var _this2 = this;

            // forminput
            var data = this.editor.getAllInputData();
            data.draft = true;

            // 
            $.ajax({
                url: './draft',
                type: "POST",
                dataType: 'json',
                data: data
            }).done(function (res) {
                _this2.$shareBoxWrapper.addClass('visible');

                var previewURL = globalData('blogs-uri-base') + '/draft/' + res.token;
                _this2.$tokenInput.val(previewURL).focus().select();

                // ID
                _this2.editor.setEntryId(res.entry_id);
            }).fail(function (xhr, status, error) {
                Logger.BUG(error, 'ShareDraft');
            });
        }

        /**
         * URL
         */
    }, {
        key: 'closeShareDraftWindow',
        value: function closeShareDraftWindow() {
            this.$shareBoxWrapper.removeClass('visible');
        }
    }]);

    return ShareDraft;
})();

module.exports = ShareDraft;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Logger":293,"js/Base/globalData":302}],556:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var decodeParam = require('js/Util/decodeParam');
var Dropdown = require('./Dropdown');
var Locale = require('js/Locale');
var locationWithParam = require('js/Util/locationWithParam');

/**
 * syntax
 * 
 */

var SyntaxSwitcher = (function () {
    function SyntaxSwitcher($syntaxSwitcher, $dropdownWindow, editor) {
        var _this = this;

        _classCallCheck(this, SyntaxSwitcher);

        this.$syntaxSwitcher = $syntaxSwitcher;
        this.$dropdownWindow = $dropdownWindow;

        this.editor = editor;

        this.params = decodeParam(location.search.slice(1));

        // syntax
        if (this.params.entry) {
            this.$syntaxSwitcher.addClass('syntax-switcher-disabled');
            return;
        }

        this.syntaxSwitcher = new Dropdown(this.$syntaxSwitcher, this.$dropdownWindow);

        this.$dropdownWindow.on('click', '.js-dropdown-syntax', function (e) {
            var isEmpty = _this.editor.getBody() === '';

            if (isEmpty || confirm(Locale.text('epic.syntax_switch'))) {
                _this.switchSyntax($(e.currentTarget).data('syntax'));
            } else {
                _this.$dropdownWindow.toggle();
            }
        });
    }

    _createClass(SyntaxSwitcher, [{
        key: 'switchSyntax',
        value: function switchSyntax(syntax) {
            // 
            $(document).trigger('clearBackup');

            // 
            //  ()
            var newParams = _.extend(this.params, {
                syntax: syntax,
                title: this.editor.getTitle()
            });

            this.editor.trigger('initialize');
            location.href = locationWithParam(newParams);
        }
    }, {
        key: 'disable',
        value: function disable() {
            this.$dropdownWindow.hide();
            this.$syntaxSwitcher.addClass('syntax-switcher-hidden');
        }
    }, {
        key: 'enable',
        value: function enable() {
            this.$syntaxSwitcher.removeClass('syntax-switcher-hidden');
        }
    }]);

    return SyntaxSwitcher;
})();

module.exports = SyntaxSwitcher;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Dropdown":548,"js/Locale":561,"js/Util/decodeParam":573,"js/Util/locationWithParam":580,"underscore":213}],557:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var EventTracker = require('js/Base/EventTracker');
var ColorPicker = require('./ColorPicker');
var Dropdown = require('./Dropdown');

var Toolbar = {

    /**
     * @param {jQuery} $toolbar
     * @param {jQuery} $subToolbar
     * @param {Editor} editor
     */
    init: function init($toolbar, $subToolbar, editor) {
        var _this = this;

        this.$toolbar = $toolbar;
        this.$subToolbar = $subToolbar;
        this.$moreButton = $('.button-toolbar-more');

        this.editor = editor;

        this.$toolbar.on('click', 'button', function (e) {
            var action = $(e.currentTarget).attr('data-action');

            if (action) {
                _this.editor.invokeAction(action);
            }

            return false;
        });

        this.$toolbar.find('button[data-action]').each(function (i, elem) {
            var $button = $(elem);
            var action = $button.attr('data-action');

            if (!_this.editor.actions[action]) {
                $button.attr('disabled', 'disabled');
                $button.addClass('disabled');
            }
        });

        // Dropdown
        this.$toolbar.find('.toolbar-select-button').each(function (i, elem) {
            var dropdownWindowSelector = $(elem).attr('data-dropdown-window-selector');
            var $dropdownWindow = $('#editor').find(dropdownWindowSelector);

            new Dropdown($(elem), $dropdownWindow);
        });

        $('.toolbar-select-dropdown-window').on('mousedown', '[data-action]', function (e) {
            var $button = $(e.currentTarget);
            var action = $button.attr('data-action');
            _this.editor.invokeAction(action);
            EventTracker.trackEvent($button.attr('data-track-name'));
        });

        this.setupColorPicker();
        this.setupToolbarMore();
    },

    // ""
    setupToolbarMore: function setupToolbarMore() {
        var _this2 = this;

        var localStorageKey = 'Hatena.Diary.Editor.showSubToolbar';

        try {
            localStorage[localStorageKey] = localStorage[localStorageKey] || "true";
        } catch (ignore) {}

        this.$moreButton.on('click', function (e) {
            e.preventDefault();

            _this2.toggleSubToolbar();

            try {
                // localStorage
                var showSubToolbarValue = !JSON.parse(localStorage[localStorageKey]);
                localStorage[localStorageKey] = showSubToolbarValue.toString();
            } catch (ignore) {}
        });

        // localStorage
        var shouldOpen = undefined;
        try {
            shouldOpen = localStorage[localStorageKey] === 'true';
        } catch (error) {
            shouldOpen = true;
        }

        if (shouldOpen) {
            this.toggleSubToolbar();
        }
    },

    toggleSubToolbar: function toggleSubToolbar() {
        this.$subToolbar.toggle();
        this.$moreButton.toggleClass('is-hidden');

        this.editor.emit('resizeRequired');
    },

    setupColorPicker: function setupColorPicker() {
        var _this3 = this;

        var $colorPickerWindow = $('.js-hatena-diary-color-picker');
        var $colorPickerButton = $('[data-action="color"]');

        this.colorPicker = new ColorPicker($colorPickerWindow);
        this.colorPicker.on('colorpick', function (color) {
            _this3.editor.invokeAction('pickColor', color);
        });

        this.colorPickerDropdown = new Dropdown($colorPickerButton, $colorPickerWindow);
    }

};

module.exports = Toolbar;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./ColorPicker":429,"./Dropdown":548,"js/Base/EventTracker":284}],558:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Logger = require('js/Base/Logger');
var BUG = Logger.BUG;
var globalData = require('js/Base/globalData');
var extractFotolifeSyntax = require('js/Base/extractFotolifeSyntax');

/**
 * Fotolife
 */
var isUploadableFile = function isUploadableFile(filename) {
    var uploadableImagePattern = /\.(jpg|jpeg|gif|png|bmp)$/i;
    var uploadableMoviePattern = /\.(mov|mpg|wmv|avi|flv|3gp|3g2)$/i;
    return !!filename.match(uploadableImagePattern) || !!filename.match(uploadableMoviePattern);
};

var defaultFolder = {
    fotolife: 'Hatena Blog',
    paint: 'Hatena Blog Illust'
};

/**
 * 
 * 11
 * 
 * - progress   { percent: 0100 }
 * - disk_full 
 * - success    { html, syntax }
 * - error     
 */

var Uploader = (function () {
    function Uploader() {
        _classCallCheck(this, Uploader);

        this.handlers = {};
        this.params = {};
    }

    /** @static */

    _createClass(Uploader, [{
        key: 'on',
        value: function on(name, func) {
            if (!this.handlers[name]) {
                this.handlers[name] = [];
            }
            this.handlers[name].push(func);
        }
    }, {
        key: 'emit',
        value: function emit(name, event) {
            var handlers = this.handlers[name] || [];
            for (var i = 0, len = handlers.length; i < len; i++) {
                try {
                    handlers[i](event);
                } catch (e) {
                    Logger.BUG('Error on emit[' + name + '] ' + e);
                }
            }
        }

        /**
         * 
         * @param {Object} params -  {size: 300} size=300
         */
    }, {
        key: 'setParams',
        value: function setParams(params) {
            this.params = params;
        }

        /**
         * 
         * @param {File} file       - 
         * @param {string} [folder] - 
         */
    }, {
        key: 'upload',
        value: function upload(file, folder) {
            var _this = this;

            var ret = $.Deferred();

            if (!isUploadableFile(file.name)) {
                var e = new TypeError('File not supported');
                ret.reject(e);
                this.emit('error', e);
                return;
            }

            // 
            if (folder === null || folder === undefined) {
                BUG(new Error('Uploader: invalid folder name'));
                folder = defaultFolder.fotolife;
            }

            var data = new FormData();
            data.append('rkm', globalData('rkm'));
            data.append('append', 1);
            data.append('fototitle', '');
            data.append('folder', folder);
            data.append('image', file);

            _.each(this.params, function (value, key) {
                data.append(key, value);
            });

            var xhr = new XMLHttpRequest();

            xhr.upload.addEventListener('progress', function (e) {
                var percent = e.lengthComputable ? e.loaded / e.total * 100 : NaN;
                _this.emit('progress', { percent: percent });
                ret.notify(percent);
            }, false);

            xhr.addEventListener('load', function (e) {
                _this.emit('progress', { percent: 100 });
                ret.notify(100);

                if (xhr.status !== 200) {
                    if (xhr.status === 402) {
                        _this.emit('disk_full', e);
                    }
                    _this.emit('error', e);
                    ret.reject(e);
                    return;
                }

                extractFotolifeSyntax(xhr.responseText).done(function (syntax) {
                    ret.resolve(syntax);
                    _this.emit('success', syntax);
                }).fail(function (err) {
                    ret.reject(err);
                });
            }, false);

            xhr.addEventListener('error', function (e) {
                _this.emit('error', e);
                ret.reject(e);
            }, false);

            xhr.addEventListener('abort', function (e) {
                _this.emit('error', e);
                ret.reject(e);
            }, false);

            xhr.open('POST', '/f/' + globalData('name') + '/upbysmart');
            xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
            xhr.send(data);

            return ret.promise();
        }
    }, {
        key: 'uploadPaint',
        value: function uploadPaint(base64data, ext) {
            var _this2 = this;

            var ret = $.Deferred();

            $.post('/f/' + globalData('name') + '/haiku', {
                rkm: globalData('rkm'),
                append: 1,
                fototitle: '',
                folder: defaultFolder.paint,
                image: base64data,
                ext: ext,
                model: 'hatenablog'
            }).done(function (data) {
                _this2.emit('progress', { percent: 100 });

                extractFotolifeSyntax(data).done(function (syntax) {
                    ret.resolve(syntax);
                    _this2.emit('success', syntax);
                }).fail(function (err) {
                    ret.reject(err);
                });
            }).fail(function (err) {
                _this2.emit('error', err);
                ret.reject(err);
            });

            return ret;
        }
    }]);

    return Uploader;
})();

Uploader.uploadDroppedFiles = function (e) {
    // 
    // uploader
    var files = [].slice.call(e.dataTransfer.files);
    $(document).trigger('uploadDroppedFiles', [files]);
};

Uploader.DEFAULT_SIZE = 1024;

module.exports = Uploader;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Logger":293,"js/Base/extractFotolifeSyntax":300,"js/Base/globalData":302,"underscore":213}],559:[function(require,module,exports){
'use strict';

var BUG = require('js/Base/Logger').BUG;

var KEY_PREFIX = 'hatenablog-editor-config-';

// 
// 1arrayJSON.stringify/parse
var configStorage = {
    save: function save(key, value) {
        try {
            localStorage.setItem(KEY_PREFIX + key, JSON.stringify([value]));
        } catch (e) {
            BUG(e);
        }
    },
    load: function load(key) {
        var result = undefined;

        try {
            result = JSON.parse(localStorage.getItem(KEY_PREFIX + key) || '[]')[0];
        } catch (e) {
            BUG(e);
        }

        return result;
    }
};

module.exports = configStorage;

},{"js/Base/Logger":293}],560:[function(require,module,exports){
'use strict';

var Logger = require('js/Base/Logger');

var EDITORS = {
    html: require('./HTMLEditor'),
    hatena: require('./HatenaEditor'),
    markdown: require('./MarkdownEditor')
};

module.exports = function createEditor(form) {
    var mode = $(form).find('[name="syntax"]').val();
    Logger.LOG('init editor with mode: ' + mode);
    return new EDITORS[mode](form);
};

},{"./HTMLEditor":550,"./HatenaEditor":551,"./MarkdownEditor":552,"js/Base/Logger":293}],561:[function(require,module,exports){
'use strict';

document.createElement('time'); // IE

var Locale = {
    /* --- Languages --- */

    // 
    getAvailLangs: function getAvailLangs() {
        if (this._availLangs) return this._availLangs;
        var de = document.documentElement;
        var langs = de ? de.getAttribute('data-avail-langs') : '';
        if (langs) {
            langs = langs.split(/\s+/);
        } else {
            langs = [];
        }
        this._availLangs = langs;
        return langs;
    },

    // cookie
    setAcceptLang: function setAcceptLang(newLang) {
        var cookie = new Cookie();
        cookie.set('Accept-Language', newLang, { domain: this.cookieDomain, expires: '+1y', path: '/' });
        cookie.set('_hatena_set_lang', 1, { domain: this.cookieDomain, expires: '+1d', path: '/' });
    },

    // 
    getTextLang: function getTextLang() {
        var docEl = document.documentElement;
        if (!docEl) return 'ja';
        var lang = docEl.getAttribute('lang');
        return lang || 'ja';
    },

    loadTextData: function loadTextData() {
        var key = 'textDataLoaded' + this.textDataDirName + this.textDataFileNameStemSuffix;
        if (this[key]) return;
        this[key] = true;

        var self = this;
        var host = this.dataHost;
        var lang = this.getTextLang();
        var date = new Date();
        var url = 'http://' + host + '/js/' + this.textDataDirName + 'texts-' + lang + this.textDataFileNameStemSuffix + '.js?' + date.getFullYear() + date.getMonth() + date.getDate();

        if (typeof Ten != "undefined" && Ten.AsyncLoader) {
            Ten.AsyncLoader.loadScripts([url], function () {
                var key = 'Hatena.Locale,' + self.project + ',Text';
                Ten.AsyncLoader.registerObject(key, self);
            });
        } else {
            var script = document.createElement('script');
            script.src = url;
            document.getElementsByTagName('head')[0].appendChild(script);
        }
    },

    /**
     * msgid
     * @param  {String} msgid - ID
     * @return {String}         msgid msgid
     */
    text: function text(msgid) {
        var allArgs = arguments;
        var lang = this.getTextLang();
        var project = Hatena.Locale.project;
        var entry;
        try {
            entry = Hatena[project].Locale.Data.Text[lang][msgid]; // XXX
        } catch (e) {}
        if (entry) {
            var v = entry.value;
            var args = entry.args;
            if (args) {
                var i = 0;
                return v.replace(/%s/g, function () {
                    return allArgs[parseInt(args[i++], 10)];
                });
            } else {
                return v;
            }
        } else {
            return msgid;
        }
    },

    textN: function textN(msgid, n) {
        var allArgs = arguments;
        var lang = this.getTextLang();
        n = n || 0;
        var project = Hatena.Locale.project;
        var entry;
        try {
            entry = Hatena[project].Locale.Data.Text[lang][msgid]; // XXX
        } catch (e) {}
        if (entry) {
            var qt = entry.quanttype || 'o';
            var v = entry.value;
            var args = entry.args;
            if (qt == '1_o') {
                if (n == 1) {
                    v = entry.value_1;
                    args = entry.args_1;
                }
            } else if (qt == '01_o') {
                if (n === 0 || n === 1) {
                    v = entry.value_1;
                    args = entry.args_1;
                }
            }

            if (args) {
                var i = 0;
                return v.replace(/%s/, function () {
                    return allArgs[1 + parseInt(args[i++], 10)];
                });
            } else {
                return v;
            }
        } else {
            return msgid;
        }
    },

    textFwN: function textFwN(msgid, n) {
        var lang = this.getTextLang();
        if (/^ja(?:-|$)$/.test(lang)) {
            //
        } else {
                n *= 2;
            }

        var args = [msgid, n, this.number(n)];
        for (var i = 2; i < arguments.length; i++) {
            args.push(arguments[i]);
        }

        return this.textN.apply(this, args);
    },

    // IE
    _period00: new RegExp('\\' + Number(0).toLocaleString().replace(/0/g, '') + '0+$'),

    number: function number(n) {
        return (n + 0).toLocaleString().replace(this._period00, '');
    },

    /* --- Regions --- */

    getAvailRegions: function getAvailRegions() {
        if (this._availRegions) return this._availRegions;
        var de = document.documentElement;
        var regions = de ? de.getAttribute('data-avail-regions') : '';
        if (regions) {
            regions = regions.split(/\s+/);
        } else {
            regions = [];
        }
        this._availRegions = regions;
        return regions;
    },

    getRegionCode: function getRegionCode() {
        var docEl = document.documentElement;
        if (!docEl) return 0;
        var region = docEl.getAttribute('data-region');
        return parseInt(region || 0, 10);
    },

    setRegionCode: function setRegionCode(newRegionCode) {
        var cookie = new Cookie();
        cookie.set('_hatena_region', newRegionCode, { domain: this.cookieDomain, expires: '+1y', path: '/' });
    },

    /* --- Date and Time --- */

    datetimeHTML: function datetimeHTML(dt) {
        var y = '000' + dt.getUTCFullYear();y = y.substring(y.length - 4);
        var M = '0' + (dt.getUTCMonth() + 1);M = M.substring(M.length - 2);
        var d = '0' + dt.getUTCDate();d = d.substring(d.length - 2);
        var h = '0' + dt.getUTCHours();h = h.substring(h.length - 2);
        var m = '0' + dt.getUTCMinutes();m = m.substring(m.length - 2);
        var s = '0' + dt.getUTCSeconds();s = s.substring(s.length - 2);
        var ms = '00' + dt.getUTCMilliseconds();ms = ms.substring(ms.length - 3);
        return '<time datetime="' + y + '-' + M + '-' + d + 'T' + h + ':' + m + ':' + s + '.' + ms + 'Z">' + dt.toLocaleString() + '</time>';
    },

    /* You have to add service name tags to msgids such as "minutes_n"
       in Hatena::Translator such that messages are included in
       data-??.js. */
    deltaDatetime: function deltaDatetime(dt) {
        function datetime_to_delta(date) {
            var diff = (new Date().getTime() - date.getTime()) / 1000;
            var future = diff < 0;
            if (future) diff = -diff;
            diff = Math.floor(diff / 60);
            if (diff < 60) {
                return { num: diff, unit: 'minutes_n', future: future };
            }
            diff = Math.floor(diff / 60);
            if (diff < 24) {
                return { num: diff, unit: 'hours_n', future: future };
            }
            diff = Math.floor(diff / 24);
            if (diff < 365) {
                return { num: diff, unit: 'days_n', future: future };
            }
            diff = Math.floor(diff / 365);
            return { num: diff, unit: 'years_n', future: future };
        }

        var delta = datetime_to_delta(dt);

        if (typeof delta.num != "undefined") {
            var text = this.textN(delta.unit, delta.num, delta.num);
            if (delta.future) {
                return this.text('datetime.later', text);
            } else {
                return this.text('datetime.ago', text);
            }
        } else {
            return dt.toLocaleString();
        }
    },

    updateTimestamps: function updateTimestamps(root) {
        var datetimePattern = /(\d+-\d+-\d+)T(\d+:\d+:\d+)(?:\.(\d+))?Z/;

        root = root || document;
        var targets = root.getElementsByTagName('time'); // XXX class=""
        for (var i = 0, len = targets.length; i < len; i++) {
            var time = targets[i];
            if (time._date) {
                continue;
            }

            // Check date type
            var isRelative = time.getAttribute('data-relative') !== null;
            var isLocal = time.getAttribute('data-local') !== null;
            if (!isRelative && !isLocal) {
                continue;
            }

            // Time attr -> Date object
            var datetime = time.getAttribute('datetime');
            var epoch = time.getAttribute('data-epoch');
            if (!datetime && !epoch) {
                continue;
            }

            var date;
            if (datetime && datetime.match(datetimePattern)) {
                date = new Date(datetime);
            } else if (epoch && epoch.match(/^\d+$/)) {
                date = new Date(+epoch);
            }
            if (!date) {
                continue;
            }

            // Set innerHTML
            if (isRelative) {
                try {
                    time.innerHTML = this.deltaDatetime(date);
                } catch (e) {}
            }
            if (isLocal) {
                time.innerHTML = date.toLocaleString();
            }
        }
    },

    setupTimestampUpdater: function setupTimestampUpdater() {
        if (this._timestampUpdaterEnabled) return;
        this._timestampUpdaterEnabled = true;

        this.updateTimestamps();
        setInterval(function () {
            Locale.updateTimestamps();
        }, 60 * 1000);
    },

    /* --- URLs and Navigation --- */

    reload: function reload(args) {
        var query = location.search;
        if (query) {
            args = args || {};
            var preserve = args.preserve || {};

            query = query.replace(/^\?/, '').split(/[&;]/);
            var changed = false;
            var newQuery = [];
            for (var i = 0; i < query.length; i++) {
                var qp = query[i];
                var m;
                if (m = qp.match(/^(locale.[^=]+)/)) {
                    if (preserve[m[1]]) {
                        newQuery.push(qp);
                    } else {
                        changed = true;
                    }
                } else {
                    newQuery.push(qp);
                }
            }

            if (changed) {
                location.search = '?' + newQuery.join('&');
                return;
            }
        }

        location.reload(true);
    },

    reloadIfWrongLocale: function reloadIfWrongLocale() {
        var cookie = new Cookie();

        if (/\blocale\.(?:lang|region|country)\b/.test(location.search)) {
            return;
        }

        if (cookie.get('_hatena_locale_reload')) {
            cookie.set('_hatena_locale_reload', '', { domain: this.cookieDomain, expires: '-1y', path: '/' });
            return;
        } else {
            var cookieLang = (cookie.get('Accept-Language') || '').split(/,/)[0].split(/;/)[0].replace(/[^A-Za-z0-9\-]/g, '').toLowerCase();
            var cookieRegion = cookie.get('_hatena_region');
            if (!cookieLang || cookieRegion === null || cookieRegion === '') return;
            cookieRegion = parseInt(cookieRegion, 10);

            var currentLang = this.getTextLang();
            var currentRegion = this.getRegionCode();
            if (currentLang == cookieLang && currentRegion == cookieRegion) return;

            var availLangs = this.getAvailLangs();
            var availRegions = this.getAvailRegions();
            if (availLangs.join(",").indexOf(cookieLang) == -1) return;
            if (availRegions.join(",").indexOf(cookieRegion) == -1) return;

            cookie.set('_hatena_locale_reload', 1, { domain: this.cookieDomain, path: '/' });
            location.reload(true);
            return;
        }
    },

    urlWithLangAndRegion: function urlWithLangAndRegion(url) {
        var q = [];
        if (/\?/.test(url)) {
            var u = url.split(/\?/, 2);
            var qp = u[1].split(/[&;]/);
            for (var i = 0; i < qp.length; i++) {
                if (!/^locale\.(lang|region)=/.test(qp[i])) {
                    q.push(qp[i]);
                }
            }
            url = u[0];
        }
        q.push('locale.lang=' + encodeURIComponent(this.getTextLang()));
        q.push('locale.region=' + encodeURIComponent(this.getRegionCode()));
        return url + '?' + q.join('&');
    },

    /* --- Cookie and remote data configuration --- */

    project: 'Default',
    textDataFileNameStemSuffix: '',
    textDataDirName: '',
    dataHost: location.host,
    cookieDomain: '.hatena.ne.jp'
};

if (/\.hatena\.com$/i.test(location.hostname)) {
    Locale.cookieDomain = '.hatena.com';
}

// LocaleCookie
var Cookie = function Cookie() {
    this.init.apply(this, arguments);
};
Cookie.prototype = {
    init: function init(string) {
        this.cookies = this.parse(string);
    },

    parse: function parse(string) {
        var cookies = {};

        var segments = (string || document.cookie).split(/;\s*/);
        while (segments.length) {
            try {
                var segment = segments.shift().replace(/^\s*|\s*$/g, '');
                if (!segment.match(/^([^=]*)=(.*)$/)) continue;
                var key = RegExp.$1,
                    value = RegExp.$2;
                if (value.indexOf('&') != -1) {
                    value = value.split(/&/);
                    for (var i = 0; i < value.length; i++) value[i] = decodeURIComponent(value[i]);
                } else {
                    value = decodeURIComponent(value);
                }
                key = decodeURIComponent(key);

                cookies[key] = value;
            } catch (e) {}
        }

        return cookies;
    },

    set: function set(key, value, option) {
        this.cookies[key] = value;

        if (value instanceof Array) {
            for (var i = 0; i < value.length; i++) value[i] = encodeURIComponent(value[i]);
            value = value.join('&');
        } else {
            value = encodeURIComponent(value);
        }
        var cookie = encodeURIComponent(key) + '=' + value;

        option = option || {};
        if (typeof option == 'string' || option instanceof Date) {
            // deprecated
            option = {
                expires: option
            };
        }

        if (!option.expires) {
            option.expires = this.defaultExpires;
        }
        if (/^\+?(\d+)([ymdh])$/.exec(option.expires)) {
            var count = parseInt(RegExp.$1, 10);
            var field = ({ y: 'FullYear', m: 'Month', d: 'Date', h: 'Hours' })[RegExp.$2];

            var date = new Date();
            date['set' + field](date['get' + field]() + count);
            option.expires = date;
        }

        if (option.expires) {
            if (option.expires.toUTCString) option.expires = option.expires.toUTCString();
            cookie += '; expires=' + option.expires;
        }
        if (option.domain) {
            cookie += '; domain=' + option.domain;
        }
        if (option.path) {
            cookie += '; path=' + option.path;
        } else {
            cookie += '; path=/';
        }

        return document.cookie = cookie;
    },
    get: function get(key) {
        return this.cookies[key];
    },
    has: function has(key) {
        return key in this.cookies && !(key in Object.prototype);
    },
    clear: function clear(key) {
        this.set(key, '', new Date(0));
        delete this.cookies[key];
    }
};

module.exports = Locale;

},{}],562:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var keyString = require('js/keyString');
var Logger = require('js/Base/Logger');
var globalData = require('js/Base/globalData');

var EventEmitter = require('events').EventEmitter;

/**
 * 1
 * iframecreateForParentframeMessenger
 * framecreateForFrameiframeMessenger
 */

var Messenger = (function () {

    /**
     * @param {Object} opts.window - framewindow
     * @param {string} opts.key    - frame createKeywindow.name
     */

    function Messenger(opts) {
        var _this = this;

        _classCallCheck(this, Messenger);

        this.window = opts.window;
        this.key = opts.key;

        this.eventEmitter = new EventEmitter();

        // this.receivepostMessage
        this.messageListener = function (e) {
            return _this.receive(e);
        };
        window.addEventListener('message', this.messageListener, false);
    }

    // Static methods

    /**
     * Messenger
     * 1
     * @param {string} type - 
     * @param {Object} obj  - 
     */

    _createClass(Messenger, [{
        key: 'send',
        value: function send(type, obj) {
            this.window.postMessage(JSON.stringify({
                key: this.key,
                type: type,
                data: obj
            }), '*');
        }

        /**
         * postMessage
         * keythis.keythis.dispatchEvent()
         * @param {event} e
         */
    }, {
        key: 'receive',
        value: function receive(e) {
            try {
                var data = JSON.parse(e.data);
                if (data.key !== this.key) {
                    return;
                }
                this.eventEmitter.emit(data.type, data.data);
            } catch (err) {
                if (Messenger.ENABLE_DEBUG && window.console) {
                    console.log(err.name + ': ' + err.message);
                }
            }
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            window.removeEventListener('message', this.messageListener, false);
        }
    }, {
        key: 'addEventListener',
        value: function addEventListener(type, listener) {
            if (!listener) {
                return;
            }
            this.eventEmitter.on(type, listener);
        }
    }, {
        key: 'removeEventListener',
        value: function removeEventListener(type, listener) {
            this.eventEmitter.removeListener(type, listener);
        }
    }, {
        key: 'dispatchEvent',
        value: function dispatchEvent() {
            var _eventEmitter;

            (_eventEmitter = this.eventEmitter).emit.apply(_eventEmitter, arguments);
        }
    }]);

    return Messenger;
})();

Messenger.SIGNATURE = 'MZ';

/**
 * 
 * @static
 */
Messenger.createKey = function () {
    // 2821109907456 = 36 ** 8
    var key = Messenger.SIGNATURE + Math.floor(Math.random() * 2821109907456 + 2821109907456).toString(36).substring(1);
    return key + '@';
};

Messenger.createForParent = function () {
    var key = window.name;
    return new Messenger({
        key: key,
        window: window.opener || window.parent
    });
};

Messenger.createForFrame = function (frame, url) {
    return Messenger.createForWindow(frame.contentWindow, url);
};

Messenger.createForWindow = function (targetWindow, url) {
    var key = Messenger.createKey();

    targetWindow.name = key;
    targetWindow.location.replace(url);

    return new Messenger({
        key: key,
        window: targetWindow
    });
};

Messenger.createForCurrentWindow = function () {
    var key = window.name;
    if (key === '') {
        key = Messenger.createKey();
    }

    return new Messenger({
        key: key,
        window: window
    });
};

// window.Messenger
Messenger.messenger = null;
Messenger.send = function (type, obj) {
    Logger.LOG(['send', type, obj]);
    try {
        Messenger.messenger.send(type, obj);
    } catch (error) {
        Logger.BUG(error, 'Messenger.send(' + type + ')');
    }
};
Messenger.addEventListener = function (type, func) {
    try {
        Messenger.messenger.addEventListener(type, func);
    } catch (error) {
        Logger.BUG(error, 'Messenger.addEventListener(' + type + ')');
    }
};
Messenger.listenToParent = function () {
    Messenger.messenger = Messenger.createForParent();

    if (globalData('page') !== 'globalheader') {
        $('.close').on('click', function () {
            Messenger.send('close', { name: window.name });
            return false;
        });

        $(window).keyup(function (e) {
            if (keyString(e) === 'S-ESC') {
                Messenger.send('close', { name: window.name });
            }
        });
    }
};
Messenger.listenToFrame = function (iframe, url) {
    Messenger.messenger = Messenger.createForFrame(iframe, url);
};

module.exports = Messenger;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"events":207,"js/Base/Logger":293,"js/Base/globalData":302,"js/keyString":599}],563:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Messenger = require('js/Messenger');

var EventTracker = require('js/Base/EventTracker');
var globalData = require('js/Base/globalData');

var getSelected = require('js/Util/getSelected');
var getSelectedText = require('js/Util/getSelectedText');

var QUOTE_OFFSET = {
    LEFT: 60,
    MIN_LEFT: 10
};
var SELECT_STAR_SIZE = 40;

var Quote = {
    targetArticle: {
        $el: null,
        title: '',
        uri: '',
        uuid: ''
    },
    selectedText: '',

    init: function init() {
        var self = this;
        var $selectionStartArticleURI, $selectionEndArticleURI;

        // 
        self.$el = $('.quote-box');

        // 
        $(document).on('mousedown', 'body', function (e) {
            var $target = $(e.target);
            var $targetArticle = self.getClosestArticle($target);
            $selectionStartArticleURI = self.getArticleURI($targetArticle);
        });

        // 
        $(document).on('mouseup', 'body', function (e) {
            var $target = $(e.target);
            var $targetArticle = self.getClosestArticle($target);
            $selectionEndArticleURI = self.getArticleURI($targetArticle);

            // 
            // ()
            if ($target.closest($('.hatena-star-add-button')).length > 0) {
                e.preventDefault();
                self.hideQuoteBox();
                return;
            }

            _.defer(function () {
                var selectedText = getSelectedText();

                // 
                // 
                if ($target.closest(self.$el).length > 0) return;
                if ($target.closest($('.quote-stock-panel')).length > 0) return;

                //    
                if ($selectionStartArticleURI !== $selectionEndArticleURI || !self.isValidSelected($target, selectedText)) {
                    self.selectedText = '';
                    self.setTargetArticle(null);
                    self.hideQuoteBox();
                    return;
                }

                // 
                self.selectedText = selectedText;
                self.setTargetArticle($targetArticle);
                self.showQuoteBox($targetArticle, e.pageY);
            });
        });
    },
    isValidSelected: function isValidSelected($target, selectedText) {
        var selectionIsBlank = selectedText.match(/^\s*$/);
        var isComment = $target.closest('.comment').length > 0;

        if (isComment || selectionIsBlank) return false;

        return true;
    },
    showQuoteBox: function showQuoteBox($targetArticle, y) {
        var self = this;
        var box = self.$el;

        // 
        var left = $targetArticle.offset().left - QUOTE_OFFSET.LEFT;
        left = Math.max(left, QUOTE_OFFSET.MIN_LEFT);
        box.css({ top: y, left: left });

        // 
        box.show();
    },
    hideQuoteBox: function hideQuoteBox() {
        var self = this;
        self.$el.hide();
    },

    // Util
    getClosestArticle: function getClosestArticle($target) {
        var $article = $target.closest('article');

        // articlemouseuparticle
        // article
        if ($article.length <= 0) {
            var selection = getSelected();
            if (selection.focusNode !== undefined) {
                $article = $(selection.focusNode).closest('article');
            }
        }
        return $article;
    },
    getArticleURI: function getArticleURI($article) {
        return $article.find('.entry-title .entry-title-link').attr('href');
    },
    getArticleTitle: function getArticleTitle($article) {
        return $article.find('.entry-title .entry-title-link').text();
    },
    getArticleUUID: function getArticleUUID($article) {
        return $article.attr('data-uuid');
    },
    setTargetArticle: function setTargetArticle($article) {
        var self = this;

        if ($article) {
            self.targetArticle = {
                $el: $article,
                uri: self.getArticleURI($article),
                title: self.getArticleTitle($article),
                uuid: self.getArticleUUID($article)
            };
        } else {
            self.targetArticle = {
                $el: null,
                uri: '',
                title: '',
                uuid: ''
            };
        }
    }
};

Quote.Star = {
    // methods
    init: function init() {
        if (!Hatena.Star) return;

        var self = this;
        var messageFadeoutTimer = null;

        // DOM
        self.$starButton = $('.tooltip-quote-star');
        self.$starMessageBox = $('#quote-star-message-box');

        // Hatena.Star
        self.$starButton.show();

        // 
        Hatena.Star.AddButton.prototype.addStar = _.wrap(Hatena.Star.AddButton.prototype.addStar, function (func, e) {
            this.selectedText = Quote.selectedText.substr(0, 200);

            func.call(this, e);

            if (this.selectedText !== '') {
                EventTracker.trackEvent('hatena-star-add-quote');
            }
        });

        // beforeAddStar
        Hatena.Star.AddButton.prototype.setupObservers = _.wrap(Hatena.Star.AddButton.prototype.setupObservers, function (func) {
            func.call(this);

            new Ten.Observer(self.$starButton[0], 'onclick', this, 'beforeAddStar');
        });

        Hatena.Star.AddButton.prototype.beforeAddStar = function (e) {
            if (Quote.targetArticle.uuid === $(this.entry.entryNode).attr('data-uuid')) {
                this.addStar(e);
            }
        };

        // 
        // /or
        Hatena.Star.AddButton.prototype.receiveResult = _.wrap(Hatena.Star.AddButton.prototype.receiveResult, function (func, args) {
            // 
            var messageBoxOffset = {
                top: self.$starButton.offset().top,
                left: self.$starButton.offset().left + SELECT_STAR_SIZE
            };

            if (args.quote && self.$starButton.is(':visible')) {
                // 
                if (args.isGuest) {
                    var pos = { x: messageBoxOffset.left, y: messageBoxOffset.top };

                    // HatenaStar.js, 
                    pos.x += 10;
                    pos.y -= 25;

                    this.lastPosition = pos;
                } else {
                    self.$starMessageBox.stop().css(_.extend(messageBoxOffset, { opacity: 1.0 })).show();

                    if (messageFadeoutTimer) {
                        clearTimeout(messageFadeoutTimer);
                    }
                    messageFadeoutTimer = setTimeout(function () {
                        self.$starMessageBox.fadeOut(1000);
                    }, 1000);

                    EventTracker.trackEvent('hatena-star-add-select');
                }
            }

            func.call(this, args);
        });
    }
};

Quote.Stock = {
    init: function init(info) {
        var self = this;

        // DOM
        self.$stockButton = $('.tooltip-quote-stock');
        self.$stockMessageBox = $('#quote-stock-message-box');
        self.$stockSuccessMessage = $('#quote-stock-succeeded-message');
        self.$stockFailMessage = $('#quote-stock-failed-message');
        self.$stockCloseMessageButton = $('.quote-stock-close-message-button');
        self.$stockShowEditorButton = $('#quote-stock-show-editor-button');
        self.$unstockableMessageBox = $('#unstockable-quote-message-box');
        self.$quoteLoginRequiredMessageBox = $('#quote-login-required-message');
        self.$quoteLoginButton = $('#quote-login-button');

        // 
        self.$stockButton.show();

        // 
        if (info.should_navigate_to_login) {
            self.$stockButton.on('click', function () {
                var messageBoxOffset = {
                    top: self.$stockButton.offset().top,
                    left: self.$stockButton.offset().left + SELECT_STAR_SIZE
                };
                self.$stockMessageBox.css(messageBoxOffset);
                self.$quoteLoginRequiredMessageBox.show();
            });

            self.$quoteLoginButton.on('click', function () {
                var redirectURI, loginURI;
                redirectURI = globalData('admin-domain') + '/go?blog=' + encodeURIComponent(Quote.targetArticle.uri);
                loginURI = 'https://www.hatena.ne.jp/login?location=' + encodeURIComponent(redirectURI);
                location.href = loginURI;
            });

            self.$stockCloseMessageButton.on('click', function () {
                self.$quoteLoginRequiredMessageBox.hide();
            });

            return false;
        }

        // 
        if (!info.stockable) {
            // 
            self.$stockButton.on('mouseover', function () {
                var messageBoxOffset = {
                    top: self.$stockButton.offset().top,
                    left: self.$stockButton.offset().left + SELECT_STAR_SIZE
                };
                self.$stockMessageBox.css(messageBoxOffset);
                self.$unstockableMessageBox.show();
            });

            self.$stockButton.on('mouseout', function () {
                self.$unstockableMessageBox.hide();
            });

            return false;
        }

        self.setupQuoteStockButton();
    },
    setupQuoteStockButton: function setupQuoteStockButton() {
        var self = this;

        // 
        self.$stockButton.on('click', function () {
            // 
            var messageBoxOffset = {
                top: self.$stockButton.offset().top,
                left: self.$stockButton.offset().left + SELECT_STAR_SIZE
            };
            self.$stockMessageBox.css(messageBoxOffset);

            // 
            Messenger.send('stockQuote', {
                uri: Quote.targetArticle.uri,
                title: Quote.targetArticle.title,
                selected_text: Quote.selectedText
            });
        });

        Messenger.addEventListener('successStockQuote', function () {
            self.$stockSuccessMessage.show();
        });

        Messenger.addEventListener('failStockQuote', function () {
            self.$stockFailMessage.show();
        });

        self.$stockShowEditorButton.on('click', function () {
            self.$stockSuccessMessage.hide();
            Messenger.send('quote-edit-entry', {});
        });

        self.$stockCloseMessageButton.on('click', function () {
            // close all messages
            self.$stockSuccessMessage.hide();
            self.$stockFailMessage.hide();
        });
    }
};

module.exports = Quote;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EventTracker":284,"js/Base/globalData":302,"js/Messenger":562,"js/Util/getSelected":575,"js/Util/getSelectedText":576,"underscore":213}],564:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Messenger = require('js/Messenger');

var EventTracker = require('js/Base/EventTracker');
var globalData = require('js/Base/globalData');

var getSelected = require('js/Util/getSelected');
var getSelectedText = require('js/Util/getSelectedText');
var ShortenText = require('js/Util/shortenText.js');

//  
var shortenText = new ShortenText($('#quote-text'), {});

// 
var setShortenedText = _.throttle(function () {
    shortenText.execute();
}, 800);

var Quote = {
    // properties
    targetArticle: {
        $el: null,
        uri: '',
        title: '',
        uuid: ''
    },
    selectedText: '',

    // methods
    init: function init(info) {
        var self = this;
        var selection = getSelected();

        // DOM
        self.$el = $('#quote-base');
        self.$box = $('#quote-box');
        self.$quoteText = $('#quote-text');
        self.$loginRequiredLink = $('.quote-login-link');
        self.$loginRequiredMessage = $('#quote-login-required');

        // targetArticle
        var article = $('article').first();
        self.targetArticle = {
            $el: article,
            uri: article.find('.entry-title a').attr('href'),
            title: article.find('.entry-title a').text(),
            uuid: article.attr('data-uuid')
        };

        // 
        self.$el.on('touchend', function (e) {
            e.preventDefault();
        });

        $(window).on('resize', function (e) {
            setShortenedText();
        });

        $('#container').on('click', function (e) {
            self.hideQuoteBox(e);
        });

        $(document).on('selectionchange', function () {
            // 
            if (selection.rangeCount < 1) return;

            // 
            var isArticle = $(selection.anchorNode).parents('article').length > 0;
            var isComment = $(selection.anchorNode).parents('.comment').length > 0;
            if (!isArticle || isComment) return;

            self.selectedText = getSelectedText().replace(/(^\s+)|(\s+$)/g, '');
            if (self.selectedText.length === 0) return;

            self.showQuoteBox();
        });

        // 
        // touchend
        // self.$elpreventDefaulta
        var redirectURI, loginURI;
        if (info.should_navigate_to_login) {
            redirectURI = globalData('admin-domain') + '/go?blog=' + encodeURIComponent(self.targetArticle.uri);
            loginURI = 'https://www.hatena.ne.jp/login?location=' + encodeURIComponent(redirectURI);
            self.$loginRequiredLink.attr('href', loginURI);
            self.$loginRequiredLink.on('touchend', function () {
                location.href = loginURI;
            });
            self.$loginRequiredMessage.show();
        }

        QuoteStar.init(info);
        QuoteStock.init(info);
    },
    showQuoteBox: function showQuoteBox() {
        var self = this;

        self.$el.show();
        shortenText.init(self.selectedText);
        setShortenedText();
    },
    hideQuoteBox: function hideQuoteBox(e) {
        var self = this;

        // 
        if (self.isBoxTouched(e.target)) return;

        self.$el.hide();
        self.$quoteText.text('');
        self.selectedText = '';
    },

    // Util
    isBoxTouched: function isBoxTouched(target) {
        return $(target).closest(this.$box).length > 0;
    }
};

var QuoteStar = {
    init: function init(info) {
        var self = this;
        var messageFadeoutTimer;

        // DOM
        self.$starButton = $('#quote-star-button');
        self.$messageBox = $('#quote-star-result');
        self.$errorBox = $('#quote-star-error');

        // , 
        if (info.should_navigate_to_login) {
            return false;
        }

        // 
        if (!info.star_addable) {
            self.$starButton.on('touchend', function () {
                self.$errorBox.show();

                if (messageFadeoutTimer) {
                    clearTimeout(messageFadeoutTimer);
                }

                messageFadeoutTimer = setTimeout(function () {
                    self.$errorBox.fadeOut(1000);
                }, 1000);
            });

            return false;
        }

        // , 
        self.$starButton.addClass('available');
        self.setupQuoteStarButtonEvents();
    },
    setupQuoteStarButtonEvents: function setupQuoteStarButtonEvents() {
        var self = this;
        var messageFadeoutTimer;

        // 
        Hatena.Star.AddButton.SmartPhone.prototype.addStar = _.wrap(Hatena.Star.AddButton.SmartPhone.prototype.addStar, function (func, e) {
            this.selectedText = Quote.selectedText.substr(0, 200);

            func.call(this, e);

            if (this.selectedText !== '') {
                EventTracker.trackEvent('hatena-star-add-quote-smartphone');
            }
        });

        // beforeAddStar
        Hatena.Star.AddButton.SmartPhone.prototype.setupObservers = _.wrap(Hatena.Star.AddButton.SmartPhone.prototype.setupObservers, function (func) {
            func.call(this);

            new Ten.Observer(self.$starButton[0], 'ontouchend', this, 'beforeAddStar');
        });

        Hatena.Star.AddButton.SmartPhone.prototype.beforeAddStar = function (e) {
            if ($(this.entry.entryNode).attr('data-uuid') === Quote.targetArticle.uuid) {
                Hatena.Star.AddButton.SmartPhone.AddStarPath = 'star.add.json';
                this.addStar(e);
                Hatena.Star.AddButton.SmartPhone.AddStarPath = 'star.add_multi.json';
            }
        };

        // 
        // /or
        Hatena.Star.AddButton.prototype.receiveResult = _.wrap(Hatena.Star.AddButton.prototype.receiveResult, function (func, args) {
            if (args.quote) {
                self.$messageBox.show();

                if (messageFadeoutTimer) {
                    clearTimeout(messageFadeoutTimer);
                }

                messageFadeoutTimer = setTimeout(function () {
                    self.$messageBox.fadeOut(1000);
                }, 1000);

                EventTracker.trackEvent('hatena-star-add-select-smartphone');
            }

            func.call(this, args);
        });
    }
};

var QuoteStock = {
    init: function init(info) {
        var self = this;
        var messageFadeoutTimer;

        // 
        if (info.should_navigate_to_login) {
            return false;
        }

        // DOM
        self.$stockButton = $('#quote-stock-button');
        self.$successMessageBox = $('#quote-stock-result');
        self.$unstockableErrorBox = $('#quote-unstockable-error');
        self.$errorBox = $('#quote-stock-error');

        // 
        if (!info.stockable) {
            self.$stockButton.on('touchend', function () {
                self.$unstockableErrorBox.show();

                if (messageFadeoutTimer) {
                    clearTimeout(messageFadeoutTimer);
                }

                messageFadeoutTimer = setTimeout(function () {
                    self.$unstockableErrorBox.fadeOut(1000);
                }, 1000);
            });

            return false;
        }

        // , 
        self.$stockButton.addClass('available');
        self.setupQuoteStockButtonEvents();
    },
    setupQuoteStockButtonEvents: function setupQuoteStockButtonEvents() {
        var self = this;
        var messageFadeoutTimer;

        self.$stockButton.on('touchend', function () {
            Messenger.send('stockQuote', {
                uri: Quote.targetArticle.uri,
                title: Quote.targetArticle.title,
                selected_text: Quote.selectedText
            });
        });

        Messenger.addEventListener('successStockQuote', function () {
            self.closeAllMessageBoxes();
            self.$successMessageBox.show();

            if (messageFadeoutTimer) {
                clearTimeout(messageFadeoutTimer);
            }

            messageFadeoutTimer = setTimeout(function () {
                self.$successMessageBox.fadeOut(1000);
            }, 1000);
        });

        Messenger.addEventListener('failStockQuote', function () {
            self.closeAllMessageBoxes();
            self.$errorBox.show();

            if (messageFadeoutTimer) {
                clearTimeout(messageFadeoutTimer);
            }

            messageFadeoutTimer = setTimeout(function () {
                self.$errorBox.fadeOut(1000);
            }, 1000);
        });
    },
    closeAllMessageBoxes: function closeAllMessageBoxes() {
        var self = this;
        self.$successMessageBox.hide();
    }
};

module.exports = Quote;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EventTracker":284,"js/Base/globalData":302,"js/Messenger":562,"js/Util/getSelected":575,"js/Util/getSelectedText":576,"js/Util/shortenText.js":589,"underscore":213}],565:[function(require,module,exports){
(function (global){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var React = (typeof window !== "undefined" ? window['React'] : typeof global !== "undefined" ? global['React'] : null);

var configStorage = require('js/Editor/configStorage');

var Tabs = (function (_React$Component) {
    _inherits(Tabs, _React$Component);

    function Tabs() {
        _classCallCheck(this, Tabs);

        _get(Object.getPrototypeOf(Tabs.prototype), 'constructor', this).call(this);

        this.state = {
            currentTab: ''
        };
    }

    _createClass(Tabs, [{
        key: 'componentDidMount',
        value: function componentDidMount() {
            // storagedTab
            var storagedTabKey = configStorage.load(this.props.localStoragePrefix);

            // 
            // 
            var initialTabKey = this.props.tabs.some(function (t) {
                return t.key === storagedTabKey;
            }) ? storagedTabKey : this.props.tabs[0].key;

            // 
            this._updateState(initialTabKey);
        }
    }, {
        key: '_updateState',
        value: function _updateState(tabKey) {
            this.setState({
                currentTab: tabKey
            });
        }
    }, {
        key: 'render',
        value: function render() {
            return React.createElement(
                'div',
                { className: "react-tabs" + (this.props.className ? ' ' + this.props.className : ''), ref: 'tabs' },
                React.createElement(
                    'div',
                    { className: 'react-tabs-list', ref: 'tablist' },
                    this._renderTabListItems()
                ),
                React.createElement(
                    'div',
                    { className: 'react-tabs-contents', ref: 'tabcontents' },
                    this._renderTabContents()
                )
            );
        }
    }, {
        key: '_renderTabListItems',
        value: function _renderTabListItems() {
            var _this = this;

            return this.props.tabs.map(function (tab) {
                var isActive = tab.key === _this.state.currentTab;
                return React.createElement(
                    'div',
                    {
                        key: '-' + tab.key,
                        className: "react-tabs-list-item" + (isActive ? ' active' : ''),
                        onClick: function () {
                            return _this._onClick(tab);
                        } },
                    tab.name
                );
            });
        }
    }, {
        key: '_renderTabContents',
        value: function _renderTabContents() {
            var _this2 = this;

            return this.props.tabs.map(function (tab) {
                var Component = tab && tab.component ? tab.component : null;
                return React.createElement(
                    'div',
                    {
                        key: '-' + tab.key,
                        className: 'react-tabs-content',
                        style: tab.key === _this2.state.currentTab ? null : { display: 'none' } },
                    Component ? React.createElement(Component, tab.props) : null
                );
            });
        }
    }, {
        key: '_onClick',
        value: function _onClick(tab) {
            this._updateState(tab.key);
            configStorage.save(this.props.localStoragePrefix, tab.key);

            if (this.props.onSelect) {
                this.props.onSelect.call(null, tab.key);
            }
        }
    }]);

    return Tabs;
})(React.Component);

Tabs.propTypes = {
    tabs: React.PropTypes.array.isRequired,
    onSelect: React.PropTypes.func,
    className: React.PropTypes.string,
    localStoragePrefix: React.PropTypes.string
};

module.exports = Tabs;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Editor/configStorage":559}],566:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

var globalData = require('js/Base/globalData');
var Locale = require('js/Locale');
var URLGenerator = require('js/Base/URLGenerator');
var EventTracker = require('js/Base/EventTracker');

var ShortenText = require('js/Util/shortenText.js');

var waitForResource = require('js/Util/waitForResource');
var positionToString = require('js/Util/positionToString');
var updateDynamicPieces = require('js/Util/updateDynamicPieces');

var setupStar = function setupStar() {
    if (!Hatena.Star) return;

    var entryConfig = {
        entryNodes: {
            // PC, article
            'article.entry': {
                uri: '.hatena-star-metadata .hatena-star-permalink',
                title: '.hatena-star-metadata .hatena-star-permalink',
                container: 'div.hatena-star-container'
            },
            // PC, archive
            'section.archive-entry': {
                uri: '.hatena-star-metadata .hatena-star-permalink',
                title: '.hatena-star-metadata .hatena-star-permalink',
                container: 'span.star-container'
            },
            // touch, article
            '.entry-article': {
                uri: '.hatena-star-metadata .hatena-star-permalink',
                title: '.hatena-star-metadata .hatena-star-permalink',
                container: 'div.hatena-star-container'
            },
            // touch, comment
            'li.entry-comment': {
                uri: 'p.comment-metadata a.permalink',
                title: 'div.comment-content',
                container: '.comment-metadata'
            }
        }
    };

    var commentConfig = {
        entryNodes: {
            'li.entry-comment': {
                uri: 'p.comment-metadata a.permalink',
                title: 'div.comment-content::-ten-truncate',
                container: '.comment-metadata'
            }
        }
    };

    Hatena.Star.SiteConfig = entryConfig;

    Hatena.Star.EntryLoader.intoCommentScope = function (func) {
        Hatena.Star.SiteConfig = commentConfig;
        func();
        Hatena.Star.SiteConfig = entryConfig;
    };

    Hatena.Star.User.prototype.userPage = function () {
        var uri = globalData('admin-domain') + '/' + this.name + '/';
        return uri;
    };

    var img_src = URLGenerator.static_url('/images/theme/star/hatena-star-add-button.png');
    Hatena.Star.AddButton.ImgSrc = img_src;
    Hatena.Star.AddButton.SmartPhone.ImgSrc = img_src;
};

setupStar();

var Star = {
    // 
    initBigStar: function initBigStar() {
        if (!Hatena.Star) return;

        // 
        Hatena.Star.Star.prototype.generateImg = function () {
            var img, star_img, user_img, span, user_icon;

            user_icon = function (name) {
                var base;
                if (location.protocol == 'https:') {
                    base = 'https://www.hatena.com/users/';
                } else {
                    base = 'http://cdn1.www.st-hatena.com/users/';
                }

                return base + encodeURI(name.slice(0, 2)) + "/" + encodeURI(name) + "/profile.gif";
            };

            star_img = Hatena.Star.Star.getImage(this.container);
            star_img.alt = this.screen_name;
            star_img.title = '';

            if (this.color && this.color != 'yellow' && this.color != 'temp') {
                star_img.alt = star_img.alt + ' (' + this.color + ')';
            }

            this.img = star_img;

            if (this.screen_name) {
                if (!Hatena.Star.Star.gotImage[this.screen_name]) {
                    Hatena.Star.Star.gotImage[this.screen_name] = {};
                }

                if (!Hatena.Star.Star.gotImage[this.screen_name][this.color]) {
                    span = document.createElement('span');
                    span.className = 'hatena-big-star-star-container';
                    user_img = document.createElement('img');
                    user_img.src = user_icon(this.screen_name);
                    user_img.setAttribute('tabIndex', 0);
                    user_img.className = 'hatena-star-user';
                    user_img.style.padding = '0';
                    user_img.style.border = 'none';

                    span.appendChild(user_img);
                    span.appendChild(star_img);

                    Hatena.Star.Star.gotImage[this.screen_name][this.color] = span;
                }

                this.img = Hatena.Star.Star.gotImage[this.screen_name][this.color].cloneNode(true);
            }
        };

        // pos
        Hatena.Star.AddButton.prototype.showColorPallet = function (e) {
            this.clearSelectedColorTimer();
            if (!this.pallet) this.pallet = new Hatena.Star.Pallet();
            var pos = Ten.Geometry.getElementPosition(this.img);
            pos.x += 2;
            pos.y += 22;
            this.pallet.showPallet(pos, this);
        };

        Hatena.Star.AddButton.SmartPhone.prototype.showColorPallet = function (e) {
            this.clearSelectedColorTimer();

            if (!this.pallet) {
                this.pallet = new Hatena.Star.Pallet.SmartPhone();
            }

            var pos = Ten.Geometry.getElementPosition(this.img);
            pos.x = Ten.Browser.isDSi ? 5 : 15;
            pos.y += 30;
            this.pallet.showPallet(pos, this);
            this.pallet.show(Hatena.Star.UseAnimation ? { x: 0, y: 0 } : pos);
        };

        // 
        Hatena.Star.AddButton.prototype.addStar = _.wrap(Hatena.Star.AddButton.prototype.addStar, function (fun, e) {
            fun.apply(this, [e]);
            EventTracker.trackEvent('hatena-star-add');
        });

        Hatena.Star.AddButton.SmartPhone.prototype.addStar = _.wrap(Hatena.Star.AddButton.SmartPhone.prototype.addStar, function (fun, e) {
            fun.apply(this, [e]);
            EventTracker.trackEvent('hatena-star-add-smartphone');
        });
    },

    // 
    initStarNavigation: function initStarNavigation() {

        if (!Hatena.Star) return;

        var $star_navigation_tooltip = $('<div>').addClass('star-navigation-tooltip').append($('<p>').text(Locale.text('star-navigation-message')));

        $.getJSON("https://www.hatena.ne.jp/notify/notices.count.json?services=1&callback=?", function (res) {

            // 
            if (res.services.s) return;

            // 
            Hatena.Star.AddButton.prototype.addStar = _.wrap(Hatena.Star.AddButton.prototype.addStar, function (fun, e) {
                fun.apply(this, [e]);
                EventTracker.trackEvent('hatena-star-add-first');
            });

            //  localStorage 
            var localStorageKey = 'Hatena.Diary.Blogs.StarNavigation.Read';

            var isRead = function isRead() {
                try {
                    return localStorage[localStorageKey] === 'already';
                } catch (ignore) {}
            };

            var setIsRead = function setIsRead(isRead) {
                try {
                    localStorage[localStorageKey] = isRead ? 'already' : 'not yet';
                } catch (ignore) {}
            };

            //  tipsy 
            if (isRead()) return;

            var wait_for_star_load = function wait_for_star_load(func) {
                setTimeout(function () {
                    var $star_button = $('.hatena-star-add-button');

                    if ($star_button.length !== 0) {
                        func();
                        return;
                    }

                    wait_for_star_load(func);
                }, 200);
            };

            wait_for_star_load(function () {
                $('.hatena-star-container').after($star_navigation_tooltip);

                $('.star-navigation-tooltip').click(function () {
                    setIsRead(true);
                    $(this).fadeOut(1000);
                });

                $('.hatena-star-add-button').click(function () {
                    setIsRead(true);
                    $('.star-navigation-tooltip').fadeOut(1000);
                });
            });
        });
    },

    initDeleteStar: function initDeleteStar() {
        if (!Hatena.Star) return;

        Hatena.Star.Star.prototype.setImgObservers = function () {
            var self = this;
            new Ten.Observer(self.img, 'onmouseover', self, 'showName');
            new Ten.Observer(self.img, 'onmouseout', self, 'hideName');
        };

        Hatena.Star.Star.prototype.asElement = _.wrap(Hatena.Star.Star.prototype.asElement, function (func) {
            var self = this;
            var element = func.call(self);

            if (!Hatena.Star.Config.isStarDeletable) return element;

            // documentappend

            // Deferred
            var checkCanDelete = _.once(function () {
                var dfd = $.Deferred();

                var uri = Hatena.Star.BaseURL.replace(/^http:/, Hatena.Star.BaseURLProtocol) + 'star.deletable.json';
                var data = {
                    name: self.name,
                    uri: self.entry.uri
                };
                if (self.color) data.color = self.color;
                if (self.quote) data.quote = self.quote;

                $.ajax({
                    type: 'get',
                    dataType: 'jsonp',
                    url: uri,
                    data: data
                }).done(function (res) {
                    var can_delete = res.result && (res.message || res.confirm_html);
                    if (can_delete) {
                        dfd.resolve(res);
                    } else {
                        dfd.reject(res);
                    }
                });

                return dfd;
            });

            var $star_container = $(self.anchor);

            $star_container.hover(function () {
                // 
                checkCanDelete().done(function (deletion_info) {
                    var $delete_button = $("<img>").addClass('star-delete-button').attr("src", URLGenerator.static_url('/images/theme/star/star-delete.png'));
                    $star_container.append($delete_button);
                    var button_position = $delete_button.position();
                    $delete_button.css({
                        left: button_position.left - 9,
                        top: button_position.top
                    });

                    //
                    $delete_button.click(function () {
                        if (deletion_info.confirm_html) {
                            var pos = Ten.Geometry.getElementPosition(self.anchor);
                            var scr = new Hatena.Star.DeleteConfirmScreen();
                            scr.showConfirm(deletion_info.confirm_html, self, pos);
                        } else if (confirm(deletion_info.message)) {
                            self.deleteStar();
                        }

                        return false;
                    });
                });
            }, function () {
                $(this).find(".star-delete-button").remove();
            });

            return element;
        });
    },

    // mobile
    initStarForThirdPartyCookiesDisabled: function initStarForThirdPartyCookiesDisabled(info) {
        waitForResource(function () {
            return Hatena.Star;
        }, function () {
            _.extend(Hatena.Star.AddButton.prototype, {
                addStar: function addStar() {
                    var self = this;

                    // uri:      URI
                    // location: 
                    var url = 'https://s.hatena.ne.jp/star.add?' + $.param({
                        uri: self.entry.uri,
                        location: globalData('admin-domain') + '/-/close'
                    });

                    var position = {
                        width: 500,
                        height: 200
                    };
                    position.left = Math.floor((screen.width - position.width) / 2);
                    position.top = Math.floor((screen.height - position.height) / 2);

                    var position_string = positionToString(position);

                    var star_window = window.open(url, 'add_star', position_string);

                    // window
                    waitForResource(function () {
                        return star_window.closed;
                    }, function () {
                        updateDynamicPieces([self.entry.entryNode.parentNode]);
                    });
                },
                // 
                showColorPallet: function showColorPallet() {},
                showColorPalletDelay: function showColorPalletDelay() {}
            });
        });
    }
};

module.exports = Star;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EventTracker":284,"js/Base/URLGenerator":298,"js/Base/globalData":302,"js/Locale":561,"js/Util/positionToString":584,"js/Util/shortenText.js":589,"js/Util/updateDynamicPieces":591,"js/Util/waitForResource":592,"underscore":213}],567:[function(require,module,exports){
'use strict';

var _ = require('underscore');
var Locale = require('js/Locale');
var extend = require('js/Util/extend');
var positionToString = require('js/Util/positionToString');
var Base = require('./Base');

/**
 * admin
 * Base 
 *  Messenger  localStorage 
 */
var SubscribeButtonAdmin = function SubscribeButtonAdmin($el, userData, blogData) {
    this.initialize($el, userData, blogData);
};
extend(SubscribeButtonAdmin.prototype, Base.prototype);

/** @override */
SubscribeButtonAdmin.prototype.initialize = function ($el, userData, blogData, messenger) {
    Base.prototype.initialize.call(this, $el, userData, blogData);

    // 
    this.initMessages();
};

/** @override */
SubscribeButtonAdmin.prototype.initMessages = function () {
    // localStoragestorage
    var self = this;
    window.addEventListener("storage", function (event) {
        if (event.key !== 'subscription') {
            return;
        }
        var data = JSON.parse(event.newValue);
        var blogData = data[self.blog.blogUrl];

        // 
        if (blogData === self.user.isSubscribing) {
            return;
        }

        // truefalse (undefined)
        if (blogData === true) {
            self.subscribe();
        }
        if (blogData === false) {
            self.unsubscribe();
        }
    });
};

/**
 * @override
 * @public
 */
SubscribeButtonAdmin.prototype.openSubscribeWindow = function () {
    var self = this;

    // confirm
    // 
    var confirmMessage = Locale.text(self.user.isSubscribing ? 'epic.confirm_unsubscribe' : 'epic.confirm_subscribe', self.blog.blogName, self.blog.blogUrl);
    var res = window.confirm(confirmMessage);
    if (!res) {
        return false;
    }

    // 
    if (self.user.isGuest) {
        self.popupLoginWindow();
        return false;
    }

    // 
    self.blog.requestUpdate(self.user).success(function () {
        self.toggleState();
    });
};

SubscribeButtonAdmin.prototype.popupLoginWindow = function () {
    // 
    var options = { width: 900, height: 600, scrollbars: 'yes' };
    options.left = Math.floor((screen.width - options.width) / 2);
    options.top = Math.floor((screen.height - options.height) / 2);

    // URL
    var targetURL = this.blog.requestUrl + '?iframe=1';
    var loginURL = 'http://www.hatena.ne.jp/login?location=' + encodeURIComponent(targetURL);

    // 
    var loginWindow = window.open(loginURL, 'login', positionToString(options));
};

/** @override */
SubscribeButtonAdmin.prototype.toggleState = function () {
    if (this.user.isSubscribing) {
        this.unsubscribe();
        SubscribeButtonAdmin.setSubscription(this.blog.blogUrl, false);
    } else {
        this.subscribe();
        SubscribeButtonAdmin.setSubscription(this.blog.blogUrl, true);
    }
};

/**
 * localStorage
 * @static
 */
SubscribeButtonAdmin.setSubscription = function (blogUrl, isSubscribing) {
    var value = JSON.parse(window.localStorage.getItem('subscription'));
    value = _.isObject(value) ? value : {};
    value[blogUrl] = isSubscribing;
    window.localStorage.setItem('subscription', JSON.stringify(value));
};

module.exports = SubscribeButtonAdmin;

},{"./Base":568,"js/Locale":561,"js/Util/extend":574,"js/Util/positionToString":584,"underscore":213}],568:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var globalData = require('js/Base/globalData');

/**
 * 
 *
 * @param {boolean} [userData.isSubscribing] - 
 * @param {boolean} [userData.isGuest]       - 
 */
var User = function User(userData) {
    this.initialize(userData);
};
User.prototype = {
    initialize: function initialize(userData) {
        this.isSubscribing = userData.isSubscribing || false;
        this.isGuest = userData.isGuest || false;
    },
    toggle: function toggle() {
        this.isSubscribing = !this.isSubscribing;
    }
};

/**
 * 
 * 
 *
 * @param {number} [blogData.subscribersCount] - 
 * @param {number} [blogData.blogUrl]          - URL
 * @param {string} [blogData.blogName]         - 
 * @param {number} [blogData.requestUrl]       - POSTURL
 */
var Blog = function Blog(blogData) {
    this.initialize(blogData);
};
Blog.prototype = {
    initialize: function initialize(blogData) {
        this.subscribersCount = +blogData.subscribersCount || 0;
        this.blogUrl = blogData.blogUrl;
        this.blogName = blogData.blogName;
        this.requestUrl = blogData.requestUrl;
    },

    requestUpdate: function requestUpdate(user) {
        var ajax = $.ajax({
            type: "POST",
            url: this.requestUrl,
            data: {
                rkm: globalData('rkm'),
                rkc: globalData('rkc'),
                "delete": user.isSubscribing ? 1 : 0
            }
        });
        return ajax;
    },

    updateSubscribersCount: function updateSubscribersCount(user) {
        this.subscribersCount += user.isSubscribing ? 1 : -1;
    }
};

/**
 * 
 *  openSubscribeWindow 
 *
 * @param {$element}  [$el]       - jQuery
 * @param {Object}    [userData]  - User
 * @param {Object}    [blogData]  - Blog
 */
var SubscribeButton = function SubscribeButton($el, userData, blogData) {
    this.initialize($el, userData, blogData);
};
SubscribeButton.prototype = {
    initialize: function initialize($el, userData, blogData) {
        var self = this;

        self.$el = $el;

        // 
        self.user = new User(userData);
        self.blog = new Blog(blogData);

        // 
        self.$subscribeBtn = self.$el.find('.js-hatena-follow-button');
        self.$subscriptionCount = self.$el.find('.js-subscription-count');
        self.$subscriptionCountBox = self.$el.find('.js-subscription-count-box');

        self.updateViews();

        // 
        self.initEvents();
    },

    // 
    initEvents: function initEvents() {
        var self = this;
        this.$subscribeBtn.on('mouseenter', function () {
            $(this).addClass('hover');
        }).on('mouseleave', function () {
            $(this).removeClass('hover');
        }).on('click', function (e) {
            var offset = self.$subscribeBtn.offset();
            offset.top += self.$subscribeBtn.height();
            self.openSubscribeWindow(offset);
            return false;
        });
    },

    /**
     * 
     * @abstract
     */
    initMessages: function initMessages() {},

    // user, blog
    updateViews: function updateViews() {
        // toggleClass
        var isSubscribing = this.user.isSubscribing;
        this.$subscribeBtn.addClass(isSubscribing ? 'subscribing' : 'unsubscribing').removeClass(isSubscribing ? 'unsubscribing' : 'subscribing');

        // hover
        // 
        this.$subscribeBtn.removeClass('hover');

        this.updateCountBox();
    },

    // 
    updateCountBox: function updateCountBox() {
        if (this.blog.subscribersCount >= 1) {
            this.$subscriptionCountBox.show();
            this.$subscriptionCount.text(this.blog.subscribersCount);
        } else {
            this.$subscriptionCountBox.hide();
        }
    },

    /**
     * iframeconfirm
     * 
     * @abstract
     * @public
     */
    openSubscribeWindow: function openSubscribeWindow(offset, isFixed) {},

    /**
     * 
     * @abstract
     */
    toggleState: function toggleState() {},

    // model, view
    subscribe: function subscribe() {
        this.user.isSubscribing = true;
        this.blog.subscribersCount++;
        this.updateViews();
    },

    // model, view
    unsubscribe: function unsubscribe() {
        this.user.isSubscribing = false;
        this.blog.subscribersCount--;
        this.updateViews();
    }
};

module.exports = SubscribeButton;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/globalData":302}],569:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
var Messenger = require('js/Messenger');
var Browser = require('js/Base/Browser');
var URLGenerator = require('js/Base/URLGenerator');
var Window = require('js/Base/Window');
var globalData = require('js/Base/globalData');
var Base = require('./Base');
var extend = require('js/Util/extend');
var positionToString = require('js/Util/positionToString');

/**
 * blogs
 * Messenger
 *
 * @param {$element}  [$el]       - jQuery
 * @param {Object}    [userData]  - User
 * @param {Object}    [blogData]  - Blog
 * @param {Messenger} [messenger] - windowMessenger
 */
var SubscribeButtonBlogs = function SubscribeButtonBlogs($el, userData, blogData, messenger) {
    this.initialize($el, userData, blogData, messenger);
};
extend(SubscribeButtonBlogs.prototype, Base.prototype);

/** @override */
SubscribeButtonBlogs.prototype.initialize = function ($el, userData, blogData, messenger) {
    Base.prototype.initialize.call(this, $el, userData, blogData);

    // 
    this.messenger = messenger;
    this.initMessages();
};

/** @override */
SubscribeButtonBlogs.prototype.initMessages = function () {
    // localStoragepostMessage
    // localStoragestorage
    var self = this;
    self.messenger.addEventListener('subscription', function (data) {
        var blogData = data[self.blog.blogUrl];

        // 
        if (blogData === self.user.isSubscribing) {
            return;
        }

        // truefalse (undefined)
        if (blogData === true) {
            self.subscribe();
        }
        if (blogData === false) {
            self.unsubscribe();
        }
    });
};

/**
 * iframe
 * 
 *
 * @public
 * @param {Object}  [offset]  - iframeoffset
 * @param {boolean} [isFixed] - iframe
 */
SubscribeButtonBlogs.prototype.openSubscribeWindow = function (offset, isFixed) {
    var uri = '' + globalData('admin-domain') + '/' + globalData('author') + '/' + globalData('blog') + '/subscribe?iframe=1';

    var self = this;
    Browser.thirdPartyCookiesBlocked.done(function (blocked) {
        if (blocked) {
            self.subscribeButtonHandlerWindow(uri);
        } else {
            self.subscribeButtonHandlerIframe(uri, offset, isFixed);
        }
    });
};

// iframe
SubscribeButtonBlogs.prototype.subscribeButtonHandlerIframe = function (uri, offset, isFixed) {
    var $container = $('<div class="hatena-iframe-container popup"></div>');
    var $loading = $(['<div class="loading">', '<img src="', URLGenerator.static_url('/images/loading.gif'), '" alt="loading"/>', Locale.text('loading'), '</div>'].join(''));
    var $iframe = $('<iframe frameborder="0"></iframe>');

    // window
    var maxWidth = $(window).width();
    var winWidth = 300;
    var padding = 20;
    if (maxWidth - offset.left < winWidth + padding) {
        offset.left = maxWidth - (winWidth + padding);
    }

    // DOM
    $container.appendTo(document.body);
    $loading.appendTo($container);
    $iframe.appendTo($container);

    // 
    $container.hide().css({
        width: winWidth,
        height: 155,
        position: isFixed ? 'fixed' : 'absolute'
    });
    if (offset) {
        $container.offset(offset); // offsetcss
    }
    $loading.hide().delay(250).show();
    $iframe.on('load', function () {
        $loading.hide();
    });

    // message
    var iframeMessenger = Messenger.createForFrame($iframe[0], uri);

    iframeMessenger.addEventListener('resize', function (data) {
        if (data) {
            $container.css(data);
        }
    });

    iframeMessenger.addEventListener('close', function () {
        Window.hide($container);
    });

    var self = this;
    iframeMessenger.addEventListener('done', function () {
        self.toggleState();
    });

    Window.show($container, {
        destroy: function destroy() {
            $container.remove();
            iframeMessenger.destroy();
        }
    });
};

// 
SubscribeButtonBlogs.prototype.subscribeButtonHandlerWindow = function (uri) {
    // window
    var position = {
        width: 300,
        height: 150
    };
    position.left = Math.floor((screen.width - position.width) / 2);
    position.top = Math.floor((screen.height - position.height) / 2);

    // window
    var subscribeWindow = window.open('', 'subscribe', positionToString(position));

    var popupMessenger = Messenger.createForWindow(subscribeWindow, uri);

    var self = this;
    popupMessenger.addEventListener('done', function () {
        self.toggleState();
        close();
    });

    var close = function close() {
        popupMessenger.destroy();
        subscribeWindow.close();
    };

    popupMessenger.addEventListener('close', close);

    // window
    $(document.body).one('focus', close);
};

/** @override */
SubscribeButtonBlogs.prototype.toggleState = function () {
    var data = {};
    data[this.blog.blogUrl] = !this.user.isSubscribing;
    this.messenger.send('subscription', data);
};

module.exports = SubscribeButtonBlogs;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./Base":568,"js/Base/Browser":278,"js/Base/URLGenerator":298,"js/Base/Window":299,"js/Base/globalData":302,"js/Locale":561,"js/Messenger":562,"js/Util/extend":574,"js/Util/positionToString":584}],570:[function(require,module,exports){
'use strict';

var Admin = require('./Admin');
var Blogs = require('./Blogs');

module.exports = {
    Admin: Admin,
    Blogs: Blogs
};

},{"./Admin":567,"./Blogs":569}],571:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

/**
 * localStorage
 * @param {jQuery}   args.$container - 
 * @param {String}   args.key        - localStorage
 * @param {Function} args.onchange   - 
 */
var backupTab = function backupTab(args) {
    var $container = args.$container;
    var key = args.key;
    var onchange = args.onchange;

    var isAvailable;

    try {
        isAvailable = localStorage;
    } catch (ignore) {}

    if (!isAvailable) return;

    var localStorageKey = 'Hatena.Diary.Util.backupTab.' + key;

    var getValue = function getValue() {
        return localStorage[localStorageKey];
    };

    var setValue = function setValue(value) {
        localStorage[localStorageKey] = value;
    };

    var restoreLastValue = function restoreLastValue() {
        var lastValue = getValue();
        if (lastValue === undefined) return;

        var $input = $container.find('input[value="' + lastValue + '"]');
        $input.trigger('click');
        onchange($input);
    };

    restoreLastValue();

    $container.delegate('input', 'change', function () {
        var $input = $(this);

        setValue($input.val());

        onchange($input);
    });
};

module.exports = backupTab;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],572:[function(require,module,exports){
'use strict';

var canonicalizeColor = function canonicalizeColor(color) {
    if (color.match(/#([0-9a-f]{6})/i)) {
        color = RegExp.$1;
    } else if (color.match(/#([0-9a-f])([0-9a-f])([0-9a-f])/i)) {
        color = RegExp.$1 + RegExp.$1 + RegExp.$2 + RegExp.$2 + RegExp.$3 + RegExp.$3;
    } else if (color.match(/rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d+)\s*)?/)) {
        var transparent = RegExp.$4.length && +RegExp.$4 === 0;
        color = transparent ? null : ("0" + (+RegExp.$1).toString(16)).slice(-2) + ("0" + (+RegExp.$2).toString(16)).slice(-2) + ("0" + (+RegExp.$3).toString(16)).slice(-2);
    } else {
        color = null;
    }
    return color ? color.toLowerCase() : null;
};

module.exports = canonicalizeColor;

},{}],573:[function(require,module,exports){
'use strict';

// $.param
// input: key=value1&key=value2 String
// output: { key: [value1, value2] }
var decodeParam = function decodeParam(data) {
    var params = {};
    var values = data.split('&');
    for (var i = 0, len = values.length; i < len; i++) {
        if (!values[i].match(/[=]/)) continue;
        var kv = values[i].split('=');
        var key = decodeURIComponent(kv[0]);
        var val = kv[1].replace(/\+/g, ' ');
        if (!params[key]) params[key] = [];
        params[key].push(decodeURIComponent(val));
    }

    return params;
};

module.exports = decodeParam;

},{}],574:[function(require,module,exports){
'use strict';

// parenttarget
// target
// XXX: _.extendOwn
var extend = function extend(target, parent) {
    for (var key in parent) if (parent.hasOwnProperty(key) && !target.hasOwnProperty(key)) {
        target[key] = parent[key];
    }
};

module.exports = extend;

},{}],575:[function(require,module,exports){
// Ten.base.jsgetSelectedText

module.exports = function () {
    if (window.getSelection) {
        return window.getSelection();
    } else if (document.getSelection) {
        return document.getSelection();
    } else {
        return {};
    }
};

},{}],576:[function(require,module,exports){
module.exports = function () {
    if (window.getSelection) {
        return '' + (window.getSelection() || '');
    } else if (document.getSelection) {
        return document.getSelection();
    } else if (document.selection) {
        return document.selection.createRange().text;
    } else {
        return '';
    }
};

},{}],577:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Logger = require('js/Base/Logger');

// 
// $container: 1 1
// enable_bottom: #containertrue
var initScrollFollowedElement = function initScrollFollowedElement($container, enable_bottom) {
    var $target = $($container.children()[0]);

    if ($target.length === 0) {
        Logger.BUG("ad element not found: " + $container.html(), 'followedAd');
        return;
    }

    var $document = $(document);
    var $page_container = $('#container');

    var onScroll = function onScroll() {
        var container_offset = $container.offset();
        var scroll_top = $document.scrollTop();
        var target_height = $target.height();
        var page_container_top = $page_container.offset().top;
        var page_container_height = $page_container.height();

        if (scroll_top + page_container_top < container_offset.top) {
            // 
            $target.css({
                position: 'static'
            });
        } else if (!enable_bottom || scroll_top < page_container_height - target_height) {
            //  

            $target.css({
                position: 'fixed',
                top: page_container_top,
                left: container_offset.left
            });
        } else {
            //  #container
            $target.css({
                position: 'absolute',
                top: page_container_top + page_container_height - target_height,
                left: container_offset.left
            });
        }
    };

    var onResize = function onResize() {

        var container_offset = $container.offset();

        $target.css({
            left: container_offset.left
        });
    };

    $(window).scroll(onScroll).resize(onResize);
    onScroll();
};

module.exports = initScrollFollowedElement;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Logger":293}],578:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

// URL
// resolve, rejectDeferred
var loadImages = function loadImages(urls) {
    var loaded = $.Deferred();
    var images;

    var count = 0;
    var onload = function onload() {
        count++;
        if (count === urls.length) {
            loaded.resolve(images);
        }
    };
    var onerror = function onerror() {
        loaded.reject(images);
    };

    images = _.map(urls, function (url) {
        var $img = $('<img>');
        $img.on('load', onload).on('error', onerror).attr('src', url);
        return $img[0];
    });

    return loaded.promise();
};

module.exports = loadImages;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],579:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

// private
var template = _.template('<span class="user-name-nickname"><%- nickname %></span> <span class="user-name-paren">(</span><span class="user-name-hatena-id">id:<%- hatenaId %></span><span class="user-name-paren">)</span>');

// 
var displayNicknames = function displayNicknames($elements, friendships) {
    $elements.each(function () {
        var $element = $(this);
        var username = $element.attr('data-user-name');
        if (friendships[username] && username != friendships[username].name) {
            var html = template({
                nickname: friendships[username].name,
                hatenaId: username
            });

            $element.html(html);
        }
    });
};

// JSONP
var request = function request($elements, usernames) {
    var usernamesCurrent = usernames.splice(0, 20);
    $.ajax({
        url: 'https://h.hatena.ne.jp/api/friendships/show.json',
        dataType: 'jsonp',
        data: {
            url_name: usernamesCurrent
        },
        traditional: true
    }).done(function (friendships) {
        displayNicknames($elements, friendships);
        if (usernames.length > 0) {
            request($elements, usernames);
        }
    });
};

// $container  data-load-nicknames 
var loadNicknames = function loadNicknames($container) {
    var $elements = $container.find('[data-load-nickname]');
    var usernames = [];
    $elements.each(function () {
        var $element = $(this);
        var username = $element.attr('data-user-name');
        usernames.push(username);
    });
    usernames = _.uniq(usernames);
    if (usernames.length === 0) {
        return;
    }
    if (usernames.length === 1) {
        usernames.push('hatenablog');
    } // APIusernames2

    request($elements, usernames);
};

module.exports = loadNicknames;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],580:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

// decodeParamlocation
// decodeParam1, 1
// input: { key: value1, key1: [value1], key2: [value1,value2] }
// output: location?key=value1&key1=value1&key2[]=value1&key2[]=value2
var locationWithParam = function locationWithParam(params) {
    _.each(params, function (value, key) {
        if (_.isArray(value) && value.length == 1) params[key] = value[0];
    });
    return location.pathname + '?' + $.param(params);
};

module.exports = locationWithParam;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],581:[function(require,module,exports){
'use strict';

var migrateOldStyleYoutubeURL = function migrateOldStyleYoutubeURL(url) {
    // XXX: /v/URLiframe/embed/
    // : https://www.youtube.com/v/***&aaa=bbbb&
    // : https://www.youtube.com/embed/***
    // /embed/ ?list= /v/
    if (url.match(/\/v\//i)) {
        url = url.split(/[?&]/)[0];
        url = url.replace(/\/v\//i, '/embed/');
    }

    // XXX: youtube.googleapis.com iPhonewww.youtube.com/embed/ 
    url = url.replace('youtube.googleapis.com', 'www.youtube.com');

    // XXX: https//
    url = url.replace(/^https:/, '');
    return url;
};

module.exports = migrateOldStyleYoutubeURL;

},{}],582:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');

//  notices.count.json
var needComrule2013 = function needComrule2013(data) {
    if (!data.need_comrule2013) {
        return;
    }
    _.defer(function () {
        var BASE = location.hostname.match(/\.hatena\.[^:]+/)[0];
        window.top.location.href = 'http://www' + BASE + '/login?need_comrule2013=1';
    });
};

module.exports = needComrule2013;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"underscore":213}],583:[function(require,module,exports){
'use strict';

// W3CDTFStringDate
// IE8new Date( )
// datetime: YYYY-MM-DDThh:mm:ss String
// returns: Date | null
var parseW3CDTF = function parseW3CDTF(datetime) {
    var matched = datetime.match(/(\d+)-(\d+)-(\d+)T(\d+):(\d+):(\d+)/);
    if (!matched) return null;
    return new Date(+matched[1], +matched[2] - 1, +matched[3], +matched[4], +matched[5], +matched[6]);
};

module.exports = parseW3CDTF;

},{}],584:[function(require,module,exports){
'use strict';

var _ = require('underscore');

// windowhashwindow.open
// position: { width, height, left, top } valueint
// return: "width=\d,height=\d,left=\d,top=\d"
var positionToString = function positionToString(position) {
    return _.map(_.keys(position), function (key) {
        return key + '=' + position[key];
    }).join(',');
};

module.exports = positionToString;

},{"underscore":213}],585:[function(require,module,exports){
'use strict';

var _ = require('underscore');

var preventDuplicateSubmit = function preventDuplicateSubmit($form) {
    // submit
    // submitsubmitdisabledsubmitdisabled
    _.defer(function () {
        $form.find(':submit').prop('disabled', true);
    });
};

module.exports = preventDuplicateSubmit;

},{"underscore":213}],586:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var migrateOldStyleYoutubeURL = require('./migrateOldStyleYoutubeURL');

var replaceYoutubeURL = function replaceYoutubeURL($entry) {
    // youtubeiframesrcURL
    $entry.find('iframe[src*="youtube.com/"],iframe[src*="youtube.googleapis.com/"]').each(function () {
        var $iframe = $(this);
        var src = $iframe.attr('src');
        $iframe.attr('src', migrateOldStyleYoutubeURL(src));
    });
};

module.exports = replaceYoutubeURL;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./migrateOldStyleYoutubeURL":581}],587:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Messenger = require('js/Messenger');

// iframedocument.body.height
// OperaJSON.stringify Redmine615
// Opera*1
var sendResizeRequest = function sendResizeRequest() {
    Messenger.send('resize', {
        height: $(document.body).height() * 1
    });
};

module.exports = sendResizeRequest;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Messenger":562}],588:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var Browser = require('../Base/Browser');

var setupTipsy = function setupTipsy() {
    // touchtipsytipsy
    if (Browser.isTouch) return;

    if (!$.fn.tipsy) return;

    //  n
    // w e
    //  s

    var rules = {
        left: 'e',
        right: 'w',
        bottom: 'n',
        top: 's',
        northwest: 'nw',
        southwest: 'sw',
        northeast: 'ne',
        southeast: 'se'
    };
    var $body = $(document.body);

    for (var rule in rules) if (rules.hasOwnProperty(rule)) {
        var selector = '.tipsy-' + rule;
        var gravity = rules[rule];

        $body.tipsy({
            gravity: gravity,
            fade: false,
            opacity: 1.0,
            live: selector
        });
    }
};

module.exports = setupTipsy;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"../Base/Browser":278,"underscore":213}],589:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);

var ShortenText = function ShortenText($el, options) {
    this.options = $.extend({
        symbol: '...',
        reduce: 1
    }, options);

    this.$el = $el;
    this.$el.css({ overflow: 'hidden' });
};

ShortenText.prototype = {
    // original_text
    init: function init(original_text) {
        this.original_text = original_text;
    },

    // 
    execute: function execute() {
        var options = this.options;
        var text = this.original_text;
        var $el = this.$el;

        // append invisible clone
        var $clone = $el.clone();
        $clone.attr('id', '').css({
            display: 'none',
            position: 'absolute',
            overflow: 'visible',
            width: $el.css('width'),
            height: 'auto'
        }).text(text);

        $el.after($clone);

        // shorten text
        var result,
            rawText = text,
            shortened = text;
        if ($clone.height() > $el.height()) {
            while (rawText.length > 0 && $clone.height() > $el.height()) {
                result = this._shorten(rawText);
                rawText = result[0];shortened = result[1];
                $clone.text(shortened);
            }
        }
        $el.text(shortened);
        $clone.remove();
    },

    // 1
    _shorten: function _shorten(text) {
        var rawText, shortened;
        var options = this.options;

        shortened = [text.slice(0, Math.floor((text.length - options.reduce) / 2)), options.symbol, text.slice(Math.floor((text.length - options.reduce) / 2) + options.reduce, text.length)];
        rawText = shortened[0] + shortened[2];
        shortened = shortened[0] + shortened[1] + shortened[2];

        return [rawText, shortened];
    }
};

module.exports = ShortenText;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],590:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Window = require('js/Base/Window');

var showFlashMessage = function showFlashMessage(message) {
    var $container = $('<div class="hatena-globalheader-window message">' + '<div class="message">' + message + '</div>' + '</div>').css({
        width: 200,
        height: 'auto',
        right: 'auto',
        left: ($(window).width() - 200) / 2
    }).appendTo(document.body);

    Window.show($container, {
        destroy: function destroy() {
            $container.remove();
        }
    });
};

module.exports = showFlashMessage;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/Window":299}],591:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var Locale = require('js/Locale');
// var Star          = require('../Star');  // TODO: Hatena.StarCommonJS
var loadNicknames = require('./loadNicknames');
var MathJaxLoader = require('js/Base/MathJaxLoader');

// MathJax
var updateDynamicPieces = function updateDynamicPieces(container) {
    container = $(container[0]);
    Locale.updateTimestamps(container[0]);
    if (Hatena.Star && Hatena.Star.WindowObserver.loaded) {
        container.find('span.hatena-star-comment-container, span.hatena-star-star-container').remove();
        Hatena.Star.EntryLoader.loadNewEntries(container[0]);
    }
    loadNicknames(container);
    MathJaxLoader.load(container);
};

module.exports = updateDynamicPieces;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"./loadNicknames":579,"js/Base/MathJaxLoader":294,"js/Locale":561}],592:[function(require,module,exports){
'use strict';

/**
 * 
 * get_resource()main_fun()
 *  polling
 *
 * @param {Function} getResource - 
 * @param {Function} mainFun     - 
 * @param {Number}   interval     -  500msec
 */
var waitForResource = function waitForResource(getResource, mainFun, interval) {
    if (!interval) {
        interval = 500;
    }
    var role = function role() {
        if (getResource()) {
            mainFun();
            return true;
        }
        return false;
    };
    if (role()) {
        return;
    }
    var timer = setInterval(function () {
        if (role()) {
            clearInterval(timer);
        }
    }, interval);
};

module.exports = waitForResource;

},{}],593:[function(require,module,exports){
(function (global){
'use strict';

var $ = (typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null);
var _ = require('underscore');
var EventTracker = require('js/Base/EventTracker');
var Location = require('js/Base/Location');
var Logger = require('js/Base/Logger');
var Pages = require('js/Base/Pages');
var preventClickJacking = require('js/Base/preventClickJacking');
var setupTipsy = require('js/Util/setupTipsy');

var called = false;

/**
 * 
 */
var base = function base() {
    // on DOMContentLoaded
    $(function () {
        if (called) {
            return;
        }
        called = true;

        Pages.loadPage();
        EventTracker.setupTrack();
        setupTipsy();
        preventClickJacking();
    });

    // admin
    // 
    if (Location.domainType() === Location.Admin) {
        window.onerror = _.once(function (message, url, line, colno) {
            Logger.BUG(message + ' at ' + line + ':' + colno, 'window.onerror');
        });
    }
};

module.exports = base;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{"js/Base/EventTracker":284,"js/Base/Location":292,"js/Base/Logger":293,"js/Base/Pages":295,"js/Base/preventClickJacking":304,"js/Util/setupTipsy":588,"underscore":213}],594:[function(require,module,exports){
'use strict';

var cache = undefined;

/**
 * process.env
 * envify
 */
var env = Object.defineProperties({}, {
    NODE_ENV: {
        get: function get() {
            if (cache) {
                return cache;
            }

            try {
                cache = document.querySelector('#hatenablog-js').getAttribute('data-env');
            } catch (e) {}

            return cache || 'production';
        },
        set: function set(NODE_ENV) {
            cache = NODE_ENV;
        },
        configurable: true,
        enumerable: true
    }
});

module.exports = env;

},{}],595:[function(require,module,exports){
'use strict';

require('js/loadExternalLibraries');
require('babel-polyfill');

var _ = require('underscore');
window._ = _;

// templates
window.Messenger = require('js/Messenger');
window.keyString = require('js/keyString');

window.Hatena = _.extend(window.Hatena || {}, {
    Locale: require('js/Locale')
});

window.Hatena.Diary = _.extend(window.Hatena.Diary || {}, {
    AppAPI: require('js/AppAPI'),
    Devices: require('js/Base/Devices'),
    GlobalHeader: require('js/Base/GlobalHeader'),

    // XXX 
    GlobalHeaderPage: require('js/Controllers/Admin/globalheader')
});

// jQuery plugins
require('js/jQuery/jquery.hashchange.js'); // chojquery.hashchange
require('js/jQuery/wPaint.js');
require('js/jQuery/wColorPicker.js');

// 
var Pages = require('js/Base/Pages');
Pages.setControllers(require('js/Controllers'));

// 
require('js/base')();

},{"babel-polyfill":18,"js/AppAPI":276,"js/Base/Devices":280,"js/Base/GlobalHeader":289,"js/Base/Pages":295,"js/Controllers":424,"js/Controllers/Admin/globalheader":377,"js/Locale":561,"js/Messenger":562,"js/base":593,"js/jQuery/jquery.hashchange.js":596,"js/jQuery/wColorPicker.js":597,"js/jQuery/wPaint.js":598,"js/keyString":599,"js/loadExternalLibraries":600,"underscore":213}],596:[function(require,module,exports){
(function ($) {
    var last = location.hash;

    $.fn.hashchange = function (fun) {
        if (fun) {
            arguments.callee.setup.apply(this);
            return this.bind('hashchange', fun);
        } else {
            return this.trigger('hashchange');
        }
    };

    var setuped;
    $.fn.hashchange.setup = function () {
        if (setuped) return;setuped = true;
        var self = this;
        (function () {
            if (location.hash != last) {
                self.trigger('hashchange');
            }
            setTimeout(arguments.callee, 500);
        })();
    };

    $(window).hashchange(function () {
        last = location.hash;
    });
})(jQuery);

},{}],597:[function(require,module,exports){
/******************************************
 * Websanova.com
 *
 * Resources for web entrepreneurs
 *
 * @author          Websanova
 * @copyright       Copyright (c) 2012 Websanova.
 * @license         This wChar jQuery plug-in is dual licensed under the MIT and GPL licenses.
 * @link            http://www.websanova.com
 * @github			http://github.com/websanova/wColorPicker
 * @version         Version 1.3.2
 *
 ******************************************/
(function ($) {
	$.fn.wColorPicker = function (option, settings) {
		if (typeof option === 'object') {
			settings = option;
		} else if (typeof option === 'string') {
			var values = [];

			var elements = this.each(function () {
				var data = $(this).data('_wColorPicker');

				if (data) {
					if ($.fn.wColorPicker.defaultSettings[option] !== undefined) {
						if (settings !== undefined) {
							data.settings[option] = settings;
						} else {
							values.push(data.settings[option]);
						}
					}
				}
			});

			if (values.length === 1) {
				return values[0];
			}
			if (values.length > 0) {
				return values;
			} else {
				return elements;
			}
		}

		settings = $.extend({}, $.fn.wColorPicker.defaultSettings, settings || {});

		return this.each(function () {
			var elem = $(this);
			var $settings = jQuery.extend(true, {}, settings);

			var cp = new ColorPicker($settings, elem);

			cp.generate();

			cp.appendToElement(elem);

			cp.colorSelect(cp, $settings.initColor);

			elem.data('_wColorPicker', cp);
		});
	};

	$.fn.wColorPicker.defaultSettings = {
		theme: 'black', // colors - black, white, cream, red, green, blue, yellow, orange, plum
		opacity: 0.8, // opacity level
		initColor: '#FF0000', // initial colour to set palette to
		onMouseover: null, // function to run when palette color is moused over
		onMouseout: null, // function to run when palette color is moused out
		onSelect: null, // function to run when palette color is selected
		mode: 'flat', // flat mode inserts the palette to container, other modes insert button into container - hover, click
		buttonSize: 20, // size of button if mode is ohter than flat
		effect: 'slide', // none/slide/fade
		showSpeed: 500, // time to run the effects on show
		hideSpeed: 500 // time to run the effects on hide
	};

	/**
  * ColorPicker class definition
  */
	function ColorPicker(settings, elem) {
		this.colorPicker = null;
		this.settings = settings;
		this.$elem = elem;
		this.currentColor = settings.initColor;

		this.height = null; // init this, need to get height/width proper while element is still showing
		this.width = null;
		this.slideTopToBottom = null; // used to assist with sliding in proper direction

		this.customTarget = null;
		this.buttonColor = null;
		this.paletteHolder = null;

		return this;
	}

	ColorPicker.prototype = {
		generate: function generate() {
			if (this.colorPicker) return this.colorPicker;

			var $this = this;

			var clearFloats = { clear: 'both', height: 0, lineHeight: 0, fontSize: 0 };

			//custom colors
			this.customTarget = $('<div class="_wColorPicker_customTarget"></div>');
			this.customInput = $('<input type="text" class="_wColorPicker_customInput" value=""/>').keyup(function (e) {
				var code = e.keyCode ? e.keyCode : e.which;

				var hex = $this.validHex($(this).val());

				$(this).val(hex);

				//auto set color in target if it's valid hex code
				if (hex.length == 7) $this.customTarget.css('backgroundColor', hex);

				if (code == 13) //set color if user hits enter while on input
					{
						$this.colorSelect($this, $(this).val());
						if ($this.buttonColor) $this.hidePalette($this);
					}
			}).click(function (e) {
				e.stopPropagation();
			});

			//setup custom area
			var custom = $('<div class="_wColorPicker_custom"></div>').append(this.appendColors($('<div class="_wColorPicker_noColor">'), [''], 1)).append(this.customTarget).append(this.customInput)
			//clear floats
			.append($('<div></div>').css(clearFloats));

			//grays/simple palette
			var simpleColors = ['000000', '333333', '666666', '999999', 'CCCCCC', 'FFFFFF', 'FF0000', '00FF00', '0000FF', 'FFFF00', '00FFFF', 'FF00FF'];
			var simplePalette = this.appendColors($('<div class="_wColorPicker_palette_simple"></div>'), simpleColors, 1);

			//colors palette
			var mixedColors = ['000000', '003300', '006600', '009900', '00CC00', '00FF00', '330000', '333300', '336600', '339900', '33CC00', '33FF00', '660000', '663300', '666600', '669900', '66CC00', '66FF00', '000033', '003333', '006633', '009933', '00CC33', '00FF33', '330033', '333333', '336633', '339933', '33CC33', '33FF33', '660033', '663333', '666633', '669933', '66CC33', '66FF33', '000066', '003366', '006666', '009966', '00CC66', '00FF66', '330066', '333366', '336666', '339966', '33CC66', '33FF66', '660066', '663366', '666666', '669966', '66CC66', '66FF66', '000099', '003399', '006699', '009999', '00CC99', '00FF99', '330099', '333399', '336699', '339999', '33CC99', '33FF99', '660099', '663399', '666699', '669999', '66CC99', '66FF99', '0000CC', '0033CC', '0066CC', '0099CC', '00CCCC', '00FFCC', '3300CC', '3333CC', '3366CC', '3399CC', '33CCCC', '33FFCC', '6600CC', '6633CC', '6666CC', '6699CC', '66CCCC', '66FFCC', '0000FF', '0033FF', '0066FF', '0099FF', '00CCFF', '00FFFF', '3300FF', '3333FF', '3366FF', '3399FF', '33CCFF', '33FFFF', '6600FF', '6633FF', '6666FF', '6699FF', '66CCFF', '66FFFF', '990000', '993300', '996600', '999900', '99CC00', '99FF00', 'CC0000', 'CC3300', 'CC6600', 'CC9900', 'CCCC00', 'CCFF00', 'FF0000', 'FF3300', 'FF6600', 'FF9900', 'FFCC00', 'FFFF00', '990033', '993333', '996633', '999933', '99CC33', '99FF33', 'CC0033', 'CC3333', 'CC6633', 'CC9933', 'CCCC33', 'CCFF33', 'FF0033', 'FF3333', 'FF6633', 'FF9933', 'FFCC33', 'FFFF33', '990066', '993366', '996666', '999966', '99CC66', '99FF66', 'CC0066', 'CC3366', 'CC6666', 'CC9966', 'CCCC66', 'CCFF66', 'FF0066', 'FF3366', 'FF6666', 'FF9966', 'FFCC66', 'FFFF66', '990099', '993399', '996699', '999999', '99CC99', '99FF99', 'CC0099', 'CC3399', 'CC6699', 'CC9999', 'CCCC99', 'CCFF99', 'FF0099', 'FF3399', 'FF6699', 'FF9999', 'FFCC99', 'FFFF99', '9900CC', '9933CC', '9966CC', '9999CC', '99CCCC', '99FFCC', 'CC00CC', 'CC33CC', 'CC66CC', 'CC99CC', 'CCCCCC', 'CCFFCC', 'FF00CC', 'FF33CC', 'FF66CC', 'FF99CC', 'FFCCCC', 'FFFFCC', '9900FF', '9933FF', '9966FF', '9999FF', '99CCFF', '99FFFF', 'CC00FF', 'CC33FF', 'CC66FF', 'CC99FF', 'CCCCFF', 'CCFFFF', 'FF00FF', 'FF33FF', 'FF66FF', 'FF99FF', 'FFCCFF', 'FFFFFF'];
			var mixedPalette = this.appendColors($('<div class="_wColorPicker_palette_mixed"></div>'), mixedColors, 18);

			//palette container
			var bg = $('<div class="_wColorPicker_bg"></div>').css({ opacity: this.settings.opacity });
			var content = $('<div class="_wColorPicker_content"></div>').append(custom).append(simplePalette).append(mixedPalette).append($('<div></div>').css(clearFloats));

			//put it all together
			this.colorPicker = $('<div class="_wColorPicker_holder"></div>').click(function (e) {
				e.stopPropagation();
			}).append($('<div class="_wColorPicker_outer"></div>').append($('<div class="_wColorPicker_inner"></div>').append(bg).append(content))).addClass('_wColorPicker_' + this.settings.theme);

			return this.colorPicker;
		},

		appendColors: function appendColors($palette, colors, lineCount) {
			var counter = 1;
			var $this = this;

			for (index in colors) {
				$palette.append($('<div id="_wColorPicker_color_' + counter + '" class="_wColorPicker_color _wColorPicker_color_' + counter + '"></div>').css('backgroundColor', '#' + colors[index]).click(function () {
					$this.colorSelect($this, $(this).css('backgroundColor'));
				}).mouseout(function (e) {
					$this.colorHoverOff($this, $(this));
				}).mouseover(function () {
					$this.colorHoverOn($this, $(this));
				}));

				if (counter == lineCount) {
					$palette.append($('<div></div>').css({ clear: 'both', height: 0, fontSize: 0, lineHeight: 0, marginTop: -1 }));
					counter = 0;
				}

				counter++;
			}

			return $palette;
		},

		colorSelect: function colorSelect($this, color) {
			color = $this.toHex(color);;

			$this.customTarget.css('backgroundColor', color);
			$this.currentColor = color;
			$this.customInput.val(color);

			if ($this.settings.onSelect) $this.settings.onSelect.apply(this, [color]);

			if ($this.buttonColor) {
				$this.buttonColor.css('backgroundColor', color);
				$this.hidePalette($this);
			}
		},

		colorHoverOn: function colorHoverOn($this, $element) {
			$element.parent().children('active').removeClass('active');
			$element.addClass('active').next().addClass('activeLeft');
			$element.nextAll('.' + $element.attr('id') + ':first').addClass('activeTop');

			var color = $this.toHex($element.css('backgroundColor'));

			$this.customTarget.css('backgroundColor', color);
			$this.customInput.val(color);

			if ($this.settings.onMouseover) $this.settings.onMouseover.apply(this, [color]);
		},

		colorHoverOff: function colorHoverOff($this, $element) {
			$element.removeClass('active').next().removeClass('activeLeft');
			$element.nextAll('.' + $element.attr('id') + ':first').removeClass('activeTop');

			$this.customTarget.css('backgroundColor', $this.currentColor);
			$this.customInput.val($this.currentColor);

			if ($this.settings.onMouseout) $this.settings.onMouseout.apply(this, [$this.currentColor]);
		},

		appendToElement: function appendToElement($element) {
			var $this = this;

			if ($this.settings.mode == 'flat') $element.append($this.colorPicker);else {
				//setup button
				$this.paletteHolder = $('<div class="_wColorPicker_paletteHolder"></div>').css({ position: 'absolute', overflow: 'hidden', width: 1000 }).append($this.colorPicker);

				$this.buttonColor = $('<div class="_wColorPicker_buttonColor"></div>').css({ width: $this.settings.buttonSize, height: $this.settings.buttonSize });

				var buttonHolder = $('<div class="_wColorPicker_buttonHolder"></div>').css({ position: 'relative' }).append($('<div class="_wColorPicker_buttonBorder"></div>').append($this.buttonColor)).append($this.paletteHolder);

				$element.append(buttonHolder);

				$this.width = $this.colorPicker.outerWidth(true);
				$this.height = $this.colorPicker.outerHeight(true);
				$this.paletteHolder.css({ width: $this.width, height: $this.height }).hide();

				if ($this.settings.effect == 'fade') $this.paletteHolder.css({ opacity: 0 });

				//setup events
				if ($this.settings.mode == 'hover') {
					buttonHolder.hover(function (e) {
						$this.showPalette(e, $this);
					}, function (e) {
						$this.hidePalette($this);
					});
				} else if ($this.settings.mode == 'click') {
					$(document).click(function () {
						if ($this.paletteHolder.hasClass('active')) $this.hidePalette($this);
					});

					buttonHolder.click(function (e) {
						e.stopPropagation();
						$this.paletteHolder.hasClass('active') ? $this.hidePalette($this) : $this.showPalette(e, $this);
					});
				}

				$this.colorSelect($this, $this.settings.initColor);
			}
		},

		showPalette: function showPalette(e, $this) {
			var offset = $this.paletteHolder.parent().offset();

			//init some vars
			var left = 0;
			var top = $this.paletteHolder.parent().outerHeight(true);
			$this.slideTopToBottom = top;

			if (offset.left - $(window).scrollLeft() + $this.width > $(window).width()) left = -1 * ($this.width - $this.paletteHolder.parent().outerWidth(true));
			if (offset.top - $(window).scrollTop() + $this.height > $(window).height()) {
				$this.slideTopToBottom = 0;
				top = -1 * $this.height;
			}

			$this.paletteHolder.css({ left: left, top: top });

			$this.paletteHolder.addClass('active');

			if ($this.settings.effect == 'slide') {
				$this.paletteHolder.stop(true, false).css({ height: 0, top: $this.slideTopToBottom == 0 ? 0 : top }).show().animate({ height: $this.height, top: top }, $this.settings.showSpeed);
			} else if ($this.settings.effect == 'fade') {
				$this.paletteHolder.stop(true, false).show().animate({ opacity: 1 }, $this.settings.showSpeed);
			} else {
				$this.paletteHolder.show();
			}
		},

		hidePalette: function hidePalette($this) {
			//need this to avoid the double hide when you click on colour (once on click, once on mouse out) - this way it's only triggered once
			if ($this.paletteHolder.hasClass('active')) {
				$this.paletteHolder.removeClass('active');

				if ($this.settings.effect == 'slide') {
					$this.paletteHolder.stop(true, false).animate({ height: 0, top: $this.slideTopToBottom == 0 ? 0 : $this.slideTopToBottom }, $this.settings.hideSpeed, function () {
						$this.paletteHolder.hide();
					});
				} else if ($this.settings.effect == 'fade') {
					$this.paletteHolder.stop(true, false).animate({ opacity: 0 }, $this.settings.hideSpeed, function () {
						$this.paletteHolder.hide();
					});
				} else {
					$this.paletteHolder.hide();
				}
			}
		},

		toHex: function toHex(color) {
			if (color.substring(0, 4) === 'rgba') {
				hex = 'transparent';
			} else if (color.substring(0, 3) === 'rgb') {
				var rgb = color.substring(4, color.length - 1).replace(/\s/g, '').split(',');

				for (i in rgb) {
					rgb[i] = parseInt(rgb[i]).toString(16);
					if (rgb[i] == '0') rgb[i] = '00';
				}

				var hex = '#' + rgb.join('').toUpperCase();
			} else {
				hex = color;
			}

			return hex;
		},

		validHex: function validHex(hex) {
			return '#' + hex.replace(/[^0-9a-f]/ig, '').substring(0, 6).toUpperCase();
		}
	};
})(jQuery);

},{}],598:[function(require,module,exports){
/******************************************
 * Websanova.com
 *
 * Resources for web entrepreneurs
 *
 * @author          Websanova
 * @copyright       Copyright (c) 2012 Websanova.
 * @license         This wPaint jQuery plug-in is dual licensed under the MIT and GPL licenses.
 * @link            http://www.websanova.com
 * @github			http://github.com/websanova/wPaint
 * @version         Version 1.14.0
 *
 ******************************************/
(function ($) {
	$.fn.wPaint = function (option, settings) {
		if (typeof option === 'object') {
			settings = option;
		} else if (typeof option == 'string') {
			var values = [];

			var elements = this.each(function () {
				var data = $(this).data('_wPaint');

				if (data) {
					if (option == 'clear') {
						data.clearAll();
					} else if (option == 'undo') {
						data.undoPrev();
					} else if (option == 'redo') {
						data.undoNext();
					} else if (option == 'image' && settings === undefined) {
						values.push(data.getImage());
					} else if (option == 'image' && settings !== undefined) {
						data.setImage(settings, true);
					} else if (option == 'imageBg' && settings !== undefined) {
						data.setBgImage(settings);
					} else if ($.fn.wPaint.defaultSettings[option] !== undefined) {
						if (settings !== undefined) {
							data.settings[option] = settings;
						} else {
							values.push(data.settings[option]);
						}
					}
				}
			});

			if (values.length === 1) {
				return values[0];
			}
			if (values.length > 0) {
				return values;
			} else {
				return elements;
			}
		}

		//clean up some variables
		settings = $.extend({}, $.fn.wPaint.defaultSettings, settings || {});
		settings.lineWidthMin = parseInt(settings.lineWidthMin);
		settings.lineWidthMax = parseInt(settings.lineWidthMax);
		settings.lineWidth = parseInt(settings.lineWidth);
		settings.fontSizeMin = parseInt(settings.fontSizeMin);
		settings.fontSizeMax = parseInt(settings.fontSizeMax);
		settings.fontSize = parseInt(settings.fontSize);
		settings.undoMax = parseInt(settings.undoMax);

		return this.each(function () {
			var $elem = $(this);
			var _settings = jQuery.extend(true, {}, settings);

			//test for HTML5 canvas
			var test = document.createElement('canvas');
			if (!test.getContext) {
				$elem.html("Browser does not support HTML5 canvas, please upgrade to a more modern browser.");
				return false;
			}

			if ($elem.data('_wPaint')) return false;

			var canvas = new Canvas(_settings, $elem);
			canvas.mainMenu = new MainMenu(canvas);
			canvas.textMenu = new TextMenu(canvas);

			if (_settings.imageBg) $elem.append(canvas.generateBg($elem.width(), $elem.height(), _settings.imageBg));
			$elem.append(canvas.generate($elem.width(), $elem.height()));
			$elem.append(canvas.generateTemp());
			$elem.append(canvas.generateTextInput());

			$elem.append(canvas.mainMenu.generate(canvas, canvas.textMenu)).append(canvas.textMenu.generate(canvas, canvas.mainMenu));

			//init the snap on the text menu
			canvas.mainMenu.moveTextMenu(canvas.mainMenu, canvas.textMenu);

			//init mode
			canvas.mainMenu.set_mode(canvas.mainMenu, canvas, _settings.mode);

			//pull from css so that it is dynamic
			var buttonSize = $("._wPaint_icon").outerHeight(true) - (parseInt($("._wPaint_icon").css('paddingTop').split('px')[0]) + parseInt($("._wPaint_icon").css('paddingBottom').split('px')[0]));

			canvas.mainMenu.menu.find("._wPaint_fillColorPicker").wColorPicker({
				mode: "click",
				initColor: _settings.fillStyle,
				buttonSize: buttonSize,
				showSpeed: 300,
				hideSpeed: 300,
				onSelect: function onSelect(color) {
					canvas.settings.fillStyle = color;
					canvas.textInput.css({ color: color });
				}
			});

			canvas.mainMenu.menu.find("._wPaint_strokeColorPicker").wColorPicker({
				mode: "click",
				initColor: _settings.strokeStyle,
				buttonSize: buttonSize,
				showSpeed: 300,
				hideSpeed: 300,
				onSelect: function onSelect(color) {
					canvas.settings.strokeStyle = color;
				}
			});

			//must set width after append to get proper dimensions
			canvas.mainMenu.setWidth(canvas, canvas.mainMenu.menu);
			canvas.mainMenu.setWidth(canvas, canvas.textMenu.menu);

			if (_settings.image) {
				canvas.setImage(_settings.image, true);
			} else {
				canvas.addUndo();
			}

			$elem.data('_wPaint', canvas);
		});
	};

	var shapes = ['Rectangle', 'Ellipse', 'Line', 'Text'];

	$.fn.wPaint.defaultSettings = {
		mode: 'Pencil', // drawing mode - Rectangle, Ellipse, Line, Pencil, Eraser
		lineWidthMin: '0', // line width min for select drop down
		lineWidthMax: '10', // line widh max for select drop down
		lineWidth: '2', // starting line width
		fillStyle: '#FFFFFF', // starting fill style
		strokeStyle: '#FFFF00', // start stroke style
		fontSizeMin: '8', // min font size in px
		fontSizeMax: '20', // max font size in px
		fontSize: '12', // current font size for text input
		fontFamilyOptions: ['Arial', 'Courier', 'Times', 'Trebuchet', 'Verdana'], // available font families
		fontFamily: 'Arial', // active font family for text input
		fontTypeBold: false, // text input bold enable/disable
		fontTypeItalic: false, // text input italic enable/disable
		fontTypeUnderline: false, // text input italic enable/disable
		image: null, // preload image - base64 encoded data
		imageBg: null, // preload image bg, cannot be altered but saved with image
		drawDown: null, // function to call when start a draw
		drawMove: null, // function to call during a draw
		drawUp: null, // function to call at end of draw
		menu: ['undo', 'redo', 'clear', 'rectangle', 'ellipse', 'line', 'pencil', 'text', 'eraser', 'dropper', 'bucket', 'fillColor', 'lineWidth', 'strokeColor'], // menu items - appear in order they are set
		menuOrientation: 'horizontal', // orinetation of menu (horizontal, vertical)
		menuOffsetX: 5, // offset for menu (left)
		menuOffsetY: 5, // offset for menu (top)
		menuTitles: { // icon titles, replace any of the values to customize
			'undo': 'undo',
			'redo': 'redo',
			'clear': 'clear',
			'rectangle': 'rectangle',
			'ellipse': 'ellipse',
			'line': 'line',
			'pencil': 'pencil',
			'text': 'text',
			'eraser': 'eraser',
			'dropper': 'dropper',
			'bucket': 'bucket',
			'fillColor': 'fill color',
			'lineWidth': 'line width',
			'strokeColor': 'stroke color',
			'bold': 'bold',
			'italic': 'italic',
			'underline': 'underline',
			'fontSize': 'font size',
			'fontFamily': 'font family'
		},
		undoMax: 10,
		disableMobileDefaults: false // disable default touchmove events for mobile (will prevent flipping between tabs and scrolling)
	};

	/**
  * Canvas class definition
  */
	function Canvas(settings, elem) {
		this.settings = settings;
		this.$elem = elem;
		this.mainMenu = null;
		this.textMenu = null;

		this.undoArray = [];
		this.undoCurrent = -1;
		this.undoMax = settings.undoMax;

		this.draw = false;

		this.canvas = null;
		this.ctx = null;

		this.canvasTemp = null;
		this.ctxTemp = null;

		this.canvasBg = null;
		this.ctxBg = null;

		this.bufferCanvas = null;
		this.bufferCtx = null;

		this.canvasTempLeftOriginal = null;
		this.canvasTempTopOriginal = null;

		this.canvasTempLeftNew = null;
		this.canvasTempTopNew = null;

		this.textInput = null;

		return this;
	}

	Canvas.prototype = {
		/*******************************************************************************
   * Generate canvases and events
   *******************************************************************************/
		generate: function generate(width, height) {
			this.canvas = document.createElement('canvas');
			this.$canvas = $(this.canvas);
			this.ctx = this.canvas.getContext('2d');
			this.bufferCanvas = document.createElement('canvas');
			this.$bufferCanvas = $(this.bufferCanvas);
			this.bufferCtx = this.bufferCanvas.getContext('2d');

			//create local reference
			var _self = this;
			this.$canvas.add(this.$bufferCanvas).attr('width', width + 'px').attr('height', height + 'px').css({ position: 'absolute', left: 0, top: 0 });

			this.$canvas.css('z-index', 10);
			this.$bufferCanvas.css('z-index', 11);

			var onDown = function onDown(e) {
				e.preventDefault();
				e.stopPropagation();
				_self.draw = true;
				_self.callFunc(e, _self, 'Down');
			};

			if (navigator.userAgent.match(/MSIE/)) {
				// IEmousedownonDown
				this.$bufferCanvas.mousemove(function (e) {
					if (_self.draw) _self.callFunc(e, _self, 'Move');
				});
			} else {
				// Firefoxbuttons
				// which
				var isFirefox = navigator.userAgent.match(/Firefox/);
				$(document).mousemove(function (e) {
					var pressed = isFirefox ? e.buttons % 2 === 1 : e.which === 1;
					if (!_self.draw && pressed) {
						onDown(e);
					}
					if (_self.draw) _self.callFunc(e, _self, 'Move');
				});
			}

			this.$bufferCanvas.mousedown(onDown);

			$(document).mouseup(function (e) {
				//make sure we are in draw mode otherwise this will fire on any mouse up.
				if (_self.draw) {
					_self.draw = false;
					_self.callFunc(e, _self, 'Up');
				}
			});

			this.bindMobile();

			return this.$canvas.add(this.$bufferCanvas);
		},

		bindMobile: function bindMobile() {
			$(this.canvas).bind('touchstart touchmove touchend touchcancel', function () {
				var touches = event.changedTouches,
				    first = touches[0],
				    type = "";

				switch (event.type) {
					case "touchstart":
						type = "mousedown";break;
					case "touchmove":
						type = "mousemove";break;
					case "touchend":
						type = "mouseup";break;
					default:
						return;
				}

				var simulatedEvent = document.createEvent("MouseEvent");

				simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY, false, false, false, false, 0, /*left*/null);
				first.target.dispatchEvent(simulatedEvent);
				event.preventDefault();
			});

			//eliminate browser defaults for
			if (this.settings.disableMobileDefaults) $(document).bind('touchmove', function (e) {
				e.preventDefault();
			});
		},

		generateTemp: function generateTemp() {
			this.canvasTemp = document.createElement('canvas');
			this.ctxTemp = this.canvasTemp.getContext('2d');

			$(this.canvasTemp).css({ position: 'absolute' }).hide();

			return $(this.canvasTemp);
		},

		generateBg: function generateBg(width, height, data) {
			var _self = this;

			if (!this.canvasBg) {
				this.canvasBg = document.createElement('canvas');
				this.ctxBg = this.canvasBg.getContext('2d');

				$(this.canvasBg).attr('id', 'mofo').css({ position: 'absolute', left: 0, top: 0 }).attr('width', width).attr('height', height);
			}

			this.setBgImage(data);

			return $(this.canvasBg);
		},

		generateTextInput: function generateTextInput() {
			var _self = this;

			_self.textCalc = $('<div></div>').css({ display: 'none', fontSize: this.settings.fontSize, lineHeight: this.settings.fontSize + 'px', fontFamily: this.settings.fontFamily });

			_self.textInput = $('<textarea class="_wPaint_textInput" spellcheck="false"></textarea>').css({ display: 'none', position: 'absolute', color: this.settings.fillStyle, fontSize: this.settings.fontSize, lineHeight: this.settings.fontSize + 'px', fontFamily: this.settings.fontFamily });

			if (_self.settings.fontTypeBold) {
				_self.textInput.css('fontWeight', 'bold');_self.textCalc.css('fontWeight', 'bold');
			}
			if (_self.settings.fontTypeItalic) {
				_self.textInput.css('fontStyle', 'italic');_self.textCalc.css('fontStyle', 'italic');
			}
			if (_self.settings.fontTypeUnderline) {
				_self.textInput.css('textDecoration', 'underline');_self.textCalc.css('textDecoration', 'underline');
			}

			$('body').append(_self.textCalc);

			return _self.textInput;
		},

		callFunc: function callFunc(e, _self, event) {
			$e = jQuery.extend(true, {}, e);

			var canvas_offset = $(_self.canvas).offset();

			$e.origPageX = Math.floor($e.pageX - canvas_offset.left);
			$e.origPageY = Math.floor($e.pageY - canvas_offset.top);
			$e.pageX = $e.origPageX * _self.xRatio();
			$e.pageY = $e.origPageY * _self.yRatio();

			var mode = $.inArray(_self.settings.mode, shapes) > -1 ? 'Shape' : _self.settings.mode;
			var func = mode === 'Dropper' && event == 'Down' ? _self['pickColor'] : mode === 'Bucket' && event == 'Down' ? _self['fillArea'] : _self['draw' + mode + '' + event];

			if (func) func($e, _self);

			if (_self.settings['draw' + event]) _self.settings['draw' + event].apply(_self, [e, mode]);

			if (_self.settings.mode !== 'Text' && event === 'Up') {
				this.addUndo();
			}
		},

		/*******************************************************************************
   * draw any shape
   *******************************************************************************/
		drawShapeDown: function drawShapeDown(e, _self) {
			if (_self.settings.mode == 'Text') {
				//draw current text before resizing next text box
				if (_self.textInput.val() != '') _self.drawTextUp(e, _self);

				_self.textInput.css({ left: e.pageX - 1, top: e.pageY - 1, width: 0, height: 0 });
			}

			$(_self.canvasTemp).css({ left: e.origPageX, top: e.origPageY }).attr('width', 0).attr('height', 0).show();

			_self.canvasTempLeftOriginal = e.pageX;
			_self.canvasTempTopOriginal = e.pageY;

			var func = _self['draw' + _self.settings.mode + 'Down'];

			if (func) func(e, _self);
		},

		drawShapeMove: function drawShapeMove(e, _self) {
			var xo = _self.canvasTempLeftOriginal;
			var yo = _self.canvasTempTopOriginal;

			var half_line_width = _self.settings.lineWidth / 2;

			// Calculations done respective to the "image" (i.e. "larger") values
			var left = (e.pageX < xo ? e.pageX : xo) - (_self.settings.mode == 'Line' ? Math.floor(half_line_width) : 0);
			var top = (e.pageY < yo ? e.pageY : yo) - (_self.settings.mode == 'Line' ? Math.floor(half_line_width) : 0);
			var width = Math.abs(e.pageX - xo) + (_self.settings.mode == 'Line' ? _self.settings.lineWidth : 0);
			var height = Math.abs(e.pageY - yo) + (_self.settings.mode == 'Line' ? _self.settings.lineWidth : 0);

			$(_self.canvasTemp).css({
				left: left / _self.xRatio(),
				top: top / _self.yRatio(),
				maxWidth: width / _self.xRatio(),
				maxHeight: height / _self.yRatio() }).attr('width', width).attr('height', height);

			if (_self.settings.mode == 'Text') _self.textInput.css({ left: left - 1, top: top - 1, width: width, height: height });

			_self.canvasTempLeftNew = left;
			_self.canvasTempTopNew = top;

			var func = _self['draw' + _self.settings.mode + 'Move'];

			if (func) {
				var factor = _self.settings.mode == 'Line' ? 1 : 2;

				e.x = half_line_width * factor;
				e.y = half_line_width * factor;
				e.w = width - _self.settings.lineWidth * factor;
				e.h = height - _self.settings.lineWidth * factor;

				_self.ctxTemp.fillStyle = _self.settings.fillStyle;
				_self.ctxTemp.strokeStyle = _self.settings.strokeStyle;
				_self.ctxTemp.lineWidth = _self.settings.lineWidth * factor;

				func(e, _self);
			}
		},

		drawShapeUp: function drawShapeUp(e, _self) {
			if (_self.settings.mode != 'Text') {
				_self.ctx.drawImage(_self.canvasTemp, _self.canvasTempLeftNew, _self.canvasTempTopNew);

				$(_self.canvasTemp).hide();

				var func = _self['draw' + _self.settings.mode + 'Up'];
				if (func) func(e, _self);
			}
		},

		/*******************************************************************************
   * draw rectangle
   *******************************************************************************/
		drawRectangleMove: function drawRectangleMove(e, _self) {
			_self.ctxTemp.beginPath();
			_self.ctxTemp.rect(e.x, e.y, e.w, e.h);
			_self.ctxTemp.closePath();
			_self.ctxTemp.stroke();
			_self.ctxTemp.fill();
		},

		/*******************************************************************************
   * draw ellipse
   *******************************************************************************/
		drawEllipseMove: function drawEllipseMove(e, _self) {
			var kappa = .5522848;
			var ox = e.w / 2 * kappa; // control point offset horizontal
			var oy = e.h / 2 * kappa; // control point offset vertical
			var xe = e.x + e.w; // x-end
			var ye = e.y + e.h; // y-end
			var xm = e.x + e.w / 2; // x-middle
			var ym = e.y + e.h / 2; // y-middle

			_self.ctxTemp.beginPath();
			_self.ctxTemp.moveTo(e.x, ym);
			_self.ctxTemp.bezierCurveTo(e.x, ym - oy, xm - ox, e.y, xm, e.y);
			_self.ctxTemp.bezierCurveTo(xm + ox, e.y, xe, ym - oy, xe, ym);
			_self.ctxTemp.bezierCurveTo(xe, ym + oy, xm + ox, ye, xm, ye);
			_self.ctxTemp.bezierCurveTo(xm - ox, ye, e.x, ym + oy, e.x, ym);
			_self.ctxTemp.closePath();
			if (_self.settings.lineWidth > 0) _self.ctxTemp.stroke();
			_self.ctxTemp.fill();
		},

		/*******************************************************************************
   * draw line
   *******************************************************************************/
		drawLineMove: function drawLineMove(e, _self) {
			var xo = _self.canvasTempLeftOriginal;
			var yo = _self.canvasTempTopOriginal;

			if (e.pageX < xo) {
				e.x = e.x + e.w;e.w = e.w * -1;
			}
			if (e.pageY < yo) {
				e.y = e.y + e.h;e.h = e.h * -1;
			}

			_self.ctxTemp.lineJoin = "round";
			_self.ctxTemp.beginPath();
			_self.ctxTemp.moveTo(e.x, e.y);
			_self.ctxTemp.lineTo(e.x + e.w, e.y + e.h);
			_self.ctxTemp.closePath();
			_self.ctxTemp.stroke();
		},

		/*******************************************************************************
   * draw pencil
   *******************************************************************************/
		drawPencilDown: function drawPencilDown(e, _self) {
			_self.bufferCtx.lineJoin = "round";
			_self.bufferCtx.lineCap = "round";
			_self.bufferCtx.strokeStyle = _self.settings.strokeStyle;
			_self.bufferCtx.fillStyle = _self.settings.strokeStyle;
			_self.bufferCtx.lineWidth = _self.settings.lineWidth;

			//draw single dot in case of a click without a move
			_self.bufferCtx.beginPath();
			_self.bufferCtx.arc(e.pageX, e.pageY, _self.settings.lineWidth / 2, 0, Math.PI * 2, true);
			_self.bufferCtx.closePath();
			_self.bufferCtx.fill();

			//start the path for a drag
			_self.startPoint = { x: e.pageX, y: e.pageY };
			_self.strokePoints = [];
		},

		drawPencilMove: function drawPencilMove(e, _self) {
			var start = _self.startPoint;
			_self.strokePoints.push({ x: e.pageX, y: e.pageY });

			_self.bufferCtx.clearRect(0, 0, _self.canvas.width, _self.canvas.height);
			_self.bufferCtx.beginPath();
			_self.bufferCtx.moveTo(start.x, start.y);

			for (var i = 0; i < _self.strokePoints.length; i++) {
				_self.bufferCtx.lineTo(_self.strokePoints[i].x, _self.strokePoints[i].y);
			}
			_self.bufferCtx.stroke();
		},

		drawPencilUp: function drawPencilUp(e, _self) {
			_self.ctx.drawImage(_self.bufferCanvas, 0, 0);
			_self.bufferCtx.clearRect(0, 0, _self.canvas.width, _self.canvas.height);
		},

		/*******************************************************************************
   * draw text
   *******************************************************************************/

		drawTextDown: function drawTextDown(e, _self) {
			_self.textInput.val('').show().focus();
		},

		drawTextUp: function drawTextUp(e, _self) {
			if (e) {
				this.addUndo();
			}

			var fontString = '';
			if (_self.settings.fontTypeItalic) fontString += 'italic ';
			//if(_self.settings.fontTypeUnderline) fontString += 'underline ';
			if (_self.settings.fontTypeBold) fontString += 'bold ';

			fontString += _self.settings.fontSize + 'px ' + _self.settings.fontFamily;

			//setup lines
			var lines = _self.textInput.val().split('\n');
			var linesNew = [];
			var textInputWidth = _self.textInput.width() - 2;

			var width = 0;
			var lastj = 0;

			for (var i = 0, ii = lines.length; i < ii; i++) {
				_self.textCalc.html('');
				lastj = 0;

				for (var j = 0, jj = lines[0].length; j < jj; j++) {
					width = _self.textCalc.append(lines[i][j]).width();

					if (width > textInputWidth) {
						linesNew.push(lines[i].substring(lastj, j));
						lastj = j;
						_self.textCalc.html(lines[i][j]);
					}
				}

				if (lastj != j) linesNew.push(lines[i].substring(lastj, j));
			}

			lines = _self.textInput.val(linesNew.join('\n')).val().split('\n');

			var offset = _self.textInput.position();
			var left = offset.left;
			var top = offset.top;
			var underlineOffset = 0;

			for (var i = 0, ii = lines.length; i < ii; i++) {
				_self.ctx.fillStyle = _self.settings.fillStyle;

				_self.ctx.textBaseline = 'top';
				_self.ctx.font = fontString;
				_self.ctx.fillText(lines[i], left, top);

				top += _self.settings.fontSize;

				if (lines[i] != '' && _self.settings.fontTypeUnderline) {
					width = _self.textCalc.html(lines[i]).width();

					//manually set pixels for underline since to avoid antialiasing 1px issue, and lack of support for underline in canvas
					var imgData = _self.ctx.getImageData(0, top + underlineOffset, width, 1);

					for (j = 0; j < imgData.width * imgData.height * 4; j += 4) {
						imgData.data[j] = parseInt(_self.settings.fillStyle.substring(1, 3), 16);
						imgData.data[j + 1] = parseInt(_self.settings.fillStyle.substring(3, 5), 16);
						imgData.data[j + 2] = parseInt(_self.settings.fillStyle.substring(5, 7), 16);
						imgData.data[j + 3] = 255;
					}

					_self.ctx.putImageData(imgData, left, top + underlineOffset);
				}
			}
		},

		/*******************************************************************************
   * eraser
   *******************************************************************************/
		drawEraserDown: function drawEraserDown(e, _self) {
			_self.ctx.save();
			_self.ctx.globalCompositeOperation = 'destination-out';
			_self.settings._strokeStyle = _self.settings.strokeStyle;
			_self.settings.strokeStyle = '#FFF';
			_self.drawPencilDown(e, _self);
		},

		drawEraserMove: function drawEraserMove(e, _self) {
			_self.drawPencilMove(e, _self);
		},

		drawEraserUp: function drawEraserUp(e, _self) {
			_self.drawPencilUp(e, _self);
			_self.ctx.restore();
			_self.settings.strokeStyle = _self.settings._strokeStyle;
		},

		/*******************************************************************************
   * save / load data
   *******************************************************************************/
		getImage: function getImage() {
			this.canvasSave = document.createElement('canvas');
			this.ctxSave = this.canvasSave.getContext('2d');

			$(this.canvasSave).css({ display: 'none', position: 'absolute', left: 0, top: 0 }).attr('width', $(this.canvas).attr('width')).attr('height', $(this.canvas).attr('height'));

			//if a bg image is set, it will automatically save with the image
			if (this.canvasBg) this.ctxSave.drawImage(this.canvasBg, 0, 0);

			this.ctxSave.drawImage(this.canvas, 0, 0);

			return this.canvasSave.toDataURL();
		},

		setImage: function setImage(data, addUndo) {
			var _self = this;

			var myImage = new Image();
			myImage.src = data.toString();

			_self.ctx.clearRect(0, 0, _self.canvas.width, _self.canvas.height);

			$(myImage).load(function () {
				_self.ctx.drawImage(myImage, 0, 0);
				if (addUndo) {
					_self.addUndo();
				}
			});
		},

		setBgImage: function setBgImage(data, addUndo) {
			var _self = this;

			var myImage = new Image();
			myImage.src = data.toString();

			_self.ctxBg.clearRect(0, 0, _self.canvasBg.width, _self.canvasBg.height);

			$(myImage).load(function () {
				_self.ctxBg.drawImage(myImage, 0, 0);
			});
		},

		/*******************************************************************************
   * undo / redo
   *******************************************************************************/

		addUndo: function addUndo() {
			//if it's not at the end of the array we need to repalce the current array position
			if (this.undoCurrent < this.undoArray.length - 1) {
				this.undoArray[++this.undoCurrent] = this.getImage();
			} else // owtherwise we push normally here
				{
					this.undoArray.push(this.getImage());

					//if we're at the end of the array we need to slice off the front - in increment required
					if (this.undoArray.length > this.undoMax) {
						this.undoArray = this.undoArray.slice(1, this.undoArray.length);
					}
					//if we're NOT at the end of the array, we just increment
					else {
							this.undoCurrent++;
						}
				}

			//for undo's then a new draw we want to remove everything afterwards - in most cases nothing will happen here
			while (this.undoCurrent != this.undoArray.length - 1) {
				this.undoArray.pop();
			}

			this.undoToggleIcons();
		},

		setUndoImage: function setUndoImage() {
			this.setImage(this.undoArray[this.undoCurrent]);
		},

		undoNext: function undoNext() {
			if (this.undoArray[this.undoCurrent + 1]) {
				this.undoCurrent++;this.setUndoImage();
			}

			this.undoToggleIcons();
		},

		undoPrev: function undoPrev() {
			if (this.undoArray[this.undoCurrent - 1]) {
				this.undoCurrent--;this.setUndoImage();
			}

			this.undoToggleIcons();
		},

		undoToggleIcons: function undoToggleIcons() {
			var iconUndo = this.mainMenu.menu.find("._wPaint_undo");
			var iconRedo = this.mainMenu.menu.find("._wPaint_redo");

			if (this.undoCurrent > 0 && this.undoArray.length > 1) {
				if (!iconUndo.hasClass('uactive')) {
					iconUndo.addClass('uactive');
				}
			} else {
				iconUndo.removeClass('uactive');
			}

			if (this.undoCurrent < this.undoArray.length - 1) {
				if (!iconRedo.hasClass('uactive')) {
					iconRedo.addClass('uactive');
				}
			} else {
				iconRedo.removeClass('uactive');
			}
		},

		/*******************************************************************************
   * Functions
   *******************************************************************************/
		clearAll: function clearAll() {
			this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);

			this.addUndo();
		},

		/*******************************************************************************
   * dropper
   ******************************************************************************/
		// get pixel data represented as RGBa color from pixel array.
		_getPixel: function _getPixel(imageData, pos) {
			var pixelArray = imageData.data;
			var base = (pos.y * imageData.width + pos.x) * 4;
			return {
				r: pixelArray[base],
				g: pixelArray[base + 1],
				b: pixelArray[base + 2],
				a: pixelArray[base + 3]
			};
		},
		pickColor: function pickColor(e, _self) {
			var imageData = _self.ctx.getImageData(0, 0, _self.canvas.width, _self.canvas.height);
			var pixelArray = imageData.data;
			var pixel = _self._getPixel(imageData, { x: e.pageX, y: e.pageY });

			var depth = 255;
			var alpha = pixel.a / depth;

			// composite with white
			var colorString = 'rgb(' + [Math.floor(pixel.r * alpha + depth * (1 - alpha)), Math.floor(pixel.g * alpha + depth * (1 - alpha)), Math.floor(pixel.b * alpha + depth * (1 - alpha))].join(',') + ')';

			_self.settings.strokeStyle = colorString;

			_self.$elem.trigger('wPaint:dropper', colorString);

			var cpContainer = _self.mainMenu.menu.find("._wPaint_strokeColorPicker");
			if (!cpContainer.length) return;

			var cp = cpContainer.data('_wColorPicker');
			cp.colorSelect(cp, colorString);
		},

		/*******************************************************************************
   * bucket
   ******************************************************************************/
		_equalPixel: function _equalPixel(p1, p2) {
			return p1.r == p2.r && p1.g == p2.g && p1.b == p2.b && p1.a == p2.a;
		},

		_putPixel: function _putPixel(imageData, pos, pixel) {
			var pixelArray = imageData.data;
			var base = (pos.y * imageData.width + pos.x) * 4;
			pixelArray[base] = pixel.r;
			pixelArray[base + 1] = pixel.g;
			pixelArray[base + 2] = pixel.b;
			pixelArray[base + 3] = pixel.a;
		},

		_toPixel: function _toPixel(color) {
			var matched;
			if (color.charAt(0) === '#') {
				if (color.length === 4) {
					return {
						r: parseInt(color.charAt(1), 16),
						g: parseInt(color.charAt(2), 16),
						b: parseInt(color.charAt(3), 16),
						a: 255
					};
				} else if (color.length === 7) {
					return {
						r: parseInt(color.substr(1, 2), 16),
						g: parseInt(color.substr(3, 2), 16),
						b: parseInt(color.substr(5, 2), 16),
						a: 255
					};
				}
			} else if (matched = color.replace(/\s/g, '').match(/rgba?\(([\d,.]+)\)/)[1]) {
				var rgba = matched.split(',');
				var pixel = {};
				pixel.r = rgba[0];
				pixel.g = rgba[1];
				pixel.b = rgba[2];
				pixel.a = rgba[3] === undefined ? 255 : rgba[3] * 255;
				return pixel;
			}
		},

		fillArea: function fillArea(e, _self) {
			var imageData = _self.ctx.getImageData(0, 0, _self.canvas.width, _self.canvas.height);

			var dist = [{ x: 0, y: 1 }, { x: 1, y: 0 }, { x: 0, y: -1 }, { x: -1, y: 0 }];

			var pixel = _self._toPixel(_self.settings.fillStyle);
			var startPos = { x: e.pageX, y: e.pageY };
			var startPixel = _self._getPixel(imageData, startPos);

			_self._putPixel(imageData, startPos, pixel);
			var queue = [startPos];

			while (!!queue.length) {
				var pos = queue.shift();

				for (var i = 0; i < dist.length; i++) {
					var nextPos = { x: pos.x + dist[i].x, y: pos.y + dist[i].y };
					if (nextPos.x < 0 || nextPos.x >= _self.canvas.width) continue;
					if (nextPos.y < 0 || nextPos.y >= _self.canvas.height) continue;
					var nextPixel = _self._getPixel(imageData, nextPos);
					if (!_self._equalPixel(startPixel, nextPixel)) continue;
					if (_self._equalPixel(pixel, nextPixel)) continue;

					_self._putPixel(imageData, nextPos, pixel);
					queue.push(nextPos);
				}
			}
			_self.ctx.putImageData(imageData, 0, 0);
		},

		/**
   * Ration between the actual width, and the image width
   * - image width can be larger when the canvas is constraint with a `max-width`
   * - returned ration is >= 1
   */
		xRatio: function xRatio() {
			return this.canvas.width / this.canvas.clientWidth;
		},
		yRatio: function yRatio() {
			return this.canvas.height / this.canvas.clientHeight;
		}
	};

	/**
  * Main Menu
  */
	function MainMenu(canvas) {
		this.menu = null;

		return this;
	}

	MainMenu.prototype = {
		generate: function generate(canvas, textMenu) {
			var $canvas = canvas;
			this.textMenu = textMenu;
			var _self = this;

			//setup the line width select
			var options = '';
			for (var i = $canvas.settings.lineWidthMin; i <= $canvas.settings.lineWidthMax; i++) options += '<option value="' + i + '" ' + ($canvas.settings.lineWidth == i ? 'selected="selected"' : '') + '>' + i + '</option>';

			var lineWidth = $('<div class="_wPaint_lineWidth _wPaint_dropDown" title="' + $canvas.settings.menuTitles.lineWidth + '"></div>').append($('<select>' + options + '</select>').change(function (e) {
				$canvas.settings.lineWidth = parseInt($(this).val());
			}));

			//content
			var menuContent = $('<div class="_wPaint_options"></div>');

			$.each($canvas.settings.menu, function (i, item) {
				switch (item) {
					case 'undo':
						menuContent.append($('<div class="_wPaint_icon _wPaint_undo" title="' + $canvas.settings.menuTitles.undo + '"></div>').click(function () {
							$canvas.undoPrev();
						}));break;
					case 'redo':
						menuContent.append($('<div class="_wPaint_icon _wPaint_redo" title="' + $canvas.settings.menuTitles.redo + '"></div>').click(function () {
							$canvas.undoNext();
						}));break;
					case 'clear':
						menuContent.append($('<div class="_wPaint_icon _wPaint_clear" title="' + $canvas.settings.menuTitles.clear + '"></div>').click(function () {
							$canvas.clearAll();
						}));break;
					case 'rectangle':
						menuContent.append($('<div class="_wPaint_icon _wPaint_rectangle" title="' + $canvas.settings.menuTitles.rectangle + '"></div>').click(function () {
							_self.set_mode(_self, $canvas, 'Rectangle');
						}));break;
					case 'ellipse':
						menuContent.append($('<div class="_wPaint_icon _wPaint_ellipse" title="' + $canvas.settings.menuTitles.ellipse + '"></div>').click(function () {
							_self.set_mode(_self, $canvas, 'Ellipse');
						}));break;
					case 'line':
						menuContent.append($('<div class="_wPaint_icon _wPaint_line" title="' + $canvas.settings.menuTitles.line + '"></div>').click(function () {
							_self.set_mode(_self, $canvas, 'Line');
						}));break;
					case 'pencil':
						menuContent.append($('<div class="_wPaint_icon _wPaint_pencil" title="' + $canvas.settings.menuTitles.pencil + '"></div>').click(function () {
							_self.set_mode(_self, $canvas, 'Pencil');
						}));break;
					case 'text':
						menuContent.append($('<div class="_wPaint_icon _wPaint_text" title="' + $canvas.settings.menuTitles.text + '"></div>').click(function () {
							_self.set_mode(_self, $canvas, 'Text');
						}));break;
					case 'eraser':
						menuContent.append($('<div class="_wPaint_icon _wPaint_eraser" title="' + $canvas.settings.menuTitles.eraser + '"></div>').click(function (e) {
							_self.set_mode(_self, $canvas, 'Eraser');
						}));break;
					case 'dropper':
						menuContent.append($('<div class="_wPaint_icon _wPaint_dropper" title="' + $canvas.settings.menuTitles.dropper + '"></div>').click(function (e) {
							_self.set_mode(_self, $canvas, 'Dropper');
						}));break;
					case 'bucket':
						menuContent.append($('<div class="_wPaint_icon _wPaint_bucket" title="' + $canvas.settings.menuTitles.bucket + '"></div>').click(function (e) {
							_self.set_mode(_self, $canvas, 'Bucket');
						}));break;
					case 'fillColor':
						menuContent.append($('<div class="_wPaint_fillColorPicker _wPaint_colorPicker" title="' + $canvas.settings.menuTitles.fillColor + '"></div>'));break;
					case 'lineWidth':
						menuContent.append(lineWidth);break;
					case 'strokeColor':
						menuContent.append($('<div class="_wPaint_strokeColorPicker _wPaint_colorPicker" title="' + $canvas.settings.menuTitles.strokeColor + 'r"></div>'));break;
				}
			});

			//handle
			var menuHandle = $('<div class="_wPaint_handle"></div>');

			//get position of canvas
			//var offset = $($canvas.canvas).offset();

			//menu
			return this.menu = $('<div class="_wPaint_menu _wPaint_menu_' + $canvas.settings.menuOrientation + '"></div>').css({ position: 'absolute', left: $canvas.settings.menuOffsetX, top: $canvas.settings.menuOffsetY }).draggable({
				handle: menuHandle,
				drag: function drag() {
					_self.moveTextMenu(_self, _self.textMenu);
				},
				stop: function stop() {
					_self.moveTextMenu(_self, _self.textMenu);
				}
			}).append(menuHandle).append(menuContent);
		},

		moveTextMenu: function moveTextMenu(mainMenu, textMenu) {
			if (textMenu.docked) {
				textMenu.menu.css({ left: parseInt(mainMenu.menu.css('left')) + textMenu.dockOffsetLeft, top: parseInt(mainMenu.menu.css('top')) + textMenu.dockOffsetTop });
			}
		},

		set_mode: function set_mode(_self, $canvas, mode) {
			$canvas.settings.mode = mode;

			if (mode == 'Text') {
				_self.textMenu.menu.show();
				_self.setWidth($canvas, _self.textMenu.menu);
			} else {
				$canvas.drawTextUp(null, $canvas);
				_self.textMenu.menu.hide();
				$canvas.textInput.hide();
			}

			_self.menu.find("._wPaint_icon").removeClass('active');
			_self.menu.find("._wPaint_" + mode.toLowerCase()).addClass('active');
		},

		setWidth: function setWidth(canvas, menu) {
			var options = menu.find('._wPaint_options');

			if (canvas.settings.menuOrientation === 'vertical') {
				// set proper width
				var width = menu.find('._wPaint_options > div:first').outerWidth(true);
				width += options.outerWidth(true) - options.width();

				//set proper height
			} else {
					var width = menu.find('._wPaint_handle').outerWidth(true);
					width += menu.outerWidth(true) - menu.width();

					menu.find('._wPaint_options').children().each(function () {
						width += $(this).outerWidth(true);
					});
				}

			menu.width(width);
		}
	};

	/**
  * Text Helper
  */
	function TextMenu(canvas) {
		this.menu = null;

		this.docked = true;

		this.dockOffsetLeft = canvas.settings.menuOrientation === 'vertical' ? 36 : 0;
		this.dockOffsetTop = canvas.settings.menuOrientation === 'vertical' ? 0 : 36;

		return this;
	}

	TextMenu.prototype = {
		generate: function generate(canvas, mainMenu) {
			var $canvas = canvas;
			var _self = this;

			//setup font sizes
			var options = '';
			for (var i = $canvas.settings.fontSizeMin; i <= $canvas.settings.fontSizeMax; i++) options += '<option value="' + i + '" ' + ($canvas.settings.fontSize == i ? 'selected="selected"' : '') + '>' + i + '</option>';

			var fontSize = $('<div class="_wPaint_fontSize _wPaint_dropDown" title="' + $canvas.settings.menuTitles.fontSize + '"></div>').append($('<select>' + options + '</select>').change(function (e) {
				var fontSize = parseInt($(this).val());
				$canvas.settings.fontSize = fontSize;
				$canvas.textInput.css({ fontSize: fontSize, lineHeight: fontSize + 'px' });
				$canvas.textCalc.css({ fontSize: fontSize, lineHeight: fontSize + 'px' });
			}));

			//setup font family
			var options = '';
			for (var i = 0, ii = $canvas.settings.fontFamilyOptions.length; i < ii; i++) options += '<option value="' + $canvas.settings.fontFamilyOptions[i] + '" ' + ($canvas.settings.fontFamily == $canvas.settings.fontFamilyOptions[i] ? 'selected="selected"' : '') + '>' + $canvas.settings.fontFamilyOptions[i] + '</option>';

			var fontFamily = $('<div class="_wPaint_fontFamily _wPaint_dropDown" title="' + $canvas.settings.menuTitles.fontFamily + '"><div class="_wPaint_dropDown_cover"></div></div>').append($('<select>' + options + '</select>').change(function (e) {
				var fontFamily = $(this).val();
				$canvas.settings.fontFamily = fontFamily;
				$canvas.textInput.css({ fontFamily: fontFamily });
				$canvas.textCalc.css({ fontFamily: fontFamily });
			}));

			//content
			var menuContent = $('<div class="_wPaint_options"></div>').append($('<div class="_wPaint_icon _wPaint_bold ' + ($canvas.settings.fontTypeBold ? 'active' : '') + '" title="' + $canvas.settings.menuTitles.bold + '"></div>').click(function () {
				_self.setType(_self, $canvas, 'Bold');
			})).append($('<div class="_wPaint_icon _wPaint_italic ' + ($canvas.settings.fontTypeItalic ? 'active' : '') + '" title="' + $canvas.settings.menuTitles.italic + '"></div>').click(function () {
				_self.setType(_self, $canvas, 'Italic');
			})).append($('<div class="_wPaint_icon _wPaint_underline ' + ($canvas.settings.fontTypeUnderline ? 'active' : '') + '" title="' + $canvas.settings.menuTitles.underline + '"></div>').click(function () {
				_self.setType(_self, $canvas, 'Underline');
			})).append(fontSize).append(fontFamily);

			//handle
			var menuHandle = $('<div class="_wPaint_handle"></div>');

			//get position of canvas
			var offset = $($canvas.canvas).offset();

			//menu
			return this.menu = $('<div class="_wPaint_menu _wPaint_menu_' + $canvas.settings.menuOrientation + '""></div>').css({ display: 'none', position: 'absolute' }).draggable({
				snap: '._wPaint_menu',
				handle: menuHandle,
				stop: function stop() {
					$.each($(this).data('draggable').snapElements, function (index, element) {
						_self.dockOffsetLeft = _self.menu.offset().left - mainMenu.menu.offset().left;
						_self.dockOffsetTop = _self.menu.offset().top - mainMenu.menu.offset().top;
						_self.docked = element.snapping;
					});
				}
			}).append(menuHandle).append(menuContent);
		},

		setType: function setType(_self, $canvas, mode) {
			var element = _self.menu.find("._wPaint_" + mode.toLowerCase());
			var isActive = element.hasClass('active');

			$canvas.settings['fontType' + mode] = !isActive;

			isActive ? element.removeClass('active') : element.addClass('active');

			fontTypeBold = $canvas.settings.fontTypeBold ? 'bold' : 'normal';
			fontTypeItalic = $canvas.settings.fontTypeItalic ? 'italic' : 'normal';
			fontTypeUnderline = $canvas.settings.fontTypeUnderline ? 'underline' : 'none';

			$canvas.textInput.css({ fontWeight: fontTypeBold });$canvas.textCalc.css({ fontWeight: fontTypeBold });
			$canvas.textInput.css({ fontStyle: fontTypeItalic });$canvas.textCalc.css({ fontStyle: fontTypeItalic });
			$canvas.textInput.css({ textDecoration: fontTypeUnderline });$canvas.textCalc.css({ textDecoration: fontTypeUnderline });
		}
	};
})(jQuery);

},{}],599:[function(require,module,exports){
'use strict';

var table1 = { 9: "TAB", 27: "ESC", 33: "PageUp", 34: "PageDown", 35: "End", 36: "Home", 37: "Left", 38: "Up", 39: "Right", 40: "Down", 45: "Insert", 46: "Delete", 112: "F1", 113: "F2", 114: "F3", 115: "F4", 116: "F5", 117: "F6", 118: "F7", 119: "F8", 120: "F9", 121: "F10", 122: "F11", 123: "F12" };
var table2 = { 8: "BS", 9: "TAB", 16: "", 17: "", 18: "", 27: "ESC", 13: "RET", 32: "SPC", 224: "" };

function keyString(e) {
	var ret = '';
	if (e.ctrlKey) ret += 'C-';
	if (e.altKey) ret += 'M-';
	if (e.metaKey) ret += 'W-';
	if (e.which === 0) {
		if (e.shiftKey) ret += 'S-';
		ret += table1[e.keyCode];
	} else {
		var key = table2[e.which];
		if (typeof key == "string") {
			if (e.shiftKey) ret += 'S-';
			ret += key;
		} else {
			if (e.ctrlKey && e.which <= 26) {
				e.which += 64;
			}
			if (65 <= e.which && e.which <= 90 || 97 <= e.which && e.which <= 122) {
				ret += String.fromCharCode(e.which)[e.shiftKey ? 'toUpperCase' : 'toLowerCase']();
			} else {
				if (e.keyCode && e.shiftKey) ret += 'S-';
				ret += String.fromCharCode(e.which);
			}
		}
	}
	return ret;
}

module.exports = keyString;

// Usage (with jQuery):
// var keyConfig = {
//     'M-1' : function () {},
//     'M-2' : function () {},
//     'M-3' : function () {},
//     'M-4' : function () {},
//     'M-0' : function () {},
//     '.'   : function () {},
//     'ESC' : function () {},
// };
// $(window).keydown(function (e) {
//     if (!e.altKey) return;
//     var key = keyString(e);
//     var handler = keyConfig[key];
//     handler && handler();
// });
// $(window).keypress(function (e) {
//     var key = keyString(e);
//     var handler = keyConfig[key];
//     handler && handler();
// });
//

},{}],600:[function(require,module,exports){
'use strict';

require('../../static/js/delete-define.js');
require('../../static/js/vendor/jquery-colorbox/jquery.colorbox-min.js');
require('../../static/js/vendor/jqueryui/ui/minified/i18n/jquery.ui.datepicker-ja.min.js');
require('../../static/js/vendor/tipsy/src/javascripts/jquery.tipsy.js');
require('../../static/js/vendor/jcrop/js/jquery.Jcrop.min.js');
require('../../static/js/vendor/jQuery-menu-aim/jquery.menu-aim.js');
require('../../static/js/vendor/jquery-highlight/jquery.highlight.js');

},{"../../static/js/delete-define.js":601,"../../static/js/vendor/jQuery-menu-aim/jquery.menu-aim.js":602,"../../static/js/vendor/jcrop/js/jquery.Jcrop.min.js":603,"../../static/js/vendor/jquery-colorbox/jquery.colorbox-min.js":604,"../../static/js/vendor/jquery-highlight/jquery.highlight.js":605,"../../static/js/vendor/jqueryui/ui/minified/i18n/jquery.ui.datepicker-ja.min.js":606,"../../static/js/vendor/tipsy/src/javascripts/jquery.tipsy.js":607}],601:[function(require,module,exports){
// XXX: twitterwidget.jswindow.define
//      jquery.cookiedefineAMDexportjquery.cookie
//      window.define
window.define = undefined;

},{}],602:[function(require,module,exports){
/**
 * menu-aim is a jQuery plugin for dropdown menus that can differentiate
 * between a user trying hover over a dropdown item vs trying to navigate into
 * a submenu's contents.
 *
 * menu-aim assumes that you have are using a menu with submenus that expand
 * to the menu's right. It will fire events when the user's mouse enters a new
 * dropdown item *and* when that item is being intentionally hovered over.
 *
 * __________________________
 * | Monkeys  >|   Gorilla  |
 * | Gorillas >|   Content  |
 * | Chimps   >|   Here     |
 * |___________|____________|
 *
 * In the above example, "Gorillas" is selected and its submenu content is
 * being shown on the right. Imagine that the user's cursor is hovering over
 * "Gorillas." When they move their mouse into the "Gorilla Content" area, they
 * may briefly hover over "Chimps." This shouldn't close the "Gorilla Content"
 * area.
 *
 * This problem is normally solved using timeouts and delays. menu-aim tries to
 * solve this by detecting the direction of the user's mouse movement. This can
 * make for quicker transitions when navigating up and down the menu. The
 * experience is hopefully similar to amazon.com/'s "Shop by Department"
 * dropdown.
 *
 * Use like so:
 *
 *      $("#menu").menuAim({
 *          activate: $.noop,  // fired on row activation
 *          deactivate: $.noop  // fired on row deactivation
 *      });
 *
 *  ...to receive events when a menu's row has been purposefully (de)activated.
 *
 * The following options can be passed to menuAim. All functions execute with
 * the relevant row's HTML element as the execution context ('this'):
 *
 *      .menuAim({
 *          // Function to call when a row is purposefully activated. Use this
 *          // to show a submenu's content for the activated row.
 *          activate: function() {},
 *
 *          // Function to call when a row is deactivated.
 *          deactivate: function() {},
 *
 *          // Function to call when mouse enters a menu row. Entering a row
 *          // does not mean the row has been activated, as the user may be
 *          // mousing over to a submenu.
 *          enter: function() {},
 *
 *          // Function to call when mouse exits a menu row.
 *          exit: function() {},
 *
 *          // Selector for identifying which elements in the menu are rows
 *          // that can trigger the above events. Defaults to "> li".
 *          rowSelector: "> li",
 *
 *          // You may have some menu rows that aren't submenus and therefore
 *          // shouldn't ever need to "activate." If so, filter submenu rows w/
 *          // this selector. Defaults to "*" (all elements).
 *          submenuSelector: "*",
 *
 *          // Direction the submenu opens relative to the main menu. Can be
 *          // left, right, above, or below. Defaults to "right".
 *          submenuDirection: "right"
 *      });
 *
 * https://github.com/kamens/jQuery-menu-aim
*/
(function ($) {

    $.fn.menuAim = function (opts) {
        // Initialize menu-aim for all elements in jQuery collection
        this.each(function () {
            init.call(this, opts);
        });

        return this;
    };

    function init(opts) {
        var $menu = $(this),
            activeRow = null,
            mouseLocs = [],
            lastDelayLoc = null,
            timeoutId = null,
            options = $.extend({
            rowSelector: "> li",
            submenuSelector: "*",
            submenuDirection: "right",
            tolerance: 75, // bigger = more forgivey when entering submenu
            enter: $.noop,
            exit: $.noop,
            activate: $.noop,
            deactivate: $.noop,
            exitMenu: $.noop
        }, opts);

        var MOUSE_LOCS_TRACKED = 3,
            // number of past mouse locations to track
        DELAY = 300; // ms delay when user appears to be entering submenu

        /**
         * Keep track of the last few locations of the mouse.
         */
        var mousemoveDocument = function mousemoveDocument(e) {
            mouseLocs.push({ x: e.pageX, y: e.pageY });

            if (mouseLocs.length > MOUSE_LOCS_TRACKED) {
                mouseLocs.shift();
            }
        };

        /**
         * Cancel possible row activations when leaving the menu entirely
         */
        var mouseleaveMenu = function mouseleaveMenu() {
            if (timeoutId) {
                clearTimeout(timeoutId);
            }

            // If exitMenu is supplied and returns true, deactivate the
            // currently active row on menu exit.
            if (options.exitMenu(this)) {
                if (activeRow) {
                    options.deactivate(activeRow);
                }

                activeRow = null;
            }
        };

        /**
         * Trigger a possible row activation whenever entering a new row.
         */
        var mouseenterRow = function mouseenterRow() {
            if (timeoutId) {
                // Cancel any previous activation delays
                clearTimeout(timeoutId);
            }

            options.enter(this);
            possiblyActivate(this);
        },
            mouseleaveRow = function mouseleaveRow() {
            options.exit(this);
        };

        /*
         * Immediately activate a row if the user clicks on it.
         */
        var clickRow = function clickRow() {
            activate(this);
        };

        /**
         * Activate a menu row.
         */
        var activate = function activate(row) {
            if (row == activeRow) {
                return;
            }

            if (activeRow) {
                options.deactivate(activeRow);
            }

            options.activate(row);
            activeRow = row;
        };

        /**
         * Possibly activate a menu row. If mouse movement indicates that we
         * shouldn't activate yet because user may be trying to enter
         * a submenu's content, then delay and check again later.
         */
        var possiblyActivate = function possiblyActivate(row) {
            var delay = activationDelay();

            if (delay) {
                timeoutId = setTimeout(function () {
                    possiblyActivate(row);
                }, delay);
            } else {
                activate(row);
            }
        };

        /**
         * Return the amount of time that should be used as a delay before the
         * currently hovered row is activated.
         *
         * Returns 0 if the activation should happen immediately. Otherwise,
         * returns the number of milliseconds that should be delayed before
         * checking again to see if the row should be activated.
         */
        var activationDelay = function activationDelay() {
            if (!activeRow || !$(activeRow).is(options.submenuSelector)) {
                // If there is no other submenu row already active, then
                // go ahead and activate immediately.
                return 0;
            }

            var offset = $menu.offset(),
                upperLeft = {
                x: offset.left,
                y: offset.top - options.tolerance
            },
                upperRight = {
                x: offset.left + $menu.outerWidth(),
                y: upperLeft.y
            },
                lowerLeft = {
                x: offset.left,
                y: offset.top + $menu.outerHeight() + options.tolerance
            },
                lowerRight = {
                x: offset.left + $menu.outerWidth(),
                y: lowerLeft.y
            },
                loc = mouseLocs[mouseLocs.length - 1],
                prevLoc = mouseLocs[0];

            if (!loc) {
                return 0;
            }

            if (!prevLoc) {
                prevLoc = loc;
            }

            if (prevLoc.x < offset.left || prevLoc.x > lowerRight.x || prevLoc.y < offset.top || prevLoc.y > lowerRight.y) {
                // If the previous mouse location was outside of the entire
                // menu's bounds, immediately activate.
                return 0;
            }

            if (lastDelayLoc && loc.x == lastDelayLoc.x && loc.y == lastDelayLoc.y) {
                // If the mouse hasn't moved since the last time we checked
                // for activation status, immediately activate.
                return 0;
            }

            // Detect if the user is moving towards the currently activated
            // submenu.
            //
            // If the mouse is heading relatively clearly towards
            // the submenu's content, we should wait and give the user more
            // time before activating a new row. If the mouse is heading
            // elsewhere, we can immediately activate a new row.
            //
            // We detect this by calculating the slope formed between the
            // current mouse location and the upper/lower right points of
            // the menu. We do the same for the previous mouse location.
            // If the current mouse location's slopes are
            // increasing/decreasing appropriately compared to the
            // previous's, we know the user is moving toward the submenu.
            //
            // Note that since the y-axis increases as the cursor moves
            // down the screen, we are looking for the slope between the
            // cursor and the upper right corner to decrease over time, not
            // increase (somewhat counterintuitively).
            function slope(a, b) {
                return (b.y - a.y) / (b.x - a.x);
            };

            var decreasingCorner = upperRight,
                increasingCorner = lowerRight;

            // Our expectations for decreasing or increasing slope values
            // depends on which direction the submenu opens relative to the
            // main menu. By default, if the menu opens on the right, we
            // expect the slope between the cursor and the upper right
            // corner to decrease over time, as explained above. If the
            // submenu opens in a different direction, we change our slope
            // expectations.
            if (options.submenuDirection == "left") {
                decreasingCorner = lowerLeft;
                increasingCorner = upperLeft;
            } else if (options.submenuDirection == "below") {
                decreasingCorner = lowerRight;
                increasingCorner = lowerLeft;
            } else if (options.submenuDirection == "above") {
                decreasingCorner = upperLeft;
                increasingCorner = upperRight;
            }

            var decreasingSlope = slope(loc, decreasingCorner),
                increasingSlope = slope(loc, increasingCorner),
                prevDecreasingSlope = slope(prevLoc, decreasingCorner),
                prevIncreasingSlope = slope(prevLoc, increasingCorner);

            if (decreasingSlope < prevDecreasingSlope && increasingSlope > prevIncreasingSlope) {
                // Mouse is moving from previous location towards the
                // currently activated submenu. Delay before activating a
                // new menu row, because user may be moving into submenu.
                lastDelayLoc = loc;
                return DELAY;
            }

            lastDelayLoc = null;
            return 0;
        };

        /**
         * Hook up initial menu events
         */
        $menu.mouseleave(mouseleaveMenu).find(options.rowSelector).mouseenter(mouseenterRow).mouseleave(mouseleaveRow).click(clickRow);

        $(document).mousemove(mousemoveDocument);
    };
})(jQuery);

},{}],603:[function(require,module,exports){
/**
 * jquery.Jcrop.min.js v0.9.12 (build:20130202)
 * jQuery Image Cropping Plugin - released under MIT License
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC
 * https://github.com/tapmodo/Jcrop
 */
(function (a) {
  a.Jcrop = function (b, c) {
    function i(a) {
      return Math.round(a) + "px";
    }function j(a) {
      return d.baseClass + "-" + a;
    }function k() {
      return a.fx.step.hasOwnProperty("backgroundColor");
    }function l(b) {
      var c = a(b).offset();return [c.left, c.top];
    }function m(a) {
      return [a.pageX - e[0], a.pageY - e[1]];
    }function n(b) {
      typeof b != "object" && (b = {}), d = a.extend(d, b), a.each(["onChange", "onSelect", "onRelease", "onDblClick"], function (a, b) {
        typeof d[b] != "function" && (d[b] = function () {});
      });
    }function o(a, b, c) {
      e = l(D), bc.setCursor(a === "move" ? a : a + "-resize");if (a === "move") return bc.activateHandlers(q(b), v, c);var d = _.getFixed(),
          f = r(a),
          g = _.getCorner(r(f));_.setPressed(_.getCorner(f)), _.setCurrent(g), bc.activateHandlers(p(a, d), v, c);
    }function p(a, b) {
      return function (c) {
        if (!d.aspectRatio) switch (a) {case "e":
            c[1] = b.y2;break;case "w":
            c[1] = b.y2;break;case "n":
            c[0] = b.x2;break;case "s":
            c[0] = b.x2;} else switch (a) {case "e":
            c[1] = b.y + 1;break;case "w":
            c[1] = b.y + 1;break;case "n":
            c[0] = b.x + 1;break;case "s":
            c[0] = b.x + 1;}_.setCurrent(c), bb.update();
      };
    }function q(a) {
      var b = a;return bd.watchKeys(), function (a) {
        _.moveOffset([a[0] - b[0], a[1] - b[1]]), b = a, bb.update();
      };
    }function r(a) {
      switch (a) {case "n":
          return "sw";case "s":
          return "nw";case "e":
          return "nw";case "w":
          return "ne";case "ne":
          return "sw";case "nw":
          return "se";case "se":
          return "nw";case "sw":
          return "ne";}
    }function s(a) {
      return function (b) {
        return d.disabled ? !1 : a === "move" && !d.allowMove ? !1 : (e = l(D), W = !0, o(a, m(b)), b.stopPropagation(), b.preventDefault(), !1);
      };
    }function t(a, b, c) {
      var d = a.width(),
          e = a.height();d > b && b > 0 && (d = b, e = b / a.width() * a.height()), e > c && c > 0 && (e = c, d = c / a.height() * a.width()), T = a.width() / d, U = a.height() / e, a.width(d).height(e);
    }function u(a) {
      return { x: a.x * T, y: a.y * U, x2: a.x2 * T, y2: a.y2 * U, w: a.w * T, h: a.h * U };
    }function v(a) {
      var b = _.getFixed();b.w > d.minSelect[0] && b.h > d.minSelect[1] ? (bb.enableHandles(), bb.done()) : bb.release(), bc.setCursor(d.allowSelect ? "crosshair" : "default");
    }function w(a) {
      if (d.disabled) return !1;if (!d.allowSelect) return !1;W = !0, e = l(D), bb.disableHandles(), bc.setCursor("crosshair");var b = m(a);return _.setPressed(b), bb.update(), bc.activateHandlers(x, v, a.type.substring(0, 5) === "touch"), bd.watchKeys(), a.stopPropagation(), a.preventDefault(), !1;
    }function x(a) {
      _.setCurrent(a), bb.update();
    }function y() {
      var b = a("<div></div>").addClass(j("tracker"));return g && b.css({ opacity: 0, backgroundColor: "white" }), b;
    }function be(a) {
      G.removeClass().addClass(j("holder")).addClass(a);
    }function bf(a, b) {
      function t() {
        window.setTimeout(u, l);
      }var c = a[0] / T,
          e = a[1] / U,
          f = a[2] / T,
          g = a[3] / U;if (X) return;var h = _.flipCoords(c, e, f, g),
          i = _.getFixed(),
          j = [i.x, i.y, i.x2, i.y2],
          k = j,
          l = d.animationDelay,
          m = h[0] - j[0],
          n = h[1] - j[1],
          o = h[2] - j[2],
          p = h[3] - j[3],
          q = 0,
          r = d.swingSpeed;c = k[0], e = k[1], f = k[2], g = k[3], bb.animMode(!0);var s,
          u = (function () {
        return function () {
          q += (100 - q) / r, k[0] = Math.round(c + q / 100 * m), k[1] = Math.round(e + q / 100 * n), k[2] = Math.round(f + q / 100 * o), k[3] = Math.round(g + q / 100 * p), q >= 99.8 && (q = 100), q < 100 ? (bh(k), t()) : (bb.done(), bb.animMode(!1), typeof b == "function" && b.call(bs));
        };
      })();t();
    }function bg(a) {
      bh([a[0] / T, a[1] / U, a[2] / T, a[3] / U]), d.onSelect.call(bs, u(_.getFixed())), bb.enableHandles();
    }function bh(a) {
      _.setPressed([a[0], a[1]]), _.setCurrent([a[2], a[3]]), bb.update();
    }function bi() {
      return u(_.getFixed());
    }function bj() {
      return _.getFixed();
    }function bk(a) {
      n(a), br();
    }function bl() {
      d.disabled = !0, bb.disableHandles(), bb.setCursor("default"), bc.setCursor("default");
    }function bm() {
      d.disabled = !1, br();
    }function bn() {
      bb.done(), bc.activateHandlers(null, null);
    }function bo() {
      G.remove(), A.show(), A.css("visibility", "visible"), a(b).removeData("Jcrop");
    }function bp(a, b) {
      bb.release(), bl();var c = new Image();c.onload = function () {
        var e = c.width,
            f = c.height,
            g = d.boxWidth,
            h = d.boxHeight;D.width(e).height(f), D.attr("src", a), H.attr("src", a), t(D, g, h), E = D.width(), F = D.height(), H.width(E).height(F), M.width(E + L * 2).height(F + L * 2), G.width(E).height(F), ba.resize(E, F), bm(), typeof b == "function" && b.call(bs);
      }, c.src = a;
    }function bq(a, b, c) {
      var e = b || d.bgColor;d.bgFade && k() && d.fadeTime && !c ? a.animate({ backgroundColor: e }, { queue: !1, duration: d.fadeTime }) : a.css("backgroundColor", e);
    }function br(a) {
      d.allowResize ? a ? bb.enableOnly() : bb.enableHandles() : bb.disableHandles(), bc.setCursor(d.allowSelect ? "crosshair" : "default"), bb.setCursor(d.allowMove ? "move" : "default"), d.hasOwnProperty("trueSize") && (T = d.trueSize[0] / E, U = d.trueSize[1] / F), d.hasOwnProperty("setSelect") && (bg(d.setSelect), bb.done(), delete d.setSelect), ba.refresh(), d.bgColor != N && (bq(d.shade ? ba.getShades() : G, d.shade ? d.shadeColor || d.bgColor : d.bgColor), N = d.bgColor), O != d.bgOpacity && (O = d.bgOpacity, d.shade ? ba.refresh() : bb.setBgOpacity(O)), P = d.maxSize[0] || 0, Q = d.maxSize[1] || 0, R = d.minSize[0] || 0, S = d.minSize[1] || 0, d.hasOwnProperty("outerImage") && (D.attr("src", d.outerImage), delete d.outerImage), bb.refresh();
    }var d = a.extend({}, a.Jcrop.defaults),
        e,
        f = navigator.userAgent.toLowerCase(),
        g = /msie/.test(f),
        h = /msie [1-6]\./.test(f);typeof b != "object" && (b = a(b)[0]), typeof c != "object" && (c = {}), n(c);var z = { border: "none", visibility: "visible", margin: 0, padding: 0, position: "absolute", top: 0, left: 0 },
        A = a(b),
        B = !0;if (b.tagName == "IMG") {
      if (A[0].width != 0 && A[0].height != 0) A.width(A[0].width), A.height(A[0].height);else {
        var C = new Image();C.src = A[0].src, A.width(C.width), A.height(C.height);
      }var D = A.clone().removeAttr("id").css(z).show();D.width(A.width()), D.height(A.height()), A.after(D).hide();
    } else D = A.css(z).show(), B = !1, d.shade === null && (d.shade = !0);t(D, d.boxWidth, d.boxHeight);var E = D.width(),
        F = D.height(),
        G = a("<div />").width(E).height(F).addClass(j("holder")).css({ position: "relative", backgroundColor: d.bgColor }).insertAfter(A).append(D);d.addClass && G.addClass(d.addClass);var H = a("<div />"),
        I = a("<div />").width("100%").height("100%").css({ zIndex: 310, position: "absolute", overflow: "hidden" }),
        J = a("<div />").width("100%").height("100%").css("zIndex", 320),
        K = a("<div />").css({ position: "absolute", zIndex: 600 }).dblclick(function () {
      var a = _.getFixed();d.onDblClick.call(bs, a);
    }).insertBefore(D).append(I, J);B && (H = a("<img />").attr("src", D.attr("src")).css(z).width(E).height(F), I.append(H)), h && K.css({ overflowY: "hidden" });var L = d.boundary,
        M = y().width(E + L * 2).height(F + L * 2).css({ position: "absolute", top: i(-L), left: i(-L), zIndex: 290 }).mousedown(w),
        N = d.bgColor,
        O = d.bgOpacity,
        P,
        Q,
        R,
        S,
        T,
        U,
        V = !0,
        W,
        X,
        Y;e = l(D);var Z = (function () {
      function a() {
        var a = {},
            b = ["touchstart", "touchmove", "touchend"],
            c = document.createElement("div"),
            d;try {
          for (d = 0; d < b.length; d++) {
            var e = b[d];e = "on" + e;var f = (e in c);f || (c.setAttribute(e, "return;"), f = typeof c[e] == "function"), a[b[d]] = f;
          }return a.touchstart && a.touchend && a.touchmove;
        } catch (g) {
          return !1;
        }
      }function b() {
        return d.touchSupport === !0 || d.touchSupport === !1 ? d.touchSupport : a();
      }return { createDragger: function createDragger(a) {
          return function (b) {
            return d.disabled ? !1 : a === "move" && !d.allowMove ? !1 : (e = l(D), W = !0, o(a, m(Z.cfilter(b)), !0), b.stopPropagation(), b.preventDefault(), !1);
          };
        }, newSelection: function newSelection(a) {
          return w(Z.cfilter(a));
        }, cfilter: function cfilter(a) {
          return a.pageX = a.originalEvent.changedTouches[0].pageX, a.pageY = a.originalEvent.changedTouches[0].pageY, a;
        }, isSupported: a, support: b() };
    })(),
        _ = (function () {
      function h(d) {
        d = n(d), c = a = d[0], e = b = d[1];
      }function i(a) {
        a = n(a), f = a[0] - c, g = a[1] - e, c = a[0], e = a[1];
      }function j() {
        return [f, g];
      }function k(d) {
        var f = d[0],
            g = d[1];0 > a + f && (f -= f + a), 0 > b + g && (g -= g + b), F < e + g && (g += F - (e + g)), E < c + f && (f += E - (c + f)), a += f, c += f, b += g, e += g;
      }function l(a) {
        var b = m();switch (a) {case "ne":
            return [b.x2, b.y];case "nw":
            return [b.x, b.y];case "se":
            return [b.x2, b.y2];case "sw":
            return [b.x, b.y2];}
      }function m() {
        if (!d.aspectRatio) return p();var f = d.aspectRatio,
            g = d.minSize[0] / T,
            h = d.maxSize[0] / T,
            i = d.maxSize[1] / U,
            j = c - a,
            k = e - b,
            l = Math.abs(j),
            m = Math.abs(k),
            n = l / m,
            r,
            s,
            t,
            u;return h === 0 && (h = E * 10), i === 0 && (i = F * 10), n < f ? (s = e, t = m * f, r = j < 0 ? a - t : t + a, r < 0 ? (r = 0, u = Math.abs((r - a) / f), s = k < 0 ? b - u : u + b) : r > E && (r = E, u = Math.abs((r - a) / f), s = k < 0 ? b - u : u + b)) : (r = c, u = l / f, s = k < 0 ? b - u : b + u, s < 0 ? (s = 0, t = Math.abs((s - b) * f), r = j < 0 ? a - t : t + a) : s > F && (s = F, t = Math.abs(s - b) * f, r = j < 0 ? a - t : t + a)), r > a ? (r - a < g ? r = a + g : r - a > h && (r = a + h), s > b ? s = b + (r - a) / f : s = b - (r - a) / f) : r < a && (a - r < g ? r = a - g : a - r > h && (r = a - h), s > b ? s = b + (a - r) / f : s = b - (a - r) / f), r < 0 ? (a -= r, r = 0) : r > E && (a -= r - E, r = E), s < 0 ? (b -= s, s = 0) : s > F && (b -= s - F, s = F), q(o(a, b, r, s));
      }function n(a) {
        return a[0] < 0 && (a[0] = 0), a[1] < 0 && (a[1] = 0), a[0] > E && (a[0] = E), a[1] > F && (a[1] = F), [Math.round(a[0]), Math.round(a[1])];
      }function o(a, b, c, d) {
        var e = a,
            f = c,
            g = b,
            h = d;return c < a && (e = c, f = a), d < b && (g = d, h = b), [e, g, f, h];
      }function p() {
        var d = c - a,
            f = e - b,
            g;return P && Math.abs(d) > P && (c = d > 0 ? a + P : a - P), Q && Math.abs(f) > Q && (e = f > 0 ? b + Q : b - Q), S / U && Math.abs(f) < S / U && (e = f > 0 ? b + S / U : b - S / U), R / T && Math.abs(d) < R / T && (c = d > 0 ? a + R / T : a - R / T), a < 0 && (c -= a, a -= a), b < 0 && (e -= b, b -= b), c < 0 && (a -= c, c -= c), e < 0 && (b -= e, e -= e), c > E && (g = c - E, a -= g, c -= g), e > F && (g = e - F, b -= g, e -= g), a > E && (g = a - F, e -= g, b -= g), b > F && (g = b - F, e -= g, b -= g), q(o(a, b, c, e));
      }function q(a) {
        return { x: a[0], y: a[1], x2: a[2], y2: a[3], w: a[2] - a[0], h: a[3] - a[1] };
      }var a = 0,
          b = 0,
          c = 0,
          e = 0,
          f,
          g;return { flipCoords: o, setPressed: h, setCurrent: i, getOffset: j, moveOffset: k, getCorner: l, getFixed: m };
    })(),
        ba = (function () {
      function f(a, b) {
        e.left.css({ height: i(b) }), e.right.css({ height: i(b) });
      }function g() {
        return h(_.getFixed());
      }function h(a) {
        e.top.css({ left: i(a.x), width: i(a.w), height: i(a.y) }), e.bottom.css({ top: i(a.y2), left: i(a.x), width: i(a.w), height: i(F - a.y2) }), e.right.css({ left: i(a.x2), width: i(E - a.x2) }), e.left.css({ width: i(a.x) });
      }function j() {
        return a("<div />").css({ position: "absolute", backgroundColor: d.shadeColor || d.bgColor }).appendTo(c);
      }function k() {
        b || (b = !0, c.insertBefore(D), g(), bb.setBgOpacity(1, 0, 1), H.hide(), l(d.shadeColor || d.bgColor, 1), bb.isAwake() ? n(d.bgOpacity, 1) : n(1, 1));
      }function l(a, b) {
        bq(p(), a, b);
      }function m() {
        b && (c.remove(), H.show(), b = !1, bb.isAwake() ? bb.setBgOpacity(d.bgOpacity, 1, 1) : (bb.setBgOpacity(1, 1, 1), bb.disableHandles()), bq(G, 0, 1));
      }function n(a, e) {
        b && (d.bgFade && !e ? c.animate({ opacity: 1 - a }, { queue: !1, duration: d.fadeTime }) : c.css({ opacity: 1 - a }));
      }function o() {
        d.shade ? k() : m(), bb.isAwake() && n(d.bgOpacity);
      }function p() {
        return c.children();
      }var b = !1,
          c = a("<div />").css({ position: "absolute", zIndex: 240, opacity: 0 }),
          e = { top: j(), left: j().height(F), right: j().height(F), bottom: j() };return { update: g, updateRaw: h, getShades: p, setBgColor: l, enable: k, disable: m, resize: f, refresh: o, opacity: n };
    })(),
        bb = (function () {
      function k(b) {
        var c = a("<div />").css({ position: "absolute", opacity: d.borderOpacity }).addClass(j(b));return I.append(c), c;
      }function l(b, c) {
        var d = a("<div />").mousedown(s(b)).css({ cursor: b + "-resize", position: "absolute", zIndex: c }).addClass("ord-" + b);return Z.support && d.bind("touchstart.jcrop", Z.createDragger(b)), J.append(d), d;
      }function m(a) {
        var b = d.handleSize,
            e = l(a, c++).css({ opacity: d.handleOpacity }).addClass(j("handle"));return b && e.width(b).height(b), e;
      }function n(a) {
        return l(a, c++).addClass("jcrop-dragbar");
      }function o(a) {
        var b;for (b = 0; b < a.length; b++) g[a[b]] = n(a[b]);
      }function p(a) {
        var b, c;for (c = 0; c < a.length; c++) {
          switch (a[c]) {case "n":
              b = "hline";break;case "s":
              b = "hline bottom";break;case "e":
              b = "vline right";break;case "w":
              b = "vline";}e[a[c]] = k(b);
        }
      }function q(a) {
        var b;for (b = 0; b < a.length; b++) f[a[b]] = m(a[b]);
      }function r(a, b) {
        d.shade || H.css({ top: i(-b), left: i(-a) }), K.css({ top: i(b), left: i(a) });
      }function t(a, b) {
        K.width(Math.round(a)).height(Math.round(b));
      }function v() {
        var a = _.getFixed();_.setPressed([a.x, a.y]), _.setCurrent([a.x2, a.y2]), w();
      }function w(a) {
        if (b) return x(a);
      }function x(a) {
        var c = _.getFixed();t(c.w, c.h), r(c.x, c.y), d.shade && ba.updateRaw(c), b || A(), a ? d.onSelect.call(bs, u(c)) : d.onChange.call(bs, u(c));
      }function z(a, c, e) {
        if (!b && !c) return;d.bgFade && !e ? D.animate({ opacity: a }, { queue: !1, duration: d.fadeTime }) : D.css("opacity", a);
      }function A() {
        K.show(), d.shade ? ba.opacity(O) : z(O, !0), b = !0;
      }function B() {
        F(), K.hide(), d.shade ? ba.opacity(1) : z(1), b = !1, d.onRelease.call(bs);
      }function C() {
        h && J.show();
      }function E() {
        h = !0;if (d.allowResize) return J.show(), !0;
      }function F() {
        h = !1, J.hide();
      }function G(a) {
        a ? (X = !0, F()) : (X = !1, E());
      }function L() {
        G(!1), v();
      }var b,
          c = 370,
          e = {},
          f = {},
          g = {},
          h = !1;d.dragEdges && a.isArray(d.createDragbars) && o(d.createDragbars), a.isArray(d.createHandles) && q(d.createHandles), d.drawBorders && a.isArray(d.createBorders) && p(d.createBorders), a(document).bind("touchstart.jcrop-ios", function (b) {
        a(b.currentTarget).hasClass("jcrop-tracker") && b.stopPropagation();
      });var M = y().mousedown(s("move")).css({ cursor: "move", position: "absolute", zIndex: 360 });return Z.support && M.bind("touchstart.jcrop", Z.createDragger("move")), I.append(M), F(), { updateVisible: w, update: x, release: B, refresh: v, isAwake: function isAwake() {
          return b;
        }, setCursor: function setCursor(a) {
          M.css("cursor", a);
        }, enableHandles: E, enableOnly: function enableOnly() {
          h = !0;
        }, showHandles: C, disableHandles: F, animMode: G, setBgOpacity: z, done: L };
    })(),
        bc = (function () {
      function f(b) {
        M.css({ zIndex: 450 }), b ? a(document).bind("touchmove.jcrop", k).bind("touchend.jcrop", l) : e && a(document).bind("mousemove.jcrop", h).bind("mouseup.jcrop", i);
      }function g() {
        M.css({ zIndex: 290 }), a(document).unbind(".jcrop");
      }function h(a) {
        return b(m(a)), !1;
      }function i(a) {
        return a.preventDefault(), a.stopPropagation(), W && (W = !1, c(m(a)), bb.isAwake() && d.onSelect.call(bs, u(_.getFixed())), g(), b = function () {}, c = function () {}), !1;
      }function j(a, d, e) {
        return W = !0, b = a, c = d, f(e), !1;
      }function k(a) {
        return b(m(Z.cfilter(a))), !1;
      }function l(a) {
        return i(Z.cfilter(a));
      }function n(a) {
        M.css("cursor", a);
      }var b = function b() {},
          c = function c() {},
          e = d.trackDocument;return e || M.mousemove(h).mouseup(i).mouseout(i), D.before(M), { activateHandlers: j, setCursor: n };
    })(),
        bd = (function () {
      function e() {
        d.keySupport && (b.show(), b.focus());
      }function f(a) {
        b.hide();
      }function g(a, b, c) {
        d.allowMove && (_.moveOffset([b, c]), bb.updateVisible(!0)), a.preventDefault(), a.stopPropagation();
      }function i(a) {
        if (a.ctrlKey || a.metaKey) return !0;Y = a.shiftKey ? !0 : !1;var b = Y ? 10 : 1;switch (a.keyCode) {case 37:
            g(a, -b, 0);break;case 39:
            g(a, b, 0);break;case 38:
            g(a, 0, -b);break;
          case 40:
            g(a, 0, b);break;case 27:
            d.allowSelect && bb.release();break;case 9:
            return !0;}return !1;
      }var b = a('<input type="radio" />').css({ position: "fixed", left: "-120px", width: "12px" }).addClass("jcrop-keymgr"),
          c = a("<div />").css({ position: "absolute", overflow: "hidden" }).append(b);return d.keySupport && (b.keydown(i).blur(f), h || !d.fixedSupport ? (b.css({ position: "absolute", left: "-20px" }), c.append(b).insertBefore(D)) : b.insertBefore(D)), { watchKeys: e };
    })();Z.support && M.bind("touchstart.jcrop", Z.newSelection), J.hide(), br(!0);var bs = { setImage: bp, animateTo: bf, setSelect: bg, setOptions: bk, tellSelect: bi, tellScaled: bj, setClass: be, disable: bl, enable: bm, cancel: bn, release: bb.release, destroy: bo, focus: bd.watchKeys, getBounds: function getBounds() {
        return [E * T, F * U];
      }, getWidgetSize: function getWidgetSize() {
        return [E, F];
      }, getScaleFactor: function getScaleFactor() {
        return [T, U];
      }, getOptions: function getOptions() {
        return d;
      }, ui: { holder: G, selection: K } };return g && G.bind("selectstart", function () {
      return !1;
    }), A.data("Jcrop", bs), bs;
  }, a.fn.Jcrop = function (b, c) {
    var d;return this.each(function () {
      if (a(this).data("Jcrop")) {
        if (b === "api") return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b);
      } else this.tagName == "IMG" ? a.Jcrop.Loader(this, function () {
        a(this).css({ display: "block", visibility: "hidden" }), d = a.Jcrop(this, b), a.isFunction(c) && c.call(d);
      }) : (a(this).css({ display: "block", visibility: "hidden" }), d = a.Jcrop(this, b), a.isFunction(c) && c.call(d));
    }), this;
  }, a.Jcrop.Loader = function (b, c, d) {
    function g() {
      f.complete ? (e.unbind(".jcloader"), a.isFunction(c) && c.call(f)) : window.setTimeout(g, 50);
    }var e = a(b),
        f = e[0];e.bind("load.jcloader", g).bind("error.jcloader", function (b) {
      e.unbind(".jcloader"), a.isFunction(d) && d.call(f);
    }), f.complete && a.isFunction(c) && (e.unbind(".jcloader"), c.call(f));
  }, a.Jcrop.defaults = { allowSelect: !0, allowMove: !0, allowResize: !0, trackDocument: !0, baseClass: "jcrop", addClass: null, bgColor: "black", bgOpacity: .6, bgFade: !1, borderOpacity: .4, handleOpacity: .5, handleSize: null, aspectRatio: 0, keySupport: !0, createHandles: ["n", "s", "e", "w", "nw", "ne", "se", "sw"], createDragbars: ["n", "s", "e", "w"], createBorders: ["n", "s", "e", "w"], drawBorders: !0, dragEdges: !0, fixedSupport: !0, touchSupport: null, shade: null, boxWidth: 0, boxHeight: 0, boundary: 2, fadeTime: 400, animationDelay: 20, swingSpeed: 3, minSelect: [0, 0], maxSize: [0, 0], minSize: [0, 0], onChange: function onChange() {}, onSelect: function onSelect() {}, onDblClick: function onDblClick() {}, onRelease: function onRelease() {} };
})(jQuery);

},{}],604:[function(require,module,exports){
/*!
	Colorbox 1.6.3
	license: MIT
	http://www.jacklmoore.com/colorbox
*/
(function (t, e, i) {
	function n(i, n, o) {
		var r = e.createElement(i);return n && (r.id = Z + n), o && (r.style.cssText = o), t(r);
	}function o() {
		return i.innerHeight ? i.innerHeight : t(i).height();
	}function r(e, i) {
		i !== Object(i) && (i = {}), this.cache = {}, this.el = e, this.value = function (e) {
			var n;return void 0 === this.cache[e] && (n = t(this.el).attr("data-cbox-" + e), void 0 !== n ? this.cache[e] = n : void 0 !== i[e] ? this.cache[e] = i[e] : void 0 !== X[e] && (this.cache[e] = X[e])), this.cache[e];
		}, this.get = function (e) {
			var i = this.value(e);return t.isFunction(i) ? i.call(this.el, this) : i;
		};
	}function h(t) {
		var e = W.length,
		    i = (A + t) % e;return 0 > i ? e + i : i;
	}function a(t, e) {
		return Math.round((/%/.test(t) ? ("x" === e ? E.width() : o()) / 100 : 1) * parseInt(t, 10));
	}function s(t, e) {
		return t.get("photo") || t.get("photoRegex").test(e);
	}function l(t, e) {
		return t.get("retinaUrl") && i.devicePixelRatio > 1 ? e.replace(t.get("photoRegex"), t.get("retinaSuffix")) : e;
	}function d(t) {
		"contains" in x[0] && !x[0].contains(t.target) && t.target !== v[0] && (t.stopPropagation(), x.focus());
	}function c(t) {
		c.str !== t && (x.add(v).removeClass(c.str).addClass(t), c.str = t);
	}function g(e) {
		A = 0, e && e !== !1 && "nofollow" !== e ? (W = t("." + te).filter(function () {
			var i = t.data(this, Y),
			    n = new r(this, i);return n.get("rel") === e;
		}), A = W.index(_.el), -1 === A && (W = W.add(_.el), A = W.length - 1)) : W = t(_.el);
	}function u(i) {
		t(e).trigger(i), ae.triggerHandler(i);
	}function f(i) {
		var o;if (!G) {
			if ((o = t(i).data(Y), _ = new r(i, o), g(_.get("rel")), !$)) {
				$ = q = !0, c(_.get("className")), x.css({ visibility: "hidden", display: "block", opacity: "" }), I = n(se, "LoadedContent", "width:0; height:0; overflow:hidden; visibility:hidden"), b.css({ width: "", height: "" }).append(I), j = T.height() + k.height() + b.outerHeight(!0) - b.height(), D = C.width() + H.width() + b.outerWidth(!0) - b.width(), N = I.outerHeight(!0), z = I.outerWidth(!0);var h = a(_.get("initialWidth"), "x"),
				    s = a(_.get("initialHeight"), "y"),
				    l = _.get("maxWidth"),
				    f = _.get("maxHeight");_.w = Math.max((l !== !1 ? Math.min(h, a(l, "x")) : h) - z - D, 0), _.h = Math.max((f !== !1 ? Math.min(s, a(f, "y")) : s) - N - j, 0), I.css({ width: "", height: _.h }), J.position(), u(ee), _.get("onOpen"), O.add(F).hide(), x.focus(), _.get("trapFocus") && e.addEventListener && (e.addEventListener("focus", d, !0), ae.one(re, function () {
					e.removeEventListener("focus", d, !0);
				})), _.get("returnFocus") && ae.one(re, function () {
					t(_.el).focus();
				});
			}var p = parseFloat(_.get("opacity"));v.css({ opacity: p === p ? p : "", cursor: _.get("overlayClose") ? "pointer" : "", visibility: "visible" }).show(), _.get("closeButton") ? B.html(_.get("close")).appendTo(b) : B.appendTo("<div/>"), w();
		}
	}function p() {
		x || (V = !1, E = t(i), x = n(se).attr({ id: Y, "class": t.support.opacity === !1 ? Z + "IE" : "", role: "dialog", tabindex: "-1" }).hide(), v = n(se, "Overlay").hide(), L = t([n(se, "LoadingOverlay")[0], n(se, "LoadingGraphic")[0]]), y = n(se, "Wrapper"), b = n(se, "Content").append(F = n(se, "Title"), R = n(se, "Current"), P = t('<button type="button"/>').attr({ id: Z + "Previous" }), K = t('<button type="button"/>').attr({ id: Z + "Next" }), S = n("button", "Slideshow"), L), B = t('<button type="button"/>').attr({ id: Z + "Close" }), y.append(n(se).append(n(se, "TopLeft"), T = n(se, "TopCenter"), n(se, "TopRight")), n(se, !1, "clear:left").append(C = n(se, "MiddleLeft"), b, H = n(se, "MiddleRight")), n(se, !1, "clear:left").append(n(se, "BottomLeft"), k = n(se, "BottomCenter"), n(se, "BottomRight"))).find("div div").css({ "float": "left" }), M = n(se, !1, "position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"), O = K.add(P).add(R).add(S)), e.body && !x.parent().length && t(e.body).append(v, x.append(y, M));
	}function m() {
		function i(t) {
			t.which > 1 || t.shiftKey || t.altKey || t.metaKey || t.ctrlKey || (t.preventDefault(), f(this));
		}return x ? (V || (V = !0, K.click(function () {
			J.next();
		}), P.click(function () {
			J.prev();
		}), B.click(function () {
			J.close();
		}), v.click(function () {
			_.get("overlayClose") && J.close();
		}), t(e).bind("keydown." + Z, function (t) {
			var e = t.keyCode;$ && _.get("escKey") && 27 === e && (t.preventDefault(), J.close()), $ && _.get("arrowKey") && W[1] && !t.altKey && (37 === e ? (t.preventDefault(), P.click()) : 39 === e && (t.preventDefault(), K.click()));
		}), t.isFunction(t.fn.on) ? t(e).on("click." + Z, "." + te, i) : t("." + te).live("click." + Z, i)), !0) : !1;
	}function w() {
		var e,
		    o,
		    r,
		    h = J.prep,
		    d = ++le;if ((q = !0, U = !1, u(he), u(ie), _.get("onLoad"), _.h = _.get("height") ? a(_.get("height"), "y") - N - j : _.get("innerHeight") && a(_.get("innerHeight"), "y"), _.w = _.get("width") ? a(_.get("width"), "x") - z - D : _.get("innerWidth") && a(_.get("innerWidth"), "x"), _.mw = _.w, _.mh = _.h, _.get("maxWidth") && (_.mw = a(_.get("maxWidth"), "x") - z - D, _.mw = _.w && _.w < _.mw ? _.w : _.mw), _.get("maxHeight") && (_.mh = a(_.get("maxHeight"), "y") - N - j, _.mh = _.h && _.h < _.mh ? _.h : _.mh), e = _.get("href"), Q = setTimeout(function () {
			L.show();
		}, 100), _.get("inline"))) {
			var c = t(e);r = t("<div>").hide().insertBefore(c), ae.one(he, function () {
				r.replaceWith(c);
			}), h(c);
		} else _.get("iframe") ? h(" ") : _.get("html") ? h(_.get("html")) : s(_, e) ? (e = l(_, e), U = _.get("createImg"), t(U).addClass(Z + "Photo").bind("error." + Z, function () {
			h(n(se, "Error").html(_.get("imgError")));
		}).one("load", function () {
			d === le && setTimeout(function () {
				var e;_.get("retinaImage") && i.devicePixelRatio > 1 && (U.height = U.height / i.devicePixelRatio, U.width = U.width / i.devicePixelRatio), _.get("scalePhotos") && (o = function () {
					U.height -= U.height * e, U.width -= U.width * e;
				}, _.mw && U.width > _.mw && (e = (U.width - _.mw) / U.width, o()), _.mh && U.height > _.mh && (e = (U.height - _.mh) / U.height, o())), _.h && (U.style.marginTop = Math.max(_.mh - U.height, 0) / 2 + "px"), W[1] && (_.get("loop") || W[A + 1]) && (U.style.cursor = "pointer", t(U).bind("click." + Z, function () {
					J.next();
				})), U.style.width = U.width + "px", U.style.height = U.height + "px", h(U);
			}, 1);
		}), U.src = e) : e && M.load(e, _.get("data"), function (e, i) {
			d === le && h("error" === i ? n(se, "Error").html(_.get("xhrError")) : t(this).contents());
		});
	}var v,
	    x,
	    y,
	    b,
	    T,
	    C,
	    H,
	    k,
	    W,
	    E,
	    I,
	    M,
	    L,
	    F,
	    R,
	    S,
	    K,
	    P,
	    B,
	    O,
	    _,
	    j,
	    D,
	    N,
	    z,
	    A,
	    U,
	    $,
	    q,
	    G,
	    Q,
	    J,
	    V,
	    X = { html: !1, photo: !1, iframe: !1, inline: !1, transition: "elastic", speed: 300, fadeOut: 300, width: !1, initialWidth: "600", innerWidth: !1, maxWidth: !1, height: !1, initialHeight: "450", innerHeight: !1, maxHeight: !1, scalePhotos: !0, scrolling: !0, opacity: .9, preloading: !0, className: !1, overlayClose: !0, escKey: !0, arrowKey: !0, top: !1, bottom: !1, left: !1, right: !1, fixed: !1, data: void 0, closeButton: !0, fastIframe: !0, open: !1, reposition: !0, loop: !0, slideshow: !1, slideshowAuto: !0, slideshowSpeed: 2500, slideshowStart: "start slideshow", slideshowStop: "stop slideshow", photoRegex: /\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i, retinaImage: !1, retinaUrl: !1, retinaSuffix: "@2x.$1", current: "image {current} of {total}", previous: "previous", next: "next", close: "close", xhrError: "This content failed to load.", imgError: "This image failed to load.", returnFocus: !0, trapFocus: !0, onOpen: !1, onLoad: !1, onComplete: !1, onCleanup: !1, onClosed: !1, rel: function rel() {
			return this.rel;
		}, href: function href() {
			return t(this).attr("href");
		}, title: function title() {
			return this.title;
		}, createImg: function createImg() {
			var e = new Image(),
			    i = t(this).data("cbox-img-attrs");return "object" == typeof i && t.each(i, function (t, i) {
				e[t] = i;
			}), e;
		}, createIframe: function createIframe() {
			var i = e.createElement("iframe"),
			    n = t(this).data("cbox-iframe-attrs");return "object" == typeof n && t.each(n, function (t, e) {
				i[t] = e;
			}), "frameBorder" in i && (i.frameBorder = 0), "allowTransparency" in i && (i.allowTransparency = "true"), i.name = new Date().getTime(), i.allowFullscreen = !0, i;
		} },
	    Y = "colorbox",
	    Z = "cbox",
	    te = Z + "Element",
	    ee = Z + "_open",
	    ie = Z + "_load",
	    ne = Z + "_complete",
	    oe = Z + "_cleanup",
	    re = Z + "_closed",
	    he = Z + "_purge",
	    ae = t("<a/>"),
	    se = "div",
	    le = 0,
	    de = {},
	    ce = (function () {
		function t() {
			clearTimeout(h);
		}function e() {
			(_.get("loop") || W[A + 1]) && (t(), h = setTimeout(J.next, _.get("slideshowSpeed")));
		}function i() {
			S.html(_.get("slideshowStop")).unbind(s).one(s, n), ae.bind(ne, e).bind(ie, t), x.removeClass(a + "off").addClass(a + "on");
		}function n() {
			t(), ae.unbind(ne, e).unbind(ie, t), S.html(_.get("slideshowStart")).unbind(s).one(s, function () {
				J.next(), i();
			}), x.removeClass(a + "on").addClass(a + "off");
		}function o() {
			r = !1, S.hide(), t(), ae.unbind(ne, e).unbind(ie, t), x.removeClass(a + "off " + a + "on");
		}var r,
		    h,
		    a = Z + "Slideshow_",
		    s = "click." + Z;return function () {
			r ? _.get("slideshow") || (ae.unbind(oe, o), o()) : _.get("slideshow") && W[1] && (r = !0, ae.one(oe, o), _.get("slideshowAuto") ? i() : n(), S.show());
		};
	})();t[Y] || (t(p), J = t.fn[Y] = t[Y] = function (e, i) {
		var n,
		    o = this;return e = e || {}, t.isFunction(o) && (o = t("<a/>"), e.open = !0), o[0] ? (p(), m() && (i && (e.onComplete = i), o.each(function () {
			var i = t.data(this, Y) || {};t.data(this, Y, t.extend(i, e));
		}).addClass(te), n = new r(o[0], e), n.get("open") && f(o[0])), o) : o;
	}, J.position = function (e, i) {
		function n() {
			T[0].style.width = k[0].style.width = b[0].style.width = parseInt(x[0].style.width, 10) - D + "px", b[0].style.height = C[0].style.height = H[0].style.height = parseInt(x[0].style.height, 10) - j + "px";
		}var r,
		    h,
		    s,
		    l = 0,
		    d = 0,
		    c = x.offset();if ((E.unbind("resize." + Z), x.css({ top: -9e4, left: -9e4 }), h = E.scrollTop(), s = E.scrollLeft(), _.get("fixed") ? (c.top -= h, c.left -= s, x.css({ position: "fixed" })) : (l = h, d = s, x.css({ position: "absolute" })), d += _.get("right") !== !1 ? Math.max(E.width() - _.w - z - D - a(_.get("right"), "x"), 0) : _.get("left") !== !1 ? a(_.get("left"), "x") : Math.round(Math.max(E.width() - _.w - z - D, 0) / 2), l += _.get("bottom") !== !1 ? Math.max(o() - _.h - N - j - a(_.get("bottom"), "y"), 0) : _.get("top") !== !1 ? a(_.get("top"), "y") : Math.round(Math.max(o() - _.h - N - j, 0) / 2), x.css({ top: c.top, left: c.left, visibility: "visible" }), y[0].style.width = y[0].style.height = "9999px", r = { width: _.w + z + D, height: _.h + N + j, top: l, left: d }, e)) {
			var g = 0;t.each(r, function (t) {
				return r[t] !== de[t] ? (g = e, void 0) : void 0;
			}), e = g;
		}de = r, e || x.css(r), x.dequeue().animate(r, { duration: e || 0, complete: function complete() {
				n(), q = !1, y[0].style.width = _.w + z + D + "px", y[0].style.height = _.h + N + j + "px", _.get("reposition") && setTimeout(function () {
					E.bind("resize." + Z, J.position);
				}, 1), t.isFunction(i) && i();
			}, step: n });
	}, J.resize = function (t) {
		var e;$ && (t = t || {}, t.width && (_.w = a(t.width, "x") - z - D), t.innerWidth && (_.w = a(t.innerWidth, "x")), I.css({ width: _.w }), t.height && (_.h = a(t.height, "y") - N - j), t.innerHeight && (_.h = a(t.innerHeight, "y")), t.innerHeight || t.height || (e = I.scrollTop(), I.css({ height: "auto" }), _.h = I.height()), I.css({ height: _.h }), e && I.scrollTop(e), J.position("none" === _.get("transition") ? 0 : _.get("speed")));
	}, J.prep = function (i) {
		function o() {
			return _.w = _.w || I.width(), _.w = _.mw && _.mw < _.w ? _.mw : _.w, _.w;
		}function a() {
			return _.h = _.h || I.height(), _.h = _.mh && _.mh < _.h ? _.mh : _.h, _.h;
		}if ($) {
			var d,
			    g = "none" === _.get("transition") ? 0 : _.get("speed");I.remove(), I = n(se, "LoadedContent").append(i), I.hide().appendTo(M.show()).css({ width: o(), overflow: _.get("scrolling") ? "auto" : "hidden" }).css({ height: a() }).prependTo(b), M.hide(), t(U).css({ "float": "none" }), c(_.get("className")), d = function () {
				function i() {
					t.support.opacity === !1 && x[0].style.removeAttribute("filter");
				}var n,
				    o,
				    a = W.length;$ && (o = function () {
					clearTimeout(Q), L.hide(), u(ne), _.get("onComplete");
				}, F.html(_.get("title")).show(), I.show(), a > 1 ? ("string" == typeof _.get("current") && R.html(_.get("current").replace("{current}", A + 1).replace("{total}", a)).show(), K[_.get("loop") || a - 1 > A ? "show" : "hide"]().html(_.get("next")), P[_.get("loop") || A ? "show" : "hide"]().html(_.get("previous")), ce(), _.get("preloading") && t.each([h(-1), h(1)], function () {
					var i,
					    n = W[this],
					    o = new r(n, t.data(n, Y)),
					    h = o.get("href");h && s(o, h) && (h = l(o, h), i = e.createElement("img"), i.src = h);
				})) : O.hide(), _.get("iframe") ? (n = _.get("createIframe"), _.get("scrolling") || (n.scrolling = "no"), t(n).attr({ src: _.get("href"), "class": Z + "Iframe" }).one("load", o).appendTo(I), ae.one(he, function () {
					n.src = "//about:blank";
				}), _.get("fastIframe") && t(n).trigger("load")) : o(), "fade" === _.get("transition") ? x.fadeTo(g, 1, i) : i());
			}, "fade" === _.get("transition") ? x.fadeTo(g, 0, function () {
				J.position(0, d);
			}) : J.position(g, d);
		}
	}, J.next = function () {
		!q && W[1] && (_.get("loop") || W[A + 1]) && (A = h(1), f(W[A]));
	}, J.prev = function () {
		!q && W[1] && (_.get("loop") || A) && (A = h(-1), f(W[A]));
	}, J.close = function () {
		$ && !G && (G = !0, $ = !1, u(oe), _.get("onCleanup"), E.unbind("." + Z), v.fadeTo(_.get("fadeOut") || 0, 0), x.stop().fadeTo(_.get("fadeOut") || 0, 0, function () {
			x.hide(), v.hide(), u(he), I.remove(), setTimeout(function () {
				G = !1, u(re), _.get("onClosed");
			}, 1);
		}));
	}, J.remove = function () {
		x && (x.stop(), t[Y].close(), x.stop(!1, !0).remove(), v.remove(), G = !1, x = null, t("." + te).removeData(Y).removeClass(te), t(e).unbind("click." + Z).unbind("keydown." + Z));
	}, J.element = function () {
		return t(_.el);
	}, J.settings = X);
})(jQuery, document, window);

},{}],605:[function(require,module,exports){
(function (global){
/*
 * jQuery Highlight plugin
 *
 * Based on highlight v3 by Johann Burkard
 * http://johannburkard.de/blog/programming/javascript/highlight-javascript-text-higlighting-jquery-plugin.html
 *
 * Code a little bit refactored and cleaned (in my humble opinion).
 * Most important changes:
 *  - has an option to highlight only entire words (wordsOnly - false by default),
 *  - has an option to be case sensitive (caseSensitive - false by default)
 *  - highlight element tag and class names can be specified in options
 *
 * Usage:
 *   // wrap every occurrance of text 'lorem' in content
 *   // with <span class='highlight'> (default options)
 *   $('#content').highlight('lorem');
 *
 *   // search for and highlight more terms at once
 *   // so you can save some time on traversing DOM
 *   $('#content').highlight(['lorem', 'ipsum']);
 *   $('#content').highlight('lorem ipsum');
 *
 *   // search only for entire word 'lorem'
 *   $('#content').highlight('lorem', { wordsOnly: true });
 *
 *   // don't ignore case during search of term 'lorem'
 *   $('#content').highlight('lorem', { caseSensitive: true });
 *
 *   // wrap every occurrance of term 'ipsum' in content
 *   // with <em class='important'>
 *   $('#content').highlight('ipsum', { element: 'em', className: 'important' });
 *
 *   // remove default highlight
 *   $('#content').unhighlight();
 *
 *   // remove custom highlight
 *   $('#content').unhighlight({ element: 'em', className: 'important' });
 *
 *
 * Copyright (c) 2009 Bartek Szopka
 *
 * Licensed under MIT license.
 *
 */
(function (factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['jquery'], factory);
    } else if (typeof exports === 'object') {
        // Node/CommonJS
        factory((typeof window !== "undefined" ? window['$'] : typeof global !== "undefined" ? global['$'] : null));
    } else {
        // Browser globals
        factory(jQuery);
    }
})(function (jQuery) {
    jQuery.extend({
        highlight: function highlight(node, re, nodeName, className) {
            if (node.nodeType === 3) {
                var match = node.data.match(re);
                if (match) {
                    var highlight = document.createElement(nodeName || 'span');
                    highlight.className = className || 'highlight';
                    var wordNode = node.splitText(match.index);
                    wordNode.splitText(match[0].length);
                    var wordClone = wordNode.cloneNode(true);
                    highlight.appendChild(wordClone);
                    wordNode.parentNode.replaceChild(highlight, wordNode);
                    return 1; //skip added node in parent
                }
            } else if (node.nodeType === 1 && node.childNodes && // only element nodes that have children
                !/(script|style)/i.test(node.tagName) && // ignore script and style nodes
                !(node.tagName === nodeName.toUpperCase() && node.className === className)) {
                    // skip if already highlighted
                    for (var i = 0; i < node.childNodes.length; i++) {
                        i += jQuery.highlight(node.childNodes[i], re, nodeName, className);
                    }
                }
            return 0;
        }
    });

    jQuery.fn.unhighlight = function (options) {
        var settings = { className: 'highlight', element: 'span' };
        jQuery.extend(settings, options);

        return this.find(settings.element + "." + settings.className).each(function () {
            var parent = this.parentNode;
            parent.replaceChild(this.firstChild, this);
            parent.normalize();
        }).end();
    };

    jQuery.fn.highlight = function (words, options) {
        var settings = { className: 'highlight', element: 'span', caseSensitive: false, wordsOnly: false };
        jQuery.extend(settings, options);

        if (words.constructor === String) {
            words = [words];
        }
        words = jQuery.grep(words, function (word, i) {
            return word != '';
        });
        words = jQuery.map(words, function (word, i) {
            return word.replace(/[-[\]{}()*+?.,\\^$|#\s]/g, "\\$&");
        });
        if (words.length == 0) {
            return this;
        };

        var flag = settings.caseSensitive ? "" : "i";
        var pattern = "(" + words.join("|") + ")";
        if (settings.wordsOnly) {
            pattern = "\\b" + pattern + "\\b";
        }
        var re = new RegExp(pattern, flag);

        return this.each(function () {
            jQuery.highlight(this, re, settings.element, settings.className);
        });
    };
});

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],606:[function(require,module,exports){
/*! jQuery UI - v1.10.0 - 2013-01-17
* http://jqueryui.com
* Includes: jquery.ui.datepicker-ja.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
jQuery(function (e) {
  e.datepicker.regional.ja = { closeText: "", prevText: "&#x3C;", nextText: "&#x3E;", currentText: "", monthNames: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"], monthNamesShort: ["1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12"], dayNames: ["", "", "", "", "", "", ""], dayNamesShort: ["", "", "", "", "", "", ""], dayNamesMin: ["", "", "", "", "", "", ""], weekHeader: "", dateFormat: "yy/mm/dd", firstDay: 0, isRTL: !1, showMonthAfterYear: !0, yearSuffix: "" }, e.datepicker.setDefaults(e.datepicker.regional.ja);
});

},{}],607:[function(require,module,exports){
// tipsy, facebook style tooltips for jquery
// version 1.0.0a
// (c) 2008-2010 jason frame [jason@onehackoranother.com]

(function ($, window, undefined) {

    function maybeCall(thing, ctx) {
        return typeof thing == 'function' ? thing.call(ctx) : thing;
    }

    function isElementInDOM(ele) {
        while (ele = ele.parentNode) {
            if (ele == document) return true;
        }
        return false;
    }

    // Returns true if it is a DOM element
    // http://stackoverflow.com/a/384380/999
    function isElement(o) {
        return typeof HTMLElement === "object" ? o instanceof HTMLElement : //DOM2
        o && typeof o === "object" && o.nodeType === 1 && typeof o.nodeName === "string";
    }

    var tipsyIDcounter = 0;
    function tipsyID() {
        return "tipsyuid" + tipsyIDcounter++;
    }

    function Tipsy(element, options) {
        this.$element = $(element);
        this.options = options;
        this.enabled = true;
        this.fixTitle();
    }

    Tipsy.prototype = {
        show: function show() {
            if (!isElementInDOM(this.$element[0])) {
                return;
            }

            if (isElement(this.$element) && !this.$element.is(':visible')) {
                return;
            }

            var title;
            if (this.enabled && (title = this.getTitle())) {
                var $tip = this.tip();

                $tip.find('.tipsy-inner' + this.options.theme)[this.options.html ? 'html' : 'text'](title);

                $tip[0].className = 'tipsy' + this.options.theme; // reset classname in case of dynamic gravity
                if (this.options.className) {
                    $tip.addClass(maybeCall(this.options.className, this.$element[0]));
                }

                $tip.remove().css({ top: 0, left: 0, visibility: 'hidden', display: 'block' }).prependTo(document.body);

                var pos = $.extend({}, this.$element.offset());

                // If the element is contained in a SVG object, use getBBox
                if (this.$element.parents('svg').size() > 0) {
                    pos = $.extend(pos, this.$element[0].getBBox());
                } else {
                    pos = $.extend(pos, {
                        width: this.$element[0].offsetWidth || 0,
                        height: this.$element[0].offsetHeight || 0
                    });
                }

                var actualWidth = $tip[0].offsetWidth,
                    actualHeight = $tip[0].offsetHeight,
                    gravity = maybeCall(this.options.gravity, this.$element[0]);

                var tp;
                switch (gravity.charAt(0)) {
                    case 'n':
                        tp = { top: pos.top + pos.height + this.options.offset, left: pos.left + pos.width / 2 - actualWidth / 2 };
                        break;
                    case 's':
                        tp = { top: pos.top - actualHeight - this.options.offset, left: pos.left + pos.width / 2 - actualWidth / 2 };
                        break;
                    case 'e':
                        tp = { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left - actualWidth - this.options.offset };
                        break;
                    case 'w':
                        tp = { top: pos.top + pos.height / 2 - actualHeight / 2, left: pos.left + pos.width + this.options.offset };
                        break;
                    default:
                        break;
                }

                if (gravity.length == 2) {
                    if (gravity.charAt(1) == 'w') {
                        tp.left = pos.left + pos.width / 2 - 15;
                    } else {
                        tp.left = pos.left + pos.width / 2 - actualWidth + 15;
                    }
                }

                $tip.css(tp).addClass('tipsy-' + gravity + this.options.theme);
                $tip.find('.tipsy-arrow' + this.options.theme)[0].className = 'tipsy-arrow' + this.options.theme + ' tipsy-arrow-' + gravity.charAt(0) + this.options.theme;
                $tip.css({ width: actualWidth - 10 + 'px' });

                if (this.options.fade) {
                    if (this.options.shadow) $(".tipsy-inner").css({ 'box-shadow': '0px 0px ' + this.options.shadowBlur + 'px ' + this.options.shadowSpread + 'px rgba(0, 0, 0, ' + this.options.shadowOpacity + ')', '-webkit-box-shadow': '0px 0px ' + this.options.shadowBlur + 'px ' + this.options.shadowSpread + 'px rgba(0, 0, 0, ' + this.options.shadowOpacity + ')' });
                    $tip.stop().css({ opacity: 0, display: 'block', visibility: 'visible' }).animate({ opacity: this.options.opacity }, this.options.fadeInTime);
                } else {
                    $tip.css({ visibility: 'visible', opacity: this.options.opacity });
                }

                if (this.options.aria) {
                    var $tipID = tipsyID();
                    $tip.attr("id", $tipID);
                    this.$element.attr("aria-describedby", $tipID);
                }
            }
        },

        hide: function hide() {
            if (this.options.fade) {
                this.tip().stop().fadeOut(this.options.fadeOutTime, function () {
                    $(this).remove();
                });
            } else {
                this.tip().remove();
            }
            if (this.options.aria) {
                this.$element.removeAttr("aria-describedby");
            }
        },

        fixTitle: function fixTitle() {
            var $e = this.$element;
            if ($e.attr('title') || typeof $e.attr('original-title') != 'string') {
                $e.attr('original-title', $e.attr('title') || '').removeAttr('title');
            }
        },

        getTitle: function getTitle() {
            var title,
                $e = this.$element,
                o = this.options;
            this.fixTitle();
            if (typeof o.title == 'string') {
                title = $e.attr(o.title == 'title' ? 'original-title' : o.title);
            } else if (typeof o.title == 'function') {
                title = o.title.call($e[0]);
            }
            title = ('' + title).replace(/(^\s*|\s*$)/, "");
            return title || o.fallback;
        },

        tip: function tip() {
            if (!this.$tip) {
                this.$tip = $('<div class="tipsy' + this.options.theme + '"></div>').html('<div class="tipsy-arrow' + this.options.theme + '"></div><div class="tipsy-inner' + this.options.theme + '"></div>').attr("role", "tooltip");
                this.$tip.data('tipsy-pointee', this.$element[0]);
            }
            return this.$tip;
        },

        validate: function validate() {
            if (!this.$element[0].parentNode) {
                this.hide();
                this.$element = null;
                this.options = null;
            }
        },

        enable: function enable() {
            this.enabled = true;
        },
        disable: function disable() {
            this.enabled = false;
        },
        toggleEnabled: function toggleEnabled() {
            this.enabled = !this.enabled;
        }
    };

    $.fn.tipsy = function (options) {

        $.fn.tipsy.enable();

        if (options === true) {
            return this.data('tipsy');
        } else if (typeof options == 'string') {
            var tipsy = this.data('tipsy');
            if (tipsy) tipsy[options]();
            return this;
        }

        options = $.extend({}, $.fn.tipsy.defaults, options);

        // Establish theme
        options.theme = options.theme && options.theme !== '' ? '-' + options.theme : '';

        function get(ele) {
            var tipsy = $.data(ele, 'tipsy');
            if (!tipsy) {
                tipsy = new Tipsy(ele, $.fn.tipsy.elementOptions(ele, options));
                $.data(ele, 'tipsy', tipsy);
            }
            return tipsy;
        }

        function enter() {
            if ($.fn.tipsy.enabled !== true) {
                return;
            }
            var tipsy = get(this);
            tipsy.hoverState = 'in';
            if (options.delayIn === 0) {
                tipsy.show();
            } else {
                tipsy.fixTitle();
                setTimeout(function () {
                    if (tipsy.hoverState == 'in' && isElementInDOM(tipsy.$element)) {
                        tipsy.show();
                    }
                }, options.delayIn);
            }
        }

        function leave() {
            var tipsy = get(this);
            tipsy.hoverState = 'out';
            if (options.delayOut === 0) {
                tipsy.hide();
            } else {
                setTimeout(function () {
                    if (tipsy.hoverState == 'out' || !tipsy.$element || !tipsy.$element.is(':visible')) tipsy.hide();
                }, options.delayOut);
            }
        }

        if (!options.live) this.each(function () {
            get(this);
        });

        if (options.trigger != 'manual') {
            var eventIn = options.trigger == 'hover' ? 'mouseenter mouseover' : 'focus',
                eventOut = options.trigger == 'hover' ? 'mouseleave mouseout' : 'blur';

            if (options.live && options.live !== true) {
                $(this).on(eventIn, options.live, enter);
                $(this).on(eventOut, options.live, leave);
            } else {
                if (options.live && !$.live) {
                    //live === true and using jQuery >= 1.9
                    throw "Since jQuery 1.9, pass selector as live argument. eg. $(document).tipsy({live: 'a.live'});";
                }
                var binder = options.live ? 'live' : 'bind';
                this[binder](eventIn, enter)[binder](eventOut, leave);
            }
        }

        return this;
    };

    $.fn.tipsy.defaults = {
        aria: false,
        className: null,
        delayIn: 0,
        delayOut: 0,
        fade: false,
        fadeInTime: 400,
        fadeOutTime: 400,
        shadow: false,
        shadowBlur: 8,
        shadowOpacity: 1,
        shadowSpread: 0,
        fallback: '',
        gravity: 'n',
        html: false,
        live: false,
        offset: 0,
        opacity: 0.8,
        title: 'title',
        trigger: 'hover',
        theme: ''
    };

    $.fn.tipsy.revalidate = function () {
        $('.tipsy').each(function () {
            var pointee = $.data(this, 'tipsy-pointee');
            if (!pointee || !isElementInDOM(pointee)) {
                $(this).remove();
            }
        });
    };

    $.fn.tipsy.enable = function () {
        $.fn.tipsy.enabled = true;
    };

    $.fn.tipsy.disable = function () {
        $.fn.tipsy.enabled = false;
    };

    // Overwrite this method to provide options on a per-element basis.
    // For example, you could store the gravity in a 'tipsy-gravity' attribute:
    // return $.extend({}, options, {gravity: $(ele).attr('tipsy-gravity') || 'n' });
    // (remember - do not modify 'options' in place!)
    $.fn.tipsy.elementOptions = function (ele, options) {
        return $.metadata ? $.extend({}, options, $(ele).metadata()) : options;
    };

    $.fn.tipsy.autoNS = function () {
        return $(this).offset().top > $(document).scrollTop() + $(window).height() / 2 ? 's' : 'n';
    };

    $.fn.tipsy.autoWE = function () {
        return $(this).offset().left > $(document).scrollLeft() + $(window).width() / 2 ? 'e' : 'w';
    };

    $.fn.tipsy.autoNWNE = function () {
        return $(this).offset().left > $(document).scrollLeft() + $(window).width() / 2 ? 'ne' : 'nw';
    };

    $.fn.tipsy.autoSWSE = function () {
        return $(this).offset().left > $(document).scrollLeft() + $(window).width() / 2 ? 'se' : 'sw';
    };

    /**
     * yields a closure of the supplied parameters, producing a function that takes
     * no arguments and is suitable for use as an autogravity function like so:
     *
     * @param margin (int) - distance from the viewable region edge that an
     *        element should be before setting its tooltip's gravity to be away
     *        from that edge.
     * @param prefer (string, e.g. 'n', 'sw', 'w') - the direction to prefer
     *        if there are no viewable region edges effecting the tooltip's
     *        gravity. It will try to vary from this minimally, for example,
     *        if 'sw' is preferred and an element is near the right viewable
     *        region edge, but not the top edge, it will set the gravity for
     *        that element's tooltip to be 'se', preserving the southern
     *        component.
     */
    $.fn.tipsy.autoBounds = function (marginNorth, marginEast, prefer) {
        return function () {
            var dir = { ns: prefer[0], ew: prefer.length > 1 ? prefer[1] : false },
                boundTop = $(document).scrollTop() + marginNorth,
                boundLeft = $(document).scrollLeft() + marginEast,
                $this = $(this);

            if ($this.offset().top < boundTop) dir.ns = 'n';
            if ($this.offset().left < boundLeft) dir.ew = 'w';
            if ($(window).width() + $(document).scrollLeft() - $this.offset().left < marginEast) dir.ew = 'e';
            if ($(window).height() + $(document).scrollTop() - $this.offset().top < marginNorth) dir.ns = 's';

            return dir.ns + (dir.ew ? dir.ew : '');
        };
    };

    /**
     * Improved version of autoBounds for automatic placement of chunky tips
     * The original autoBounds failed in two regards: 1. it would never return a 'w' or 'e', gravity even if they
     * were preferred and/or optimal, 2. it only respected the margin between the left hand side of an element and
     * left hand side of the viewport, and the top of an element and the top of the viewport. This version checks
     * to see if the bottom of an element is too close to the bottom of the screen, similarly for the right hand side
     */
    $.fn.tipsy.autoBounds2 = function (margin, prefer) {
        return function () {
            var dir = {},
                boundTop = $(document).scrollTop() + margin,
                boundLeft = $(document).scrollLeft() + margin,
                $this = $(this);

            // bi-directional string (ne, se, sw, etc...)
            if (prefer.length > 1) {
                dir.ns = prefer[0];
                dir.ew = prefer[1];
            } else {
                // single direction string (e, w, n or s)
                if (prefer[0] == 'e' || prefer[0] == 'w') {
                    dir.ew = prefer[0];
                } else {
                    dir.ns = prefer[0];
                }
            }

            if ($this.offset().top < boundTop) dir.ns = 'n';
            if ($this.offset().left < boundLeft) dir.ew = 'w';
            if ($(window).width() + $(document).scrollLeft() - ($this.offset().left + $this.width()) < margin) dir.ew = 'e';
            if ($(window).height() + $(document).scrollTop() - ($this.offset().top + $this.height()) < margin) dir.ns = 's';

            if (dir.ns) {
                return dir.ns + (dir.ew ? dir.ew : '');
            }
            return dir.ew;
        };
    };
})(jQuery, window);
// released under the MIT license

},{}]},{},[595]);
